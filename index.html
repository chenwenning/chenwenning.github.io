<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta property="og:type" content="website">
<meta property="og:title" content="CHENWENNING BLOG">
<meta property="og:url" content="https://chenwenning.github.io/index.html">
<meta property="og:site_name" content="CHENWENNING BLOG">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="CHENWENNING BLOG">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://chenwenning.github.io/"/>





  <title>CHENWENNING BLOG</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">CHENWENNING BLOG</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-question-circle"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://chenwenning.github.io/2018/06/07/GIT-Study-Notes/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="陈汶宁">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://pic.qqtn.com/up/2017-10/2017101317054482087.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CHENWENNING BLOG">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/06/07/GIT-Study-Notes/" itemprop="url">GIT项目开发实践</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-06-07T18:30:16+08:00">
                2018-06-07
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/GIT/" itemprop="url" rel="index">
                    <span itemprop="name">GIT</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/06/07/GIT-Study-Notes/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2018/06/07/GIT-Study-Notes/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="一-GIT项目分支开发流程"><a href="#一-GIT项目分支开发流程" class="headerlink" title="一.GIT项目分支开发流程"></a>一.GIT项目分支开发流程</h3><h4 id="1-创建d-kaifa分支"><a href="#1-创建d-kaifa分支" class="headerlink" title="1. 创建d-kaifa分支"></a>1. 创建d-kaifa分支</h4><ul>
<li><code>git checkout master &amp;&amp; git pull</code></li>
<li><code>git checkout -b d-kaifa master</code></li>
<li><code>git reset release **/pom.xml</code></li>
<li><code>git checkout .</code></li>
<li><code>git commit -m 创建开发分支并修改内网版本</code></li>
</ul>
<h4 id="2-项目开发并合并到develop分支"><a href="#2-项目开发并合并到develop分支" class="headerlink" title="2. 项目开发并合并到develop分支"></a>2. 项目开发并合并到develop分支</h4><ul>
<li><code>git checkout develop &amp;&amp; git pull</code></li>
<li><code>git merge d-kaifa</code></li>
</ul>
<h4 id="3-项目提测并合并到test分支"><a href="#3-项目提测并合并到test分支" class="headerlink" title="3. 项目提测并合并到test分支"></a>3. 项目提测并合并到test分支</h4><ul>
<li><code>git checkout test &amp;&amp; git pull</code></li>
<li><code>git merge d-kaifa</code></li>
</ul>
<h4 id="4-项目验收并合并到release分支"><a href="#4-项目验收并合并到release分支" class="headerlink" title="4. 项目验收并合并到release分支"></a>4. 项目验收并合并到release分支</h4><ul>
<li><code>git checkout release &amp;&amp; git pull</code></li>
<li><code>git merge d-kaifa</code></li>
</ul>
<h4 id="5-项目上线并合并到master分支"><a href="#5-项目上线并合并到master分支" class="headerlink" title="5. 项目上线并合并到master分支"></a>5. 项目上线并合并到master分支</h4><ul>
<li><code>git checkout master &amp;&amp; git pull</code></li>
<li><code>git merge d-kaifa</code></li>
<li><code>git commit -m xxx功能</code></li>
<li><code>git tag vx.x.x-xxxxxxx</code></li>
<li><code>git push origin master</code></li>
<li><code>git push origin vx.x.x-xxxxxxx</code><ul>
<li>代码有问题继续改bug<ul>
<li><code>git checkout d-kaifa</code></li>
<li><code>git merge master</code></li>
<li>开发。。。</li>
<li>重复上线流程</li>
</ul>
</li>
<li>开发完成<ul>
<li><code>git branch -D d-kaifa</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<p>###二.GIT冲突实战</p>
<p>冲突场景：</p>
<p>####1.修改相同的项目<br>A先提交,B再提交，报以下错误：<br><img src="/2018/06/07/GIT-Study-Notes/push-conflict.png" alt="Alt text"></p>
<p>解决方法：</p>
<p>先   <code>git pull origin hexo</code></p>
<p>再   <code>git push origin hexo</code></p>
<h4 id="2-修改相同的文件，不改向同行"><a href="#2-修改相同的文件，不改向同行" class="headerlink" title="2.修改相同的文件，不改向同行"></a>2.修改相同的文件，不改向同行</h4><p>A先提交，B再提交，报以下错误：</p>
<p><img src="/2018/06/07/GIT-Study-Notes/push-conflict2.png" alt="Alt text"></p>
<p>解决方法：</p>
<p>先   <code>git pull origin hexo</code></p>
<p>再   <code>git push origin hexo</code></p>
<p>####3.修改相同的文件，改相同行<br>A先提交，B再提交，报以下错误：</p>
<p><img src="/2018/06/07/GIT-Study-Notes/push-conflict3.png" alt="Alt text"></p>
<p>解决方法：</p>
<p>先    <code>git pull origin hexo</code></p>
<p><img src="/2018/06/07/GIT-Study-Notes/push-conflict4.png" alt="Alt text"></p>
<p>再手动合并：</p>
<p><img src="/2018/06/07/GIT-Study-Notes/push-conflict5.png" alt="Alt text"></p>
<p>手动合并好后：</p>
<p>执行   <code>git add .</code></p>
<p>执行   <code>git commit -m &quot; 提交hexo&quot;</code></p>
<p>执行   <code>git push origin hexo</code></p>
<p>问题解决</p>
<p>####4.修改相同的文件，改相同行；A:先提交；B:把文件add到暂存区，但不commit; 这时B 进行pull</p>
<p>解决方法：</p>
<p>B先执行   <code>git commit -m &quot; 提交hexo&quot;</code></p>
<p>执行   <code>git pull origin hexo</code></p>
<p>###三.GIT 文件状态示意图</p>
<p><img src="/2018/06/07/GIT-Study-Notes/git-status.png" alt="Alt text"></p>
<p>1.暂存区：执行 git add 文件 后 该文件就到了暂存区</p>
<p>2.修改区：就是之前有这个文件 但是现在修改文件内容</p>
<p>3.未追踪区：就是刚刚添加  还没有执行 git add 操作</p>
<p><img src="/2018/06/07/GIT-Study-Notes/git-status2.png" alt="Alt text"></p>
<p>###四.GIT 命令小图</p>
<p><img src="/2018/06/07/GIT-Study-Notes/git-quantu.png" alt="Alt text"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://chenwenning.github.io/2018/06/07/后端架构师技术图谱/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="陈汶宁">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://pic.qqtn.com/up/2017-10/2017101317054482087.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CHENWENNING BLOG">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/06/07/后端架构师技术图谱/" itemprop="url">后端架构师技术图谱（转载）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-06-07T18:30:16+08:00">
                2018-06-07
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/资料/" itemprop="url" rel="index">
                    <span itemprop="name">资料</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/06/07/后端架构师技术图谱/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2018/06/07/后端架构师技术图谱/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1>《后端架构师技术图谱》</h1>

<p><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener"><img src="https://img.shields.io/badge/License-Creative%20Commons-DC3D24.svg" alt="知识共享协议（CC协议）"></a><br><a href="https://github.com/xingshaocheng/architect-awesome/stargazers" target="_blank" rel="noopener"><img src="https://img.shields.io/github/stars/xingshaocheng/architect-awesome.svg?style=flat&amp;label=Star" alt="GitHub stars"></a><br><a href="https://github.com/xingshaocheng/architect-awesome/fork" target="_blank" rel="noopener"><img src="https://img.shields.io/github/forks/xingshaocheng/architect-awesome.svg?style=flat&amp;label=Fork" alt="GitHub forks"></a><br><a href="https://github.com/xingshaocheng/architect-awesome/watchers" target="_blank" rel="noopener"><img src="https://img.shields.io/github/watchers/xingshaocheng/architect-awesome.svg?style=flat&amp;label=Watch" alt="GitHub watchers"></a></p>
<p><strong>更新于20180513</strong></p>
<ul>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#数据结构" target="_blank" rel="noopener">数据结构</a><ul>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#队列" target="_blank" rel="noopener">队列</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#集合" target="_blank" rel="noopener">集合</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#链表数组" target="_blank" rel="noopener">链表、数组</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#字典关联数组" target="_blank" rel="noopener">字典、关联数组</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#栈" target="_blank" rel="noopener">栈</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#树" target="_blank" rel="noopener">树</a><ul>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#二叉树" target="_blank" rel="noopener">二叉树</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#完全二叉树" target="_blank" rel="noopener">完全二叉树</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#平衡二叉树" target="_blank" rel="noopener">平衡二叉树</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#二叉查找树bst" target="_blank" rel="noopener">二叉查找树（BST）</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#红黑树" target="_blank" rel="noopener">红黑树</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#b-bb树" target="_blank" rel="noopener">B-，B+，B*树</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#lsm-树" target="_blank" rel="noopener">LSM 树</a></li>
</ul>
</li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#bitset" target="_blank" rel="noopener">BitSet</a></li>
</ul>
</li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#常用算法" target="_blank" rel="noopener">常用算法</a><ul>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#排序查找算法" target="_blank" rel="noopener">排序、查找算法</a><ul>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#选择排序" target="_blank" rel="noopener">选择排序</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#冒泡排序" target="_blank" rel="noopener">冒泡排序</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#插入排序" target="_blank" rel="noopener">插入排序</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#快速排序" target="_blank" rel="noopener">快速排序</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#归并排序" target="_blank" rel="noopener">归并排序</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#希尔排序" target="_blank" rel="noopener">希尔排序</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#堆排序" target="_blank" rel="noopener">堆排序</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#计数排序" target="_blank" rel="noopener">计数排序</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#桶排序" target="_blank" rel="noopener">桶排序</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#基数排序" target="_blank" rel="noopener">基数排序</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#二分查找" target="_blank" rel="noopener">二分查找</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#java-中的排序工具" target="_blank" rel="noopener">Java 中的排序工具</a></li>
</ul>
</li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#布隆过滤器" target="_blank" rel="noopener">布隆过滤器</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#字符串比较" target="_blank" rel="noopener">字符串比较</a><ul>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#kmp-算法" target="_blank" rel="noopener">KMP 算法</a></li>
</ul>
</li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#深度优先广度优先" target="_blank" rel="noopener">深度优先、广度优先</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#贪心算法" target="_blank" rel="noopener">贪心算法</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#回溯算法" target="_blank" rel="noopener">回溯算法</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#剪枝算法" target="_blank" rel="noopener">剪枝算法</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#动态规划" target="_blank" rel="noopener">动态规划</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#朴素贝叶斯" target="_blank" rel="noopener">朴素贝叶斯</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#推荐算法" target="_blank" rel="noopener">推荐算法</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#最小生成树算法" target="_blank" rel="noopener">最小生成树算法</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#最短路径算法" target="_blank" rel="noopener">最短路径算法</a></li>
</ul>
</li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#并发" target="_blank" rel="noopener">并发</a><ul>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#多线程" target="_blank" rel="noopener">多线程</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#线程安全" target="_blank" rel="noopener">线程安全</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#一致性事务" target="_blank" rel="noopener">一致性、事务</a><ul>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#事务-acid-特性" target="_blank" rel="noopener">事务 ACID 特性</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#事务的隔离级别" target="_blank" rel="noopener">事务的隔离级别</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#mvcc" target="_blank" rel="noopener">MVCC</a></li>
</ul>
</li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#锁" target="_blank" rel="noopener">锁</a><ul>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#java中的锁和同步类" target="_blank" rel="noopener">Java中的锁和同步类</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#公平锁--非公平锁" target="_blank" rel="noopener">公平锁 &amp; 非公平锁</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#悲观锁" target="_blank" rel="noopener">悲观锁</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#乐观锁--cas" target="_blank" rel="noopener">乐观锁 &amp; CAS</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#aba-问题" target="_blank" rel="noopener">ABA 问题</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#copyonwrite容器" target="_blank" rel="noopener">CopyOnWrite容器</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#ringbuffer" target="_blank" rel="noopener">RingBuffer</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#可重入锁--不可重入锁" target="_blank" rel="noopener">可重入锁 &amp; 不可重入锁</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#互斥锁--共享锁" target="_blank" rel="noopener">互斥锁 &amp; 共享锁</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#死锁" target="_blank" rel="noopener">死锁</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#操作系统" target="_blank" rel="noopener">操作系统</a><ul>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#计算机原理" target="_blank" rel="noopener">计算机原理</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#cpu" target="_blank" rel="noopener">CPU</a><ul>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#多级缓存" target="_blank" rel="noopener">多级缓存</a></li>
</ul>
</li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#进程" target="_blank" rel="noopener">进程</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#线程" target="_blank" rel="noopener">线程</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#协程" target="_blank" rel="noopener">协程</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#linux" target="_blank" rel="noopener">Linux</a></li>
</ul>
</li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#设计模式" target="_blank" rel="noopener">设计模式</a><ul>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#设计模式的六大原则" target="_blank" rel="noopener">设计模式的六大原则</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#23种常见设计模式" target="_blank" rel="noopener">23种常见设计模式</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#应用场景" target="_blank" rel="noopener">应用场景</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#单例模式" target="_blank" rel="noopener">单例模式</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#责任链模式" target="_blank" rel="noopener">责任链模式</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#mvc" target="_blank" rel="noopener">MVC</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#ioc" target="_blank" rel="noopener">IOC</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#aop" target="_blank" rel="noopener">AOP</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#uml" target="_blank" rel="noopener">UML</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#微服务思想" target="_blank" rel="noopener">微服务思想</a><ul>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#康威定律" target="_blank" rel="noopener">康威定律</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#运维--统计--技术支持" target="_blank" rel="noopener">运维 &amp; 统计 &amp; 技术支持</a><ul>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#常规监控" target="_blank" rel="noopener">常规监控</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#apm" target="_blank" rel="noopener">APM</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#统计分析" target="_blank" rel="noopener">统计分析</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#持续集成cicd" target="_blank" rel="noopener">持续集成(CI/CD)</a><ul>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#jenkins" target="_blank" rel="noopener">Jenkins</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#环境分离" target="_blank" rel="noopener">环境分离</a></li>
</ul>
</li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#自动化运维" target="_blank" rel="noopener">自动化运维</a><ul>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#ansible" target="_blank" rel="noopener">Ansible</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#puppet" target="_blank" rel="noopener">puppet</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#chef" target="_blank" rel="noopener">chef</a></li>
</ul>
</li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#测试" target="_blank" rel="noopener">测试</a><ul>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#tdd-理论" target="_blank" rel="noopener">TDD 理论</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#单元测试" target="_blank" rel="noopener">单元测试</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#压力测试" target="_blank" rel="noopener">压力测试</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#全链路压测" target="_blank" rel="noopener">全链路压测</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#ab-灰度蓝绿测试" target="_blank" rel="noopener">A/B 、灰度、蓝绿测试</a></li>
</ul>
</li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#虚拟化" target="_blank" rel="noopener">虚拟化</a><ul>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#kvm" target="_blank" rel="noopener">KVM</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#xen" target="_blank" rel="noopener">Xen</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#openvz" target="_blank" rel="noopener">OpenVZ</a></li>
</ul>
</li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#容器技术" target="_blank" rel="noopener">容器技术</a><ul>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#docker" target="_blank" rel="noopener">Docker</a></li>
</ul>
</li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#云技术" target="_blank" rel="noopener">云技术</a><ul>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#openstack" target="_blank" rel="noopener">OpenStack</a></li>
</ul>
</li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#devops" target="_blank" rel="noopener">DevOps</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#文档管理" target="_blank" rel="noopener">文档管理</a></li>
</ul>
</li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#中间件" target="_blank" rel="noopener">中间件</a><ul>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#web-server" target="_blank" rel="noopener">Web Server</a><ul>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#nginx" target="_blank" rel="noopener">Nginx</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#openresty" target="_blank" rel="noopener">OpenResty</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#apache-httpd" target="_blank" rel="noopener">Apache Httpd</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#tomcat" target="_blank" rel="noopener">Tomcat</a><ul>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#架构原理" target="_blank" rel="noopener">架构原理</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#调优方案" target="_blank" rel="noopener">调优方案</a></li>
</ul>
</li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#jetty" target="_blank" rel="noopener">Jetty</a></li>
</ul>
</li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#缓存" target="_blank" rel="noopener">缓存</a><ul>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#本地缓存" target="_blank" rel="noopener">本地缓存</a></li>
</ul>
</li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#客户端缓存" target="_blank" rel="noopener">客户端缓存</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#服务端缓存" target="_blank" rel="noopener">服务端缓存</a><ul>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#web缓存" target="_blank" rel="noopener">Web缓存</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#memcached" target="_blank" rel="noopener">Memcached</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#redis" target="_blank" rel="noopener">Redis</a><ul>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#架构" target="_blank" rel="noopener">架构</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#回收策略" target="_blank" rel="noopener">回收策略</a></li>
</ul>
</li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#tair" target="_blank" rel="noopener">Tair</a></li>
</ul>
</li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#消息队列" target="_blank" rel="noopener">消息队列</a><ul>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#消息总线" target="_blank" rel="noopener">消息总线</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#消息的顺序" target="_blank" rel="noopener">消息的顺序</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#rabbitmq" target="_blank" rel="noopener">RabbitMQ</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#rocketmq" target="_blank" rel="noopener">RocketMQ</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#activemq" target="_blank" rel="noopener">ActiveMQ</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#kafka" target="_blank" rel="noopener">Kafka</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#redis-消息推送" target="_blank" rel="noopener">Redis 消息推送</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#zeromq" target="_blank" rel="noopener">ZeroMQ</a></li>
</ul>
</li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#定时调度" target="_blank" rel="noopener">定时调度</a><ul>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#单机定时调度" target="_blank" rel="noopener">单机定时调度</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#分布式定时调度" target="_blank" rel="noopener">分布式定时调度</a></li>
</ul>
</li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#rpc" target="_blank" rel="noopener">RPC</a><ul>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#dubbo" target="_blank" rel="noopener">Dubbo</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#thrift" target="_blank" rel="noopener">Thrift</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#grpc" target="_blank" rel="noopener">gRPC</a></li>
</ul>
</li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#数据库中间件" target="_blank" rel="noopener">数据库中间件</a><ul>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#sharding-jdbc" target="_blank" rel="noopener">Sharding Jdbc</a></li>
</ul>
</li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#日志系统" target="_blank" rel="noopener">日志系统</a><ul>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#日志搜集" target="_blank" rel="noopener">日志搜集</a></li>
</ul>
</li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#配置中心" target="_blank" rel="noopener">配置中心</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#api-网关" target="_blank" rel="noopener">API 网关</a></li>
</ul>
</li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#网络" target="_blank" rel="noopener">网络</a><ul>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#协议" target="_blank" rel="noopener">协议</a><ul>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#osi-七层协议" target="_blank" rel="noopener">OSI 七层协议</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#tcpip" target="_blank" rel="noopener">TCP/IP</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#http" target="_blank" rel="noopener">HTTP</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#http20" target="_blank" rel="noopener">HTTP2.0</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#https" target="_blank" rel="noopener">HTTPS</a></li>
</ul>
</li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#网络模型" target="_blank" rel="noopener">网络模型</a><ul>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#epoll" target="_blank" rel="noopener">Epoll</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#java-nio" target="_blank" rel="noopener">Java NIO</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#kqueue" target="_blank" rel="noopener">kqueue</a></li>
</ul>
</li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#连接和短连接" target="_blank" rel="noopener">连接和短连接</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#框架" target="_blank" rel="noopener">框架</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#零拷贝zero-copy" target="_blank" rel="noopener">零拷贝（Zero-copy）</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#序列化二进制协议" target="_blank" rel="noopener">序列化(二进制协议)</a><ul>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#hessian" target="_blank" rel="noopener">Hessian</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#protobuf" target="_blank" rel="noopener">Protobuf</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#数据库" target="_blank" rel="noopener">数据库</a><ul>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#基础理论" target="_blank" rel="noopener">基础理论</a><ul>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#数据库设计的三大范式" target="_blank" rel="noopener">数据库设计的三大范式</a></li>
</ul>
</li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#mysql" target="_blank" rel="noopener">MySQL</a><ul>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#原理" target="_blank" rel="noopener">原理</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#innodb" target="_blank" rel="noopener">InnoDB</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#优化" target="_blank" rel="noopener">优化</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#索引" target="_blank" rel="noopener">索引</a><ul>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#聚集索引-非聚集索引" target="_blank" rel="noopener">聚集索引, 非聚集索引</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#复合索引" target="_blank" rel="noopener">复合索引</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#自适应哈希索引ahi" target="_blank" rel="noopener">自适应哈希索引(AHI)</a></li>
</ul>
</li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#explain" target="_blank" rel="noopener">explain</a></li>
</ul>
</li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#nosql" target="_blank" rel="noopener">NoSQL</a><ul>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#mongodb" target="_blank" rel="noopener">MongoDB</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#hbase" target="_blank" rel="noopener">Hbase</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#搜索引擎" target="_blank" rel="noopener">搜索引擎</a><ul>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#搜索引擎原理" target="_blank" rel="noopener">搜索引擎原理</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#lucene" target="_blank" rel="noopener">Lucene</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#elasticsearch" target="_blank" rel="noopener">Elasticsearch</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#solr" target="_blank" rel="noopener">Solr</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#sphinx" target="_blank" rel="noopener">sphinx</a></li>
</ul>
</li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#性能" target="_blank" rel="noopener">性能</a><ul>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#性能优化方法论" target="_blank" rel="noopener">性能优化方法论</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#容量评估" target="_blank" rel="noopener">容量评估</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#cdn-网络" target="_blank" rel="noopener">CDN 网络</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#连接池" target="_blank" rel="noopener">连接池</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#性能调优" target="_blank" rel="noopener">性能调优</a></li>
</ul>
</li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#大数据" target="_blank" rel="noopener">大数据</a><ul>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#流式计算" target="_blank" rel="noopener">流式计算</a><ul>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#storm" target="_blank" rel="noopener">Storm</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#flink" target="_blank" rel="noopener">Flink</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#kafka-stream" target="_blank" rel="noopener">Kafka Stream</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#应用场景-1" target="_blank" rel="noopener">应用场景</a></li>
</ul>
</li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#hadoop" target="_blank" rel="noopener">Hadoop</a><ul>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#hdfs" target="_blank" rel="noopener">HDFS</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#mapreduce" target="_blank" rel="noopener">MapReduce</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#yarn" target="_blank" rel="noopener">Yarn</a></li>
</ul>
</li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#spark" target="_blank" rel="noopener">Spark</a></li>
</ul>
</li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#安全" target="_blank" rel="noopener">安全</a><ul>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#web-安全" target="_blank" rel="noopener">web 安全</a><ul>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#xss" target="_blank" rel="noopener">XSS</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#csrf" target="_blank" rel="noopener">CSRF</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#sql-注入" target="_blank" rel="noopener">SQL 注入</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#hash-dos" target="_blank" rel="noopener">Hash Dos</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#脚本注入" target="_blank" rel="noopener">脚本注入</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#漏洞扫描工具" target="_blank" rel="noopener">漏洞扫描工具</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#验证码" target="_blank" rel="noopener">验证码</a></li>
</ul>
</li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#ddos-防范" target="_blank" rel="noopener">DDoS 防范</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#用户隐私信息保护" target="_blank" rel="noopener">用户隐私信息保护</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#序列化漏洞" target="_blank" rel="noopener">序列化漏洞</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#加密解密" target="_blank" rel="noopener">加密解密</a><ul>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#对称加密" target="_blank" rel="noopener">对称加密</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#哈希算法" target="_blank" rel="noopener">哈希算法</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#非对称加密" target="_blank" rel="noopener">非对称加密</a></li>
</ul>
</li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#服务器安全" target="_blank" rel="noopener">服务器安全</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#数据安全" target="_blank" rel="noopener">数据安全</a><ul>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#数据备份" target="_blank" rel="noopener">数据备份</a></li>
</ul>
</li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#网络隔离" target="_blank" rel="noopener">网络隔离</a><ul>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#内外网分离" target="_blank" rel="noopener">内外网分离</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#登录跳板机" target="_blank" rel="noopener">登录跳板机</a></li>
</ul>
</li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#授权认证" target="_blank" rel="noopener">授权、认证</a><ul>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#rbac" target="_blank" rel="noopener">RBAC</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#oauth20" target="_blank" rel="noopener">OAuth2.0</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#双因素认证2fa" target="_blank" rel="noopener">双因素认证（2FA）</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#单点登录sso" target="_blank" rel="noopener">单点登录(SSO)</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#常用开源框架" target="_blank" rel="noopener">常用开源框架</a><ul>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#开源协议" target="_blank" rel="noopener">开源协议</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#日志框架" target="_blank" rel="noopener">日志框架</a><ul>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#log4jlog4j2" target="_blank" rel="noopener">Log4j、Log4j2</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#logback" target="_blank" rel="noopener">Logback</a></li>
</ul>
</li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#orm" target="_blank" rel="noopener">ORM</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#网络框架" target="_blank" rel="noopener">网络框架</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#web-框架" target="_blank" rel="noopener">Web 框架</a><ul>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#spring-家族" target="_blank" rel="noopener">Spring 家族</a></li>
</ul>
</li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#工具框架" target="_blank" rel="noopener">工具框架</a></li>
</ul>
</li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#分布式设计" target="_blank" rel="noopener">分布式设计</a><ul>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#扩展性设计" target="_blank" rel="noopener">扩展性设计</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#稳定性--高可用" target="_blank" rel="noopener">稳定性 &amp; 高可用</a><ul>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#硬件负载均衡" target="_blank" rel="noopener">硬件负载均衡</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#软件负载均衡" target="_blank" rel="noopener">软件负载均衡</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#限流" target="_blank" rel="noopener">限流</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#应用层容灾" target="_blank" rel="noopener">应用层容灾</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#跨机房容灾" target="_blank" rel="noopener">跨机房容灾</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#容灾演练流程" target="_blank" rel="noopener">容灾演练流程</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#平滑启动" target="_blank" rel="noopener">平滑启动</a></li>
</ul>
</li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#数据库扩展" target="_blank" rel="noopener">数据库扩展</a><ul>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#读写分离模式" target="_blank" rel="noopener">读写分离模式</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#分片模式" target="_blank" rel="noopener">分片模式</a></li>
</ul>
</li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#服务治理" target="_blank" rel="noopener">服务治理</a><ul>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#服务注册与发现" target="_blank" rel="noopener">服务注册与发现</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#服务路由控制" target="_blank" rel="noopener">服务路由控制</a></li>
</ul>
</li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#分布式一致" target="_blank" rel="noopener">分布式一致</a><ul>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#cap-与-base-理论" target="_blank" rel="noopener">CAP 与 BASE 理论</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#分布式锁" target="_blank" rel="noopener">分布式锁</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#分布式一致性算法" target="_blank" rel="noopener">分布式一致性算法</a><ul>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#paxos" target="_blank" rel="noopener">PAXOS</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#zab" target="_blank" rel="noopener">Zab</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#raft" target="_blank" rel="noopener">Raft</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#gossip" target="_blank" rel="noopener">Gossip</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#两阶段提交多阶段提交" target="_blank" rel="noopener">两阶段提交、多阶段提交</a></li>
</ul>
</li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#幂等" target="_blank" rel="noopener">幂等</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#分布式一致方案" target="_blank" rel="noopener">分布式一致方案</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#分布式-leader-节点选举" target="_blank" rel="noopener">分布式 Leader 节点选举</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#tcctryconfirmcancel-柔性事务" target="_blank" rel="noopener">TCC(Try/Confirm/Cancel) 柔性事务</a></li>
</ul>
</li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#分布式文件系统" target="_blank" rel="noopener">分布式文件系统</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#唯一id-生成" target="_blank" rel="noopener">唯一ID 生成</a><ul>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#全局唯一id" target="_blank" rel="noopener">全局唯一ID</a></li>
</ul>
</li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#一致性hash算法" target="_blank" rel="noopener">一致性Hash算法</a></li>
</ul>
</li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#设计思想--开发模式" target="_blank" rel="noopener">设计思想 &amp; 开发模式</a><ul>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#ddddomain-driven-design---领域驱动设计" target="_blank" rel="noopener">DDD(Domain-driven Design - 领域驱动设计)</a><ul>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#命令查询职责分离cqrs" target="_blank" rel="noopener">命令查询职责分离(CQRS)</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#贫血充血模型" target="_blank" rel="noopener">贫血，充血模型</a></li>
</ul>
</li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#actor-模式" target="_blank" rel="noopener">Actor 模式</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#响应式编程" target="_blank" rel="noopener">响应式编程</a><ul>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#reactor" target="_blank" rel="noopener">Reactor</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#rxjava" target="_blank" rel="noopener">RxJava</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#vertx" target="_blank" rel="noopener">Vert.x</a></li>
</ul>
</li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#dodaf20" target="_blank" rel="noopener">DODAF2.0</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#serverless" target="_blank" rel="noopener">Serverless</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#service-mesh" target="_blank" rel="noopener">Service Mesh</a></li>
</ul>
</li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#项目管理" target="_blank" rel="noopener">项目管理</a><ul>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#架构评审" target="_blank" rel="noopener">架构评审</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#重构" target="_blank" rel="noopener">重构</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#代码规范" target="_blank" rel="noopener">代码规范</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#代码-review" target="_blank" rel="noopener">代码 Review</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#rup" target="_blank" rel="noopener">RUP</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#看板管理" target="_blank" rel="noopener">看板管理</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#scrum" target="_blank" rel="noopener">SCRUM</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#敏捷开发" target="_blank" rel="noopener">敏捷开发</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#极限编程xp" target="_blank" rel="noopener">极限编程（XP）</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#结对编程" target="_blank" rel="noopener">结对编程</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#fmea管理模式" target="_blank" rel="noopener">FMEA管理模式</a></li>
</ul>
</li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#通用业务术语" target="_blank" rel="noopener">通用业务术语</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#技术趋势" target="_blank" rel="noopener">技术趋势</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#政策法规" target="_blank" rel="noopener">政策、法规</a><ul>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#法律" target="_blank" rel="noopener">法律</a><ul>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#严格遵守刑法253法条" target="_blank" rel="noopener">严格遵守刑法253法条</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#架构师素质" target="_blank" rel="noopener">架构师素质</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#团队管理" target="_blank" rel="noopener">团队管理</a><ul>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#招聘" target="_blank" rel="noopener">招聘</a></li>
</ul>
</li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#资讯" target="_blank" rel="noopener">资讯</a><ul>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#行业资讯" target="_blank" rel="noopener">行业资讯</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#公众号列表" target="_blank" rel="noopener">公众号列表</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#博客" target="_blank" rel="noopener">博客</a><ul>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#团队博客" target="_blank" rel="noopener">团队博客</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#个人博客" target="_blank" rel="noopener">个人博客</a></li>
</ul>
</li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#综合门户社区" target="_blank" rel="noopener">综合门户、社区</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#问答讨论类社区" target="_blank" rel="noopener">问答、讨论类社区</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#行业数据分析" target="_blank" rel="noopener">行业数据分析</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#专项网站" target="_blank" rel="noopener">专项网站</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#其他类" target="_blank" rel="noopener">其他类</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#推荐参考书" target="_blank" rel="noopener">推荐参考书</a><ul>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#在线电子书" target="_blank" rel="noopener">在线电子书</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#纸质书" target="_blank" rel="noopener">纸质书</a><ul>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#开发方面" target="_blank" rel="noopener">开发方面</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#架构方面" target="_blank" rel="noopener">架构方面</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#技术管理方面" target="_blank" rel="noopener">技术管理方面</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#基础理论-1" target="_blank" rel="noopener">基础理论</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#工具方面" target="_blank" rel="noopener">工具方面</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#大数据方面" target="_blank" rel="noopener">大数据方面</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#技术资源" target="_blank" rel="noopener">技术资源</a><ul>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#开源资源" target="_blank" rel="noopener">开源资源</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#手册文档教程" target="_blank" rel="noopener">手册、文档、教程</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#在线课堂" target="_blank" rel="noopener">在线课堂</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#会议活动" target="_blank" rel="noopener">会议、活动</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#常用app" target="_blank" rel="noopener">常用APP</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#找工作" target="_blank" rel="noopener">找工作</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#工具" target="_blank" rel="noopener">工具</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#代码托管" target="_blank" rel="noopener">代码托管</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#文件服务" target="_blank" rel="noopener">文件服务</a></li>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#综合云服务商" target="_blank" rel="noopener">综合云服务商</a><ul>
<li><a href="https://github.com/xingshaocheng/architect-awesome/blob/master/README.md#vps" target="_blank" rel="noopener">VPS</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>（Toc generated by <a href="https://github.com/xingshaocheng/simple-php-github-toc" target="_blank" rel="noopener">simple-php-github-toc</a> ）</strong></p>
<h1 id="数据结构"><a href="#数据结构" class="headerlink" title="数据结构"></a>数据结构</h1><h2 id="队列"><a href="#队列" class="headerlink" title="队列"></a>队列</h2><ul>
<li><p><a href="https://www.cnblogs.com/lemon-flm/p/7877898.html" target="_blank" rel="noopener">《java队列——queue详细分析》</a></p>
<ul>
<li>非阻塞队列：ConcurrentLinkedQueue(无界线程安全)，采用CAS机制（compareAndSwapObject原子操作）。</li>
<li>阻塞队列：ArrayBlockingQueue(有界)、LinkedBlockingQueue（无界）、DelayQueue、PriorityBlockingQueue，采用锁机制；使用 ReentrantLock 锁。</li>
</ul>
</li>
<li><p><a href="https://www.cnblogs.com/mantu/p/5802393.html" target="_blank" rel="noopener">《LinkedList、ConcurrentLinkedQueue、LinkedBlockingQueue对比分析》</a></p>
</li>
</ul>
<h2 id="集合"><a href="#集合" class="headerlink" title="集合"></a>集合</h2><ul>
<li><a href="https://blog.csdn.net/qq_33642117/article/details/52040345" target="_blank" rel="noopener">《Java Set集合的详解》</a></li>
</ul>
<h2 id="链表、数组"><a href="#链表、数组" class="headerlink" title="链表、数组"></a>链表、数组</h2><ul>
<li><a href="https://blog.csdn.net/wz249863091/article/details/52853360" target="_blank" rel="noopener">《Java集合详解–什么是List》</a></li>
</ul>
<h2 id="字典、关联数组"><a href="#字典、关联数组" class="headerlink" title="字典、关联数组"></a>字典、关联数组</h2><ul>
<li><a href="https://baike.xsoftlab.net/view/250.html" target="_blank" rel="noopener">《Java map 详解 - 用法、遍历、排序、常用API等》</a></li>
</ul>
<h2 id="栈"><a href="#栈" class="headerlink" title="栈"></a>栈</h2><ul>
<li><a href="https://blog.csdn.net/javazejian/article/details/53362993" target="_blank" rel="noopener">《java数据结构与算法之栈（Stack）设计与实现》</a></li>
<li><a href="http://www.runoob.com/java/java-stack-class.html" target="_blank" rel="noopener">《Java Stack 类》</a></li>
<li><a href="https://blog.csdn.net/f2006116/article/details/51375225" target="_blank" rel="noopener">《java stack的详细实现分析》</a><ul>
<li>Stack 是线程安全的。</li>
<li>内部使用数组保存数据，不够时翻倍。</li>
</ul>
</li>
</ul>
<h2 id="树"><a href="#树" class="headerlink" title="树"></a>树</h2><h3 id="二叉树"><a href="#二叉树" class="headerlink" title="二叉树"></a>二叉树</h3><p>每个节点最多有两个叶子节点。</p>
<ul>
<li><a href="https://blog.csdn.net/cai2016/article/details/52589952" target="_blank" rel="noopener">《二叉树》</a></li>
</ul>
<h3 id="完全二叉树"><a href="#完全二叉树" class="headerlink" title="完全二叉树"></a>完全二叉树</h3><ul>
<li><a href="https://baike.baidu.com/item/%E5%AE%8C%E5%85%A8%E4%BA%8C%E5%8F%89%E6%A0%91/7773232?fr=aladdin" target="_blank" rel="noopener">《完全二叉树》</a><ul>
<li>叶节点只能出现在最下层和次下层，并且最下面一层的结点都集中在该层最左边的若干位置的二叉树。</li>
</ul>
</li>
</ul>
<h3 id="平衡二叉树"><a href="#平衡二叉树" class="headerlink" title="平衡二叉树"></a>平衡二叉树</h3><p>左右两个子树的高度差的绝对值不超过1，并且左右两个子树都是一棵平衡二叉树。</p>
<ul>
<li><a href="http://www.cnblogs.com/polly333/p/4798944.html" target="_blank" rel="noopener">《浅谈数据结构-平衡二叉树》</a></li>
<li><a href="http://www.cnblogs.com/yangecnu/p/Introduce-2-3-Search-Tree.html" target="_blank" rel="noopener">《浅谈算法和数据结构: 八 平衡查找树之2-3树》</a></li>
</ul>
<h3 id="二叉查找树（BST）"><a href="#二叉查找树（BST）" class="headerlink" title="二叉查找树（BST）"></a>二叉查找树（BST）</h3><p>二叉查找树（Binary Search Tree），也称有序二叉树（ordered binary tree）,排序二叉树（sorted binary tree）。</p>
<ul>
<li><a href="http://www.cnblogs.com/yangecnu/p/Introduce-Binary-Search-Tree.html" target="_blank" rel="noopener">《浅谈算法和数据结构: 七 二叉查找树》</a></li>
</ul>
<h3 id="红黑树"><a href="#红黑树" class="headerlink" title="红黑树"></a>红黑树</h3><ul>
<li><a href="https://blog.csdn.net/sun_tttt/article/details/65445754" target="_blank" rel="noopener">《最容易懂得红黑树》</a><ul>
<li>添加阶段后，左旋或者右旋从而再次达到平衡。 </li>
</ul>
</li>
<li><a href="http://www.cnblogs.com/yangecnu/p/Introduce-Red-Black-Tree.html" target="_blank" rel="noopener">《浅谈算法和数据结构: 九 平衡查找树之红黑树》</a></li>
</ul>
<h3 id="B-，B-，B-树"><a href="#B-，B-，B-树" class="headerlink" title="B-，B+，B*树"></a>B-，B+，B*树</h3><p>MySQL是基于B+树聚集索引组织表</p>
<ul>
<li><a href="https://blog.csdn.net/aqzwss/article/details/53074186" target="_blank" rel="noopener">《B-树，B+树，B*树详解》</a></li>
<li><a href="https://blog.csdn.net/bigtree_3721/article/details/73632405" target="_blank" rel="noopener">《B-树，B+树与B*树的优缺点比较》</a><ul>
<li>B+ 树的叶子节点链表结构相比于 B- 树便于扫库，和范围检索。<h3 id="LSM-树"><a href="#LSM-树" class="headerlink" title="LSM 树"></a>LSM 树</h3></li>
</ul>
</li>
</ul>
<p>LSM（Log-Structured Merge-Trees）和 B+ 树相比，是牺牲了部分读的性能来换取写的性能(通过批量写入)，实现读写之间的。<br>Hbase、LevelDB、Tair（Long DB）、nessDB 采用 LSM 树的结构。LSM可以快速建立索引。</p>
<ul>
<li><p><a href="https://blog.csdn.net/dbanote/article/details/8897599" target="_blank" rel="noopener">《LSM树 VS B+树》</a></p>
<ul>
<li>B+ 树读性能好，但由于需要有序结构，当key比较分散时，磁盘寻道频繁，造成写性能。</li>
<li>LSM 是将一个大树拆分成N棵小树，先写到内存（无寻道问题，性能高），在内存中构建一颗有序小树（有序树），随着小树越来越大，内存的小树会flush到磁盘上。当读时，由于不知道数据在哪棵小树上，因此必须遍历（二分查找）所有的小树，但在每颗小树内部数据是有序的。</li>
</ul>
</li>
<li><p><a href="https://blog.csdn.net/u014774781/article/details/52105708" target="_blank" rel="noopener">《LSM树（Log-Structured Merge Tree）存储引擎》</a></p>
<ul>
<li>极端的说，基于LSM树实现的HBase的写性能比MySQL高了一个数量级，读性能低了一个数量级。</li>
<li>优化方式：Bloom filter 替代二分查找；compact 小数位大树，提高查询性能。</li>
<li>Hbase 中，内存中达到一定阈值后，整体flush到磁盘上、形成一个文件（B+数），HDFS不支持update操作，所以Hbase做整体flush而不是merge update。flush到磁盘上的小树，定期会合并成一个大树。</li>
</ul>
</li>
</ul>
<h2 id="BitSet"><a href="#BitSet" class="headerlink" title="BitSet"></a>BitSet</h2><p>经常用于大规模数据的排重检查。</p>
<ul>
<li><a href="http://www.runoob.com/java/java-bitset-class.html" target="_blank" rel="noopener">《Java Bitset类》</a></li>
<li><a href="https://blog.csdn.net/caiandyong/article/details/51581160" target="_blank" rel="noopener">《Java BitSet（位集）》</a></li>
</ul>
<h1 id="常用算法"><a href="#常用算法" class="headerlink" title="常用算法"></a>常用算法</h1><ul>
<li><a href="https://blog.csdn.net/gane_cheng/article/details/52652705" target="_blank" rel="noopener">《常见排序算法及对应的时间复杂度和空间复杂度》</a></li>
</ul>
<h2 id="排序、查找算法"><a href="#排序、查找算法" class="headerlink" title="排序、查找算法"></a>排序、查找算法</h2><ul>
<li><a href="https://blog.csdn.net/gane_cheng/article/details/52652705" target="_blank" rel="noopener">《常见排序算法及对应的时间复杂度和空间复杂度》</a></li>
</ul>
<h3 id="选择排序"><a href="#选择排序" class="headerlink" title="选择排序"></a>选择排序</h3><ul>
<li><a href="https://www.cnblogs.com/shen-hua/p/5424059.html" target="_blank" rel="noopener">《Java中的经典算法之选择排序（SelectionSort）》</a><ul>
<li>每一趟从待排序的记录中选出最小的元素，顺序放在已排好序的序列最后，直到全部记录排序完毕。</li>
</ul>
</li>
</ul>
<h3 id="冒泡排序"><a href="#冒泡排序" class="headerlink" title="冒泡排序"></a>冒泡排序</h3><ul>
<li><a href="https://blog.csdn.net/shuaizai88/article/details/73250615" target="_blank" rel="noopener">《冒泡排序的2种写法》</a><ul>
<li>相邻元素前后交换、把最大的排到最后。</li>
<li>时间复杂度 O(n²) </li>
</ul>
</li>
</ul>
<h3 id="插入排序"><a href="#插入排序" class="headerlink" title="插入排序"></a>插入排序</h3><ul>
<li><a href="https://www.cnblogs.com/hapjin/p/5517667.html" target="_blank" rel="noopener">《排序算法总结之插入排序》</a></li>
</ul>
<h3 id="快速排序"><a href="#快速排序" class="headerlink" title="快速排序"></a>快速排序</h3><ul>
<li><a href="http://developer.51cto.com/art/201403/430986.htm" target="_blank" rel="noopener">《坐在马桶上看算法：快速排序》</a><ul>
<li>一侧比另外一次都大或小。 <h3 id="归并排序"><a href="#归并排序" class="headerlink" title="归并排序"></a>归并排序</h3></li>
</ul>
</li>
<li><a href="http://www.cnblogs.com/chengxiao/p/6194356.html" target="_blank" rel="noopener">《图解排序算法(四)之归并排序》</a><ul>
<li>分而治之，分成小份排序，在合并(重建一个新空间进行复制)。 </li>
</ul>
</li>
</ul>
<h3 id="希尔排序"><a href="#希尔排序" class="headerlink" title="希尔排序"></a>希尔排序</h3><p>TODO</p>
<h3 id="堆排序"><a href="#堆排序" class="headerlink" title="堆排序"></a>堆排序</h3><ul>
<li><a href="https://www.cnblogs.com/chengxiao/p/6129630.html" target="_blank" rel="noopener">《图解排序算法(三)之堆排序》</a><ul>
<li>排序过程就是构建最大堆的过程，最大堆：每个结点的值都大于或等于其左右孩子结点的值，堆顶元素是最大值。</li>
</ul>
</li>
</ul>
<h3 id="计数排序"><a href="#计数排序" class="headerlink" title="计数排序"></a>计数排序</h3><ul>
<li><a href="https://www.cnblogs.com/suvllian/p/5495780.html" target="_blank" rel="noopener">《计数排序和桶排序》</a><ul>
<li>和桶排序过程比较像，差别在于桶的数量。</li>
</ul>
</li>
</ul>
<h3 id="桶排序"><a href="#桶排序" class="headerlink" title="桶排序"></a>桶排序</h3><ul>
<li><a href="http://blog.51cto.com/ahalei/1362789" target="_blank" rel="noopener">《【啊哈！算法】最快最简单的排序——桶排序》</a></li>
<li><a href="https://blog.csdn.net/sunjinshengli/article/details/70738527" target="_blank" rel="noopener">《排序算法（三）：计数排序与桶排序》</a><ul>
<li>桶排序将[0,1)区间划分为n个相同的大小的子区间，这些子区间被称为桶。</li>
<li>每个桶单独进行排序，然后再遍历每个桶。</li>
</ul>
</li>
</ul>
<h3 id="基数排序"><a href="#基数排序" class="headerlink" title="基数排序"></a>基数排序</h3><p>按照个位、十位、百位、…依次来排。</p>
<ul>
<li><a href="https://blog.csdn.net/lemon_tree12138/article/details/51695211" target="_blank" rel="noopener">《排序算法系列：基数排序》</a></li>
<li><a href="https://www.cnblogs.com/skywang12345/p/3603669.html" target="_blank" rel="noopener">《基数排序》</a></li>
</ul>
<h3 id="二分查找"><a href="#二分查找" class="headerlink" title="二分查找"></a>二分查找</h3><ul>
<li><p><a href="https://www.cnblogs.com/coderising/p/5708632.html" target="_blank" rel="noopener">《二分查找(java实现)》</a></p>
<ul>
<li>要求待查找的序列有序。</li>
<li>时间复杂度 O(logN)。</li>
</ul>
</li>
<li><p><a href="https://blog.csdn.net/maoyuanming0806/article/details/78176957" target="_blank" rel="noopener">《java实现二分查找-两种方式》</a></p>
<ul>
<li>while + 递归。<h3 id="Java-中的排序工具"><a href="#Java-中的排序工具" class="headerlink" title="Java 中的排序工具"></a>Java 中的排序工具</h3></li>
</ul>
</li>
<li><a href="https://blog.csdn.net/u011410529/article/details/56668545?locationnum=6&amp;fps=1" target="_blank" rel="noopener">《Arrays.sort和Collections.sort实现原理解析》</a><ul>
<li>Collections.sort算法调用的是合并排序。</li>
<li>Arrays.sort() 采用了2种排序算法 – 基本类型数据使用快速排序法，对象数组使用归并排序。</li>
</ul>
</li>
</ul>
<h2 id="布隆过滤器"><a href="#布隆过滤器" class="headerlink" title="布隆过滤器"></a>布隆过滤器</h2><p>常用于大数据的排重，比如email，url 等。<br>核心原理：将每条数据通过计算产生一个指纹（一个字节或多个字节，但一定比原始数据要少很多），其中每一位都是通过随机计算获得，在将指纹映射到一个大的按位存储的空间中。注意：会有一定的错误率。<br>优点：空间和时间效率都很高。<br>缺点：随着存入的元素数量增加，误算率随之增加。</p>
<ul>
<li><a href="https://segmentfault.com/a/1190000002729689" target="_blank" rel="noopener">《布隆过滤器 – 空间效率很高的数据结构》</a></li>
<li><a href="https://blog.csdn.net/zdxiq000/article/details/57626464" target="_blank" rel="noopener">《大量数据去重：Bitmap和布隆过滤器(Bloom Filter)》</a></li>
<li><a href="https://blog.csdn.net/qq_30242609/article/details/71024458" target="_blank" rel="noopener">《基于Redis的布隆过滤器的实现》</a><ul>
<li>基于 Redis 的 Bitmap 数据结构。</li>
</ul>
</li>
<li><a href="https://blog.csdn.net/lemon_tree12138/article/details/47973715" target="_blank" rel="noopener">《网络爬虫：URL去重策略之布隆过滤器(BloomFilter)的使用》</a><ul>
<li>使用Java中的 BitSet 类 和 加权和hash算法。</li>
</ul>
</li>
</ul>
<h2 id="字符串比较"><a href="#字符串比较" class="headerlink" title="字符串比较"></a>字符串比较</h2><h3 id="KMP-算法"><a href="#KMP-算法" class="headerlink" title="KMP 算法"></a>KMP 算法</h3><p>KMP：Knuth-Morris-Pratt算法（简称KMP）<br>核心原理是利用一个“部分匹配表”，跳过已经匹配过的元素。</p>
<ul>
<li><a href="http://www.ruanyifeng.com/blog/2013/05/Knuth%E2%80%93Morris%E2%80%93Pratt_algorithm.html" target="_blank" rel="noopener">《字符串匹配的KMP算法》</a></li>
</ul>
<h2 id="深度优先、广度优先"><a href="#深度优先、广度优先" class="headerlink" title="深度优先、广度优先"></a>深度优先、广度优先</h2><ul>
<li><a href="https://www.cnblogs.com/0kk470/p/7555033.html" target="_blank" rel="noopener">《广度优先搜索BFS和深度优先搜索DFS》</a></li>
</ul>
<h2 id="贪心算法"><a href="#贪心算法" class="headerlink" title="贪心算法"></a>贪心算法</h2><ul>
<li><a href="https://www.cnblogs.com/MrSaver/p/8641971.html" target="_blank" rel="noopener">《算法：贪婪算法基础》</a></li>
<li><a href="https://blog.csdn.net/a345017062/article/details/52443781" target="_blank" rel="noopener">《常见算法及问题场景——贪心算法》</a></li>
</ul>
<h2 id="回溯算法"><a href="#回溯算法" class="headerlink" title="回溯算法"></a>回溯算法</h2><ul>
<li><a href="https://blog.csdn.net/qfikh/article/details/51960331" target="_blank" rel="noopener">《 五大常用算法之四：回溯法》</a></li>
</ul>
<h2 id="剪枝算法"><a href="#剪枝算法" class="headerlink" title="剪枝算法"></a>剪枝算法</h2><ul>
<li><a href="https://blog.csdn.net/luningcsdn/article/details/50930276" target="_blank" rel="noopener">《α-β剪枝算法》</a></li>
</ul>
<h2 id="动态规划"><a href="#动态规划" class="headerlink" title="动态规划"></a>动态规划</h2><ul>
<li><a href="https://www.cnblogs.com/little-YTMM/p/5372680.html" target="_blank" rel="noopener">《详解动态规划——邹博讲动态规划》</a></li>
<li><a href="https://blog.csdn.net/yao_zi_jie/article/details/54580283" target="_blank" rel="noopener">《动态规划算法的个人理解》</a></li>
</ul>
<h2 id="朴素贝叶斯"><a href="#朴素贝叶斯" class="headerlink" title="朴素贝叶斯"></a>朴素贝叶斯</h2><ul>
<li><p><a href="https://blog.csdn.net/amds123/article/details/70173402" target="_blank" rel="noopener">《带你搞懂朴素贝叶斯分类算法》</a></p>
<ul>
<li>P(B|A)=P(A|B)P(B)/P(A)</li>
</ul>
</li>
<li><p><a href="http://www.ruanyifeng.com/blog/2011/08/bayesian_inference_part_one.html" target="_blank" rel="noopener">《贝叶斯推断及其互联网应用1》</a></p>
</li>
<li><a href="http://www.ruanyifeng.com/blog/2011/08/bayesian_inference_part_two.html" target="_blank" rel="noopener">《贝叶斯推断及其互联网应用2》</a></li>
</ul>
<h2 id="推荐算法"><a href="#推荐算法" class="headerlink" title="推荐算法"></a>推荐算法</h2><ul>
<li><a href="http://www.infoq.com/cn/articles/recommendation-algorithm-overview-part01" target="_blank" rel="noopener">《推荐算法综述》</a></li>
<li><a href="https://www.oschina.net/news/51297/top-10-open-source-recommendation-systems" target="_blank" rel="noopener">《TOP 10 开源的推荐系统简介》</a></li>
</ul>
<h2 id="最小生成树算法"><a href="#最小生成树算法" class="headerlink" title="最小生成树算法"></a>最小生成树算法</h2><ul>
<li><a href="https://blog.csdn.net/luoshixian099/article/details/51908175" target="_blank" rel="noopener">《算法导论–最小生成树（Kruskal和Prim算法）》</a></li>
</ul>
<h2 id="最短路径算法"><a href="#最短路径算法" class="headerlink" title="最短路径算法"></a>最短路径算法</h2><ul>
<li><a href="https://blog.csdn.net/qq_35644234/article/details/60870719" target="_blank" rel="noopener">《Dijkstra算法详解》</a></li>
</ul>
<h1 id="并发"><a href="#并发" class="headerlink" title="并发"></a>并发</h1><h2 id="Java-并发"><a href="#Java-并发" class="headerlink" title="Java 并发"></a>Java 并发</h2><ul>
<li><a href="https://github.com/CL0610/Java-concurrency" target="_blank" rel="noopener">Java 并发知识合集</a></li>
<li><a href="https://github.com/CL0610/Java-concurrency/blob/master/Java并发知识图谱.png" target="_blank" rel="noopener">JAVA并发知识图谱</a></li>
</ul>
<h2 id="多线程"><a href="#多线程" class="headerlink" title="多线程"></a>多线程</h2><ul>
<li><a href="http://www.importnew.com/18459.html" target="_blank" rel="noopener">《40个Java多线程问题总结》</a></li>
</ul>
<h2 id="线程安全"><a href="#线程安全" class="headerlink" title="线程安全"></a>线程安全</h2><ul>
<li><a href="https://www.cnblogs.com/zhanht/p/5450325.html" target="_blank" rel="noopener">《Java并发编程——线程安全及解决机制简介》</a></li>
</ul>
<h2 id="一致性、事务"><a href="#一致性、事务" class="headerlink" title="一致性、事务"></a>一致性、事务</h2><h3 id="事务-ACID-特性"><a href="#事务-ACID-特性" class="headerlink" title="事务 ACID 特性"></a>事务 ACID 特性</h3><ul>
<li><a href="https://blog.csdn.net/u012440687/article/details/52116108" target="_blank" rel="noopener">《数据库事务ACID特性》</a></li>
</ul>
<h3 id="事务的隔离级别"><a href="#事务的隔离级别" class="headerlink" title="事务的隔离级别"></a>事务的隔离级别</h3><ul>
<li>未提交读：一个事务可以读取另一个未提交的数据，容易出现脏读的情况。</li>
<li>读提交：一个事务等另外一个事务提交之后才可以读取数据，但会出现不可重复读的情况（多次读取的数据不一致），读取过程中出现UPDATE操作，会多。（大多数数据库默认级别是RC，比如SQL Server，Oracle），读取的时候不可以修改。</li>
<li>可重复读： 同一个事务里确保每次读取的时候，获得的是同样的数据，但不保障原始数据被其他事务更新（幻读），Mysql InnoDB 就是这个级别。</li>
<li><p>序列化：所有事物串行处理（牺牲了效率）</p>
</li>
<li><p><a href="https://blog.csdn.net/qq_33290787/article/details/51924963" target="_blank" rel="noopener">《理解事务的4种隔离级别》</a></p>
</li>
<li><p><a href="https://www.cnblogs.com/z-sm/p/7245981.html" target="_blank" rel="noopener">数据库事务的四大特性及事务隔离级别</a></p>
</li>
<li><p><a href="http://blog.sina.com.cn/s/blog_499740cb0100ugs7.html" target="_blank" rel="noopener">《MySQL的InnoDB的幻读问题 》</a></p>
<ul>
<li>幻读的例子非常清楚。</li>
<li>通过 SELECT … FOR UPDATE 解决。</li>
</ul>
</li>
<li><p><a href="http://database.51cto.com/art/201804/570101.htm" target="_blank" rel="noopener">《一篇文章带你读懂MySQL和InnoDB》</a></p>
<ul>
<li>图解脏读、不可重复读、幻读问题。</li>
</ul>
</li>
</ul>
<h3 id="MVCC"><a href="#MVCC" class="headerlink" title="MVCC"></a>MVCC</h3><ul>
<li><p><a href="https://www.cnblogs.com/chenpingzhao/p/5065316.html" target="_blank" rel="noopener">《【mysql】关于innodb中MVCC的一些理解》</a></p>
<ul>
<li>innodb 中 MVCC 用在 Repeatable-Read 隔离级别。</li>
<li>MVCC 会产生幻读问题（更新时异常。）</li>
</ul>
</li>
<li><p><a href="https://blog.csdn.net/whoamiyang/article/details/51901888" target="_blank" rel="noopener">《轻松理解MYSQL MVCC 实现机制》</a></p>
<ul>
<li>通过隐藏版本列来实现 MVCC 控制，一列记录创建时间、一列记录删除时间，这里的时间</li>
<li>每次只操作比当前版本小（或等于）的 行。</li>
</ul>
</li>
</ul>
<h2 id="锁"><a href="#锁" class="headerlink" title="锁"></a>锁</h2><h3 id="Java中的锁和同步类"><a href="#Java中的锁和同步类" class="headerlink" title="Java中的锁和同步类"></a>Java中的锁和同步类</h3><ul>
<li><p><a href="https://www.cnblogs.com/qifengshi/p/6831055.html" target="_blank" rel="noopener">《Java中的锁分类》</a></p>
<ul>
<li>主要包括 synchronized、ReentrantLock、和 ReadWriteLock。 </li>
</ul>
</li>
<li><p><a href="https://www.cnblogs.com/waterystone/p/4920797.html" target="_blank" rel="noopener">《Java并发之AQS详解》</a></p>
</li>
<li><p><a href="http://cuisuqiang.iteye.com/blog/2020146" target="_blank" rel="noopener">《Java中信号量 Semaphore》</a></p>
<ul>
<li>有数量控制</li>
<li>申请用 acquire，申请不要则阻塞；释放用 release。</li>
</ul>
</li>
<li><p><a href="https://www.cnblogs.com/davidwang456/p/6094947.html" target="_blank" rel="noopener">《java开发中的Mutex vs Semaphore》</a></p>
<ul>
<li>简单的说 就是Mutex是排它的，只有一个可以获取到资源， Semaphore也具有排它性，但可以定义多个可以获取的资源的对象。     </li>
</ul>
</li>
</ul>
<h3 id="公平锁-amp-非公平锁"><a href="#公平锁-amp-非公平锁" class="headerlink" title="公平锁 &amp; 非公平锁"></a>公平锁 &amp; 非公平锁</h3><p>公平锁的作用就是严格按照线程启动的顺序来执行的，不允许其他线程插队执行的；而非公平锁是允许插队的。</p>
<ul>
<li><a href="https://blog.csdn.net/EthanWhite/article/details/55508357" target="_blank" rel="noopener">《公平锁与非公平锁》</a><ul>
<li>默认情况下 ReentrantLock 和 synchronized 都是非公平锁。ReentrantLock 可以设置成公平锁。</li>
</ul>
</li>
</ul>
<h3 id="悲观锁"><a href="#悲观锁" class="headerlink" title="悲观锁"></a>悲观锁</h3><p>悲观锁如果使用不当（锁的条数过多），会引起服务大面积等待。推荐优先使用乐观锁+重试。</p>
<ul>
<li><p><a href="https://www.cnblogs.com/zhiqian-ali/p/6200874.html" target="_blank" rel="noopener">《【MySQL】悲观锁&amp;乐观锁》</a></p>
<ul>
<li>乐观锁的方式：版本号+重试方式</li>
<li>悲观锁：通过 select … for update 进行行锁(不可读、不可写，share 锁可读不可写)。</li>
</ul>
</li>
<li><p><a href="https://www.cnblogs.com/Lawson/p/5008741.html" target="_blank" rel="noopener">《Mysql查询语句使用select.. for update导致的数据库死锁分析》</a></p>
<ul>
<li>mysql的innodb存储引擎实务锁虽然是锁行，但它内部是锁索引的。</li>
<li>锁相同数据的不同索引条件可能会引起死锁。</li>
</ul>
</li>
<li><p><a href="https://www.cnblogs.com/zejin2008/p/5262751.html" target="_blank" rel="noopener">《Mysql并发时经典常见的死锁原因及解决方法》</a></p>
</li>
</ul>
<h3 id="乐观锁-amp-CAS"><a href="#乐观锁-amp-CAS" class="headerlink" title="乐观锁 &amp; CAS"></a>乐观锁 &amp; CAS</h3><ul>
<li><a href="http://www.importnew.com/20472.html" target="_blank" rel="noopener">《乐观锁的一种实现方式——CAS》</a><ul>
<li>和MySQL乐观锁方式相似，只不过是通过和原值进行比较。     </li>
</ul>
</li>
</ul>
<h3 id="ABA-问题"><a href="#ABA-问题" class="headerlink" title="ABA 问题"></a>ABA 问题</h3><p>由于高并发，在CAS下，更新后可能此A非彼A。通过版本号可以解决，类似于上文Mysql 中提到的的乐观锁。</p>
<ul>
<li><a href="https://www.cnblogs.com/549294286/p/3766717.html" target="_blank" rel="noopener">《Java CAS 和ABA问题》</a></li>
<li><a href="https://blog.csdn.net/li954644351/article/details/50511879" target="_blank" rel="noopener">《Java 中 ABA问题及避免》</a><ul>
<li>AtomicStampedReference 和 AtomicStampedReference。 </li>
</ul>
</li>
</ul>
<h3 id="CopyOnWrite容器"><a href="#CopyOnWrite容器" class="headerlink" title="CopyOnWrite容器"></a>CopyOnWrite容器</h3><p>可以对CopyOnWrite容器进行并发的读，而不需要加锁。CopyOnWrite并发容器用于读多写少的并发场景。比如白名单，黑名单，商品类目的访问和更新场景，不适合需要数据强一致性的场景。</p>
<ul>
<li><p><a href="https://www.cnblogs.com/hapjin/p/4840107.html" target="_blank" rel="noopener">《JAVA中写时复制(Copy-On-Write)Map实现》</a></p>
<ul>
<li>实现读写分离，读取发生在原始数据上，写入发生在副本上。  </li>
<li>不用加锁，通过最终一致实现一致性。</li>
</ul>
</li>
<li><p><a href="https://blog.csdn.net/a494303877/article/details/53404623" target="_blank" rel="noopener">《聊聊并发-Java中的Copy-On-Write容器》</a></p>
</li>
</ul>
<h3 id="RingBuffer"><a href="#RingBuffer" class="headerlink" title="RingBuffer"></a>RingBuffer</h3><ul>
<li><a href="http://www.cnblogs.com/l00l/p/4115001.html" target="_blank" rel="noopener">《线程安全的无锁RingBuffer的实现【一个读线程，一个写线程】》</a></li>
</ul>
<h3 id="可重入锁-amp-不可重入锁"><a href="#可重入锁-amp-不可重入锁" class="headerlink" title="可重入锁 &amp; 不可重入锁"></a>可重入锁 &amp; 不可重入锁</h3><ul>
<li><p><a href="https://www.cnblogs.com/dj3839/p/6580765.html" target="_blank" rel="noopener">《可重入锁和不可重入锁》</a></p>
<ul>
<li>通过简单代码举例说明可重入锁和不可重入锁。</li>
<li>可重入锁指同一个线程可以再次获得之前已经获得的锁。</li>
<li>可重入锁可以用户避免死锁。</li>
<li>Java中的可重入锁：synchronized 和 java.util.concurrent.locks.ReentrantLock</li>
</ul>
</li>
<li><p><a href="https://www.cnblogs.com/baizhanshi/p/7211802.html" target="_blank" rel="noopener">《ReenTrantLock可重入锁（和synchronized的区别）总结》</a></p>
<ul>
<li>synchronized 使用方便，编译器来加锁，是非公平锁。</li>
<li>ReenTrantLock 使用灵活，锁的公平性可以定制。</li>
<li>相同加锁场景下，推荐使用 synchronized。</li>
</ul>
</li>
</ul>
<h3 id="互斥锁-amp-共享锁"><a href="#互斥锁-amp-共享锁" class="headerlink" title="互斥锁 &amp; 共享锁"></a>互斥锁 &amp; 共享锁</h3><p>互斥锁：同时只能有一个线程获得锁。比如，ReentrantLock 是互斥锁，ReadWriteLock 中的写锁是互斥锁。<br>共享锁：可以有多个线程同时或的锁。比如，Semaphore、CountDownLatch 是共享锁，ReadWriteLock 中的读锁是共享锁。</p>
<ul>
<li><a href="https://www.cnblogs.com/liang1101/p/6475555.html" target="_blank" rel="noopener">《ReadWriteLock场景应用》</a></li>
</ul>
<h3 id="死锁"><a href="#死锁" class="headerlink" title="死锁"></a>死锁</h3><ul>
<li><a href="https://blog.csdn.net/yunfenglw/article/details/45950305" target="_blank" rel="noopener">《“死锁”四个必要条件的合理解释》</a><ul>
<li>互斥、持有、不可剥夺、环形等待。</li>
</ul>
</li>
<li><p><a href="https://blog.csdn.net/u014039577/article/details/52351626" target="_blank" rel="noopener">Java如何查看死锁？</a></p>
<ul>
<li>JConsole 可以识别死锁。</li>
</ul>
</li>
<li><p><a href="https://blog.csdn.net/bohu83/article/details/51135061" target="_blank" rel="noopener">java多线程系列：死锁及检测</a></p>
<ul>
<li>jstack 可以显示死锁。</li>
</ul>
</li>
</ul>
<h1 id="操作系统"><a href="#操作系统" class="headerlink" title="操作系统"></a>操作系统</h1><h2 id="计算机原理"><a href="#计算机原理" class="headerlink" title="计算机原理"></a>计算机原理</h2><ul>
<li><a href="https://segmentfault.com/a/1190000003692840" target="_blank" rel="noopener">《操作系统基础知识——操作系统的原理，类型和结构》</a></li>
</ul>
<h2 id="CPU"><a href="#CPU" class="headerlink" title="CPU"></a>CPU</h2><h3 id="多级缓存"><a href="#多级缓存" class="headerlink" title="多级缓存"></a>多级缓存</h3><p>典型的 CPU 有三级缓存，距离核心越近，速度越快，空间越小。L1 一般 32k，L2 一般 256k，L3 一般12M。内存速度需要200个 CPU 周期，CPU 缓存需要1个CPU周期。</p>
<ul>
<li><a href="https://blog.csdn.net/zero__007/article/details/54089730" target="_blank" rel="noopener">《从Java视角理解CPU缓存和伪共享》</a></li>
</ul>
<h2 id="进程"><a href="#进程" class="headerlink" title="进程"></a>进程</h2><p>TODO</p>
<h2 id="线程"><a href="#线程" class="headerlink" title="线程"></a>线程</h2><ul>
<li><a href="https://blog.csdn.net/asdf_1024/article/details/78978437" target="_blank" rel="noopener">《线程的生命周期及状态转换详解》</a></li>
</ul>
<h2 id="协程"><a href="#协程" class="headerlink" title="协程"></a>协程</h2><ul>
<li><a href="https://www.thinksaas.cn/group/topic/839375/" target="_blank" rel="noopener">《终结python协程—-从yield到actor模型的实现》</a><ul>
<li>线程的调度是由操作系统负责，协程调度是程序自行负责</li>
<li>与线程相比，协程减少了无谓的操作系统切换.</li>
<li>实际上当遇到IO操作时做切换才更有意义，（因为IO操作不用占用CPU），如果没遇到IO操作，按照时间片切换.</li>
</ul>
</li>
</ul>
<h2 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h2><ul>
<li><a href="http://www.runoob.com/linux/linux-command-manual.html" target="_blank" rel="noopener">《Linux 命令大全》</a></li>
</ul>
<h1 id="设计模式"><a href="#设计模式" class="headerlink" title="设计模式"></a>设计模式</h1><h2 id="设计模式的六大原则"><a href="#设计模式的六大原则" class="headerlink" title="设计模式的六大原则"></a>设计模式的六大原则</h2><ul>
<li><a href="https://blog.csdn.net/q291611265/article/details/48465113" target="_blank" rel="noopener">《设计模式的六大原则》</a><ul>
<li>开闭原则：对扩展开放,对修改关闭，多使用抽象类和接口。</li>
<li>里氏替换原则：基类可以被子类替换，使用抽象类继承,不使用具体类继承。</li>
<li>依赖倒转原则：要依赖于抽象,不要依赖于具体，针对接口编程,不针对实现编程。</li>
<li>接口隔离原则：使用多个隔离的接口,比使用单个接口好，建立最小的接口。</li>
<li>迪米特法则：一个软件实体应当尽可能少地与其他实体发生相互作用，通过中间类建立联系。</li>
<li>合成复用原则：尽量使用合成/聚合,而不是使用继承。</li>
</ul>
</li>
</ul>
<h2 id="23种常见设计模式"><a href="#23种常见设计模式" class="headerlink" title="23种常见设计模式"></a>23种常见设计模式</h2><ul>
<li><a href="http://www.runoob.com/design-pattern/design-pattern-tutorial.html" target="_blank" rel="noopener">《设计模式》</a></li>
<li><a href="https://www.cnblogs.com/susanws/p/5510229.html" target="_blank" rel="noopener">《23种设计模式全解析》</a></li>
</ul>
<h2 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h2><ul>
<li><p><a href="http://blog.jobbole.com/62314/" target="_blank" rel="noopener">《细数JDK里的设计模式》</a></p>
<ul>
<li><p>结构型模式：</p>
<ul>
<li>适配器：用来把一个接口转化成另一个接口，如 java.util.Arrays#asList()。</li>
<li>桥接模式：这个模式将抽象和抽象操作的实现进行了解耦，这样使得抽象和实现可以独立地变化，如JDBC；</li>
<li>组合模式：使得客户端看来单个对象和对象的组合是同等的。换句话说，某个类型的方法同时也接受自身类型作为参数，如 Map.putAll，List.addAll、Set.addAll。</li>
<li>装饰者模式：动态的给一个对象附加额外的功能，这也是子类的一种替代方式，如 java.util.Collections#checkedList|Map|Set|SortedSet|SortedMap。</li>
<li>享元模式：使用缓存来加速大量小对象的访问时间，如 valueOf(int)。</li>
<li>代理模式：代理模式是用一个简单的对象来代替一个复杂的或者创建耗时的对象，如 java.lang.reflect.Proxy</li>
</ul>
</li>
<li><p>创建模式:</p>
<ul>
<li>抽象工厂模式：抽象工厂模式提供了一个协议来生成一系列的相关或者独立的对象，而不用指定具体对象的类型，如 java.util.Calendar#getInstance()。</li>
<li>建造模式(Builder)：定义了一个新的类来构建另一个类的实例，以简化复杂对象的创建，如：java.lang.StringBuilder#append()。</li>
<li>工厂方法：就是 <strong>一个返*</strong> 回具体对象的方法，而不是多个，如 java.lang.Object#toString()、java.lang.Class#newInstance()。</li>
<li>原型模式：使得类的实例能够生成自身的拷贝、如：java.lang.Object#clone()。</li>
<li>单例模式：全局只有一个实例，如 java.lang.Runtime#getRuntime()。</li>
</ul>
</li>
<li>行为模式：<ul>
<li>责任链模式：通过把请求从一个对象传递到链条中下一个对象的方式，直到请求被处理完毕，以实现对象间的解耦。如 javax.servlet.Filter#doFilter()。</li>
<li>命令模式：将操作封装到对象内，以便存储，传递和返回，如：java.lang.Runnable。</li>
<li>解释器模式：定义了一个语言的语法，然后解析相应语法的语句，如，java.text.Format，java.text.Normalizer。</li>
<li>迭代器模式：提供一个一致的方法来顺序访问集合中的对象，如 java.util.Iterator。</li>
<li>中介者模式：通过使用一个中间对象来进行消息分发以及减少类之间的直接依赖，java.lang.reflect.Method#invoke()。</li>
<li>空对象模式：如 java.util.Collections#emptyList()。</li>
<li>观察者模式：它使得一个对象可以灵活的将消息发送给感兴趣的对象，如 java.util.EventListener。</li>
<li>模板方法模式：让子类可以重写方法的一部分，而不是整个重写，如 java.util.Collections#sort()。</li>
</ul>
</li>
</ul>
</li>
<li><p><a href="https://www.cnblogs.com/hwaggLee/p/4510687.html" target="_blank" rel="noopener">《Spring-涉及到的设计模式汇总》</a></p>
</li>
<li><a href="https://blog.csdn.net/u012387062/article/details/54719114" target="_blank" rel="noopener">《Mybatis使用的设计模式》</a></li>
</ul>
<h2 id="单例模式"><a href="#单例模式" class="headerlink" title="单例模式"></a>单例模式</h2><ul>
<li><a href="https://blog.csdn.net/YECrazy/article/details/79481964" target="_blank" rel="noopener">《单例模式的三种实现 以及各自的优缺点》</a></li>
<li><a href="https://www.cnblogs.com/ttylinux/p/6498822.html" target="_blank" rel="noopener">《单例模式－－反射－－防止序列化破坏单例模式》</a><ul>
<li>使用枚举类型。</li>
</ul>
</li>
</ul>
<h2 id="责任链模式"><a href="#责任链模式" class="headerlink" title="责任链模式"></a>责任链模式</h2><p>TODO</p>
<h2 id="MVC"><a href="#MVC" class="headerlink" title="MVC"></a>MVC</h2><ul>
<li><a href="http://www.runoob.com/design-pattern/mvc-pattern.html" target="_blank" rel="noopener">《MVC 模式》</a><ul>
<li>模型(model)－视图(view)－控制器(controller) </li>
</ul>
</li>
</ul>
<h2 id="IOC"><a href="#IOC" class="headerlink" title="IOC"></a>IOC</h2><ul>
<li><a href="https://www.zhihu.com/question/23277575" target="_blank" rel="noopener">《理解 IOC》</a></li>
<li><a href="https://www.cnblogs.com/NancyStartOnce/p/6813162.html" target="_blank" rel="noopener">《IOC 的理解与解释》</a><ul>
<li>正向控制：传统通过new的方式。反向控制，通过容器注入对象。</li>
<li>作用：用于模块解耦。</li>
<li>DI：Dependency Injection，即依赖注入，只关心资源使用，不关心资源来源。</li>
</ul>
</li>
</ul>
<h2 id="AOP"><a href="#AOP" class="headerlink" title="AOP"></a>AOP</h2><ul>
<li><a href="https://my.oschina.net/yanquan345/blog/203415" target="_blank" rel="noopener">《轻松理解AOP(面向切面编程)》</a></li>
<li><a href="https://www.cnblogs.com/hongwz/p/5764917.html" target="_blank" rel="noopener">《Spring AOP详解》</a></li>
<li><a href="http://www.importnew.com/24305.html" target="_blank" rel="noopener">《Spring AOP的实现原理》</a><ul>
<li>Spring AOP使用的动态代理，主要有两种方式：JDK动态代理和CGLIB动态代理。</li>
</ul>
</li>
<li><a href="https://www.ibm.com/developerworks/cn/java/j-lo-springaopcglib/" target="_blank" rel="noopener">《Spring AOP 实现原理与 CGLIB 应用》</a><ul>
<li>Spring AOP 框架对 AOP 代理类的处理原则是：如果目标对象的实现类实现了接口，Spring AOP 将会采用 JDK 动态代理来生成 AOP 代理类；如果目标对象的实现类没有实现接口，Spring AOP 将会采用 CGLIB 来生成 AOP 代理类 </li>
</ul>
</li>
</ul>
<h2 id="UML"><a href="#UML" class="headerlink" title="UML"></a>UML</h2><ul>
<li><a href="https://www.w3cschool.cn/uml_tutorial/" target="_blank" rel="noopener">《UML教程》</a></li>
</ul>
<h2 id="微服务思想"><a href="#微服务思想" class="headerlink" title="微服务思想"></a>微服务思想</h2><ul>
<li><a href="https://www.cnblogs.com/wintersun/p/6219259.html" target="_blank" rel="noopener">《微服务架构设计》</a></li>
<li><a href="http://www.infoq.com/cn/articles/micro-service-technology-stack" target="_blank" rel="noopener">《微服务架构技术栈选型手册》</a></li>
</ul>
<h3 id="康威定律"><a href="#康威定律" class="headerlink" title="康威定律"></a>康威定律</h3><ul>
<li><p><a href="https://yq.aliyun.com/articles/8611" target="_blank" rel="noopener">《微服务架构的理论基础 - 康威定律》</a></p>
<ul>
<li>定律一：组织沟通方式会通过系统设计表达出来，就是说架构的布局和组织结构会有相似。</li>
<li>定律二：时间再多一件事情也不可能做的完美，但总有时间做完一件事情。一口气吃不成胖子，先搞定能搞定的。</li>
<li>定律三：线型系统和线型组织架构间有潜在的异质同态特性。种瓜得瓜，做独立自治的子系统减少沟通成本。</li>
<li>定律四：大的系统组织总是比小系统更倾向于分解。合久必分，分而治之。</li>
</ul>
</li>
<li><p><a href="https://static.geekbang.org/PDF-%E4%BF%AE%E6%94%B9%E7%89%88-%E6%9E%81%E5%AE%A2%E6%97%B6%E9%97%B4-%E5%9B%BE%E7%89%87-%E6%9D%A8%E6%B3%A2-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84.pdf" target="_blank" rel="noopener">《微服务架构核⼼20讲》</a></p>
</li>
</ul>
<h1 id="运维-amp-统计-amp-技术支持"><a href="#运维-amp-统计-amp-技术支持" class="headerlink" title="运维 &amp; 统计 &amp; 技术支持"></a>运维 &amp; 统计 &amp; 技术支持</h1><h2 id="常规监控"><a href="#常规监控" class="headerlink" title="常规监控"></a>常规监控</h2><ul>
<li><p><a href="https://blog.csdn.net/enweitech/article/details/77849205" target="_blank" rel="noopener">《腾讯业务系统监控的修炼之路》</a></p>
<ul>
<li>监控的方式：主动、被动、旁路(比如舆情监控)</li>
<li>监控类型： 基础监控、服务端监控、客户端监控、<br>监控、用户端监控</li>
<li>监控的目标：全、块、准</li>
<li>核心指标：请求量、成功率、耗时</li>
</ul>
</li>
<li><p><a href="https://www.oschina.net/news/67525/monitoring-tools" target="_blank" rel="noopener">《开源还是商用？十大云运维监控工具横评》</a></p>
<ul>
<li>Zabbix、Nagios、Ganglia、Zenoss、Open-falcon、监控宝、 360网站服务监控、阿里云监控、百度云观测、小蜜蜂网站监测等。</li>
</ul>
</li>
<li><p><a href="http://developer.51cto.com/art/201612/525373.htm" target="_blank" rel="noopener">《监控报警系统搭建及二次开发经验》</a></p>
</li>
</ul>
<p><strong>命令行监控工具</strong></p>
<ul>
<li><p><a href="https://coderxing.gitbooks.io/architecture-evolution/di-er-pian-ff1a-feng-kuang-yuan-shi-ren/44-an-quan-yu-yun-wei/445-fu-wu-qi-zhuang-tai-jian-ce/4451-ming-ling-xing-gong-ju.html" target="_blank" rel="noopener">《常用命令行监控工具》</a></p>
<ul>
<li>top、sar、tsar、nload</li>
</ul>
</li>
<li><p><a href="http://blog.jobbole.com/96846/" target="_blank" rel="noopener">《20个命令行工具监控 Linux 系统性能》</a></p>
</li>
<li><p><a href="https://my.oschina.net/feichexia/blog/196575" target="_blank" rel="noopener">《JVM性能调优监控工具jps、jstack、jmap、jhat、jstat、hprof使用详解》</a></p>
</li>
</ul>
<h2 id="APM"><a href="#APM" class="headerlink" title="APM"></a>APM</h2><p>APM —  Application Performance Management</p>
<ul>
<li><p><a href="http://bigbully.github.io/Dapper-translation/" target="_blank" rel="noopener">《Dapper，大规模分布式系统的跟踪系统》</a></p>
</li>
<li><p><a href="http://opentracing.io" target="_blank" rel="noopener">CNCF OpenTracing</a>，<a href="https://github.com/opentracing-contrib/opentracing-specification-zh" target="_blank" rel="noopener">中文版</a></p>
</li>
<li><p>主要开源软件，按字母排序</p>
<ul>
<li><a href="https://github.com/apache/incubator-skywalking" target="_blank" rel="noopener">Apache SkyWalking</a></li>
<li><a href="https://github.com/dianping/cat" target="_blank" rel="noopener">CAT</a></li>
<li><a href="https://github.com/jaegertracing/jaeger" target="_blank" rel="noopener">CNCF jaeger</a></li>
<li><a href="https://github.com/naver/pinpoint" target="_blank" rel="noopener">Pinpoint</a></li>
<li><a href="https://github.com/openzipkin/zipkin" target="_blank" rel="noopener">Zipkin</a></li>
</ul>
</li>
<li><p><a href="http://www.infoq.com/cn/articles/apm-Pinpoint-practice" target="_blank" rel="noopener">《开源APM技术选型与实战》</a></p>
<ul>
<li>主要基于 Google的Dapper（大规模分布式系统的跟踪系统） 思想。</li>
</ul>
</li>
</ul>
<h2 id="统计分析"><a href="#统计分析" class="headerlink" title="统计分析"></a>统计分析</h2><ul>
<li><p><a href="https://zhuanlan.zhihu.com/p/25195217" target="_blank" rel="noopener">《流量统计的基础：埋点》</a></p>
<ul>
<li>常用指标：访问与访客、停留时长、跳出率、退出率、转化率、参与度</li>
</ul>
</li>
<li><p><a href="http://www.25xt.com/company/17066.html" target="_blank" rel="noopener">《APP埋点常用的统计工具、埋点目标和埋点内容》</a></p>
<ul>
<li>第三方统计：友盟、百度移动、魔方、App Annie、talking data、神策数据等。</li>
</ul>
</li>
<li><p><a href="https://tech.meituan.com/mt-mobile-analytics-practice.html" target="_blank" rel="noopener">《美团点评前端无痕埋点实践》</a></p>
<ul>
<li>所谓无痕、即通过可视化工具配置采集节点，在前端自动解析配置并上报埋点数据，而非硬编码。 </li>
</ul>
</li>
</ul>
<h2 id="持续集成-CI-CD"><a href="#持续集成-CI-CD" class="headerlink" title="持续集成(CI/CD)"></a>持续集成(CI/CD)</h2><ul>
<li><a href="http://www.ruanyifeng.com/blog/2015/09/continuous-integration.html" target="_blank" rel="noopener">《持续集成是什么？》</a></li>
<li><a href="https://www.testwo.com/article/1170" target="_blank" rel="noopener">《8个流行的持续集成工具》</a></li>
</ul>
<h3 id="Jenkins"><a href="#Jenkins" class="headerlink" title="Jenkins"></a>Jenkins</h3><ul>
<li><a href="https://www.liaoxuefeng.com/article/001463233913442cdb2d1bd1b1b42e3b0b29eb1ba736c5e000" target="_blank" rel="noopener">《使用Jenkins进行持续集成》</a></li>
</ul>
<h3 id="环境分离"><a href="#环境分离" class="headerlink" title="环境分离"></a>环境分离</h3><p>开发、测试、生成环境分离。</p>
<ul>
<li><a href="https://my.oschina.net/sancuo/blog/214904" target="_blank" rel="noopener">《开发环境、生产环境、测试环境的基本理解和区》</a></li>
</ul>
<h2 id="自动化运维"><a href="#自动化运维" class="headerlink" title="自动化运维"></a>自动化运维</h2><h3 id="Ansible"><a href="#Ansible" class="headerlink" title="Ansible"></a>Ansible</h3><ul>
<li><a href="http://www.ansible.com.cn/" target="_blank" rel="noopener">《Ansible中文权威指南》</a></li>
<li><a href="https://www.cnblogs.com/heiye123/articles/7855890.html" target="_blank" rel="noopener">《Ansible基础配置和企业级项目实用案例》</a></li>
</ul>
<h3 id="puppet"><a href="#puppet" class="headerlink" title="puppet"></a>puppet</h3><ul>
<li><a href="https://www.cnblogs.com/keerya/p/8040071.html" target="_blank" rel="noopener">《自动化运维工具——puppet详解》</a></li>
</ul>
<h3 id="chef"><a href="#chef" class="headerlink" title="chef"></a>chef</h3><ul>
<li><a href="https://www.ibm.com/developerworks/cn/cloud/library/1407_caomd_chef/" target="_blank" rel="noopener">《Chef 的安装与使用》</a></li>
</ul>
<h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><h3 id="TDD-理论"><a href="#TDD-理论" class="headerlink" title="TDD 理论"></a>TDD 理论</h3><ul>
<li><a href="https://www.jianshu.com/p/62f16cd4fef3" target="_blank" rel="noopener">《深度解读 - TDD（测试驱动开发）》</a><ul>
<li>基于测试用例编码功能代码，XP（Extreme Programming）的核心实践.</li>
<li>好处：一次关注一个点，降低思维负担；迎接需求变化或改善代码的设计；提前澄清需求；快速反馈； </li>
</ul>
</li>
</ul>
<h3 id="单元测试"><a href="#单元测试" class="headerlink" title="单元测试"></a>单元测试</h3><ul>
<li><a href="https://www.cnblogs.com/happyzm/p/6482886.html" target="_blank" rel="noopener">《Java单元测试之JUnit篇》</a></li>
<li><a href="https://blog.csdn.net/hotdust/article/details/53406086" target="_blank" rel="noopener">《JUnit 4 与 TestNG 对比》</a><ul>
<li>TestNG 覆盖 JUnit 功能，适用于更复杂的场景。 </li>
</ul>
</li>
<li><a href="https://blog.csdn.net/wqetfg/article/details/50900512" target="_blank" rel="noopener">《单元测试主要的测试功能点》</a><ul>
<li>模块接口测试、局部数据结构测试、路径测试 、错误处理测试、边界条件测试 。 </li>
</ul>
</li>
</ul>
<h3 id="压力测试"><a href="#压力测试" class="headerlink" title="压力测试"></a>压力测试</h3><ul>
<li><a href="https://blog.csdn.net/blueheart20/article/details/52170790" target="_blank" rel="noopener">《Apache ab 测试使用指南》</a></li>
<li><a href="https://www.cnblogs.com/binyue/p/6141088.html" target="_blank" rel="noopener">《大型网站压力测试及优化方案》</a></li>
<li><a href="http://news.chinabyte.com/466/14126966.shtml" target="_blank" rel="noopener">《10大主流压力/负载/性能测试工具推荐》</a></li>
<li><a href="http://quentinxxz.iteye.com/blog/2249799" target="_blank" rel="noopener">《真实流量压测工具 tcpcopy应用浅析》</a></li>
<li><a href="https://www.cnblogs.com/jwentest/p/7136727.html" target="_blank" rel="noopener">《nGrinder 简易使用教程》</a></li>
</ul>
<h3 id="全链路压测"><a href="#全链路压测" class="headerlink" title="全链路压测"></a>全链路压测</h3><ul>
<li><a href="http://www.infoq.com/cn/articles/jd-618-upgrade-full-link-voltage-test-program-forcebot" target="_blank" rel="noopener">《京东618：升级全链路压测方案，打造军演机器人ForceBot》</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/30306892" target="_blank" rel="noopener">《饿了么全链路压测的探索与实践》</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/28355759" target="_blank" rel="noopener">《四大语言，八大框架｜滴滴全链路压测解决之道》</a></li>
<li><a href="https://www.jianshu.com/p/27060fd61f72" target="_blank" rel="noopener">《全链路压测经验》</a></li>
</ul>
<h3 id="A-B-、灰度、蓝绿测试"><a href="#A-B-、灰度、蓝绿测试" class="headerlink" title="A/B 、灰度、蓝绿测试"></a>A/B 、灰度、蓝绿测试</h3><ul>
<li><a href="https://testerhome.com/topics/11165" target="_blank" rel="noopener">《技术干货 | AB 测试和灰度发布探索及实践》</a></li>
<li><p><a href="http://blog.51cto.com/purplegrape/1403123" target="_blank" rel="noopener">《nginx 根据IP 进行灰度发布》</a></p>
</li>
<li><p><a href="https://www.v2ex.com/t/344341" target="_blank" rel="noopener">《蓝绿部署、A/B 测试以及灰度发布》</a></p>
</li>
</ul>
<h2 id="虚拟化"><a href="#虚拟化" class="headerlink" title="虚拟化"></a>虚拟化</h2><ul>
<li><a href="https://blog.csdn.net/enweitech/article/details/52910082" target="_blank" rel="noopener">《VPS的三种虚拟技术OpenVZ、Xen、KVM优缺点比较》</a></li>
</ul>
<h3 id="KVM"><a href="#KVM" class="headerlink" title="KVM"></a>KVM</h3><ul>
<li><a href="http://blog.chinaunix.net/uid-20201831-id-5775661.html" target="_blank" rel="noopener">《KVM详解，太详细太深入了，经典》</a></li>
<li><a href="https://www.coderxing.com/kvm-install.html" target="_blank" rel="noopener">《【图文】KVM 虚拟机安装详解》</a></li>
</ul>
<h3 id="Xen"><a href="#Xen" class="headerlink" title="Xen"></a>Xen</h3><ul>
<li><a href="https://www.cnblogs.com/sddai/p/5931201.html" target="_blank" rel="noopener">《Xen虚拟化基本原理详解》</a></li>
</ul>
<h3 id="OpenVZ"><a href="#OpenVZ" class="headerlink" title="OpenVZ"></a>OpenVZ</h3><ul>
<li><a href="https://blog.csdn.net/longerzone/article/details/44829255" target="_blank" rel="noopener">《开源Linux容器 OpenVZ 快速上手指南》</a></li>
</ul>
<h2 id="容器技术"><a href="#容器技术" class="headerlink" title="容器技术"></a>容器技术</h2><h3 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h3><ul>
<li><a href="https://www.cnblogs.com/SzeCheng/p/6822905.html" target="_blank" rel="noopener">《几张图帮你理解 docker 基本原理及快速入门》</a></li>
<li><a href="https://draveness.me/docker" target="_blank" rel="noopener">《Docker 核心技术与实现原理》</a></li>
<li><a href="http://www.runoob.com/docker/docker-tutorial.html" target="_blank" rel="noopener">《Docker 教程》</a></li>
</ul>
<h2 id="云技术"><a href="#云技术" class="headerlink" title="云技术"></a>云技术</h2><h3 id="OpenStack"><a href="#OpenStack" class="headerlink" title="OpenStack"></a>OpenStack</h3><ul>
<li><a href="https://www.cnblogs.com/klb561/p/8660264.html" target="_blank" rel="noopener">《OpenStack构架知识梳理》</a></li>
</ul>
<h2 id="DevOps"><a href="#DevOps" class="headerlink" title="DevOps"></a>DevOps</h2><ul>
<li><a href="https://www.cnblogs.com/jetzhang/p/6068773.html" target="_blank" rel="noopener">《一分钟告诉你究竟DevOps是什么鬼？》</a></li>
<li><a href="http://www.infoq.com/cn/articles/detail-analysis-of-devops" target="_blank" rel="noopener">《DevOps详解》</a></li>
</ul>
<h2 id="文档管理"><a href="#文档管理" class="headerlink" title="文档管理"></a>文档管理</h2><ul>
<li><a href="http://www.confluence.cn/" target="_blank" rel="noopener">Confluence-收费文档管理系统</a></li>
<li>GitLab?</li>
<li>Wiki</li>
</ul>
<h1 id="中间件"><a href="#中间件" class="headerlink" title="中间件"></a>中间件</h1><h2 id="Web-Server"><a href="#Web-Server" class="headerlink" title="Web Server"></a>Web Server</h2><h3 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h3><ul>
<li><p><a href="https://blog.csdn.net/qq_25797077/article/details/52200722" target="_blank" rel="noopener">《Ngnix的基本学习-多进程和Apache的比较》</a></p>
<ul>
<li>Nginx 通过异步非阻塞的事件处理机制实现高并发。Apache 每个请求独占一个线程，非常消耗系统资源。</li>
<li>事件驱动适合于IO密集型服务(Nginx)，多进程或线程适合于CPU密集型服务(Apache)，所以Nginx适合做反向代理，而非web服务器使用。  </li>
</ul>
</li>
<li><p><a href="https://www.cnblogs.com/cunkouzh/p/5410154.html" target="_blank" rel="noopener">《nginx与Apache的对比以及优缺点》</a></p>
<ul>
<li>nginx只适合静态和反向代理，不适合处理动态请求。</li>
</ul>
</li>
</ul>
<h3 id="OpenResty"><a href="#OpenResty" class="headerlink" title="OpenResty"></a>OpenResty</h3><ul>
<li><a href="http://openresty.org/cn/" target="_blank" rel="noopener">官方网站</a></li>
<li><a href="http://www.linkedkeeper.com/detail/blog.action?bid=1034" target="_blank" rel="noopener">《浅谈 OpenResty》</a><ul>
<li>通过 Lua 模块可以在Nginx上进行开发。 </li>
</ul>
</li>
</ul>
<h3 id="Apache-Httpd"><a href="#Apache-Httpd" class="headerlink" title="Apache Httpd"></a>Apache Httpd</h3><ul>
<li><a href="http://httpd.apache.org/" target="_blank" rel="noopener">官方网站</a></li>
</ul>
<h3 id="Tomcat"><a href="#Tomcat" class="headerlink" title="Tomcat"></a>Tomcat</h3><h4 id="架构原理"><a href="#架构原理" class="headerlink" title="架构原理"></a>架构原理</h4><ul>
<li><a href="https://www.cnblogs.com/hggen/p/6264475.html" target="_blank" rel="noopener">《TOMCAT原理详解及请求过程》</a></li>
<li><a href="https://www.cnblogs.com/crazylqy/p/4706223.html" target="_blank" rel="noopener">《Tomcat服务器原理详解》</a></li>
<li><p><a href="https://www.ibm.com/developerworks/cn/java/j-lo-tomcat1/" target="_blank" rel="noopener">《Tomcat 系统架构与设计模式,第 1 部分: 工作原理》</a></p>
</li>
<li><p><a href="https://blog.csdn.net/xlgen157387/article/details/79006434" target="_blank" rel="noopener">《四张图带你了解Tomcat系统架构》</a></p>
</li>
<li><p><a href="https://www.futurehosting.com/blog/jboss-vs-tomcat-choosing-a-java-application-server/" target="_blank" rel="noopener">《JBoss vs. Tomcat: Choosing A Java Application Server》</a></p>
<ul>
<li>Tomcat 是轻量级的 Serverlet 容器，没有实现全部 JEE 特性（比如持久化和事务处理），但可以通过其他组件代替，比如Srping。</li>
<li>Jboss 实现全部了JEE特性，软件开源免费、文档收费。</li>
</ul>
</li>
</ul>
<h4 id="调优方案"><a href="#调优方案" class="headerlink" title="调优方案"></a>调优方案</h4><ul>
<li><p><a href="https://www.cnblogs.com/sunfenqing/p/7339058.html" target="_blank" rel="noopener">《Tomcat 调优方案》</a></p>
<ul>
<li>启动NIO模式（或者APR）；调整线程池；禁用AJP连接器（Nginx+tomcat的架构，不需要AJP）； </li>
</ul>
</li>
<li><p><a href="http://blog.chinaunix.net/uid-20662363-id-3012760.html" target="_blank" rel="noopener">《tomcat http协议与ajp协议》</a></p>
</li>
<li><a href="http://dmouse.iteye.com/blog/1354527" target="_blank" rel="noopener">《AJP与HTTP比较和分析》</a><ul>
<li>AJP 协议（8009端口）用于降低和前端Server（如Apache，而且需要支持AJP协议）的连接数(前端)，通过长连接提高性能。</li>
<li>并发高时，AJP协议优于HTTP协议。</li>
</ul>
</li>
</ul>
<h3 id="Jetty"><a href="#Jetty" class="headerlink" title="Jetty"></a>Jetty</h3><ul>
<li><a href="https://www.ibm.com/developerworks/cn/java/j-lo-jetty/" target="_blank" rel="noopener">《Jetty 的工作原理以及与 Tomcat 的比较》</a></li>
<li><a href="https://blog.csdn.net/doutao6677/article/details/51957288" target="_blank" rel="noopener">《jetty和tomcat优势比较》</a><ul>
<li>架构比较:Jetty的架构比Tomcat的更为简单。</li>
<li>性能比较：Jetty和Tomcat性能方面差异不大，Jetty默认采用NIO结束在处理I/O请求上更占优势，Tomcat默认采用BIO处理I/O请求，Tomcat适合处理少数非常繁忙的链接，处理静态资源时性能较差。</li>
<li>其他方面：Jetty的应用更加快速，修改简单，对新的Servlet规范的支持较好;Tomcat 对JEE和Servlet 支持更加全面。 </li>
</ul>
</li>
</ul>
<h2 id="缓存"><a href="#缓存" class="headerlink" title="缓存"></a>缓存</h2><ul>
<li><a href="https://blog.csdn.net/clementad/article/details/48229243" target="_blank" rel="noopener">《缓存失效策略（FIFO 、LRU、LFU三种算法的区别）》</a></li>
</ul>
<h3 id="本地缓存"><a href="#本地缓存" class="headerlink" title="本地缓存"></a>本地缓存</h3><ul>
<li><p><a href="https://coderxing.gitbooks.io/architecture-evolution/di-er-pian-ff1a-feng-kuang-yuan-shi-ren/42-xing-neng-zhi-ben-di-huan-cun/421-ying-yong-ceng-ben-di-huan-cun/4211.html" target="_blank" rel="noopener">《HashMap本地缓存》</a></p>
</li>
<li><p><a href="https://coderxing.gitbooks.io/architecture-evolution/di-er-pian-ff1a-feng-kuang-yuan-shi-ren/42-xing-neng-zhi-ben-di-huan-cun/421-ying-yong-ceng-ben-di-huan-cun/4212-ehcache.html" target="_blank" rel="noopener">《EhCache本地缓存》</a></p>
<ul>
<li>堆内、堆外、磁盘三级缓存。</li>
<li>可按照缓存空间容量进行设置。</li>
<li>按照时间、次数等过期策略。</li>
</ul>
</li>
<li><p><a href="https://coderxing.gitbooks.io/architecture-evolution/di-er-pian-ff1a-feng-kuang-yuan-shi-ren/42-xing-neng-zhi-ben-di-huan-cun/421-ying-yong-ceng-ben-di-huan-cun/4213-guava-cache.html" target="_blank" rel="noopener">《Guava Cache》</a></p>
<ul>
<li>简单轻量、无堆外、磁盘缓存。</li>
</ul>
</li>
</ul>
<ul>
<li><p><a href="https://coderxing.gitbooks.io/architecture-evolution/di-er-pian-ff1a-feng-kuang-yuan-shi-ren/42-xing-neng-zhi-ben-di-huan-cun/422-fu-wu-duan-ben-di-huan-cun/nginx-ben-di-huan-cun.html" target="_blank" rel="noopener">《Nginx本地缓存》</a></p>
</li>
<li><p><a href="https://coderxing.gitbooks.io/architecture-evolution/di-er-pian-ff1a-feng-kuang-yuan-shi-ren/42-xing-neng-zhi-ben-di-huan-cun/422-fu-wu-duan-ben-di-huan-cun/4222-pagespeed.html" target="_blank" rel="noopener">《Pagespeed—懒人工具，服务器端加速》</a></p>
</li>
</ul>
<h2 id="客户端缓存"><a href="#客户端缓存" class="headerlink" title="客户端缓存"></a>客户端缓存</h2><ul>
<li><p><a href="https://coderxing.gitbooks.io/architecture-evolution/di-er-pian-ff1a-feng-kuang-yuan-shi-ren/42-xing-neng-zhi-ben-di-huan-cun/423-ke-hu-duan-huan-cun.html" target="_blank" rel="noopener">《浏览器端缓存》</a></p>
<ul>
<li>主要是利用 Cache-Control 参数。</li>
</ul>
</li>
<li><p><a href="https://mp.weixin.qq.com/s/qHm_dJBhVbv0pJs8Crp77w" target="_blank" rel="noopener">《H5 和移动端 WebView 缓存机制解析与实战》</a></p>
</li>
</ul>
<h2 id="服务端缓存"><a href="#服务端缓存" class="headerlink" title="服务端缓存"></a>服务端缓存</h2><h3 id="Web缓存"><a href="#Web缓存" class="headerlink" title="Web缓存"></a>Web缓存</h3><ul>
<li><a href="https://github.com/jiangwenyuan/nuster" target="_blank" rel="noopener">nuster</a> - nuster cache</li>
<li><a href="https://github.com/varnishcache/varnish-cache" target="_blank" rel="noopener">varnish</a> - varnish cache</li>
<li><a href="https://github.com/squid-cache/squid" target="_blank" rel="noopener">squid</a> - squid cache</li>
</ul>
<h3 id="Memcached"><a href="#Memcached" class="headerlink" title="Memcached"></a>Memcached</h3><ul>
<li><a href="http://www.runoob.com/Memcached/Memcached-tutorial.html" target="_blank" rel="noopener">《Memcached 教程》</a></li>
<li><a href="https://blog.csdn.net/chenleixing/article/details/47035453" target="_blank" rel="noopener">《深入理解Memcached原理》</a><ul>
<li>采用多路复用技术提高并发性。</li>
<li>slab分配算法： memcached给Slab分配内存空间，默认是1MB。分配给Slab之后 把slab的切分成大小相同的chunk，Chunk是用于缓存记录的内存空间，Chunk 的大小默认按照1.25倍的速度递增。好处是不会频繁申请内存，提高IO效率，坏处是会有一定的内存浪费。</li>
</ul>
</li>
<li><a href="https://www.jianshu.com/p/36e5cd400580" target="_blank" rel="noopener">《Memcached软件工作原理》</a></li>
<li><p><a href="http://zhihuzeye.com/archives/2361" target="_blank" rel="noopener">《Memcache技术分享：介绍、使用、存储、算法、优化、命中率》</a></p>
</li>
<li><p><a href="https://blog.csdn.net/liu251890347/article/details/37690045" target="_blank" rel="noopener">《memcache 中 add 、 set 、replace 的区别》</a></p>
<ul>
<li>区别在于当key存在还是不存在时，返回值是true和false的。</li>
</ul>
</li>
<li><p><a href="https://pan.baidu.com/s/1qX00Lti?errno=0&amp;errmsg=Auth%20Login%20Sucess&amp;&amp;bduss=&amp;ssnerror=0&amp;traceid=" target="_blank" rel="noopener"><strong>《memcached全面剖析》</strong></a></p>
</li>
</ul>
<h3 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h3><ul>
<li><a href="http://www.runoob.com/redis/redis-tutorial.html" target="_blank" rel="noopener">《Redis 教程》</a></li>
<li><a href="https://blog.csdn.net/wcf373722432/article/details/78678504" target="_blank" rel="noopener">《redis底层原理》</a><ul>
<li>使用 ziplist 存储链表，ziplist是一种压缩链表，它的好处是更能节省内存空间，因为它所存储的内容都是在连续的内存区域当中的。</li>
<li>使用 skiplist(跳跃表)来存储有序集合对象、查找上先从高Level查起、时间复杂度和红黑树相当，实现容易，无锁、并发性好。</li>
</ul>
</li>
<li><p><a href="http://doc.redisfans.com/topic/persistence.html" target="_blank" rel="noopener">《Redis持久化方式》</a></p>
<ul>
<li>RDB方式：定期备份快照，常用于灾难恢复。优点：通过fork出的进程进行备份，不影响主进程、RDB 在恢复大数据集时的速度比 AOF 的恢复速度要快。缺点：会丢数据。</li>
<li>AOF方式：保存操作日志方式。优点：恢复时数据丢失少，缺点：文件大，回复慢。</li>
<li>也可以两者结合使用。</li>
</ul>
</li>
<li><p><a href="https://blog.csdn.net/chunlongyu/article/details/53346436" target="_blank" rel="noopener">《分布式缓存–序列3–原子操作与CAS乐观锁》</a></p>
</li>
</ul>
<h4 id="架构"><a href="#架构" class="headerlink" title="架构"></a>架构</h4><ul>
<li><a href="https://blog.csdn.net/sunhuiliang85/article/details/73656830" target="_blank" rel="noopener">《Redis单线程架构》</a></li>
</ul>
<h4 id="回收策略"><a href="#回收策略" class="headerlink" title="回收策略"></a>回收策略</h4><ul>
<li><a href="https://blog.csdn.net/qq_29108585/article/details/63251491" target="_blank" rel="noopener">《redis的回收策略》</a></li>
</ul>
<h3 id="Tair"><a href="#Tair" class="headerlink" title="Tair"></a>Tair</h3><ul>
<li><a href="https://github.com/alibaba/tair" target="_blank" rel="noopener">官方网站</a></li>
<li><a href="http://blog.csdn.net/farphone/article/details/53522383" target="_blank" rel="noopener">《Tair和Redis的对比》</a></li>
<li>特点：可以配置备份节点数目，通过异步同步到备份节点</li>
<li>一致性Hash算法。</li>
<li>架构：和Hadoop 的设计思想类似，有Configserver，DataServer，Configserver 通过心跳来检测，Configserver也有主备关系。</li>
</ul>
<p>几种存储引擎:</p>
<ul>
<li>MDB，完全内存性，可以用来存储Session等数据。</li>
<li>Rdb（类似于Redis），轻量化，去除了aof之类的操作，支持Restfull操作</li>
<li>LDB（LevelDB存储引擎），持久化存储，LDB 作为rdb的持久化，google实现，比较高效，理论基础是LSM(Log-Structured-Merge Tree)算法，现在内存中修改数据，达到一定量时（和内存汇总的旧数据一同写入磁盘）再写入磁盘，存储更加高效，县比喻Hash算法。</li>
<li>Tair采用共享内存来存储数据，如果服务挂掉（非服务器），重启服务之后，数据亦然还在。</li>
</ul>
<h2 id="消息队列"><a href="#消息队列" class="headerlink" title="消息队列"></a>消息队列</h2><ul>
<li><p><a href="https://www.cnblogs.com/charlesblc/p/6045238.html" target="_blank" rel="noopener">《消息队列-推/拉模式学习 &amp; ActiveMQ及JMS学习》</a></p>
<ul>
<li>RabbitMQ 消费者默认是推模式（也支持拉模式）。</li>
<li>Kafka 默认是拉模式。</li>
<li>Push方式：优点是可以尽可能快地将消息发送给消费者，缺点是如果消费者处理能力跟不上，消费者的缓冲区可能会溢出。</li>
<li>Pull方式：优点是消费端可以按处理能力进行拉去，缺点是会增加消息延迟。</li>
</ul>
</li>
<li><p><a href="https://blog.csdn.net/yunfeng482/article/details/72856762" target="_blank" rel="noopener">《Kafka、RabbitMQ、RocketMQ等消息中间件的对比 —— 消息发送性能和区别》</a></p>
</li>
</ul>
<h3 id="消息总线"><a href="#消息总线" class="headerlink" title="消息总线"></a>消息总线</h3><p>消息总线相当于在消息队列之上做了一层封装，统一入口，统一管控、简化接入成本。</p>
<ul>
<li><a href="https://blog.csdn.net/yanghua_kobe/article/details/43877281" target="_blank" rel="noopener">《消息总线VS消息队列》</a></li>
</ul>
<h3 id="消息的顺序"><a href="#消息的顺序" class="headerlink" title="消息的顺序"></a>消息的顺序</h3><ul>
<li><a href="https://www.cnblogs.com/cjsblog/p/8267892.html" target="_blank" rel="noopener">《如何保证消费者接收消息的顺序》</a></li>
</ul>
<h3 id="RabbitMQ"><a href="#RabbitMQ" class="headerlink" title="RabbitMQ"></a>RabbitMQ</h3><p>支持事务，推拉模式都是支持、适合需要可靠性消息传输的场景。</p>
<ul>
<li><a href="https://blog.csdn.net/whoamiyang/article/details/54954780" target="_blank" rel="noopener">《RabbitMQ的应用场景以及基本原理介绍》</a></li>
<li><a href="https://www.jianshu.com/p/79ca08116d57" target="_blank" rel="noopener">《消息队列之 RabbitMQ》</a> </li>
<li><a href="https://blog.csdn.net/u013256816/article/details/55515234" target="_blank" rel="noopener">《RabbitMQ之消息确认机制（事务+Confirm）》</a></li>
</ul>
<h3 id="RocketMQ"><a href="#RocketMQ" class="headerlink" title="RocketMQ"></a>RocketMQ</h3><p>Java实现，推拉模式都是支持，吞吐量逊于Kafka。可以保证消息顺序。</p>
<ul>
<li><a href="https://www.jianshu.com/p/824066d70da8" target="_blank" rel="noopener">《RocketMQ 实战之快速入门》</a></li>
<li><a href="http://www.iocoder.cn/categories/RocketMQ/?vip&amp;architect-awesome" target="_blank" rel="noopener">《RocketMQ 源码解析》</a></li>
</ul>
<h3 id="ActiveMQ"><a href="#ActiveMQ" class="headerlink" title="ActiveMQ"></a>ActiveMQ</h3><p>纯Java实现，兼容JMS，可以内嵌于Java应用中。</p>
<ul>
<li><a href="https://www.cnblogs.com/wintersun/p/3962302.html" target="_blank" rel="noopener">《ActiveMQ消息队列介绍》</a></li>
</ul>
<h3 id="Kafka"><a href="#Kafka" class="headerlink" title="Kafka"></a>Kafka</h3><p>高吞吐量、采用拉模式。适合高IO场景，比如日志同步。</p>
<ul>
<li><a href="http://kafka.apache.org/" target="_blank" rel="noopener">官方网站</a></li>
<li><a href="https://blog.csdn.net/allthesametome/article/details/47362451" target="_blank" rel="noopener">《各消息队列对比，Kafka深度解析，众人推荐，精彩好文！》</a></li>
<li><a href="http://lxw1234.com/archives/2015/10/538.htm" target="_blank" rel="noopener">《Kafka分区机制介绍与示例》</a></li>
</ul>
<h3 id="Redis-消息推送"><a href="#Redis-消息推送" class="headerlink" title="Redis 消息推送"></a>Redis 消息推送</h3><p>生产者、消费者模式完全是客户端行为，list 和 拉模式实现，阻塞等待采用 blpop 指令。</p>
<ul>
<li><a href="https://blog.csdn.net/qq_34212276/article/details/78455004" target="_blank" rel="noopener">《Redis学习笔记之十：Redis用作消息队列》</a></li>
</ul>
<h3 id="ZeroMQ"><a href="#ZeroMQ" class="headerlink" title="ZeroMQ"></a>ZeroMQ</h3><p> TODO</p>
<h2 id="定时调度"><a href="#定时调度" class="headerlink" title="定时调度"></a>定时调度</h2><h3 id="单机定时调度"><a href="#单机定时调度" class="headerlink" title="单机定时调度"></a>单机定时调度</h3><ul>
<li><p><a href="https://www.cnblogs.com/shuaiqing/p/7742382.html" target="_blank" rel="noopener">《linux定时任务cron配置》</a></p>
</li>
<li><p><a href="https://my.oschina.net/daquan/blog/483305" target="_blank" rel="noopener">《Linux cron运行原理》</a></p>
<ul>
<li>fork 进程 + sleep 轮询</li>
</ul>
</li>
<li><p><a href="https://www.cnblogs.com/drift-ice/p/3817269.html" target="_blank" rel="noopener">《Quartz使用总结》</a></p>
</li>
<li><a href="https://blog.csdn.net/wenniuwuren/article/details/42082981/" target="_blank" rel="noopener">《Quartz源码解析 —- 触发器按时启动原理》</a></li>
<li><a href="https://www.jianshu.com/p/bab8e4e32952" target="_blank" rel="noopener">《quartz原理揭秘和源码解读》</a><ul>
<li>定时调度在 QuartzSchedulerThread 代码中，while()无限循环，每次循环取出时间将到的trigger，触发对应的job，直到调度器线程被关闭。</li>
</ul>
</li>
</ul>
<h3 id="分布式定时调度"><a href="#分布式定时调度" class="headerlink" title="分布式定时调度"></a>分布式定时调度</h3><ul>
<li><p><a href="https://blog.csdn.net/qq_16216221/article/details/70314337" target="_blank" rel="noopener">《这些优秀的国产分布式任务调度系统，你用过几个？》</a></p>
<ul>
<li>opencron、LTS、XXL-JOB、Elastic-Job、Uncode-Schedule、Antares</li>
</ul>
</li>
<li><p><a href="https://www.cnblogs.com/zhenyuyaodidiao/p/4755649.html" target="_blank" rel="noopener">《Quartz任务调度的基本实现原理》</a></p>
<ul>
<li>Quartz集群中，独立的Quartz节点并不与另一其的节点或是管理节点通信，而是通过相同的数据库表来感知到另一Quartz应用的 </li>
</ul>
</li>
<li><a href="http://www.iocoder.cn/categories/Elastic-Job-Lite/?vip&amp;architect-awesome" target="_blank" rel="noopener">《Elastic-Job-Lite 源码解析》</a></li>
<li><a href="http://www.iocoder.cn/categories/Elastic-Job-Cloud/?vip&amp;architect-awesome" target="_blank" rel="noopener">《Elastic-Job-Cloud 源码解析》</a></li>
</ul>
<h2 id="RPC"><a href="#RPC" class="headerlink" title="RPC"></a>RPC</h2><ul>
<li><p><a href="https://blog.csdn.net/top_code/article/details/54615853" target="_blank" rel="noopener">《从零开始实现RPC框架 - RPC原理及实现》</a></p>
<ul>
<li>核心角色：Server: 暴露服务的服务提供方、Client: 调用远程服务的服务消费方、Registry: 服务注册与发现的注册中心。</li>
</ul>
</li>
<li><p><a href="https://blog.csdn.net/testcs_dn/article/details/78050590" target="_blank" rel="noopener">《分布式RPC框架性能大比拼 dubbo、motan、rpcx、gRPC、thrift的性能比较》</a></p>
</li>
</ul>
<h3 id="Dubbo"><a href="#Dubbo" class="headerlink" title="Dubbo"></a>Dubbo</h3><ul>
<li><a href="http://dubbo.apache.org/" target="_blank" rel="noopener">官方网站</a></li>
<li><a href="https://www.cnblogs.com/steven520213/p/7606598.html" target="_blank" rel="noopener">dubbo实现原理简单介绍</a></li>
</ul>
<p><strong> SPI </strong><br>TODO</p>
<h3 id="Thrift"><a href="#Thrift" class="headerlink" title="Thrift"></a>Thrift</h3><ul>
<li><a href="http://thrift.apache.org/" target="_blank" rel="noopener">官方网站</a></li>
<li><a href="https://blog.csdn.net/kesonyk/article/details/50924489" target="_blank" rel="noopener">《Thrift RPC详解》</a><ul>
<li>支持多语言，通过中间语言定义接口。</li>
</ul>
</li>
</ul>
<h3 id="gRPC"><a href="#gRPC" class="headerlink" title="gRPC"></a>gRPC</h3><p>服务端可以认证加密，在外网环境下，可以保证数据安全。</p>
<ul>
<li><a href="https://grpc.io/" target="_blank" rel="noopener">官方网站</a></li>
<li><a href="https://www.cnblogs.com/LBSer/p/4853234.html" target="_blank" rel="noopener">《你应该知道的RPC原理》</a></li>
</ul>
<h2 id="数据库中间件"><a href="#数据库中间件" class="headerlink" title="数据库中间件"></a>数据库中间件</h2><h3 id="Sharding-Jdbc"><a href="#Sharding-Jdbc" class="headerlink" title="Sharding Jdbc"></a>Sharding Jdbc</h3><ul>
<li><a href="http://shardingjdbc.io/" target="_blank" rel="noopener">官网</a></li>
</ul>
<h2 id="日志系统"><a href="#日志系统" class="headerlink" title="日志系统"></a>日志系统</h2><h3 id="日志搜集"><a href="#日志搜集" class="headerlink" title="日志搜集"></a>日志搜集</h3><ul>
<li><a href="http://cjting.me/misc/build-log-system-with-elkb/" target="_blank" rel="noopener">《从零开始搭建一个ELKB日志收集系统》</a></li>
<li><a href="https://blog.csdn.net/lzw_2006/article/details/51280058" target="_blank" rel="noopener">《用ELK搭建简单的日志收集分析系统》</a></li>
<li><a href="https://www.cnblogs.com/beginmind/p/6058194.html" target="_blank" rel="noopener">《日志收集系统-探究》</a></li>
</ul>
<h2 id="配置中心"><a href="#配置中心" class="headerlink" title="配置中心"></a>配置中心</h2><ul>
<li><p><a href="https://github.com/ctripcorp/apollo" target="_blank" rel="noopener">Apollo - 携程开源的配置中心应用</a></p>
<ul>
<li>Spring Boot 和 Spring Cloud</li>
<li>支持推、拉模式更新配置</li>
<li>支持多种语言 </li>
</ul>
</li>
<li><p><a href="https://blog.csdn.net/u011320740/article/details/78742625" target="_blank" rel="noopener">《基于zookeeper实现统一配置管理》</a></p>
</li>
<li><p><a href="https://www.cnblogs.com/shamo89/p/8016908.html" target="_blank" rel="noopener">《 Spring Cloud Config 分布式配置中心使用教程》</a></p>
</li>
</ul>
<p>servlet 3.0 异步特性可用于配置中心的客户端</p>
<ul>
<li><a href="https://www.cnblogs.com/dogdogwang/p/7151866.html" target="_blank" rel="noopener">《servlet3.0 新特性——异步处理》</a></li>
</ul>
<h2 id="API-网关"><a href="#API-网关" class="headerlink" title="API 网关"></a>API 网关</h2><p>主要职责：请求转发、安全认证、协议转换、容灾。</p>
<ul>
<li><a href="http://yunlzheng.github.io/2017/03/14/the-things-about-api-gateway/" target="_blank" rel="noopener">《API网关那些儿》</a></li>
<li><p><a href="http://www.infoq.com/cn/news/2016/07/API-background-architecture-floo" target="_blank" rel="noopener">《谈API网关的背景、架构以及落地方案》</a></p>
</li>
<li><p><a href="https://blog.csdn.net/zhanglh046/article/details/78651993" target="_blank" rel="noopener">《使用Zuul构建API Gateway》</a></p>
</li>
<li><a href="http://www.iocoder.cn/categories/Spring-Cloud-Gateway/?vip&amp;architect-awesome" target="_blank" rel="noopener">《Spring Cloud Gateway 源码解析》</a></li>
<li><a href="https://mp.weixin.qq.com/s/LIq2CiXJQmmjBC0yvYLY5A" target="_blank" rel="noopener">《HTTP API网关选择之一Kong介绍》</a></li>
</ul>
<h1 id="网络"><a href="#网络" class="headerlink" title="网络"></a>网络</h1><h2 id="协议"><a href="#协议" class="headerlink" title="协议"></a>协议</h2><h3 id="OSI-七层协议"><a href="#OSI-七层协议" class="headerlink" title="OSI 七层协议"></a>OSI 七层协议</h3><ul>
<li><a href="https://www.cnblogs.com/Robin-YB/p/6668762.html" target="_blank" rel="noopener">《OSI七层协议模型、TCP/IP四层模型学习笔记》</a></li>
</ul>
<h3 id="TCP-IP"><a href="#TCP-IP" class="headerlink" title="TCP/IP"></a>TCP/IP</h3><ul>
<li><a href="https://www.cnblogs.com/onepixel/p/7092302.html" target="_blank" rel="noopener">《深入浅出 TCP/IP 协议》</a></li>
<li><a href="https://blog.csdn.net/whuslei/article/details/6667471/" target="_blank" rel="noopener">《TCP协议中的三次握手和四次挥手》</a></li>
</ul>
<h3 id="HTTP"><a href="#HTTP" class="headerlink" title="HTTP"></a>HTTP</h3><ul>
<li><a href="https://www.cnblogs.com/wangning528/p/6388464.html" target="_blank" rel="noopener">《http协议详解(超详细)》</a></li>
</ul>
<h3 id="HTTP2-0"><a href="#HTTP2-0" class="headerlink" title="HTTP2.0"></a>HTTP2.0</h3><ul>
<li><a href="https://blog.csdn.net/zhuyiquan/article/details/69257126" target="_blank" rel="noopener">《HTTP 2.0 原理详细分析》</a></li>
<li><a href="https://blog.csdn.net/u012657197/article/details/77877840" target="_blank" rel="noopener">《HTTP2.0的基本单位为二进制帧》</a><ul>
<li>利用二进制帧负责传输。</li>
<li>多路复用。</li>
</ul>
</li>
</ul>
<h3 id="HTTPS"><a href="#HTTPS" class="headerlink" title="HTTPS"></a>HTTPS</h3><ul>
<li><p><a href="https://www.cnblogs.com/zhangshitong/p/6478721.html" target="_blank" rel="noopener">《https原理通俗了解》</a></p>
<ul>
<li>使用非对称加密协商加密算法</li>
<li>使用对称加密方式传输数据</li>
<li>使用第三方机构签发的证书，来加密公钥，用于公钥的安全传输、防止被中间人串改。</li>
</ul>
</li>
<li><p><a href="https://blog.csdn.net/enweitech/article/details/53213862" target="_blank" rel="noopener">《八大免费SSL证书-给你的网站免费添加Https安全加密》</a></p>
</li>
</ul>
<h2 id="网络模型"><a href="#网络模型" class="headerlink" title="网络模型"></a>网络模型</h2><ul>
<li><p><a href="http://blog.51cto.com/litaotao/1289790" target="_blank" rel="noopener">《web优化必须了解的原理之I/o的五种模型和web的三种工作模式》</a></p>
<ul>
<li>五种I/O模型：阻塞I/O，非阻塞I/O，I/O复用、事件(信号)驱动I/O、异步I/O，前四种I/O属于同步操作，I/O的第一阶段不同、第二阶段相同，最后的一种则属于异步操作。</li>
<li>三种 Web Server 工作方式：Prefork(多进程)、Worker方式(线程方式)、Event方式。</li>
</ul>
</li>
<li><p><a href="http://www.cnblogs.com/Anker/p/3265058.html" target="_blank" rel="noopener">《select、poll、epoll之间的区别总结》</a></p>
<ul>
<li>select，poll，epoll本质上都是同步I/O，因为他们都需要在读写事件就绪后自己负责进行读写，也就是说这个读写过程是阻塞的。</li>
<li>select 有打开文件描述符数量限制，默认1024（2048 for x64），100万并发，就要用1000个进程、切换开销大；poll采用链表结构，没有数量限制。</li>
<li>select，poll “醒着”的时候要遍历整个fd集合，而epoll在“醒着”的时候只要判断一下就绪链表是否为空就行了，通过回调机制节省大量CPU时间；select，poll每次调用都要把fd集合从用户态往内核态拷贝一次，而epoll只要一次拷贝。</li>
<li>poll会随着并发增加，性能逐渐下降，epoll采用红黑树结构，性能稳定，不会随着连接数增加而降低。</li>
</ul>
</li>
<li><p><a href="http://xingyunbaijunwei.blog.163.com/blog/static/76538067201241685556302/" target="_blank" rel="noopener">《select，poll，epoll比较  》</a></p>
<ul>
<li>在连接数少并且连接都十分活跃的情况下，select和poll的性能可能比epoll好，毕竟epoll的通知机制需要很多函数回调。</li>
</ul>
</li>
<li><p><a href="https://www.cnblogs.com/geason/p/5774096.html" target="_blank" rel="noopener">《深入理解Java NIO》</a></p>
<ul>
<li>NIO 是一种同步非阻塞的 IO 模型。同步是指线程不断轮询 IO 事件是否就绪，非阻塞是指线程在等待 IO 的时候，可以同时做其他任务</li>
</ul>
</li>
<li><p><a href="https://blog.csdn.net/skiof007/article/details/52873421" target="_blank" rel="noopener">《BIO与NIO、AIO的区别》</a></p>
</li>
<li><p><a href="https://blog.csdn.net/u013074465/article/details/46276967" target="_blank" rel="noopener">《两种高效的服务器设计模型：Reactor和Proactor模型》</a></p>
</li>
</ul>
<h3 id="Epoll"><a href="#Epoll" class="headerlink" title="Epoll"></a>Epoll</h3><ul>
<li><a href="https://www.cnblogs.com/fnlingnzb-learner/p/5835573.html" target="_blank" rel="noopener">《epoll使用详解（精髓）》</a></li>
</ul>
<h3 id="Java-NIO"><a href="#Java-NIO" class="headerlink" title="Java NIO"></a>Java NIO</h3><ul>
<li><a href="https://www.cnblogs.com/geason/p/5774096.html" target="_blank" rel="noopener">《深入理解Java NIO》</a></li>
<li><a href="https://blog.csdn.net/xidianliuy/article/details/51612676" target="_blank" rel="noopener">《Java NIO编写Socket服务器的一个例子》</a></li>
</ul>
<h3 id="kqueue"><a href="#kqueue" class="headerlink" title="kqueue"></a>kqueue</h3><ul>
<li><a href="http://www.cnblogs.com/luminocean/p/5631336.html" target="_blank" rel="noopener">《kqueue用法简介》</a></li>
</ul>
<h2 id="连接和短连接"><a href="#连接和短连接" class="headerlink" title="连接和短连接"></a>连接和短连接</h2><ul>
<li><a href="https://www.cnblogs.com/pangguoping/p/5571422.html" target="_blank" rel="noopener">《TCP/IP系列——长连接与短连接的区别》</a></li>
</ul>
<h2 id="框架"><a href="#框架" class="headerlink" title="框架"></a>框架</h2><ul>
<li><a href="https://blog.csdn.net/excellentyuxiao/article/details/53390408" target="_blank" rel="noopener">《Netty原理剖析》</a><ul>
<li>Reactor 模式介绍。</li>
<li>Netty 是 Reactor 模式的一种实现。</li>
</ul>
</li>
</ul>
<h2 id="零拷贝（Zero-copy）"><a href="#零拷贝（Zero-copy）" class="headerlink" title="零拷贝（Zero-copy）"></a>零拷贝（Zero-copy）</h2><ul>
<li><a href="https://www.cnblogs.com/xys1228/p/6088805.html" target="_blank" rel="noopener">《对于 Netty ByteBuf 的零拷贝(Zero Copy) 的理解》</a><ul>
<li>多个物理分离的buffer，通过逻辑上合并成为一个，从而避免了数据在内存之间的拷贝。</li>
</ul>
</li>
</ul>
<h2 id="序列化-二进制协议"><a href="#序列化-二进制协议" class="headerlink" title="序列化(二进制协议)"></a>序列化(二进制协议)</h2><h3 id="Hessian"><a href="#Hessian" class="headerlink" title="Hessian"></a>Hessian</h3><ul>
<li><a href="https://www.cnblogs.com/happyday56/p/4268249.html" target="_blank" rel="noopener">《Hessian原理分析》</a><br>Binary-RPC;不仅仅是序列化</li>
</ul>
<h3 id="Protobuf"><a href="#Protobuf" class="headerlink" title="Protobuf"></a>Protobuf</h3><ul>
<li><a href="https://blog.csdn.net/antgan/article/details/52103966" target="_blank" rel="noopener">《Protobuf协议的Java应用例子》</a><br>Goolge出品、占用空间和效率完胜其他序列化类库，如Hessian；需要编写  .proto 文件。</li>
<li><p><a href="https://worktile.com/tech/share/prototol-buffers" target="_blank" rel="noopener">《Protocol Buffers序列化协议及应用》</a></p>
<pre><code>* 关于协议的解释；缺点：可读性差;
</code></pre></li>
<li><p><a href="https://blog.csdn.net/eric520zenobia/article/details/53766571" target="_blank" rel="noopener">《简单的使用 protobuf 和 protostuff》</a></p>
<ul>
<li>protostuff 的好处是不用写 .proto 文件，Java 对象直接就可以序列化。</li>
</ul>
</li>
</ul>
<h1 id="数据库"><a href="#数据库" class="headerlink" title="数据库"></a>数据库</h1><h2 id="基础理论"><a href="#基础理论" class="headerlink" title="基础理论"></a>基础理论</h2><h3 id="数据库设计的三大范式"><a href="#数据库设计的三大范式" class="headerlink" title="数据库设计的三大范式"></a>数据库设计的三大范式</h3><ul>
<li><a href="https://www.cnblogs.com/waj6511988/p/7027127.html" target="_blank" rel="noopener">《数据库的三大范式以及五大约束》</a><ul>
<li>第一范式：数据表中的每一列（每个字段）必须是不可拆分的最小单元，也就是确保每一列的原子性；</li>
<li>第二范式（2NF）：满足1NF后，要求表中的所有列，都必须依赖于主键，而不能有任何一列与主键没有关系，也就是说一个表只描述一件事情；</li>
<li>第三范式：必须先满足第二范式（2NF），要求：表中的每一列只与主键直接相关而不是间接相关，（表中的每一列只能依赖于主键）；</li>
</ul>
</li>
</ul>
<h2 id="MySQL"><a href="#MySQL" class="headerlink" title="MySQL"></a>MySQL</h2><h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><ul>
<li><p><a href="http://www.admin10000.com/document/5372.html" target="_blank" rel="noopener">《MySQL的InnoDB索引原理详解》</a></p>
</li>
<li><p><a href="https://blog.csdn.net/xifeijian/article/details/20316775" target="_blank" rel="noopener">《MySQL存储引擎－－MyISAM与InnoDB区别》</a></p>
<ul>
<li>两种类型最主要的差别就是Innodb 支持事务处理与外键和行级锁</li>
</ul>
</li>
<li><p><a href="https://www.2cto.com/database/201211/172380.html" target="_blank" rel="noopener">《myisam和innodb索引实现的不同》</a></p>
</li>
</ul>
<h3 id="InnoDB"><a href="#InnoDB" class="headerlink" title="InnoDB"></a>InnoDB</h3><ul>
<li><a href="https://my.oschina.net/kailuncen/blog/1504217" target="_blank" rel="noopener">《一篇文章带你读懂Mysql和InnoDB》</a></li>
</ul>
<h3 id="优化"><a href="#优化" class="headerlink" title="优化"></a>优化</h3><ul>
<li><p><a href="http://vdisk.weibo.com/s/muWOT" target="_blank" rel="noopener">《MySQL36条军规》</a></p>
</li>
<li><p><a href="https://www.cnblogs.com/zhouyusheng/p/8038224.html" target="_blank" rel="noopener">《MYSQL性能优化的最佳20+条经验》</a></p>
</li>
<li><a href="https://blog.csdn.net/when_less_is_more/article/details/70187459" target="_blank" rel="noopener">《SQL优化之道》</a></li>
<li><a href="https://www.cnblogs.com/sivkun/p/7518540.html" target="_blank" rel="noopener">《mysql数据库死锁的产生原因及解决办法》</a></li>
<li><a href="https://blog.csdn.net/monkey_d_feilong/article/details/52291556" target="_blank" rel="noopener">《导致索引失效的可能情况》</a></li>
<li><a href="https://blog.csdn.net/zy_281870667/article/details/51604540" target="_blank" rel="noopener">《 MYSQL分页limit速度太慢优化方法》</a><ul>
<li>原则上就是缩小扫描范围。</li>
</ul>
</li>
</ul>
<h3 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h3><h4 id="聚集索引-非聚集索引"><a href="#聚集索引-非聚集索引" class="headerlink" title="聚集索引, 非聚集索引"></a>聚集索引, 非聚集索引</h4><ul>
<li><a href="https://blog.csdn.net/no_endless/article/details/77073549" target="_blank" rel="noopener">《MySQL 聚集索引/非聚集索引简述》</a></li>
<li><a href="https://www.cnblogs.com/zlcxbb/p/5757245.html" target="_blank" rel="noopener">《MyISAM和InnoDB的索引实现》</a></li>
</ul>
<p>MyISAM 是非聚集，InnoDB 是聚集</p>
<h4 id="复合索引"><a href="#复合索引" class="headerlink" title="复合索引"></a>复合索引</h4><ul>
<li><a href="https://www.cnblogs.com/summer0space/p/7247778.html" target="_blank" rel="noopener">《复合索引的优点和注意事项》</a></li>
</ul>
<h4 id="自适应哈希索引-AHI"><a href="#自适应哈希索引-AHI" class="headerlink" title="自适应哈希索引(AHI)"></a>自适应哈希索引(AHI)</h4><ul>
<li><a href="https://blog.csdn.net/Linux_ever/article/details/62043708" target="_blank" rel="noopener">《InnoDB存储引擎——自适应哈希索引》</a></li>
</ul>
<h3 id="explain"><a href="#explain" class="headerlink" title="explain"></a>explain</h3><ul>
<li><a href="https://segmentfault.com/a/1190000008131735" target="_blank" rel="noopener">《MySQL 性能优化神器 Explain 使用分析》</a></li>
</ul>
<h2 id="NoSQL"><a href="#NoSQL" class="headerlink" title="NoSQL"></a>NoSQL</h2><h3 id="MongoDB"><a href="#MongoDB" class="headerlink" title="MongoDB"></a>MongoDB</h3><ul>
<li><a href="http://www.runoob.com/mongodb/mongodb-tutorial.html" target="_blank" rel="noopener">MongoDB 教程</a></li>
<li><a href="http://mxdxm.iteye.com/blog/2093603" target="_blank" rel="noopener">《Mongodb相对于关系型数据库的优缺点》</a><ul>
<li>优点：弱一致性（最终一致），更能保证用户的访问速度；内置GridFS，支持大容量的存储；Schema-less 数据库，不用预先定义结构；内置Sharding；相比于其他NoSQL，第三方支持丰富；性能优越；</li>
<li>缺点：mongodb不支持事务操作；mongodb占用空间过大；MongoDB没有如MySQL那样成熟的维护工具，这对于开发和IT运营都是个值得注意的地方；</li>
</ul>
</li>
</ul>
<h3 id="Hbase"><a href="#Hbase" class="headerlink" title="Hbase"></a>Hbase</h3><ul>
<li><a href="http://www.thebigdata.cn/HBase/35831.html" target="_blank" rel="noopener">《简明 HBase 入门教程（开篇）》</a></li>
<li><a href="https://www.cnblogs.com/qiaoyihang/p/6246424.html" target="_blank" rel="noopener">《深入学习HBase架构原理》</a></li>
<li><a href="https://blog.csdn.net/youzhouliu/article/details/67632882" target="_blank" rel="noopener">《传统的行存储和（HBase）列存储的区别》</a></li>
</ul>
<ul>
<li><p><a href="https://blog.csdn.net/lifuxiangcaohui/article/details/39891099" target="_blank" rel="noopener">《Hbase与传统数据库的区别》</a></p>
<ul>
<li>空数据不存储，节省空间，且适用于并发。</li>
</ul>
</li>
<li><p><a href="https://blog.csdn.net/u014091123/article/details/73163088" target="_blank" rel="noopener">《HBase Rowkey设计》</a></p>
<ul>
<li>rowkey 按照字典顺序排列，便于批量扫描。</li>
<li>通过散列可以避免热点。</li>
</ul>
</li>
</ul>
<h1 id="搜索引擎"><a href="#搜索引擎" class="headerlink" title="搜索引擎"></a>搜索引擎</h1><h2 id="搜索引擎原理"><a href="#搜索引擎原理" class="headerlink" title="搜索引擎原理"></a>搜索引擎原理</h2><ul>
<li><a href="https://www.jianshu.com/p/0193dc44135b" target="_blank" rel="noopener">《倒排索引–搜索引擎入门》</a></li>
</ul>
<h2 id="Lucene"><a href="#Lucene" class="headerlink" title="Lucene"></a>Lucene</h2><ul>
<li><a href="https://www.cnblogs.com/rodge-run/p/6551152.html" target="_blank" rel="noopener">《Lucene入门简介》</a></li>
</ul>
<h2 id="Elasticsearch"><a href="#Elasticsearch" class="headerlink" title="Elasticsearch"></a>Elasticsearch</h2><ul>
<li><a href="https://blog.csdn.net/laoyang360/article/details/52244917" target="_blank" rel="noopener">《Elasticsearch学习，请先看这一篇！》</a></li>
<li><a href="https://blog.csdn.net/cyony/article/details/65437708" target="_blank" rel="noopener">《Elasticsearch索引原理》</a></li>
</ul>
<h2 id="Solr"><a href="#Solr" class="headerlink" title="Solr"></a>Solr</h2><ul>
<li><a href="https://blog.csdn.net/u011936655/article/details/51960005" target="_blank" rel="noopener">《 Apache Solr入门教程》</a></li>
<li><a href="https://blog.csdn.net/convict_eva/article/details/53537837" target="_blank" rel="noopener">《elasticsearch与solr比较》</a></li>
</ul>
<h2 id="sphinx"><a href="#sphinx" class="headerlink" title="sphinx"></a>sphinx</h2><ul>
<li><a href="http://blog.jobbole.com/101672/" target="_blank" rel="noopener">《Sphinx 的介绍和原理探索》</a></li>
</ul>
<h1 id="性能"><a href="#性能" class="headerlink" title="性能"></a>性能</h1><h2 id="性能优化方法论"><a href="#性能优化方法论" class="headerlink" title="性能优化方法论"></a>性能优化方法论</h2><ul>
<li><p><a href="https://blog.csdn.net/huangwenyi1010/article/details/72673447?ref=myread" target="_blank" rel="noopener">《15天的性能优化工作，5方面的调优经验》</a></p>
<ul>
<li>代码层面、业务层面、数据库层面、服务器层面、前端优化。</li>
</ul>
</li>
<li><p><a href="https://blog.csdn.net/tenglizhe/article/details/44563135" target="_blank" rel="noopener">《系统性能优化的几个方面》</a></p>
</li>
</ul>
<h2 id="容量评估"><a href="#容量评估" class="headerlink" title="容量评估"></a>容量评估</h2><ul>
<li><a href="https://blog.csdn.net/u012528360/article/details/70054156" target="_blank" rel="noopener">《联网性能与容量评估的方法论和典型案例》</a></li>
<li><a href="https://mp.weixin.qq.com/s?__biz=MjM5ODYxMDA5OQ==&amp;mid=2651959542&amp;idx=1&amp;sn=2494bbea9a855e0e1c3ccd6d2562a600&amp;scene=21#wechat_redirect" target="_blank" rel="noopener">《互联网架构，如何进行容量设计？》</a><ul>
<li>评估总访问量、评估平均访问量QPS、评估高峰QPS、评估系统、单机极限QPS</li>
</ul>
</li>
</ul>
<h2 id="CDN-网络"><a href="#CDN-网络" class="headerlink" title="CDN 网络"></a>CDN 网络</h2><ul>
<li><a href="https://www.cnblogs.com/wxiaona/p/5867685.html" target="_blank" rel="noopener">《CDN加速原理》</a></li>
<li><a href="https://www.zhihu.com/question/20536932" target="_blank" rel="noopener">《国内有哪些比较好的 CDN？》</a></li>
</ul>
<h2 id="连接池"><a href="#连接池" class="headerlink" title="连接池"></a>连接池</h2><ul>
<li><a href="https://blog.csdn.net/fysuccess/article/details/66972554" target="_blank" rel="noopener">《主流Java数据库连接池比较与开发配置实战》</a></li>
</ul>
<h2 id="性能调优"><a href="#性能调优" class="headerlink" title="性能调优"></a>性能调优</h2><ul>
<li><a href="https://blog.csdn.net/yethyeth/article/details/73266455" target="_blank" rel="noopener">《九大Java性能调试工具，必备至少一款》</a></li>
</ul>
<h1 id="大数据"><a href="#大数据" class="headerlink" title="大数据"></a>大数据</h1><h2 id="流式计算"><a href="#流式计算" class="headerlink" title="流式计算"></a>流式计算</h2><h3 id="Storm"><a href="#Storm" class="headerlink" title="Storm"></a>Storm</h3><ul>
<li><a href="http://storm.apache.org/" target="_blank" rel="noopener">官方网站</a></li>
<li><a href="https://blog.csdn.net/uisoul/article/details/77989927" target="_blank" rel="noopener">《最详细的Storm入门教程》</a></li>
</ul>
<h3 id="Flink"><a href="#Flink" class="headerlink" title="Flink"></a>Flink</h3><ul>
<li><a href="https://blog.csdn.net/lisi1129/article/details/54844919" target="_blank" rel="noopener">《Flink之一 Flink基本原理介绍》</a></li>
</ul>
<h3 id="Kafka-Stream"><a href="#Kafka-Stream" class="headerlink" title="Kafka Stream"></a>Kafka Stream</h3><ul>
<li><a href="https://yq.aliyun.com/articles/58382" target="_blank" rel="noopener">《Kafka Stream调研：一种轻量级流计算模式》</a></li>
</ul>
<h3 id="应用场景-1"><a href="#应用场景-1" class="headerlink" title="应用场景"></a>应用场景</h3><p>例如：</p>
<ul>
<li>广告相关实时统计；</li>
<li>推荐系统用户画像标签实时更新；</li>
<li>线上服务健康状况实时监测；</li>
<li>实时榜单；</li>
<li>实时数据统计。</li>
</ul>
<h2 id="Hadoop"><a href="#Hadoop" class="headerlink" title="Hadoop"></a>Hadoop</h2><ul>
<li><a href="https://blog.csdn.net/houbin0912/article/details/72967178" target="_blank" rel="noopener">《用通俗易懂的话说下hadoop是什么,能做什么》</a></li>
<li><a href="http://gitbook.cn/books/5954c9600326c7705af8a92a/index.html" target="_blank" rel="noopener">《史上最详细的Hadoop环境搭建》</a></li>
</ul>
<h3 id="HDFS"><a href="#HDFS" class="headerlink" title="HDFS"></a>HDFS</h3><ul>
<li><a href="https://segmentfault.com/a/1190000011575458" target="_blank" rel="noopener">《【Hadoop学习】HDFS基本原理》</a></li>
</ul>
<h3 id="MapReduce"><a href="#MapReduce" class="headerlink" title="MapReduce"></a>MapReduce</h3><ul>
<li><a href="https://blog.csdn.net/oppo62258801/article/details/72884633" target="_blank" rel="noopener">《用通俗易懂的大白话讲解Map/Reduce原理》</a></li>
<li><a href="https://blog.csdn.net/foye12/article/details/78358292" target="_blank" rel="noopener">《 简单的map-reduce的java例子》</a></li>
</ul>
<h3 id="Yarn"><a href="#Yarn" class="headerlink" title="Yarn"></a>Yarn</h3><ul>
<li><a href="http://www.cnblogs.com/codeOfLife/p/5492740.html" target="_blank" rel="noopener">《初步掌握Yarn的架构及原理》</a></li>
</ul>
<h2 id="Spark"><a href="#Spark" class="headerlink" title="Spark"></a>Spark</h2><ul>
<li><a href="http://www.cnblogs.com/tgzhu/p/5818374.html" target="_blank" rel="noopener">《Spark(一): 基本架构及原理》</a></li>
</ul>
<h1 id="安全"><a href="#安全" class="headerlink" title="安全"></a>安全</h1><h2 id="web-安全"><a href="#web-安全" class="headerlink" title="web 安全"></a>web 安全</h2><h3 id="XSS"><a href="#XSS" class="headerlink" title="XSS"></a>XSS</h3><ul>
<li><a href="https://blog.csdn.net/qq_21956483/article/details/54377947" target="_blank" rel="noopener">《xss攻击原理与解决方法》</a><h3 id="CSRF"><a href="#CSRF" class="headerlink" title="CSRF"></a>CSRF</h3></li>
<li><a href="https://coderxing.gitbooks.io/architecture-evolution/di-san-pian-ff1a-bu-luo/641-web-an-quan-fang-fan/6412-csrf.html" target="_blank" rel="noopener">《CSRF原理及防范》</a></li>
</ul>
<h3 id="SQL-注入"><a href="#SQL-注入" class="headerlink" title="SQL 注入"></a>SQL 注入</h3><ul>
<li><a href="https://coderxing.gitbooks.io/architecture-evolution/di-san-pian-ff1a-bu-luo/641-web-an-quan-fang-fan/6413-sql-zhu-ru.html" target="_blank" rel="noopener">《SQL注入》</a></li>
</ul>
<h3 id="Hash-Dos"><a href="#Hash-Dos" class="headerlink" title="Hash Dos"></a>Hash Dos</h3><ul>
<li><a href="http://www.freebuf.com/articles/web/14199.html" target="_blank" rel="noopener">《邪恶的JAVA HASH DOS攻击》</a><ul>
<li>利用JsonObjet 上传大Json，JsonObject 底层使用HashMap；不同的数据产生相同的hash值，使得构建Hash速度变慢，耗尽CPU。</li>
</ul>
</li>
<li><a href="https://yq.aliyun.com/articles/92194?t=t1" target="_blank" rel="noopener">《一种高级的DoS攻击-Hash碰撞攻击》</a></li>
<li><a href="http://www.iteye.com/news/23939/" target="_blank" rel="noopener">《关于Hash Collision DoS漏洞：解析与解决方案》</a></li>
</ul>
<h3 id="脚本注入"><a href="#脚本注入" class="headerlink" title="脚本注入"></a>脚本注入</h3><ul>
<li><a href="https://coderxing.gitbooks.io/architecture-evolution/di-san-pian-ff1a-bu-luo/641-web-an-quan-fang-fan/6414-shang-chuan-wen-jian-guo-lv.html" target="_blank" rel="noopener">《上传文件漏洞原理及防范》</a></li>
</ul>
<h3 id="漏洞扫描工具"><a href="#漏洞扫描工具" class="headerlink" title="漏洞扫描工具"></a>漏洞扫描工具</h3><ul>
<li><a href="https://coderxing.gitbooks.io/architecture-evolution/di-san-pian-ff1a-bu-luo/6421-dvwa.html" target="_blank" rel="noopener">《DVWA》</a></li>
<li><a href="https://coderxing.gitbooks.io/architecture-evolution/di-san-pian-ff1a-bu-luo/w3af.html" target="_blank" rel="noopener">W3af</a></li>
<li><a href="https://blog.csdn.net/xygg0801/article/details/53610640" target="_blank" rel="noopener">OpenVAS详解</a></li>
</ul>
<h3 id="验证码"><a href="#验证码" class="headerlink" title="验证码"></a>验证码</h3><ul>
<li><p><a href="https://blog.csdn.net/niaonao/article/details/51112686" target="_blank" rel="noopener">《验证码原理分析及实现》</a></p>
</li>
<li><p><a href="https://my.oschina.net/jiangbianwanghai/blog/1031031" target="_blank" rel="noopener">《详解滑动验证码的实现原理》</a></p>
<ul>
<li>滑动验证码是根据人在滑动滑块的响应时间，拖拽速度，时间，位置，轨迹，重试次数等来评估风险。</li>
</ul>
</li>
<li><p><a href="https://www.cnblogs.com/xcj26/p/5242758.html" target="_blank" rel="noopener">《淘宝滑动验证码研究》</a></p>
</li>
</ul>
<h2 id="DDoS-防范"><a href="#DDoS-防范" class="headerlink" title="DDoS 防范"></a>DDoS 防范</h2><ul>
<li><a href="http://netsecurity.51cto.com/art/201601/503799.htm" target="_blank" rel="noopener">《学习手册：DDoS的攻击方式及防御手段》</a></li>
<li><a href="http://netsecurity.51cto.com/art/201406/442756.htm" target="_blank" rel="noopener">《免费DDoS攻击测试工具大合集》</a></li>
</ul>
<h2 id="用户隐私信息保护"><a href="#用户隐私信息保护" class="headerlink" title="用户隐私信息保护"></a>用户隐私信息保护</h2><ol>
<li>用户密码非明文保存，加动态salt。</li>
<li>身份证号，手机号如果要显示，用 “*” 替代部分字符。</li>
<li>联系方式在的显示与否由用户自己控制。</li>
<li>TODO</li>
</ol>
<ul>
<li><a href="https://zhidao.baidu.com/question/1988017976673661587.html" target="_blank" rel="noopener">《个人隐私包括哪些》</a></li>
<li><p><a href="https://www.zhihu.com/question/20137108" target="_blank" rel="noopener">《在互联网上，隐私的范围包括哪些？》</a></p>
</li>
<li><p><a href="https://coderxing.gitbooks.io/architecture-evolution/di-san-pian-ff1a-bu-luo/642-shu-ju-jia-mi/6425-jia-mi-chang-jing-ff1a-yong-hu-mi-ma-bao-cun.html" target="_blank" rel="noopener">《用户密码保存》</a></p>
</li>
</ul>
<h2 id="序列化漏洞"><a href="#序列化漏洞" class="headerlink" title="序列化漏洞"></a>序列化漏洞</h2><ul>
<li><a href="https://blog.chaitin.cn/2015-11-11_java_unserialize_rce/" target="_blank" rel="noopener">《Lib之过？Java反序列化漏洞通用利用分析》</a></li>
</ul>
<h2 id="加密解密"><a href="#加密解密" class="headerlink" title="加密解密"></a>加密解密</h2><h3 id="对称加密"><a href="#对称加密" class="headerlink" title="对称加密"></a>对称加密</h3><ul>
<li><a href="https://coderxing.gitbooks.io/architecture-evolution/di-san-pian-ff1a-bu-luo/642-shu-ju-jia-mi/6421-chang-jian-dui-cheng-jia-mi-suan-fa.html" target="_blank" rel="noopener">《常见对称加密算法》</a><ul>
<li>DES、3DES、Blowfish、AES</li>
<li>DES 采用 56位秘钥，Blowfish 采用1到448位变长秘钥，AES 128，192和256位长度的秘钥。</li>
<li>DES 秘钥太短（只有56位）算法目前已经被 AES 取代，并且 AES 有硬件加速，性能很好。</li>
</ul>
</li>
</ul>
<h3 id="哈希算法"><a href="#哈希算法" class="headerlink" title="哈希算法"></a>哈希算法</h3><ul>
<li><p><a href="https://coderxing.gitbooks.io/architecture-evolution/di-san-pian-ff1a-bu-luo/642-shu-ju-jia-mi/6422-chang-jian-ha-xi-suan-fa-and-hmac.html" target="_blank" rel="noopener">《常用的哈希算法》</a></p>
<ul>
<li>MD5 和 SHA-1 已经不再安全，已被弃用。</li>
<li>目前 SHA-256 是比较安全的。</li>
</ul>
</li>
<li><p><a href="https://blog.csdn.net/zhangruhong168/article/details/78033202" target="_blank" rel="noopener">《基于Hash摘要签名的公网URL签名验证设计方案》</a></p>
</li>
</ul>
<h3 id="非对称加密"><a href="#非对称加密" class="headerlink" title="非对称加密"></a>非对称加密</h3><ul>
<li><p><a href="https://coderxing.gitbooks.io/architecture-evolution/di-san-pian-ff1a-bu-luo/642-shu-ju-jia-mi/6424-chang-yong-fei-dui-cheng-jia-mi-suan-fa.html" target="_blank" rel="noopener">《常见非对称加密算法》</a></p>
<ul>
<li>RSA、DSA、ECDSA(螺旋曲线加密算法)</li>
<li>和 RSA 不同的是 DSA 仅能用于数字签名，不能进行数据加密解密，其安全性和RSA相当，但其性能要比RSA快。</li>
<li><p>256位的ECC秘钥的安全性等同于3072位的RSA秘钥。</p>
<p>  <a href="http://baijiahao.baidu.com/s?id=1578348858092033763&amp;wfr=spider&amp;for=pc" target="_blank" rel="noopener">《区块链的加密技术》</a>    </p>
</li>
</ul>
</li>
</ul>
<h2 id="服务器安全"><a href="#服务器安全" class="headerlink" title="服务器安全"></a>服务器安全</h2><ul>
<li><a href="http://www.freebuf.com/articles/system/121540.html" target="_blank" rel="noopener">《Linux强化论：15步打造一个安全的Linux服务器》</a></li>
</ul>
<h2 id="数据安全"><a href="#数据安全" class="headerlink" title="数据安全"></a>数据安全</h2><h3 id="数据备份"><a href="#数据备份" class="headerlink" title="数据备份"></a>数据备份</h3><p>TODO</p>
<h2 id="网络隔离"><a href="#网络隔离" class="headerlink" title="网络隔离"></a>网络隔离</h2><h3 id="内外网分离"><a href="#内外网分离" class="headerlink" title="内外网分离"></a>内外网分离</h3><p>TODO</p>
<h3 id="登录跳板机"><a href="#登录跳板机" class="headerlink" title="登录跳板机"></a>登录跳板机</h3><p>在内外环境中通过跳板机登录到线上主机。</p>
<ul>
<li><a href="http://blog.51cto.com/zero01/2062618" target="_blank" rel="noopener">《搭建简易堡垒机》</a></li>
</ul>
<h2 id="授权、认证"><a href="#授权、认证" class="headerlink" title="授权、认证"></a>授权、认证</h2><h3 id="RBAC"><a href="#RBAC" class="headerlink" title="RBAC"></a>RBAC</h3><ul>
<li><a href="https://www.cnblogs.com/zq8024/p/5003050.html" target="_blank" rel="noopener">《基于组织角色的权限设计》</a></li>
<li><a href="https://www.cnblogs.com/shijiaqi1066/p/3793894.html" target="_blank" rel="noopener">《权限系统与RBAC模型概述》</a></li>
<li><a href="https://blog.csdn.net/he90227/article/details/38663553" target="_blank" rel="noopener">《Spring整合Shiro做权限控制模块详细案例分析》</a></li>
</ul>
<h3 id="OAuth2-0"><a href="#OAuth2-0" class="headerlink" title="OAuth2.0"></a>OAuth2.0</h3><ul>
<li><a href="http://www.ruanyifeng.com/blog/2014/05/oauth_2_0.html" target="_blank" rel="noopener">《理解OAuth 2.0》</a></li>
<li><a href="https://www.cnblogs.com/flashsun/p/7424071.html" target="_blank" rel="noopener">《一张图搞定OAuth2.0》</a></li>
</ul>
<h3 id="双因素认证（2FA）"><a href="#双因素认证（2FA）" class="headerlink" title="双因素认证（2FA）"></a>双因素认证（2FA）</h3><p>2FA - Two-factor authentication，用于加强登录验证</p>
<p>常用做法是 登录密码 + 手机验证码（或者令牌Key，类似于与网银的 USB key）</p>
<ul>
<li>【《双因素认证（2FA）教程》】(<a href="http://www.ruanyifeng.com/blog/2017/11/2fa-tutorial.html" target="_blank" rel="noopener">http://www.ruanyifeng.com/blog/2017/11/2fa-tutorial.html</a>)</li>
</ul>
<h3 id="单点登录-SSO"><a href="#单点登录-SSO" class="headerlink" title="单点登录(SSO)"></a>单点登录(SSO)</h3><ul>
<li><p><a href="https://www.cnblogs.com/ywlaker/p/6113927.html" target="_blank" rel="noopener">《单点登录原理与简单实现》</a></p>
</li>
<li><p><a href="https://github.com/apereo/cas" target="_blank" rel="noopener">CAS单点登录框架</a></p>
</li>
</ul>
<h1 id="常用开源框架"><a href="#常用开源框架" class="headerlink" title="常用开源框架"></a>常用开源框架</h1><h2 id="开源协议"><a href="#开源协议" class="headerlink" title="开源协议"></a>开源协议</h2><ul>
<li><p><a href="https://coderxing.gitbooks.io/architecture-evolution/chapter1/di-yi-zhang-ff1a-zhun-bei-qi-cheng/12-guan-yu-kai-yuan/123-kai-yuan-xie-yi-de-xuan-ze.html" target="_blank" rel="noopener">《开源协议的选择》</a></p>
</li>
<li><p><a href="http://choosealicense.online/" target="_blank" rel="noopener">如何选择一个开源软件协议</a></p>
</li>
</ul>
<h2 id="日志框架"><a href="#日志框架" class="headerlink" title="日志框架"></a>日志框架</h2><h3 id="Log4j、Log4j2"><a href="#Log4j、Log4j2" class="headerlink" title="Log4j、Log4j2"></a>Log4j、Log4j2</h3><ul>
<li><a href="https://blog.csdn.net/u012422446/article/details/51199724" target="_blank" rel="noopener">《log4j 详细讲解》</a></li>
<li><a href="https://blog.csdn.net/vbirdbest/article/details/71751835" target="_blank" rel="noopener">《log4j2 实际使用详解》</a></li>
<li><a href="https://my.oschina.net/OutOfMemory/blog/789267" target="_blank" rel="noopener">《Log4j1,Logback以及Log4j2性能测试对比》</a><ul>
<li>Log4J 异步日志性能优异。 </li>
</ul>
</li>
</ul>
<h3 id="Logback"><a href="#Logback" class="headerlink" title="Logback"></a>Logback</h3><ul>
<li><a href="https://blog.csdn.net/rulon147/article/details/52620541" target="_blank" rel="noopener">《最全LogBack 详解、含java案例和配置说明》</a></li>
</ul>
<h2 id="ORM"><a href="#ORM" class="headerlink" title="ORM"></a>ORM</h2><ul>
<li><a href="https://blog.csdn.net/sinat_34093604/article/details/53082000" target="_blank" rel="noopener">《ORM框架使用优缺点》</a><ul>
<li>主要目的是为了提高开发效率。 </li>
</ul>
</li>
</ul>
<p><strong>MyBatis：</strong></p>
<ul>
<li><p><a href="https://www.cnblogs.com/winclpt/articles/7511672.html" target="_blank" rel="noopener">《mybatis缓存机制详解》</a></p>
<ul>
<li>一级缓存是SqlSession级别的缓存，缓存的数据只在SqlSession内有效</li>
<li>二级缓存是mapper级别的缓存，同一个namespace公用这一个缓存，所以对SqlSession是共享的；使用 LRU 机制清理缓存，通过 cacheEnabled 参数开启。  </li>
</ul>
</li>
<li><p><a href="https://blog.csdn.net/baidu_32877851/article/details/53959268" target="_blank" rel="noopener">《MyBatis学习之代码生成器Generator》</a></p>
</li>
</ul>
<h2 id="网络框架"><a href="#网络框架" class="headerlink" title="网络框架"></a>网络框架</h2><p>TODO</p>
<h2 id="Web-框架"><a href="#Web-框架" class="headerlink" title="Web 框架"></a>Web 框架</h2><h3 id="Spring-家族"><a href="#Spring-家族" class="headerlink" title="Spring 家族"></a>Spring 家族</h3><p><strong>Spring</strong></p>
<ul>
<li><a href="https://www.w3cschool.cn/wkspring/" target="_blank" rel="noopener">Spring 简明教程</a></li>
</ul>
<p><strong>Spring Boot</strong></p>
<ul>
<li><a href="http://projects.spring.io/spring-boot/" target="_blank" rel="noopener">官方网站</a></li>
<li><a href="http://blog.didispace.com/Spring-Boot%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/" target="_blank" rel="noopener">《Spring Boot基础教程》</a></li>
</ul>
<p><strong>Spring Cloud</strong></p>
<ul>
<li><a href="http://springboot.fun/" target="_blank" rel="noopener">Spring Boot 中文索引站</a></li>
<li><a href="https://springcloud.cc/" target="_blank" rel="noopener">Spring Cloud 中文文档</a></li>
<li><a href="http://blog.didispace.com/Spring-Cloud%E5%9F%BA%E7%A1%80%E6%95%99%E7%A8%8B/" target="_blank" rel="noopener">《Spring Cloud基础教程》</a></li>
</ul>
<h2 id="工具框架"><a href="#工具框架" class="headerlink" title="工具框架"></a>工具框架</h2><ul>
<li><a href="https://www.cnblogs.com/crazylqy/p/4872236.html" target="_blank" rel="noopener">《Apache Commons 工具类介绍及简单使用》</a></li>
<li><a href="http://ifeve.com/google-guava/" target="_blank" rel="noopener">《Google guava 中文教程》</a></li>
</ul>
<h1 id="分布式设计"><a href="#分布式设计" class="headerlink" title="分布式设计"></a>分布式设计</h1><h2 id="扩展性设计"><a href="#扩展性设计" class="headerlink" title="扩展性设计"></a>扩展性设计</h2><ul>
<li><p><a href="https://blog.csdn.net/hemin1003/article/details/53633926" target="_blank" rel="noopener">《架构师不可不知的十大可扩展架构》</a></p>
<ul>
<li>总结下来，通用的套路就是分布、缓存及异步处理。 </li>
</ul>
</li>
<li><p><a href="https://yq.aliyun.com/articles/38119" target="_blank" rel="noopener">《可扩展性设计之数据切分》</a></p>
<ul>
<li>水平切分+垂直切分</li>
<li>利用中间件进行分片如，MySQL Proxy。</li>
<li>利用分片策略进行切分，如按照ID取模。 </li>
</ul>
</li>
<li><p><a href="https://blog.csdn.net/deniro_li/article/details/78458306" target="_blank" rel="noopener">《说说如何实现可扩展性的大型网站架构》</a></p>
<ul>
<li>分布式服务+消息队列。</li>
</ul>
</li>
<li><p><a href="https://blog.csdn.net/chaofanwei/article/details/29191073" target="_blank" rel="noopener">《大型网站技术架构（七）–网站的可扩展性架构》</a></p>
</li>
</ul>
<h2 id="稳定性-amp-高可用"><a href="#稳定性-amp-高可用" class="headerlink" title="稳定性 &amp; 高可用"></a>稳定性 &amp; 高可用</h2><ul>
<li><a href="https://blog.csdn.net/hustspy1990/article/details/78008324" target="_blank" rel="noopener">《系统设计：关于高可用系统的一些技术方案》</a><ul>
<li>可扩展：水平扩展、垂直扩展。 通过冗余部署，避免单点故障。</li>
<li>隔离：避免单一业务占用全部资源。避免业务之间的相互影响 2. 机房隔离避免单点故障。</li>
<li>解耦：降低维护成本，降低耦合风险。减少依赖，减少相互间的影响。</li>
<li>限流：滑动窗口计数法、漏桶算法、令牌桶算法等算法。遇到突发流量时，保证系统稳定。</li>
<li>降级：紧急情况下释放非核心功能的资源。牺牲非核心业务，保证核心业务的高可用。</li>
<li>熔断：异常情况超出阈值进入熔断状态，快速失败。减少不稳定的外部依赖对核心服务的影响。</li>
<li>自动化测试：通过完善的测试，减少发布引起的故障。</li>
<li>灰度发布：灰度发布是速度与安全性作为妥协，能够有效减少发布故障。</li>
</ul>
</li>
</ul>
<ul>
<li><a href="https://coolshell.cn/articles/17459.html" target="_blank" rel="noopener">《关于高可用的系统》</a><ul>
<li>设计原则：数据不丢(持久化)；服务高可用(服务副本)；绝对的100%高可用很难，目标是做到尽可能多的9，如99.999%（全年累计只有5分钟）。     </li>
</ul>
</li>
</ul>
<h3 id="硬件负载均衡"><a href="#硬件负载均衡" class="headerlink" title="硬件负载均衡"></a>硬件负载均衡</h3><ul>
<li><p><a href="https://www.cnblogs.com/wuyun-blog/p/6186198.html" target="_blank" rel="noopener">《转！！负载均衡器技术Nginx和F5的优缺点对比》</a></p>
<ul>
<li>主要是和F5对比。</li>
</ul>
</li>
<li><p><a href="https://www.cnblogs.com/lcword/p/5773296.html" target="_blank" rel="noopener">《软/硬件负载均衡产品 你知多少？》</a></p>
</li>
</ul>
<h3 id="软件负载均衡"><a href="#软件负载均衡" class="headerlink" title="软件负载均衡"></a>软件负载均衡</h3><ul>
<li><a href="https://www.cnblogs.com/tianzhiliang/articles/2317808.html" target="_blank" rel="noopener">《几种负载均衡算法》</a><br>  轮寻、权重、负载、最少连接、QoS</li>
<li><a href="https://coderxing.gitbooks.io/architecture-evolution/di-san-pian-ff1a-bu-luo/611-dns-fang-shi.html" target="_blank" rel="noopener">《DNS负载均衡》</a><ul>
<li>配置简单，更新速度慢。 </li>
</ul>
</li>
<li><p><a href="https://coderxing.gitbooks.io/architecture-evolution/di-san-pian-ff1a-bu-luo/613-nginx-fu-zai-jun-heng.html" target="_blank" rel="noopener">《Nginx负载均衡》</a></p>
<ul>
<li>简单轻量、学习成本低；主要适用于web应用。</li>
</ul>
</li>
<li><p><a href="https://www.cnblogs.com/edisonchou/p/4281978.html" target="_blank" rel="noopener">《借助LVS+Keepalived实现负载均衡 》</a></p>
<ul>
<li>配置比较负载、只支持到4层，性能较高。</li>
</ul>
</li>
<li><p><a href="http://www.ttlsa.com/linux/haproxy-study-tutorial/" target="_blank" rel="noopener">《HAProxy用法详解 全网最详细中文文档》</a></p>
<ul>
<li>支持到七层（比如HTTP）、功能比较全面，性能也不错。</li>
</ul>
</li>
<li><p><a href="http://blog.itpub.net/25704976/viewspace-1319781/" target="_blank" rel="noopener">《Haproxy+Keepalived+MySQL实现读均衡负载》</a></p>
<ul>
<li>主要是用户读请求的负载均衡。</li>
</ul>
</li>
<li><p><a href="https://www.cnblogs.com/lylife/p/5584019.html" target="_blank" rel="noopener">《rabbitmq+haproxy+keepalived实现高可用集群搭建》</a></p>
</li>
</ul>
<h3 id="限流"><a href="#限流" class="headerlink" title="限流"></a>限流</h3><ul>
<li><a href="https://www.cnblogs.com/haoxinyue/p/6792309.html" target="_blank" rel="noopener">《谈谈高并发系统的限流》</a><ul>
<li>计数器：通过滑动窗口计数器，控制单位时间内的请求次数，简单粗暴。</li>
<li>漏桶算法：固定容量的漏桶，漏桶满了就丢弃请求，比较常用。</li>
<li>令牌桶算法：固定容量的令牌桶，按照一定速率添加令牌，处理请求前需要拿到令牌，拿不到令牌则丢弃请求，或进入丢队列，可以通过控制添加令牌的速率，来控制整体速度。Guava 中的 RateLimiter 是令牌桶的实现。</li>
<li>Nginx 限流：通过 <code>limit_req</code> 等模块限制并发连接数。</li>
</ul>
</li>
</ul>
<h3 id="应用层容灾"><a href="#应用层容灾" class="headerlink" title="应用层容灾"></a>应用层容灾</h3><ul>
<li><p><a href="https://segmentfault.com/a/1190000005988895" target="_blank" rel="noopener">《防雪崩利器：熔断器 Hystrix 的原理与使用》</a></p>
<ul>
<li>雪崩效应原因：硬件故障、硬件故障、程序Bug、重试加大流量、用户大量请求。 </li>
<li>雪崩的对策：限流、改进缓存模式(缓存预加载、同步调用改异步)、自动扩容、降级。</li>
<li>Hystrix设计原则：<ul>
<li>资源隔离：Hystrix通过将每个依赖服务分配独立的线程池进行资源隔离, 从而避免服务雪崩。</li>
<li>熔断开关：服务的健康状况 = 请求失败数 / 请求总数，通过阈值设定和滑动窗口控制开关。</li>
<li>命令模式：通过继承 HystrixCommand 来包装服务调用逻辑。 </li>
</ul>
</li>
</ul>
</li>
<li><p><a href="https://blog.csdn.net/zeb_perfect/article/details/54135506" target="_blank" rel="noopener">《缓存穿透，缓存击穿，缓存雪崩解决方案分析》</a></p>
</li>
<li><a href="https://blog.csdn.net/zeb_perfect/article/details/54135506" target="_blank" rel="noopener">《缓存击穿、失效以及热点key问题》</a> <ul>
<li>主要策略：失效瞬间：单机使用锁；使用分布式锁；不过期；</li>
<li>热点数据：热点数据单独存储；使用本地缓存；分成多个子key；</li>
</ul>
</li>
</ul>
<h3 id="跨机房容灾"><a href="#跨机房容灾" class="headerlink" title="跨机房容灾"></a>跨机房容灾</h3><ul>
<li><p><a href="http://dc.idcquan.com/ywgl/71559.shtml" target="_blank" rel="noopener">《“异地多活”多机房部署经验谈》</a></p>
<ul>
<li>通过自研中间件进行数据同步。 </li>
</ul>
</li>
<li><p><a href="https://blog.csdn.net/jeffreynicole/article/details/48135093" target="_blank" rel="noopener">《异地多活（异地双活）实践经验》</a></p>
<ul>
<li>注意延迟问题，多次跨机房调用会将延时放大数倍。</li>
<li>建房间专线很大概率会出现问题，做好运维和程序层面的容错。</li>
<li>不能依赖于程序端数据双写，要有自动同步方案。 </li>
<li>数据永不在高延迟和较差网络质量下，考虑同步质量问题。</li>
<li>核心业务和次要业务分而治之，甚至只考虑核心业务。</li>
<li>异地多活监控部署、测试也要跟上。</li>
<li>业务允许的情况下考虑用户分区，尤其是游戏、邮箱业务。</li>
<li>控制跨机房消息体大小，越小越好。</li>
<li>考虑使用docker容器虚拟化技术，提高动态调度能力。</li>
</ul>
</li>
<li><p><a href="https://blog.csdn.net/yoara/article/details/38013751" target="_blank" rel="noopener">容灾技术及建设经验介绍</a></p>
</li>
</ul>
<h3 id="容灾演练流程"><a href="#容灾演练流程" class="headerlink" title="容灾演练流程"></a>容灾演练流程</h3><ul>
<li><a href="https://mp.weixin.qq.com/s?__biz=MjM5MDE0Mjc4MA==&amp;mid=2650996320&amp;idx=1&amp;sn=0ed3be190bbee4a9277886ef88cbb2e5" target="_blank" rel="noopener">《依赖治理、灰度发布、故障演练，阿里电商故障演练系统的设计与实战经验》</a><ul>
<li>常见故障画像</li>
<li>案例：预案有效性、预案有效性、故障复现、架构容灾测试、参数调优、参数调优、故障突袭、联合演练。</li>
</ul>
</li>
</ul>
<h3 id="平滑启动"><a href="#平滑启动" class="headerlink" title="平滑启动"></a>平滑启动</h3><ul>
<li><p>平滑重启应用思路<br>1.端流量（如vip层）、2. flush 数据(如果有)、3, 重启应用</p>
</li>
<li><p><a href="https://blog.csdn.net/u011001084/article/details/73480432" target="_blank" rel="noopener">《JVM安全退出（如何优雅的关闭java服务）》</a><br>推荐推出方式：System.exit，Kill SIGTERM；不推荐 kill-9；用 Runtime.addShutdownHook 注册钩子。</p>
</li>
<li><a href="http://ju.outofmemory.cn/entry/337235" target="_blank" rel="noopener">《常见Java应用如何优雅关闭》</a><br>Java、Srping、Dubbo 优雅关闭方式。</li>
</ul>
<h2 id="数据库扩展"><a href="#数据库扩展" class="headerlink" title="数据库扩展"></a>数据库扩展</h2><h3 id="读写分离模式"><a href="#读写分离模式" class="headerlink" title="读写分离模式"></a>读写分离模式</h3><ul>
<li><a href="https://www.cnblogs.com/houdj/p/6563771.html" target="_blank" rel="noopener">《Mysql主从方案的实现》</a></li>
<li><a href="https://www.cnblogs.com/edisonchou/p/4133148.html" target="_blank" rel="noopener">《搭建MySQL主从复制经典架构》</a></li>
<li><p><a href="https://blog.csdn.net/nimasike/article/details/48048341" target="_blank" rel="noopener">《Haproxy+多台MySQL从服务器(Slave) 实现负载均衡》</a></p>
</li>
<li><p><a href="https://www.cnblogs.com/zhangsubai/p/6801764.html" target="_blank" rel="noopener">《DRBD+Heartbeat+Mysql高可用读写分离架构》</a></p>
<ul>
<li>DRDB 进行磁盘复制，避免单点问题。</li>
</ul>
</li>
<li><p><a href="https://coderxing.gitbooks.io/architecture-evolution/di-san-pian-ff1a-bu-luo/62-ke-kuo-zhan-de-shu-ju-ku-jia-gou/621-gao-ke-yong-mysql-de-ji-zhong-fang-an/6214-mysql-cluster-fang-an.html" target="_blank" rel="noopener">《MySQL Cluster 方式》</a></p>
</li>
</ul>
<h3 id="分片模式"><a href="#分片模式" class="headerlink" title="分片模式"></a>分片模式</h3><ul>
<li><p><a href="https://www.jianshu.com/p/32b3e91aa22c" target="_blank" rel="noopener">《分库分表需要考虑的问题及方案》</a></p>
<ul>
<li>中间件： 轻量级：sharding-jdbc、TSharding；重量级：Atlas、MyCAT、Vitess等。</li>
<li>问题：事务、Join、迁移、扩容、ID、分页等。</li>
<li>事务补偿：对数据进行对帐检查;基于日志进行比对;定期同标准数据来源进行同步等。</li>
<li>分库策略：数值范围；取模；日期等。</li>
<li>分库数量：通常 MySQL 单库 5千万条、Oracle 单库一亿条需要分库。 </li>
</ul>
</li>
<li><p><a href="https://www.2cto.com/database/201503/380348.html" target="_blank" rel="noopener">《MySql分表和表分区详解》</a></p>
<ul>
<li>分区：是MySQL内部机制，对客户端透明，数据存储在不同文件中，表面上看是同一个表。</li>
<li>分表：物理上创建不同的表、客户端需要管理分表路由。</li>
</ul>
</li>
</ul>
<h2 id="服务治理"><a href="#服务治理" class="headerlink" title="服务治理"></a>服务治理</h2><h3 id="服务注册与发现"><a href="#服务注册与发现" class="headerlink" title="服务注册与发现"></a>服务注册与发现</h3><ul>
<li><a href="https://blog.csdn.net/jiaolongdy/article/details/51188798" target="_blank" rel="noopener">《永不失联！如何实现微服务架构中的服务发现？》</a><ul>
<li>客户端服务发现模式：客户端直接查询注册表，同时自己负责负载均衡。Eureka 采用这种方式。</li>
<li>服务器端服务发现模式：客户端通过负载均衡查询服务实例。</li>
</ul>
</li>
<li><p><a href="https://blog.csdn.net/u010963948/article/details/71730165" target="_blank" rel="noopener">《SpringCloud服务注册中心比较:Consul vs Zookeeper vs Etcd vs Eureka》</a></p>
<ul>
<li>CAP支持：Consul（CA）、zookeeper（cp）、etcd（cp） 、euerka（ap）</li>
<li>作者认为目前 Consul 对 Spring cloud 的支持比较好。</li>
</ul>
</li>
<li><p><a href="http://mobile.51cto.com/news-502394.htm" target="_blank" rel="noopener">《基于Zookeeper的服务注册与发现》</a></p>
<ul>
<li>优点：API简单、Pinterest，Airbnb 在用、多语言、通过watcher机制来实现配置PUSH，能快速响应配置变化。 </li>
</ul>
</li>
</ul>
<h3 id="服务路由控制"><a href="#服务路由控制" class="headerlink" title="服务路由控制"></a>服务路由控制</h3><ul>
<li><a href="https://blog.csdn.net/xundh/article/details/59492750" target="_blank" rel="noopener">《分布式服务框架学习笔记4 服务路由》</a><ul>
<li>原则：透明化路由</li>
<li>负载均衡策略：随机、轮询、服务调用延迟、一致性哈希、粘滞连接</li>
<li>本地路由有限策略：injvm(优先调用jvm内部的服务)，innative(优先使用相同物理机的服务),原则上找距离最近的服务。</li>
<li>配置方式：统一注册表；本地配置；动态下发。</li>
</ul>
</li>
</ul>
<h2 id="分布式一致"><a href="#分布式一致" class="headerlink" title="分布式一致"></a>分布式一致</h2><h3 id="CAP-与-BASE-理论"><a href="#CAP-与-BASE-理论" class="headerlink" title="CAP 与 BASE 理论"></a>CAP 与 BASE 理论</h3><ul>
<li><a href="http://www.cnblogs.com/szlbm/p/5588543.html" target="_blank" rel="noopener">《从分布式一致性谈到CAP理论、BASE理论》</a><ul>
<li>一致性分类：强一致(立即一致)；弱一致(可在单位时间内实现一致，比如秒级)；最终一致(弱一致的一种，一定时间内最终一致)</li>
<li>CAP：一致性、可用性、分区容错性(网络故障引起)</li>
<li>BASE：Basically Available（基本可用）、Soft state（软状态）和Eventually consistent（最终一致性）</li>
<li>BASE理论的核心思想是：即使无法做到强一致性，但每个应用都可以根据自身业务特点，采用适当的方式来使系统达到最终一致性。</li>
</ul>
</li>
</ul>
<h3 id="分布式锁"><a href="#分布式锁" class="headerlink" title="分布式锁"></a>分布式锁</h3><ul>
<li><a href="http://www.hollischuang.com/archives/1716" target="_blank" rel="noopener">《分布式锁的几种实现方式》</a><ul>
<li>基于数据库的分布式锁：优点：操作简单、容易理解。缺点：存在单点问题、数据库性能够开销较大、不可重入；</li>
<li>基于缓存的分布式锁：优点：非阻塞、性能好。缺点：操作不好容易造成锁无法释放的情况。</li>
<li>Zookeeper 分布式锁：通过有序临时节点实现锁机制，自己对应的节点需要最小，则被认为是获得了锁。优点：集群可以透明解决单点问题，避免锁不被释放问题，同时锁可以重入。缺点：性能不如缓存方式，吞吐量会随着zk集群规模变大而下降。</li>
</ul>
</li>
<li><p><a href="https://www.tuicool.com/articles/VZJr6fY" target="_blank" rel="noopener">《基于Zookeeper的分布式锁》</a></p>
<ul>
<li>清楚的原理描述 + Java 代码示例。 </li>
</ul>
</li>
<li><p><a href="https://www.cnblogs.com/0201zcr/p/5942748.html" target="_blank" rel="noopener">《jedisLock—redis分布式锁实现》</a></p>
<ul>
<li>基于 setnx(set if ont exists)，有则返回false，否则返回true。并支持过期时间。</li>
</ul>
</li>
<li><p><a href="https://blog.csdn.net/albertfly/article/details/77412333" target="_blank" rel="noopener">《Memcached 和 Redis 分布式锁方案》</a></p>
<ul>
<li>利用 memcached 的 add（有别于set）操作，当key存在时，返回false。</li>
</ul>
</li>
</ul>
<h3 id="分布式一致性算法"><a href="#分布式一致性算法" class="headerlink" title="分布式一致性算法"></a>分布式一致性算法</h3><h4 id="PAXOS"><a href="#PAXOS" class="headerlink" title="PAXOS"></a>PAXOS</h4><ul>
<li><a href="https://www.cnblogs.com/linbingdong/p/6253479.html" target="_blank" rel="noopener">《分布式系列文章——Paxos算法原理与推导》</a></li>
<li><a href="https://blog.csdn.net/u010039929/article/details/70171672" target="_blank" rel="noopener">《Paxos–&gt;Fast Paxos–&gt;Zookeeper分析》</a></li>
<li><a href="https://www.cnblogs.com/leesf456/p/6012777.html" target="_blank" rel="noopener">《【分布式】Zookeeper与Paxos》</a></li>
</ul>
<h4 id="Zab"><a href="#Zab" class="headerlink" title="Zab"></a>Zab</h4><ul>
<li><a href="https://www.jianshu.com/p/fb527a64deee" target="_blank" rel="noopener">《Zab：Zookeeper 中的分布式一致性协议介绍》</a></li>
</ul>
<h4 id="Raft"><a href="#Raft" class="headerlink" title="Raft"></a>Raft</h4><ul>
<li><a href="http://www.cnblogs.com/mindwind/p/5231986.html" target="_blank" rel="noopener">《Raft 为什么是更易理解的分布式一致性算法》</a><ul>
<li>三种角色：Leader（领袖）、Follower（群众）、Candidate（候选人）</li>
<li>通过随机等待的方式发出投票，得票多的获胜。</li>
</ul>
</li>
</ul>
<h4 id="Gossip"><a href="#Gossip" class="headerlink" title="Gossip"></a>Gossip</h4><ul>
<li><a href="http://blog.51cto.com/tianya23/530743" target="_blank" rel="noopener">《Gossip算法》</a></li>
</ul>
<h4 id="两阶段提交、多阶段提交"><a href="#两阶段提交、多阶段提交" class="headerlink" title="两阶段提交、多阶段提交"></a>两阶段提交、多阶段提交</h4><ul>
<li><a href="http://blog.jobbole.com/95632/" target="_blank" rel="noopener">《关于分布式事务、两阶段提交协议、三阶提交协议》</a></li>
</ul>
<h3 id="幂等"><a href="#幂等" class="headerlink" title="幂等"></a>幂等</h3><ul>
<li><a href="https://www.cnblogs.com/wxgblogs/p/6639272.html" target="_blank" rel="noopener">《分布式系统—幂等性设计》</a><ul>
<li>幂等特性的作用：该资源具备幂等性，请求方无需担心重复调用会产生错误。</li>
<li>常见保证幂等的手段：MVCC（类似于乐观锁）、去重表(唯一索引)、悲观锁、一次性token、序列号方式。 </li>
</ul>
</li>
</ul>
<h3 id="分布式一致方案"><a href="#分布式一致方案" class="headerlink" title="分布式一致方案"></a>分布式一致方案</h3><ul>
<li><a href="http://www.infoq.com/cn/articles/solution-of-distributed-system-transaction-consistency" target="_blank" rel="noopener">《分布式系统事务一致性解决方案》</a></li>
<li><a href="https://weibo.com/ttarticle/p/show?id=2309403965965003062676" target="_blank" rel="noopener">《保证分布式系统数据一致性的6种方案》</a></li>
</ul>
<h3 id="分布式-Leader-节点选举"><a href="#分布式-Leader-节点选举" class="headerlink" title="分布式 Leader 节点选举"></a>分布式 Leader 节点选举</h3><ul>
<li><a href="https://blog.csdn.net/johnson_moon/article/details/78809995" target="_blank" rel="noopener">《利用zookeeper实现分布式leader节点选举》</a></li>
</ul>
<h3 id="TCC-Try-Confirm-Cancel-柔性事务"><a href="#TCC-Try-Confirm-Cancel-柔性事务" class="headerlink" title="TCC(Try/Confirm/Cancel) 柔性事务"></a>TCC(Try/Confirm/Cancel) 柔性事务</h3><ul>
<li><a href="https://www.jianshu.com/p/ab1a1c6b08a1" target="_blank" rel="noopener">《传统事务与柔性事务》</a><ul>
<li>基于BASE理论：基本可用、柔性状态、最终一致。</li>
<li>解决方案：记录日志+补偿（正向补充或者回滚）、消息重试(要求程序要幂等)；“无锁设计”、采用乐观锁机制。</li>
</ul>
</li>
</ul>
<h2 id="分布式文件系统"><a href="#分布式文件系统" class="headerlink" title="分布式文件系统"></a>分布式文件系统</h2><ul>
<li><a href="https://zhuanlan.zhihu.com/p/27666295" target="_blank" rel="noopener">说说分布式文件存储系统-基本架构</a> ？</li>
<li><a href="https://blog.csdn.net/gatieme/article/details/44982961" target="_blank" rel="noopener">《各种分布式文件系统的比较》</a> ？<ul>
<li>HDFS：大批量数据读写，用于高吞吐量的场景，不适合小文件。</li>
<li>FastDFS：轻量级、适合小文件。</li>
</ul>
</li>
</ul>
<h2 id="唯一ID-生成"><a href="#唯一ID-生成" class="headerlink" title="唯一ID 生成"></a>唯一ID 生成</h2><h3 id="全局唯一ID"><a href="#全局唯一ID" class="headerlink" title="全局唯一ID"></a>全局唯一ID</h3><ul>
<li><p><a href="https://www.cnblogs.com/baiwa/p/5318432.html" target="_blank" rel="noopener">《高并发分布式系统中生成全局唯一Id汇总》</a></p>
<ul>
<li>Twitter 方案（Snowflake 算法）：41位时间戳+10位机器标识（比如IP，服务器名称等）+12位序列号(本地计数器)</li>
<li>Flicker 方案：MySQL自增ID + “REPLACE INTO XXX:SELECT LAST_INSERT_ID();” </li>
<li>UUID：缺点，无序，字符串过长，占用空间，影响检索性能。</li>
<li>MongoDB 方案：利用 ObjectId。缺点：不能自增。</li>
</ul>
</li>
<li><p><a href="https://blog.csdn.net/hdu09075340/article/details/79103851" target="_blank" rel="noopener">《TDDL 在分布式下的SEQUENCE原理》</a></p>
<ul>
<li>在数据库中创建 sequence 表，用于记录，当前已被占用的id最大值。</li>
<li>每台客户端主机取一个id区间（比如 1000~2000）缓存在本地，并更新 sequence 表中的id最大值记录。</li>
<li>客户端主机之间取不同的id区间，用完再取，使用乐观锁机制控制并发。</li>
</ul>
</li>
</ul>
<h2 id="一致性Hash算法"><a href="#一致性Hash算法" class="headerlink" title="一致性Hash算法"></a>一致性Hash算法</h2><ul>
<li><a href="https://coderxing.gitbooks.io/architecture-evolution/di-san-pian-ff1a-bu-luo/631-yi-zhi-xing-ha-xi.html" target="_blank" rel="noopener">《一致性哈希算法》</a></li>
</ul>
<h1 id="设计思想-amp-开发模式"><a href="#设计思想-amp-开发模式" class="headerlink" title="设计思想 &amp; 开发模式"></a>设计思想 &amp; 开发模式</h1><h2 id="DDD-Domain-driven-Design-领域驱动设计"><a href="#DDD-Domain-driven-Design-领域驱动设计" class="headerlink" title="DDD(Domain-driven Design - 领域驱动设计)"></a>DDD(Domain-driven Design - 领域驱动设计)</h2><ul>
<li><p><a href="https://www.cnblogs.com/netfocus/p/5548025.html" target="_blank" rel="noopener">《浅谈我对DDD领域驱动设计的理解》</a></p>
<ul>
<li>概念：DDD 主要对传统软件开发流程(分析-设计-编码)中各阶段的割裂问题而提出，避免由于一开始分析不明或在软件开发过程中的信息流转不一致而造成软件无法交付（和需求方设想不一致）的问题。DDD 强调一切以领域（Domain）为中心，强调领域专家（Domain Expert）的作用，强调先定义好领域模型之后在进行开发，并且领域模型可以指导开发（所谓的驱动）。</li>
<li>过程：理解领域、拆分领域、细化领域，模型的准确性取决于模型的理解深度。</li>
<li>设计：DDD 中提出了建模工具，比如聚合、实体、值对象、工厂、仓储、领域服务、领域事件来帮助领域建模。</li>
</ul>
</li>
<li><p><a href="https://www.cnblogs.com/butterfly100/p/7827870.html" target="_blank" rel="noopener">《领域驱动设计的基础知识总结》</a></p>
<ul>
<li>领域（Doamin）本质上就是问题域，比如一个电商系统，一个论坛系统等。</li>
<li>界限上下文（Bounded Context）：阐述子域之间的关系，可以简单理解成一个子系统或组件模块。</li>
<li>领域模型（Domain Model）：DDD的核心是建立（用通用描述语言、工具—领域通用语言）正确的领域模型；反应业务需求的本质，包括实体和过程；其贯穿软件分析、设计、开发 的整个过程；常用表达领域模型的方式：图、代码或文字；</li>
<li>领域通用语言：领域专家、开发设计人员都能立即的语言或工具。</li>
<li>经典分层架构：用户界面/展示层、应用层、领域层、基础设施层，是四层架构模式。</li>
<li>使用的模式：<ul>
<li>关联尽量少，尽量单项，尽量降低整体复杂度。</li>
<li>实体（Entity）：领域中的唯一标示，一个实体的属性尽量少，少则清晰。</li>
<li>值对象（Value Object）：没有唯一标识，且属性值不可变，小二简单的对象，比如Date。</li>
<li>领域服务（Domain Service）： 协调多个领域对象，只有方法没有状态(不存数据)；可以分为应用层服务，领域层服务、基础层服务。</li>
<li>聚合及聚合根（Aggregate，Aggregate Root）：聚合定义了一组具有内聚关系的相关对象的集合；聚合根是对聚合引用的唯一元素；当修改一个聚合时，必须在事务级别；大部分领域模型中，有70%的聚合通常只有一个实体，30%只有2~3个实体；如果一个聚合只有一个实体，那么这个实体就是聚合根；如果有多个实体，那么我们可以思考聚合内哪个对象有独立存在的意义并且可以和外部直接进行交互；</li>
<li>工厂（Factory）：类似于设计模式中的工厂模式。</li>
<li>仓储（Repository）：持久化到DB，管理对象，且只对聚合设计仓储。</li>
</ul>
</li>
</ul>
</li>
<li><p><a href="http://www.cnblogs.com/Leo_wl/p/3866629.html" target="_blank" rel="noopener">《领域驱动设计(DDD)实现之路》</a></p>
<ul>
<li>聚合：比如一辆汽车（Car）包含了引擎（Engine）、车轮（Wheel）和油箱（Tank）等组件，缺一不可。</li>
</ul>
</li>
<li><p><a href="http://www.hollischuang.com/archives/553" target="_blank" rel="noopener">《领域驱动设计系列（2）浅析VO、DTO、DO、PO的概念、区别和用处》</a></p>
</li>
</ul>
<h3 id="命令查询职责分离-CQRS"><a href="#命令查询职责分离-CQRS" class="headerlink" title="命令查询职责分离(CQRS)"></a>命令查询职责分离(CQRS)</h3><p>CQRS — Command Query Responsibility Seperation</p>
<ul>
<li><p><a href="https://www.cnblogs.com/cnblogsfans/p/4551990.html" target="_blank" rel="noopener">《领域驱动设计系列 (六)：CQRS》</a></p>
<ul>
<li>核心思想：读写分离（查询和更新在不同的方法中），不同的流程只是不同的设计方式，CQ代码分离，分布式环境中会有明显体现（有冗余数据的情况下），目的是为了高性能。</li>
</ul>
</li>
<li><p><a href="http://www.techweb.com.cn/network/system/2017-07-07/2553563.shtml" target="_blank" rel="noopener">《DDD CQRS架构和传统架构的优缺点比较》</a></p>
<ul>
<li>最终一致的设计理念；依赖于高可用消息中间件。</li>
</ul>
</li>
<li><p><a href="http://www.cnblogs.com/netfocus/p/4055346.html" target="_blank" rel="noopener">《CQRS架构简介》</a></p>
<ul>
<li>一个实现 CQRS 的抽象案例。</li>
</ul>
</li>
<li><p><a href="http://www.uml.org.cn/zjjs/201609221.asp" target="_blank" rel="noopener">《深度长文：我对CQRS/EventSourcing架构的思考》</a></p>
<ul>
<li>CQRS 模式分析 + 12306 抢票案例</li>
</ul>
</li>
</ul>
<h3 id="贫血，充血模型"><a href="#贫血，充血模型" class="headerlink" title="贫血，充血模型"></a>贫血，充血模型</h3><ul>
<li><a href="https://kb.cnblogs.com/page/520743/" target="_blank" rel="noopener">《贫血，充血模型的解释以及一些经验》</a><ul>
<li>失血模型：老子和儿子分别定义，相互不知道，二者实体定义中完全没有业务逻辑，通过外部Service进行关联。</li>
<li>贫血模型：老子知道儿子，儿子也知道老子；部分业务逻辑放到实体中；优点：各层单项依赖，结构清楚，易于维护；缺点：不符合OO思想，相比于充血模式，Service层较为厚重；</li>
<li>充血模型：和贫血模型类似，区别在于如何划分业务逻辑。优点：Service层比较薄，只充当Facade的角色，不和DAO打交道、复合OO思想；缺点：非单项依赖，DO和DAO之间双向依赖、和Service层的逻辑划分容易造成混乱。</li>
<li>肿胀模式：是一种极端情况，取消Service层、全部业务逻辑放在DO中；优点：符合OO思想、简化了分层；缺点：暴露信息过多、很多非DO逻辑也会强行并入DO。这种模式应该避免。</li>
<li>作者主张使用贫血模式。</li>
</ul>
</li>
</ul>
<h2 id="Actor-模式"><a href="#Actor-模式" class="headerlink" title="Actor 模式"></a>Actor 模式</h2><p>TODO</p>
<h2 id="响应式编程"><a href="#响应式编程" class="headerlink" title="响应式编程"></a>响应式编程</h2><h3 id="Reactor"><a href="#Reactor" class="headerlink" title="Reactor"></a>Reactor</h3><p>TODO</p>
<h3 id="RxJava"><a href="#RxJava" class="headerlink" title="RxJava"></a>RxJava</h3><p>TODO</p>
<h3 id="Vert-x"><a href="#Vert-x" class="headerlink" title="Vert.x"></a>Vert.x</h3><p>TODO</p>
<h2 id="DODAF2-0"><a href="#DODAF2-0" class="headerlink" title="DODAF2.0"></a>DODAF2.0</h2><ul>
<li><a href="http://www.360doc.com/content/16/0627/19/33945750_571201779.shtml" target="_blank" rel="noopener">《DODAF2.0方法论》</a></li>
<li><a href="http://blog.51cto.com/xiaoyong/1553164" target="_blank" rel="noopener">《DODAF2.0之能力视角如何落地》</a></li>
</ul>
<h2 id="Serverless"><a href="#Serverless" class="headerlink" title="Serverless"></a>Serverless</h2><p>无需过多关系服务器的服务架构理念。</p>
<ul>
<li><p><a href="http://www.jdon.com/soa/serverless.html" target="_blank" rel="noopener">《什么是Serverless无服务器架构？》</a></p>
<ul>
<li>Serverless 不代表出去服务器，而是去除对服务器运行状态的关心。</li>
<li>Serverless 代表一思维方式的转变，从“构建一套服务在一台服务器上，对对个事件进行响应转变为构建一个为服务器，来响应一个事件”。</li>
<li>Serverless 不代表某个具体的框架。</li>
</ul>
</li>
<li><p><a href="http://www.infoq.com/cn/news/2017/10/how-to-understand-serverless" target="_blank" rel="noopener">《如何理解Serverless？》</a></p>
<ul>
<li>依赖于 Baas （(Mobile) Backend as a Service） 和 Faas （Functions as a service）</li>
</ul>
</li>
</ul>
<h2 id="Service-Mesh"><a href="#Service-Mesh" class="headerlink" title="Service Mesh"></a>Service Mesh</h2><ul>
<li><a href="https://time.geekbang.org/article/2355" target="_blank" rel="noopener">《什么是Service Mesh？》</a></li>
<li><p><a href="https://www.jianshu.com/p/e23e3e74538e" target="_blank" rel="noopener">《初识 Service Mesh》</a></p>
</li>
<li><p><a href="https://time.geekbang.org/article/2355" target="_blank" rel="noopener">《什么是Service Mesh？》</a></p>
</li>
</ul>
<h1 id="项目管理"><a href="#项目管理" class="headerlink" title="项目管理"></a>项目管理</h1><h2 id="架构评审"><a href="#架构评审" class="headerlink" title="架构评审"></a>架构评审</h2><ul>
<li><a href="http://developer.51cto.com/art/201506/478486.htm" target="_blank" rel="noopener">《架构设计之如何评审架构设计说明书》</a></li>
<li><a href="https://blog.csdn.net/wireless_com/article/details/45935591" target="_blank" rel="noopener">《人人都是架构师：非功能性需求》</a></li>
</ul>
<h2 id="重构"><a href="#重构" class="headerlink" title="重构"></a>重构</h2><ul>
<li><a href="http://www.infoq.com/cn/articles/architect-12-rules-complete/" target="_blank" rel="noopener">《架构之重构的12条军规》</a></li>
</ul>
<h2 id="代码规范"><a href="#代码规范" class="headerlink" title="代码规范"></a>代码规范</h2><ul>
<li><a href="https://github.com/alibaba/p3c" target="_blank" rel="noopener">《阿里巴巴Java开发手册》</a></li>
</ul>
<h2 id="代码-Review"><a href="#代码-Review" class="headerlink" title="代码 Review"></a>代码 Review</h2><p>制度还是制度!<br>另外，每个公司需要根据自己的需求和目标制定自己的 check list</p>
<ul>
<li><p><a href="http://www.sohu.com/a/229745352_181657" target="_blank" rel="noopener">《为什么你做不好 Code Review？》</a></p>
<ul>
<li>代码 review 做的好，在于制度建设。</li>
</ul>
</li>
<li><p><a href="https://blog.csdn.net/uxyheaven/article/details/49773619" target="_blank" rel="noopener">《从零开始Code Review》</a></p>
</li>
<li><p><a href="https://www.cnblogs.com/zuoping/p/5477047.html" target="_blank" rel="noopener">《Code Review Checklist》</a></p>
</li>
<li><p><a href="https://dzone.com/articles/java-code-review-checklist" target="_blank" rel="noopener">《Java Code Review Checklist》</a></p>
</li>
<li><p><a href="https://blog.csdn.net/legend0011/article/details/45585575" target="_blank" rel="noopener">《如何用 gitlab 做 code review》</a></p>
</li>
</ul>
<h2 id="RUP"><a href="#RUP" class="headerlink" title="RUP"></a>RUP</h2><ul>
<li><a href="https://blog.csdn.net/apanious/article/details/51011946" target="_blank" rel="noopener">《运用RUP 4+1视图方法进行软件架构设计》</a></li>
</ul>
<h2 id="看板管理"><a href="#看板管理" class="headerlink" title="看板管理"></a>看板管理</h2><ul>
<li><a href="https://blog.csdn.net/tkchen/article/details/51637643" target="_blank" rel="noopener">《说说看板在项目中的应用》</a></li>
</ul>
<h2 id="SCRUM"><a href="#SCRUM" class="headerlink" title="SCRUM"></a>SCRUM</h2><p>SCRUM - 争球</p>
<ul>
<li>3个角色:Product Owner(PO) 产品负责人;Scrum Master（SM），推动Scrum执行;Team 开发团队。</li>
<li>3个工件：Product Backlog 产品TODOLIST，含优先级;Sprint Backlog 功能开发 TODO LIST；燃尽图；</li>
<li>五个价值观：专注、勇气、公开、承诺、尊重。</li>
</ul>
<ul>
<li><p><a href="https://blog.csdn.net/inny100_100/article/details/54633757" target="_blank" rel="noopener">《敏捷项目管理流程-Scrum框架最全总结！》</a></p>
</li>
<li><p><a href="https://blog.csdn.net/superkunkun/article/details/52951142" target="_blank" rel="noopener">《敏捷其实很简单3—敏捷方法之scrum》</a></p>
</li>
</ul>
<h2 id="敏捷开发"><a href="#敏捷开发" class="headerlink" title="敏捷开发"></a>敏捷开发</h2><p>TODO</p>
<h2 id="极限编程（XP）"><a href="#极限编程（XP）" class="headerlink" title="极限编程（XP）"></a>极限编程（XP）</h2><p>XP - eXtreme Programming</p>
<ul>
<li><p><a href="http://www.woshipm.com/pmd/406917.html" target="_blank" rel="noopener">《主流敏捷开发方法：极限编程XP》</a></p>
<ul>
<li>是一种指导开发人员的方法论。</li>
<li><p>4大价值：</p>
<ul>
<li>沟通：鼓励口头沟通，提高效率。</li>
<li>简单：够用就好。</li>
<li>反馈：及时反馈、通知相关人。</li>
<li>勇气：提倡拥抱变化，敢于重构。</li>
</ul>
</li>
<li><p>5个原则：快速反馈、简单性假设、逐步修改、提倡更改（小步快跑）、优质工作（保证质量的前提下保证小步快跑）。</p>
</li>
<li>5个工作：阶段性冲刺；冲刺计划会议；每日站立会议；冲刺后review；回顾会议。</li>
</ul>
</li>
</ul>
<h2 id="结对编程"><a href="#结对编程" class="headerlink" title="结对编程"></a>结对编程</h2><p>边写码，边review。能够增强代码质量、减少bug。</p>
<ul>
<li><a href="http://www.baike.com/wiki/%E7%BB%93%E5%AF%B9%E7%BC%96%E7%A8%8B" target="_blank" rel="noopener">《结对编程》</a></li>
</ul>
<h2 id="PDCA-循环质量管理"><a href="#PDCA-循环质量管理" class="headerlink" title="PDCA 循环质量管理"></a>PDCA 循环质量管理</h2><p>P——PLAN 策划，D——DO 实施，C——CHECK 检查，A——ACT 改进</p>
<ul>
<li><a href="http://www.baike.com/wiki/PDCA" target="_blank" rel="noopener">《PDCA》</a></li>
</ul>
<h2 id="FMEA管理模式"><a href="#FMEA管理模式" class="headerlink" title="FMEA管理模式"></a>FMEA管理模式</h2><p>TODO</p>
<h1 id="通用业务术语"><a href="#通用业务术语" class="headerlink" title="通用业务术语"></a>通用业务术语</h1><p>TODO</p>
<h1 id="技术趋势"><a href="#技术趋势" class="headerlink" title="技术趋势"></a>技术趋势</h1><p>TODO</p>
<h1 id="政策、法规"><a href="#政策、法规" class="headerlink" title="政策、法规"></a>政策、法规</h1><p>TODO</p>
<h2 id="法律"><a href="#法律" class="headerlink" title="法律"></a>法律</h2><h3 id="严格遵守刑法253法条"><a href="#严格遵守刑法253法条" class="headerlink" title="严格遵守刑法253法条"></a>严格遵守刑法253法条</h3><p>我国刑法第253条之一规定：</p>
<blockquote>
<ul>
<li>国家机关或者金融、电信、交通、教育、医疗等单位的工作人员，违反国家规定，将本单位在履行职责或者提供服务过程中获得的公民个人信息，出售或者非法提供给他人，情节严重的，处3年以下有期徒刑或者拘役，并处或者单处罚金。</li>
<li>窃取或者以其他方法非法获取上述信息，情节严重的，依照前款的规定处罚。 </li>
<li>单位犯前两款罪的，对单位判处罚金，并对其直接负责的主管人员和其他直接责任人员，依照各该款的规定处罚。</li>
</ul>
</blockquote>
<p>最高人民法院、最高人民检察院关于执行《中华人民共和国刑法》确定罪名的补充规定（四）规定：触犯刑法第253条之一第1款之规定，构成“出售、非法提供公民个人信息罪”；触犯刑法第253条之一第2款之规定，构成“非法获取公民个人信息罪”</p>
<ul>
<li><a href="https://baike.baidu.com/item/%E9%9D%9E%E6%B3%95%E8%8E%B7%E5%8F%96%E5%85%AC%E6%B0%91%E4%B8%AA%E4%BA%BA%E4%BF%A1%E6%81%AF%E7%BD%AA" target="_blank" rel="noopener">《非法获取公民个人信息罪》</a></li>
</ul>
<h1 id="架构师素质"><a href="#架构师素质" class="headerlink" title="架构师素质"></a>架构师素质</h1><ul>
<li><p><a href="http://hellojava.info/?p=430" target="_blank" rel="noopener">《架构师画像》</a></p>
<ul>
<li>业务理解和抽象能力</li>
<li>NB的代码能力</li>
<li>全面：1. 在面对业务问题上，架构师脑海里是否会浮现出多种技术方案；2. 在做系统设计时是否考虑到了足够多的方方面面；3. 在做系统设计时是否考虑到了足够多的方方面面； </li>
<li>全局：是否考虑到了对上下游的系统的影响。</li>
<li>权衡：权衡投入产出比；优先级和节奏控制；</li>
</ul>
</li>
<li><p><a href="http://www.infoq.com/cn/articles/architecture-optimization-and-design-the-architect-must-know" target="_blank" rel="noopener">《关于架构优化和设计，架构师必须知道的事情》</a></p>
<ul>
<li>要去考虑的细节：模块化、轻耦合、无共享架构；减少各个组件之前的依赖、注意服务之间依赖所有造成的链式失败及影响等。</li>
<li>基础设施、配置、测试、开发、运维综合考虑。</li>
<li>考虑人、团队、和组织的影响。 </li>
</ul>
</li>
<li><p><a href="https://www.zhihu.com/question/19841397" target="_blank" rel="noopener">《如何才能真正的提高自己，成为一名出色的架构师？》</a> </p>
</li>
<li><p><a href="https://blog.csdn.net/sanbingyutuoniao123/article/details/54144129" target="_blank" rel="noopener">《架构师的必备素质和成长途径》</a></p>
<ul>
<li>素质：业务理解、技术广度、技术深度、丰富经验、沟通能力、动手能力、美学素养。</li>
<li>成长路径：2年积累知识、4年积累技能和组内影响力、7年积累部门内影响力、7年以上积累跨部门影响力。 </li>
</ul>
</li>
<li><p><a href="http://blog.51cto.com/frankfan/1248401" target="_blank" rel="noopener">《架构设计师—你在哪层楼？》</a></p>
<ul>
<li>第一层的架构师看到的只是产品本身</li>
<li>第二层的架构师不仅看到自己的产品，还看到了整体的方案</li>
<li>第三层的架构师看到的是商业价值 </li>
</ul>
</li>
</ul>
<h1 id="团队管理"><a href="#团队管理" class="headerlink" title="团队管理"></a>团队管理</h1><p>TODO</p>
<h2 id="招聘"><a href="#招聘" class="headerlink" title="招聘"></a>招聘</h2><h1 id="资讯"><a href="#资讯" class="headerlink" title="资讯"></a>资讯</h1><h2 id="行业资讯"><a href="#行业资讯" class="headerlink" title="行业资讯"></a>行业资讯</h2><ul>
<li><a href="http://36kr.com/" target="_blank" rel="noopener">36kr</a></li>
<li><a href="http://www.techweb.com.cn/" target="_blank" rel="noopener">Techweb</a></li>
</ul>
<h2 id="公众号列表"><a href="#公众号列表" class="headerlink" title="公众号列表"></a>公众号列表</h2><p>TODO</p>
<h2 id="博客"><a href="#博客" class="headerlink" title="博客"></a>博客</h2><h3 id="团队博客"><a href="#团队博客" class="headerlink" title="团队博客"></a>团队博客</h3><ul>
<li><a href="http://jm.taobao.org/" target="_blank" rel="noopener">阿里中间件博客</a></li>
<li><a href="https://tech.meituan.com" target="_blank" rel="noopener">美团点评技术团队博客</a></li>
</ul>
<h3 id="个人博客"><a href="#个人博客" class="headerlink" title="个人博客"></a>个人博客</h3><ul>
<li><a href="http://www.ruanyifeng.com/" target="_blank" rel="noopener">阮一峰的网络日志</a></li>
<li><a href="https://coolshell.cn/" target="_blank" rel="noopener">酷壳 - COOLSHELL-陈皓</a></li>
<li><a href="http://hellojava.info/" target="_blank" rel="noopener">hellojava-阿里毕玄</a></li>
<li><a href="http://cmsblogs.com/" target="_blank" rel="noopener">Cm’s Blog</a></li>
<li><a href="http://blog.didispace.com/" target="_blank" rel="noopener">程序猿DD-翟永超-《Spring Cloud微服务实战》作者</a></li>
</ul>
<h2 id="综合门户、社区"><a href="#综合门户、社区" class="headerlink" title="综合门户、社区"></a>综合门户、社区</h2><p><strong>国内：</strong></p>
<ul>
<li><a href="http://csdn.net" target="_blank" rel="noopener">CSDN</a><br>   老牌技术社区、不必解释。</li>
<li><a href="http://www.51cto.com/" target="_blank" rel="noopener">51cto.com</a></li>
<li><a href="http://www.iteye.com/" target="_blank" rel="noopener">ITeye</a><ul>
<li>偏 Java 方向 </li>
</ul>
</li>
<li><a href="https://www.cnblogs.com" target="_blank" rel="noopener">博客园</a></li>
<li><a href="http://www.tom.net/" target="_blank" rel="noopener">ChinaUnix</a><ul>
<li>偏 Linux 方向 </li>
</ul>
</li>
<li><a href="https://www.oschina.net/" target="_blank" rel="noopener">开源中国社区</a></li>
<li><a href="http://www.open-open.com/" target="_blank" rel="noopener">深度开源</a></li>
<li><p><a href="http://www.jobbole.com/" target="_blank" rel="noopener">伯乐在线</a></p>
<ul>
<li>涵盖 IT职场、Web前端、后端、移动端、数据库等方面内容，偏技术端。</li>
</ul>
</li>
<li><p><a href="http://www.itpub.net/" target="_blank" rel="noopener">ITPUB</a></p>
</li>
<li><a href="https://cloud.tencent.com/developer/column" target="_blank" rel="noopener">腾讯云— 云+社区</a></li>
<li><a href="https://yq.aliyun.com/" target="_blank" rel="noopener">阿里云— 云栖社区</a></li>
<li><a href="https://www.ibm.com/developerworks/cn/" target="_blank" rel="noopener">IBM DeveloperWorks</a></li>
<li><a href="https://toutiao.io/" target="_blank" rel="noopener">开发者头条</a></li>
<li><a href="http://www.linkedkeeper.com" target="_blank" rel="noopener">LinkedKeeper</a></li>
</ul>
<p><strong>国外：</strong></p>
<ul>
<li><a href="https://dzone.com" target="_blank" rel="noopener">DZone</a></li>
<li><a href="https://www.reddit.com" target="_blank" rel="noopener">Reddit</a></li>
</ul>
<h2 id="问答、讨论类社区"><a href="#问答、讨论类社区" class="headerlink" title="问答、讨论类社区"></a>问答、讨论类社区</h2><ul>
<li><a href="https://segmentfault.com" target="_blank" rel="noopener">segmentfault</a><ul>
<li>问答+专栏 </li>
</ul>
</li>
<li><a href="https://www.zhihu.com/" target="_blank" rel="noopener">知乎</a></li>
<li><a href="https://stackoverflow.com/" target="_blank" rel="noopener">stackoverflow</a></li>
</ul>
<h2 id="行业数据分析"><a href="#行业数据分析" class="headerlink" title="行业数据分析"></a>行业数据分析</h2><ul>
<li><a href="http://report.iresearch.cn/" target="_blank" rel="noopener">艾瑞网</a></li>
<li><p><a href="https://www.questmobile.com.cn" target="_blank" rel="noopener">QUEST MOBILE</a></p>
</li>
<li><p><a href="http://data.stats.gov.cn/" target="_blank" rel="noopener">国家数据</a></p>
</li>
<li><p><a href="http://www.talkingdata.com/" target="_blank" rel="noopener">TalkingData</a></p>
</li>
</ul>
<h2 id="专项网站"><a href="#专项网站" class="headerlink" title="专项网站"></a>专项网站</h2><ul>
<li><p>测试:</p>
<ul>
<li><a href="http://www.ltesting.net/" target="_blank" rel="noopener">领测国际</a> </li>
<li><a href="https://www.testwo.com/" target="_blank" rel="noopener">测试窝</a></li>
<li><a href="https://testerhome.com" target="_blank" rel="noopener">TesterHome</a></li>
</ul>
</li>
<li><p>运维:</p>
<pre><code>* [运维派](http://www.yunweipai.com/) 
* [Abcdocker](https://www.abcdocker.com/)
</code></pre></li>
<li><p>Java:</p>
<ul>
<li><a href="http://www.importnew.com/" target="_blank" rel="noopener">ImportNew</a><ul>
<li>专注于 Java 技术分享</li>
</ul>
</li>
<li><a href="https://howtodoinjava.com/" target="_blank" rel="noopener">HowToDoInJava</a><ul>
<li>英文博客</li>
</ul>
</li>
</ul>
</li>
<li><p>安全</p>
<ul>
<li><a href="https://www.2cto.com/" target="_blank" rel="noopener">红黑联盟</a> </li>
<li><a href="http://www.freebuf.com/" target="_blank" rel="noopener">FreeBuf</a></li>
</ul>
</li>
<li><p>大数据</p>
<ul>
<li><a href="http://www.thebigdata.cn/" target="_blank" rel="noopener">中国大数据</a> </li>
</ul>
</li>
<li><p>其他专题网站：</p>
<ul>
<li><a href="http://www.dockerinfo.net/" target="_blank" rel="noopener">DockerInfo</a><ul>
<li>专注于 Docker 应用及咨询、教程的网站。</li>
</ul>
</li>
<li><a href="https://www.linuxidc.com/" target="_blank" rel="noopener">Linux公社</a><ul>
<li>Linux 主题社区</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="其他类"><a href="#其他类" class="headerlink" title="其他类"></a>其他类</h2><ul>
<li><a href="https://github.com/TeamStuQ/skill-map" target="_blank" rel="noopener">程序员技能图谱</a></li>
</ul>
<h2 id="推荐参考书"><a href="#推荐参考书" class="headerlink" title="推荐参考书"></a>推荐参考书</h2><h3 id="在线电子书"><a href="#在线电子书" class="headerlink" title="在线电子书"></a>在线电子书</h3><ul>
<li><a href="https://github.com/forezp/SpringCloudLearning" target="_blank" rel="noopener">《深入理解Spring Cloud与微服务构建》</a></li>
</ul>
<ul>
<li><a href="http://techforum-img.cn-hangzhou.oss-pub.aliyun-inc.com/1523849261680/AliTech101_RD.pdf" target="_blank" rel="noopener">《阿里技术参考图册-研发篇》</a></li>
<li><p><a href="http://techforum-img.cn-hangzhou.oss-pub.aliyun-inc.com/1523848064814/AliTech101_Algorithms.pdf" target="_blank" rel="noopener">《阿里技术参考图册-算法篇》</a></p>
</li>
<li><p><a href="http://dpurl.cn/n/1lqcX" target="_blank" rel="noopener">《2018美团点评技术年货（合辑）》70M</a></p>
</li>
<li><p><a href="http://www.infoq.com/cn/architect/" target="_blank" rel="noopener">InfoQ《架构师》月刊</a></p>
</li>
<li><p><a href="https://www.w3cschool.cn/architectroad/" target="_blank" rel="noopener">《架构师之路》</a></p>
</li>
</ul>
<h3 id="纸质书"><a href="#纸质书" class="headerlink" title="纸质书"></a>纸质书</h3><h4 id="开发方面"><a href="#开发方面" class="headerlink" title="开发方面"></a>开发方面</h4><ul>
<li>《阿里巴巴Java开发手册》<a href="https://union-click.jd.com/jdc?d=bVKwZQ" target="_blank" rel="noopener">京东</a> <a href="https://s.taobao.com/search?q=阿里巴巴Java开发手册" target="_blank" rel="noopener">淘宝</a></li>
</ul>
<h4 id="架构方面"><a href="#架构方面" class="headerlink" title="架构方面"></a>架构方面</h4><ul>
<li>《软件架构师的12项修炼：技术技能篇》<a href="https://union-click.jd.com/jdc?d=gXvRd8" target="_blank" rel="noopener">京东</a> <a href="https://s.taobao.com/search?q=软件架构师的12项修炼：技术技能篇" target="_blank" rel="noopener">淘宝</a></li>
<li>《架构之美》<a href="https://union-click.jd.com/jdc?d=xJit5I" target="_blank" rel="noopener">京东</a> <a href="https://s.taobao.com/search?q=架构之美" target="_blank" rel="noopener">淘宝</a></li>
<li>《分布式服务架构》<a href="https://union-click.jd.com/jdc?d=JS5Od9" target="_blank" rel="noopener">京东</a> <a href="https://s.taobao.com/search?q=分布式服务架构" target="_blank" rel="noopener">淘宝</a></li>
<li>《聊聊架构》 <a href="https://union-click.jd.com/jdc?d=FHooH4" target="_blank" rel="noopener">京东</a> <a href="https://s.taobao.com/search?q=聊聊架构" target="_blank" rel="noopener">淘宝</a></li>
<li>《云原生应用架构实践》<a href="https://union-click.jd.com/jdc?d=orkJSj" target="_blank" rel="noopener">京东</a> <a href="https://s.taobao.com/search?q=云原生应用架构实践" target="_blank" rel="noopener">淘宝</a></li>
<li>《亿级流量网站架构核心技术》<a href="https://union-click.jd.com/jdc?d=RnOSP5" target="_blank" rel="noopener">京东</a> <a href="https://s.taobao.com/search?q=亿级流量网站架构核心技术" target="_blank" rel="noopener">淘宝</a></li>
<li>《淘宝技术这十年》<a href="https://union-click.jd.com/jdc?d=LwrDfD" target="_blank" rel="noopener">京东</a> <a href="https://s.taobao.com/search?q=淘宝技术这十年" target="_blank" rel="noopener">淘宝</a></li>
<li><p>《企业IT架构转型之道-中台战略思想与架构实战》 <a href="https://union-click.jd.com/jdc?d=89pAEm" target="_blank" rel="noopener">京东</a> <a href="https://s.taobao.com/search?q=企业IT架构转型之道" target="_blank" rel="noopener">淘宝</a></p>
</li>
<li><p>《高可用架构（第1卷）》<a href="https://item.jd.com/12195481.html" target="_blank" rel="noopener">京东</a> <a href="https://s.taobao.com/search?q=高可用架构" target="_blank" rel="noopener">淘宝</a></p>
</li>
</ul>
<h4 id="技术管理方面"><a href="#技术管理方面" class="headerlink" title="技术管理方面"></a>技术管理方面</h4><ul>
<li>《CTO说》<a href="https://union-click.jd.com/jdc?d=zhTZyr" target="_blank" rel="noopener">京东</a> <a href="https://s.taobao.com/search?q=CTO说" target="_blank" rel="noopener">淘宝</a></li>
<li>《技术管理之巅》<a href="https://union-click.jd.com/jdc?d=LgRBUW" target="_blank" rel="noopener">京东</a> <a href="https://s.taobao.com/search?q=技术管理之巅" target="_blank" rel="noopener">淘宝</a></li>
<li>《网易一千零一夜：互联网产品项目管理实战》<a href="https://union-click.jd.com/jdc?d=jcRz2r" target="_blank" rel="noopener">京东</a> <a href="https://s.taobao.com/search?q=网易一千零一夜：互联网产品项目管理实战" target="_blank" rel="noopener">淘宝</a></li>
</ul>
<h4 id="基础理论-1"><a href="#基础理论-1" class="headerlink" title="基础理论"></a>基础理论</h4><ul>
<li>《数学之美》<a href="https://union-click.jd.com/jdc?d=ghIES2" target="_blank" rel="noopener">京东</a> <a href="https://s.taobao.com/search?q=数学之美" target="_blank" rel="noopener">淘宝</a></li>
<li>《编程珠玑》<a href="https://union-click.jd.com/jdc?d=YmhdEu" target="_blank" rel="noopener">京东</a> <a href="https://s.taobao.com/search?q=编程珠玑" target="_blank" rel="noopener">淘宝</a></li>
</ul>
<h4 id="工具方面"><a href="#工具方面" class="headerlink" title="工具方面"></a>工具方面</h4><p>TODO</p>
<h4 id="大数据方面"><a href="#大数据方面" class="headerlink" title="大数据方面"></a>大数据方面</h4><h1 id="技术资源"><a href="#技术资源" class="headerlink" title="技术资源"></a>技术资源</h1><h2 id="开源资源"><a href="#开源资源" class="headerlink" title="开源资源"></a>开源资源</h2><ul>
<li><p><a href="https://github.com" target="_blank" rel="noopener">github</a></p>
</li>
<li><p><a href="https://www.apache.org/index.html" target="_blank" rel="noopener">Apache 软件基金会</a></p>
</li>
</ul>
<h2 id="手册、文档、教程"><a href="#手册、文档、教程" class="headerlink" title="手册、文档、教程"></a>手册、文档、教程</h2><p><strong>国内：</strong></p>
<ul>
<li><a href="http://w3cschool.cn" target="_blank" rel="noopener">W3Cschool</a> </li>
<li><p><a href="http://www.runoob.com/" target="_blank" rel="noopener">Runoob.com</a></p>
<ul>
<li>HTML 、 CSS、XML、Java、Python、PHP、设计模式等入门手册。</li>
</ul>
</li>
<li><p><a href="https://love2.io/" target="_blank" rel="noopener">Love2.io</a></p>
<ul>
<li>很多很多中文在线电子书，是一个全新的开源技术文档分享平台。</li>
</ul>
</li>
<li><a href="http://gitbook.cn/" target="_blank" rel="noopener">gitbook.cn</a><ul>
<li>付费电子书。 </li>
</ul>
</li>
<li><a href="http://www.apachecn.org/" target="_blank" rel="noopener">ApacheCN</a><ul>
<li>AI、大数据方面系列中文文档。</li>
</ul>
</li>
</ul>
<p><strong>国外：</strong></p>
<ul>
<li><a href="http://www.quickcode.co/" target="_blank" rel="noopener">Quick Code</a><ul>
<li>免费在线技术教程。</li>
</ul>
</li>
<li><a href="http://gitbook.com" target="_blank" rel="noopener">gitbook.com</a><ul>
<li>有部分中文电子书。</li>
</ul>
</li>
<li><a href="https://www.cheatography.com/" target="_blank" rel="noopener">Cheatography</a><ul>
<li>Cheat Sheets 大全，单页文档网站。</li>
</ul>
</li>
<li><a href="https://www.tutorialspoint.com/index.htm" target="_blank" rel="noopener">Tutorialspoint</a><ul>
<li>知名教程网站，提供Java、Python、JS、SQL、大数据等高质量入门教程。</li>
</ul>
</li>
</ul>
<h2 id="在线课堂"><a href="#在线课堂" class="headerlink" title="在线课堂"></a>在线课堂</h2><ul>
<li><a href="http://www.xuetuwuyou.com/" target="_blank" rel="noopener">学徒无忧</a></li>
<li><a href="https://time.geekbang.org/" target="_blank" rel="noopener">极客时间</a></li>
<li><a href="https://segmentfault.com/lives" target="_blank" rel="noopener">segmentfault</a></li>
<li><a href="https://new.stuq.org/course/explore" target="_blank" rel="noopener">斯达克学院</a></li>
<li><a href="http://nowcoder.com" target="_blank" rel="noopener">牛客网</a></li>
<li><a href="https://www.jikexueyuan.com/" target="_blank" rel="noopener">极客学院</a></li>
<li><a href="http://edu.51cto.com/" target="_blank" rel="noopener">51CTO学院</a></li>
</ul>
<h2 id="会议、活动"><a href="#会议、活动" class="headerlink" title="会议、活动"></a>会议、活动</h2><ul>
<li><a href="http://www.infoq.com/cn/qcon/" target="_blank" rel="noopener">QCon</a></li>
<li><a href="https://archsummit.com" target="_blank" rel="noopener">ArchSummit</a></li>
<li><a href="http://www.thegitc.com/" target="_blank" rel="noopener">GITC全球互联网技术大会</a></li>
</ul>
<p><strong>活动发布平台:</strong> </p>
<ul>
<li><a href="http://www.huodongxing.com/" target="_blank" rel="noopener">活动行</a></li>
</ul>
<h2 id="常用APP"><a href="#常用APP" class="headerlink" title="常用APP"></a>常用APP</h2><ul>
<li><a href="https://time.geekbang.org" target="_blank" rel="noopener">极客时间</a></li>
<li><a href="https://www.igetget.com" target="_blank" rel="noopener">得到</a></li>
</ul>
<h2 id="找工作"><a href="#找工作" class="headerlink" title="找工作"></a>找工作</h2><ul>
<li><a href="https://www.zhipin.com" target="_blank" rel="noopener">Boss直聘</a></li>
<li><a href="https://www.lagou.com" target="_blank" rel="noopener">拉勾网</a></li>
<li><a href="https://www.liepin.com" target="_blank" rel="noopener">猎聘</a></li>
<li><a href="https://cn.100offer.com/" target="_blank" rel="noopener">100Offer</a></li>
</ul>
<h2 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h2><ul>
<li><a href="https://s.geekbang.org/" target="_blank" rel="noopener">极客搜索</a><ul>
<li>技术文章搜索引擎。</li>
</ul>
</li>
</ul>
<h2 id="代码托管"><a href="#代码托管" class="headerlink" title="代码托管"></a>代码托管</h2><ul>
<li><a href="https://coding.net" target="_blank" rel="noopener">Coding</a></li>
<li><a href="https://gitee.com/" target="_blank" rel="noopener">码云</a></li>
</ul>
<h2 id="文件服务"><a href="#文件服务" class="headerlink" title="文件服务"></a>文件服务</h2><ul>
<li>七牛</li>
<li>又拍云</li>
</ul>
<h2 id="综合云服务商"><a href="#综合云服务商" class="headerlink" title="综合云服务商"></a>综合云服务商</h2><ul>
<li>阿里云</li>
<li><a href="https://cloud.tencent.com/redirect.php?redirect=1012&amp;cps_key=c2665015d90871c0cb20fef91b7afc3c" target="_blank" rel="noopener">腾讯云</a></li>
<li>百度云</li>
<li>新浪云</li>
<li>金山云</li>
<li><a href="https://amazonaws-china.com/cn/" target="_blank" rel="noopener">亚马逊云(AWS)</a></li>
<li><a href="https://cloud.google.com/?hl=zh-cn" target="_blank" rel="noopener">谷歌云</a></li>
<li><a href="https://azure.microsoft.com/zh-cn/" target="_blank" rel="noopener">微软云</a></li>
</ul>
<h3 id="VPS"><a href="#VPS" class="headerlink" title="VPS"></a>VPS</h3><ul>
<li><a href="http://linode.com" target="_blank" rel="noopener">Linode</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://chenwenning.github.io/2018/06/07/MySQL学习笔记(Day014)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="陈汶宁">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://pic.qqtn.com/up/2017-10/2017101317054482087.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CHENWENNING BLOG">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/06/07/MySQL学习笔记(Day014)/" itemprop="url">MySQL学习笔记（Day014：触发器下/存储过程/自定义函数）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-06-07T17:30:16+08:00">
                2018-06-07
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/mysql/" itemprop="url" rel="index">
                    <span itemprop="name">mysql</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/06/07/MySQL学习笔记(Day014)/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2018/06/07/MySQL学习笔记(Day014)/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="MySQL学习笔记（Day014：触发器下-存储过程-自定义函数）"><a href="#MySQL学习笔记（Day014：触发器下-存储过程-自定义函数）" class="headerlink" title="MySQL学习笔记（Day014：触发器下/存储过程/自定义函数）"></a>MySQL学习笔记（Day014：触发器下/存储过程/自定义函数）</h1><p>@(MySQL学习)</p>
<p>[TOC]</p>
<h2 id="一-作业讲解"><a href="#一-作业讲解" class="headerlink" title="一. 作业讲解"></a>一. 作业讲解</h2><ul>
<li><p><strong>查询employees表中非基层用户的最近详细信息</strong></p>
<blockquote>
<p><strong>关于<code>Group By</code>在《SQL必知必会》中提及的部分规定：</strong></p>
<ol>
<li><code>GROUP BY</code>子句中列出的每一列都必须是检索列或有效的表达式（但不能是聚集函数）。如果在SELECT中使用表达式，则必须在<code>GROUP BY</code>子句中指定相同的表达式。不能使用别名。</li>
<li>除聚集计算语句外，<code>SELECT语句中的每一列都必须在GROUP BY子句中给出</code>。</li>
</ol>
</blockquote>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">    e.emp_no,</span><br><span class="line">    <span class="keyword">CONCAT</span>(last_name, <span class="string">' '</span>, first_name) <span class="keyword">AS</span> <span class="keyword">name</span>,</span><br><span class="line">    t.title,</span><br><span class="line">    dp.dept_name,</span><br><span class="line">    s.salary</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">    employees e</span><br><span class="line">        <span class="keyword">LEFT</span> <span class="keyword">JOIN</span></span><br><span class="line">    dept_manager d <span class="keyword">ON</span> e.emp_no = d.emp_no</span><br><span class="line">        <span class="keyword">LEFT</span> <span class="keyword">JOIN</span></span><br><span class="line">    (<span class="keyword">SELECT</span> </span><br><span class="line">        emp_no, title, from_date, <span class="keyword">to_date</span></span><br><span class="line">    <span class="keyword">FROM</span></span><br><span class="line">        titles</span><br><span class="line">    <span class="keyword">WHERE</span></span><br><span class="line">        (emp_no , from_date, <span class="keyword">to_date</span>) <span class="keyword">IN</span> (<span class="keyword">SELECT</span> </span><br><span class="line">                emp_no, <span class="keyword">MAX</span>(from_date), <span class="keyword">MAX</span>(<span class="keyword">to_date</span>)</span><br><span class="line">            <span class="keyword">FROM</span></span><br><span class="line">                titles <span class="keyword">AS</span> b</span><br><span class="line">            <span class="keyword">GROUP</span> <span class="keyword">BY</span> b.emp_no)) t <span class="keyword">ON</span> t.emp_no = e.emp_no</span><br><span class="line">        <span class="keyword">LEFT</span> <span class="keyword">JOIN</span></span><br><span class="line">    (<span class="keyword">SELECT</span> </span><br><span class="line">        dept_no, emp_no, from_date, <span class="keyword">to_date</span></span><br><span class="line">    <span class="keyword">FROM</span></span><br><span class="line">        dept_emp</span><br><span class="line">    <span class="keyword">WHERE</span></span><br><span class="line">        (emp_no , from_date, <span class="keyword">to_date</span>) <span class="keyword">IN</span> (<span class="keyword">SELECT</span> </span><br><span class="line">                emp_no, <span class="keyword">MAX</span>(from_date), <span class="keyword">MAX</span>(<span class="keyword">to_date</span>)</span><br><span class="line">            <span class="keyword">FROM</span></span><br><span class="line">                dept_emp <span class="keyword">AS</span> b</span><br><span class="line">            <span class="keyword">GROUP</span> <span class="keyword">BY</span> b.emp_no)) de <span class="keyword">ON</span> de.emp_no = e.emp_no</span><br><span class="line">        <span class="keyword">LEFT</span> <span class="keyword">JOIN</span></span><br><span class="line">    (<span class="keyword">SELECT</span> </span><br><span class="line">        emp_no, salary, from_date, <span class="keyword">to_date</span></span><br><span class="line">    <span class="keyword">FROM</span></span><br><span class="line">        salaries</span><br><span class="line">    <span class="keyword">WHERE</span></span><br><span class="line">        (emp_no , from_date, <span class="keyword">to_date</span>) <span class="keyword">IN</span> (<span class="keyword">SELECT</span> </span><br><span class="line">                emp_no, <span class="keyword">MAX</span>(from_date), <span class="keyword">MAX</span>(<span class="keyword">to_date</span>)</span><br><span class="line">            <span class="keyword">FROM</span></span><br><span class="line">                salaries <span class="keyword">AS</span> b</span><br><span class="line">            <span class="keyword">GROUP</span> <span class="keyword">BY</span> b.emp_no)) s <span class="keyword">ON</span> s.emp_no = e.emp_no</span><br><span class="line">        <span class="keyword">LEFT</span> <span class="keyword">JOIN</span></span><br><span class="line">    departments dp <span class="keyword">ON</span> dp.dept_no = de.dept_no</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">    d.emp_no <span class="keyword">IS</span> <span class="literal">NULL</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- 改进的子查询语句 - 1</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">    emp_no, title, from_date, <span class="keyword">to_date</span></span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">    titles</span><br><span class="line">        <span class="keyword">WHERE</span></span><br><span class="line">        (emp_no , from_date, <span class="keyword">to_date</span>) <span class="keyword">IN</span> </span><br><span class="line">            (</span><br><span class="line">                <span class="keyword">SELECT</span> </span><br><span class="line">                    emp_no, <span class="keyword">MAX</span>(from_date), <span class="keyword">MAX</span>(<span class="keyword">to_date</span>)  <span class="comment">-- 因为数据本身的问题，这里from_date和to_date都要</span></span><br><span class="line">                <span class="keyword">FROM</span></span><br><span class="line">                    titles <span class="keyword">AS</span> b</span><br><span class="line">                    <span class="keyword">GROUP</span> <span class="keyword">BY</span> b.emp_no</span><br><span class="line">            ) <span class="comment">-- 这个子查询表示以emp_no分类，找到最大（最近）的from_date和to_date</span></span><br><span class="line">              <span class="comment">-- 而where条件在这个最大的基础上，过滤出我们要的title。(salary同理)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- 改进的子查询语句 - 2</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">    emp_no, title, from_date, <span class="keyword">to_date</span></span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">    titles <span class="keyword">AS</span> a</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">    (from_date, <span class="keyword">to_date</span>) = (<span class="keyword">SELECT</span> </span><br><span class="line">            <span class="keyword">MAX</span>(from_date), <span class="keyword">MAX</span>(<span class="keyword">to_date</span>)  <span class="comment">-- 同样使用from_date和to_date</span></span><br><span class="line">        <span class="keyword">FROM</span></span><br><span class="line">            titles <span class="keyword">AS</span> b</span><br><span class="line">        <span class="keyword">WHERE</span></span><br><span class="line">            a.emp_no = b.emp_no  <span class="comment">-- 这个是一个关联子查询</span></span><br><span class="line">        <span class="keyword">GROUP</span> <span class="keyword">BY</span> b.emp_no);</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>Rank排名一条SQL语句</strong></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from test_rank_2;</span><br><span class="line">+<span class="comment">------+-------+</span></span><br><span class="line">| id   | score |</span><br><span class="line">+<span class="comment">------+-------+</span></span><br><span class="line">|    1 |    10 |</span><br><span class="line">|    2 |    20 |</span><br><span class="line">|    3 |    30 |</span><br><span class="line">|    4 |    30 |</span><br><span class="line">|    5 |    40 |</span><br><span class="line">|    6 |    40 |</span><br><span class="line">+<span class="comment">------+-------+</span></span><br><span class="line">6 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> <span class="keyword">id</span>, score,</span><br><span class="line">    -&gt; <span class="keyword">case</span></span><br><span class="line">    -&gt;     <span class="keyword">when</span> @prev_value = score <span class="keyword">then</span> @rank_count</span><br><span class="line">    -&gt;     <span class="keyword">when</span> @prev_value := score <span class="keyword">then</span> @rank_count := @rank_count + <span class="number">1</span></span><br><span class="line">    -&gt; <span class="keyword">end</span> <span class="keyword">as</span> rank_column</span><br><span class="line">    -&gt; <span class="keyword">from</span> test_rank_2, (<span class="keyword">select</span> @prev_value:=<span class="literal">NULL</span>, @rank_count:=<span class="number">0</span>) <span class="keyword">as</span> t  <span class="comment">-- 和RowNumber思路一样，增加一个表</span></span><br><span class="line">    -&gt; <span class="keyword">order</span> <span class="keyword">by</span> score <span class="keyword">desc</span>;</span><br><span class="line">+<span class="comment">------+-------+-------------+</span></span><br><span class="line">| id   | score | rank_column |</span><br><span class="line">+<span class="comment">------+-------+-------------+</span></span><br><span class="line">|    5 |    40 | 1           |</span><br><span class="line">|    6 |    40 | 1           |</span><br><span class="line">|    3 |    30 | 2           |</span><br><span class="line">|    4 |    30 | 2           |</span><br><span class="line">|    2 |    20 | 3           |</span><br><span class="line">|    1 |    10 | 4           |</span><br><span class="line">+<span class="comment">------+-------+-------------+</span></span><br><span class="line">6 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="二-触发器-・-下"><a href="#二-触发器-・-下" class="headerlink" title="二. 触发器 ・ 下"></a>二. 触发器 ・ 下</h2><h3 id="1-触发器总结"><a href="#1-触发器总结" class="headerlink" title="1. 触发器总结"></a>1. 触发器总结</h3><ul>
<li>触发器对性能有损耗，应当非常慎重使用；</li>
<li>对于事物表，<code>触发器执行失败则整个语句回滚</code>；</li>
<li>Row格式主从复制，<code>触发器不会在从库上执行</code>； <ul>
<li>因为从库复制的肯定是主库已经提交的数据，既然已经提交了说明触发器已经被触发过了，所以从库不会执行。</li>
</ul>
</li>
<li><p>使用触发器时应防止递归执行；</p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">delimiter //</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">trigger</span> trg_test</span><br><span class="line">    <span class="keyword">before</span> <span class="keyword">update</span> <span class="keyword">on</span> <span class="string">'test_trigger'</span></span><br><span class="line">    <span class="keyword">for</span> <span class="keyword">each</span> <span class="keyword">row</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">update</span> test_trigger <span class="keyword">set</span> score=<span class="number">20</span> <span class="keyword">where</span> <span class="keyword">name</span> = old.name;  <span class="comment">-- 又触发了update操作，循环触发了</span></span><br><span class="line"><span class="keyword">end</span>;//</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="2-触发器模拟物化视图"><a href="#2-触发器模拟物化视图" class="headerlink" title="2. 触发器模拟物化视图"></a>2. 触发器模拟物化视图</h3><ul>
<li><p><strong>物化视图的概念</strong></p>
<ul>
<li>不是基于基表的虚表</li>
<li>根据基表实际存在的实表</li>
<li>预先计算并保存耗时较多的SQL操作结果（如多表链接(join)或者group by等）</li>
</ul>
</li>
<li><p><strong>模拟物化视图</strong></p>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create table Orders  </span><br><span class="line">    -&gt; (order_id int unsigned not null auto_increment,</span><br><span class="line">    -&gt; product_name varchar(30) not null,</span><br><span class="line">    -&gt; price decimal(8,2) not null,</span><br><span class="line">    -&gt; amount smallint not null,</span><br><span class="line">    -&gt; primary key(order_id));</span><br><span class="line">Query OK, 0 rows affected (0.13 sec)  <span class="comment">-- 创建Orders表</span></span><br><span class="line"></span><br><span class="line">mysql&gt; insert into Orders values </span><br><span class="line">    -&gt; (null, 'cpu', 135.5 ,1),</span><br><span class="line">    -&gt; (null, 'memory', 48.2, 3),</span><br><span class="line">    -&gt; (null, 'cpu', 125.6, 3),</span><br><span class="line">    -&gt; (null, 'cpu', 105.3, 4);</span><br><span class="line">Query OK, 4 rows affected (0.06 sec)  <span class="comment">-- 插入测试数据</span></span><br><span class="line">Records: 4  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from  Orders;</span><br><span class="line">+<span class="comment">----------+--------------+--------+--------+</span></span><br><span class="line">| order_id | product_name | price  | amount |</span><br><span class="line">+<span class="comment">----------+--------------+--------+--------+</span></span><br><span class="line">|        1 | cpu          | 135.50 |      1 |</span><br><span class="line">|        2 | memory       |  48.20 |      3 |</span><br><span class="line">|        3 | cpu          | 125.60 |      3 |</span><br><span class="line">|        4 | cpu          | 105.30 |      4 |</span><br><span class="line">+<span class="comment">----------+--------------+--------+--------+</span></span><br><span class="line">4 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 建立一个模拟物化视图的表（即用这张表来模拟物化视图）</span></span><br><span class="line">mysql&gt; <span class="keyword">create</span> <span class="keyword">table</span> Orders_MV </span><br><span class="line">    -&gt; ( product_name <span class="built_in">varchar</span>(<span class="number">30</span>) <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">    -&gt;  price_sum <span class="built_in">decimal</span>(<span class="number">8</span>,<span class="number">2</span>) <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">    -&gt;  amount_sum <span class="built_in">int</span> <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">    -&gt;  price_avg <span class="built_in">float</span> <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">    -&gt;  orders_cnt <span class="built_in">int</span> <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">    -&gt;  <span class="keyword">unique</span> <span class="keyword">index</span> (product_name));</span><br><span class="line">Query OK, 0 rows affected (0.14 sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 通过Orders表的数据，将测试数据初始化到Orders_MV表中</span></span><br><span class="line">mysql&gt; insert into Orders_MV </span><br><span class="line">    -&gt;     select product_name, sum(price), </span><br><span class="line">    -&gt;            sum(amount), avg(price), count(*)</span><br><span class="line">    -&gt;     from Orders</span><br><span class="line">    -&gt;     group by product_name;</span><br><span class="line">Query OK, 2 rows affected (0.07 sec)</span><br><span class="line">Records: 2  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from Orders_MV;</span><br><span class="line">+<span class="comment">--------------+-----------+------------+-----------+------------+</span></span><br><span class="line">| product_name | price_sum | amount_sum | price_avg | orders_cnt |</span><br><span class="line">+<span class="comment">--------------+-----------+------------+-----------+------------+</span></span><br><span class="line">| cpu          |    366.40 |          8 |   122.133 |          3 |</span><br><span class="line">| memory       |     48.20 |          3 |      48.2 |          1 |</span><br><span class="line">+<span class="comment">--------------+-----------+------------+-----------+------------+</span></span><br><span class="line">2 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 在MySQL workbench中输入，比较方便</span></span><br><span class="line">delimiter //</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TRIGGER</span> tgr_Orders_insert <span class="comment">-- 创建触发器为tgr_Orders_insert</span></span><br><span class="line">	<span class="keyword">AFTER</span> <span class="keyword">INSERT</span> <span class="keyword">ON</span> Orders  <span class="comment">-- 触发器是INSERT类型的，且作用于Orders表</span></span><br><span class="line">	<span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="keyword">ROW</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">	<span class="keyword">SET</span> @old_price_sum := <span class="number">0</span>;  <span class="comment">-- 设置临时存放Orders_MV表(模拟物化视图)的字段的变量</span></span><br><span class="line">	<span class="keyword">SET</span> @old_amount_sum := <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">SET</span> @old_price_avg := <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">SET</span> @old_orders_cnt := <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">SELECT</span>   <span class="comment">-- select ... into ... 在更新Orders_MV之前，将Orders_MV中对应某个产品的信息写入临时变量 </span></span><br><span class="line">		<span class="keyword">IFNULL</span>(price_sum, <span class="number">0</span>),</span><br><span class="line">		<span class="keyword">IFNULL</span>(amount_sum, <span class="number">0</span>),</span><br><span class="line">		<span class="keyword">IFNULL</span>(price_avg, <span class="number">0</span>),</span><br><span class="line">		<span class="keyword">IFNULL</span>(orders_cnt, <span class="number">0</span>)</span><br><span class="line">	<span class="keyword">FROM</span></span><br><span class="line">		Orders_MV</span><br><span class="line">	<span class="keyword">WHERE</span></span><br><span class="line">		product_name = NEW.product_name <span class="keyword">INTO</span> @old_price_sum , @old_amount_sum , @old_price_avg , @old_orders_cnt;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">SET</span> @new_price_sum = @old_price_sum + NEW.price; <span class="comment">-- 累加新的值</span></span><br><span class="line">	<span class="keyword">SET</span> @new_amount_sum = @old_amount_sum + NEW.amount;</span><br><span class="line">	<span class="keyword">SET</span> @new_orders_cnt = @old_orders_cnt + <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">SET</span> @new_price_avg = @new_price_sum / @new_orders_cnt ;</span><br><span class="line">	</span><br><span class="line">    <span class="keyword">REPLACE</span> <span class="keyword">INTO</span> Orders_MV   </span><br><span class="line">			<span class="keyword">VALUES</span>(NEW.product_name, @new_price_sum,</span><br><span class="line">				   @new_amount_sum, @new_price_avg, @new_orders_cnt );</span><br><span class="line">   <span class="comment">-- REPLACE 将对应的物品（唯一索引）的字段值替换new_xxx的值</span></span><br><span class="line"><span class="keyword">END</span>;//</span><br><span class="line"></span><br><span class="line">delimiter ;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mysql&gt; insert into Orders values (null, 'ssd', 299, 3);</span><br><span class="line">Query OK, 1 row affected (0.03 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into Orders values (null, 'memory', 47.9, 5);</span><br><span class="line">Query OK, 1 row affected (0.05 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from Orders_MV;</span><br><span class="line">+<span class="comment">--------------+-----------+------------+-----------+------------+</span></span><br><span class="line">| product_name | price_sum | amount_sum | price_avg | orders_cnt |</span><br><span class="line">+<span class="comment">--------------+-----------+------------+-----------+------------+</span></span><br><span class="line">| cpu          |    366.40 |          8 |   122.133 |          3 |</span><br><span class="line">| memory       |     96.10 |          8 |     48.05 |          2 | <span class="comment">-- 数量自动增加了1，价格也发生了变化</span></span><br><span class="line">| ssd          |    299.00 |          3 |       299 |          1 | <span class="comment">-- 新增加的ssd产品</span></span><br><span class="line">+<span class="comment">--------------+-----------+------------+-----------+------------+</span></span><br><span class="line">3 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- IFNULL MySQL内建函数的演示</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line">mysql&gt; <span class="keyword">select</span> @<span class="keyword">test</span>;</span><br><span class="line">+<span class="comment">-------+</span></span><br><span class="line">| @test |</span><br><span class="line">+<span class="comment">-------+</span></span><br><span class="line">| NULL  |  <span class="comment">-- 当前会话中没有test变量</span></span><br><span class="line">+<span class="comment">-------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> <span class="keyword">ifnull</span>(@<span class="keyword">test</span>, <span class="number">100</span>);   <span class="comment">-- 如果test为NULL，则ifnull返回100</span></span><br><span class="line">+<span class="comment">--------------------+</span></span><br><span class="line">| ifnull(@test, 100) |</span><br><span class="line">+<span class="comment">--------------------+</span></span><br><span class="line">| 100                |  <span class="comment">-- ifnull函数return的值是100</span></span><br><span class="line">+<span class="comment">--------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> @<span class="keyword">test</span>;</span><br><span class="line">+<span class="comment">-------+</span></span><br><span class="line">| @test |</span><br><span class="line">+<span class="comment">-------+</span></span><br><span class="line">| NULL  |  <span class="comment">-- 但是test还是NULL</span></span><br><span class="line">+<span class="comment">-------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">set</span> @<span class="keyword">test</span>:=<span class="number">200</span>;  <span class="comment">-- 给test变量赋值为200</span></span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select ifnull(@test, 100);  -- 再次ifnull判断，此时test不为null，则返回test变量的值</span><br><span class="line">+<span class="comment">--------------------+</span></span><br><span class="line">| ifnull(@test, 100) |</span><br><span class="line">+<span class="comment">--------------------+</span></span><br><span class="line">|                200 |  <span class="comment">-- test不为null。返回test的值200</span></span><br><span class="line">+<span class="comment">--------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- select into 用法</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line">mysql&gt; <span class="keyword">select</span> @id_1;</span><br><span class="line">+<span class="comment">-------+</span></span><br><span class="line">| @id_1 |</span><br><span class="line">+<span class="comment">-------+</span></span><br><span class="line">|  NULL | <span class="comment">-- 当前变量id_1为null </span></span><br><span class="line">+<span class="comment">-------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> @score_1;</span><br><span class="line">+<span class="comment">----------+</span></span><br><span class="line">| @score_1 |</span><br><span class="line">+<span class="comment">----------+</span></span><br><span class="line">|     NULL |  <span class="comment">-- 当前变量score_1为null</span></span><br><span class="line">+<span class="comment">----------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> * <span class="keyword">from</span> test_rank_2;</span><br><span class="line">+<span class="comment">------+-------+</span></span><br><span class="line">| id   | score |</span><br><span class="line">+<span class="comment">------+-------+</span></span><br><span class="line">|    1 |    10 |</span><br><span class="line">|    2 |    20 |</span><br><span class="line">|    3 |    30 |</span><br><span class="line">|    4 |    30 |</span><br><span class="line">|    5 |    40 |</span><br><span class="line">|    6 |    40 |</span><br><span class="line">+<span class="comment">------+-------+</span></span><br><span class="line">6 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> * <span class="keyword">from</span> test_rank_2 </span><br><span class="line">    -&gt; <span class="keyword">where</span> <span class="keyword">id</span>=<span class="number">1</span> <span class="keyword">into</span> @id_1, @score_1;</span><br><span class="line"><span class="comment">-- 选择id=1的记录，将对应的id和score赋值给变量 id_1 和 score_1</span></span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select @id_1;</span><br><span class="line">+<span class="comment">-------+</span></span><br><span class="line">| @id_1 |</span><br><span class="line">+<span class="comment">-------+</span></span><br><span class="line">|     1 |</span><br><span class="line">+<span class="comment">-------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> @score_1;</span><br><span class="line">+<span class="comment">----------+</span></span><br><span class="line">| @score_1 |</span><br><span class="line">+<span class="comment">----------+</span></span><br><span class="line">|       10 |</span><br><span class="line">+<span class="comment">----------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 触发器对性能会有影响，相当于在一个事物中插入了其他的事物</span></span><br></pre></td></tr></table></figure>
<hr>
<h2 id="三-存储过程"><a href="#三-存储过程" class="headerlink" title="三. 存储过程"></a>三. 存储过程</h2><h3 id="1-存储过程介绍"><a href="#1-存储过程介绍" class="headerlink" title="1. 存储过程介绍"></a>1. 存储过程介绍</h3><ul>
<li>存储在数据库端的一组SQL语句集；</li>
<li>用户可以通过存储过程名和传参多次调用的程序模块；</li>
<li>存储过程的特点：<ul>
<li>使用灵活，可以使用流控语句、自定义变量等完成复杂的业务逻辑；</li>
<li>提高数据安全性，屏蔽应用程序直接对表的操作，易于进行审计；</li>
<li>减少网络传输；</li>
<li>提高代码维护的复杂度，实际使用需要结合业务评估；</li>
</ul>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span></span><br><span class="line">    [DEFINER = &#123; <span class="keyword">user</span> | <span class="keyword">CURRENT_USER</span> &#125;]</span><br><span class="line">    <span class="keyword">PROCEDURE</span> sp_name ([proc_parameter[,...]])</span><br><span class="line">    [characteristic ...] routine_body</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">proc_parameter:  <span class="comment">-- 注意，只有procedure才有in(传入),out(传出),inout(传入传出)参数，自定义函数（只有）默认就是 in。</span></span><br><span class="line">    [ <span class="keyword">IN</span> | <span class="keyword">OUT</span> | INOUT ] param_name <span class="keyword">type</span> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">characteristic:</span><br><span class="line">    <span class="keyword">COMMENT</span> <span class="string">'string'</span></span><br><span class="line">  | <span class="keyword">LANGUAGE</span> <span class="keyword">SQL</span></span><br><span class="line">  | [<span class="keyword">NOT</span>] <span class="keyword">DETERMINISTIC</span></span><br><span class="line">  | &#123; CONTAINS <span class="keyword">SQL</span> | <span class="keyword">NO</span> <span class="keyword">SQL</span> | <span class="keyword">READS</span> <span class="keyword">SQL</span> <span class="keyword">DATA</span> | MODIFIES <span class="keyword">SQL</span> <span class="keyword">DATA</span> &#125;</span><br><span class="line">  | <span class="keyword">SQL</span> <span class="keyword">SECURITY</span> &#123; DEFINER | INVOKER &#125;</span><br><span class="line"></span><br><span class="line">routine_body:</span><br><span class="line">    Valid <span class="keyword">SQL</span> routine <span class="keyword">statement</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">PROCEDURE</span>  procedure_name;</span><br></pre></td></tr></table></figure>
<h3 id="2-存储过程举例与流程控制语句"><a href="#2-存储过程举例与流程控制语句" class="headerlink" title="2. 存储过程举例与流程控制语句"></a>2. 存储过程举例与流程控制语句</h3><blockquote>
<p><a href="http://dev.mysql.com/doc/refman/5.7/en/flow-control-statements.html" target="_blank" rel="noopener">流程控制语句 官方文档</a></p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- IF</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- 语法</span></span><br><span class="line">IF search_condition THEN statement_list</span><br><span class="line">    [ELSEIF search_condition THEN statement_list] ...</span><br><span class="line">    [ELSE statement_list]</span><br><span class="line"><span class="keyword">END</span> <span class="keyword">IF</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 例子</span></span><br><span class="line">mysql&gt; delimiter //</span><br><span class="line">mysql&gt; <span class="keyword">create</span> <span class="keyword">procedure</span> pcd_test_1 (<span class="keyword">in</span> param_a <span class="built_in">int</span>) <span class="comment">-- 创建一个</span></span><br><span class="line">    -&gt; <span class="keyword">begin</span></span><br><span class="line">    -&gt; <span class="keyword">declare</span> a <span class="built_in">int</span>;  <span class="comment">-- delcare声明了该变量的作用域在该procedure中</span></span><br><span class="line">    -&gt;     if param_a &gt; 10 then set a:=11;        </span><br><span class="line">    -&gt;         elseif param_a = 10 then set a:=10;</span><br><span class="line">    -&gt;         else set a:=9;</span><br><span class="line">    -&gt;     end if;</span><br><span class="line">    -&gt; end;//</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select @a;  -- 查看当前会话中变量a的值</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">| @a   |</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">| NULL |  <span class="comment">-- 当前会话中a为NULL</span></span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">call</span> pcd_test_1(<span class="number">1</span>);</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">| a    |</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">|    9 |</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="keyword">Query</span> OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">call</span> pcd_test_1(<span class="number">10</span>);</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">| a    |</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">|   10 |</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="keyword">Query</span> OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">call</span> pcd_test_1(<span class="number">20</span>);</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">| a    |</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">|   11 |</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="keyword">Query</span> OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> @a;</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">| @a   |</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">| NULL | <span class="comment">-- 使用了declare，使得procedure中a的作用域限制在了procedure内</span></span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- CASE WHEN</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- CASE WHEN 语法</span></span><br><span class="line"><span class="keyword">CASE</span> case_value</span><br><span class="line">    <span class="keyword">WHEN</span> when_value <span class="keyword">THEN</span> statement_list</span><br><span class="line">    [<span class="keyword">WHEN</span> when_value <span class="keyword">THEN</span> statement_list] ...</span><br><span class="line">    [<span class="keyword">ELSE</span> statement_list]</span><br><span class="line"><span class="keyword">END</span> <span class="keyword">CASE</span></span><br><span class="line"><span class="comment">-- 或者是</span></span><br><span class="line"><span class="keyword">CASE</span></span><br><span class="line">    <span class="keyword">WHEN</span> search_condition <span class="keyword">THEN</span> statement_list</span><br><span class="line">    [<span class="keyword">WHEN</span> search_condition <span class="keyword">THEN</span> statement_list] ...</span><br><span class="line">    [<span class="keyword">ELSE</span> statement_list]</span><br><span class="line"><span class="keyword">END</span> <span class="keyword">CASE</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- CASE WHEN 例子</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line">mysql&gt; delimiter //</span><br><span class="line">mysql&gt; </span><br><span class="line">mysql&gt; <span class="keyword">create</span> <span class="keyword">procedure</span> pcd_test_2(<span class="keyword">in</span> param_1 <span class="built_in">int</span>)</span><br><span class="line">    -&gt;   <span class="keyword">begin</span></span><br><span class="line">    -&gt;     <span class="keyword">case</span> param_1  </span><br><span class="line">    <span class="comment">-- 当case后面有value时，该value会和when中的when_value进行"="判断</span></span><br><span class="line">    <span class="comment">-- 相等则执行then后面的语句，然后跳出；否则就进行下一次when的匹配</span></span><br><span class="line">    -&gt;       <span class="keyword">when</span> <span class="number">2</span> <span class="keyword">then</span> <span class="keyword">select</span> <span class="number">200</span>;</span><br><span class="line">    -&gt;       when 3 then select 300;</span><br><span class="line">    -&gt;       else</span><br><span class="line">    -&gt;         begin  </span><br><span class="line">                    <span class="comment">-- 当没有匹配时，且else中没有要执行的语句</span></span><br><span class="line">                    <span class="comment">-- 则给一个begin/end的空语句；</span></span><br><span class="line">                    <span class="comment">-- 或者不写else语句；</span></span><br><span class="line">    -&gt;         end;</span><br><span class="line">    -&gt;     end case;</span><br><span class="line">    -&gt; end;//</span><br><span class="line">Query OK, 0 rows affected (0.03 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; delimiter ;</span><br><span class="line">mysql&gt; call pcd_test_2(1);</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; call pcd_test_2(2);</span><br><span class="line">+<span class="comment">-----+</span></span><br><span class="line">| 200 |</span><br><span class="line">+<span class="comment">-----+</span></span><br><span class="line">| 200 |</span><br><span class="line">+<span class="comment">-----+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="keyword">Query</span> OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">call</span> pcd_test_2(<span class="number">3</span>);</span><br><span class="line">+<span class="comment">-----+</span></span><br><span class="line">| 300 |</span><br><span class="line">+<span class="comment">-----+</span></span><br><span class="line">| 300 |</span><br><span class="line">+<span class="comment">-----+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="keyword">Query</span> OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 另外一种SQL语法请参考rank排名作业；注意when后跟的是condition</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- WHILE  循环</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- WHILE 语法</span></span><br><span class="line">[begin_label:] <span class="keyword">WHILE</span> search_condition <span class="keyword">DO</span></span><br><span class="line">    statement_list</span><br><span class="line"><span class="keyword">END</span> <span class="keyword">WHILE</span> [end_label]</span><br><span class="line"></span><br><span class="line"><span class="comment">-- WHILE举例</span></span><br><span class="line">mysql&gt; delimiter //</span><br><span class="line">mysql&gt; </span><br><span class="line">mysql&gt; <span class="keyword">create</span> <span class="keyword">procedure</span> pcd_test_3(<span class="keyword">in</span> param_1 <span class="built_in">int</span>)</span><br><span class="line">    -&gt; <span class="keyword">begin</span></span><br><span class="line">    -&gt;     <span class="keyword">declare</span> a <span class="built_in">int</span> <span class="keyword">default</span> <span class="number">1</span>;</span><br><span class="line">    -&gt;     while param_1 &gt; 10 do</span><br><span class="line">    -&gt;         set param_1 = param_1 - 1;</span><br><span class="line">    -&gt;         set a = a + 1;</span><br><span class="line">    -&gt;     end while;</span><br><span class="line">    -&gt;     select a;</span><br><span class="line">    -&gt; end;//</span><br><span class="line"></span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line">mysql&gt; delimiter ;</span><br><span class="line"></span><br><span class="line">mysql&gt; call pcd_test_3(15); -- 15 - 10 = 5；需要5次循环</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">| a    |</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">|    6 |  <span class="comment">-- a + 5 = 6</span></span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="keyword">Query</span> OK, <span class="number">0</span> <span class="keyword">rows</span> affected (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- REPEAT   循环</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- REPEAT 语法</span></span><br><span class="line">[begin_label:] <span class="keyword">REPEAT</span></span><br><span class="line">    statement_list</span><br><span class="line"><span class="keyword">UNTIL</span> search_condition</span><br><span class="line"><span class="keyword">END</span> <span class="keyword">REPEAT</span> [end_label]</span><br><span class="line"></span><br><span class="line">mysql&gt; delimiter //</span><br><span class="line">mysql&gt; <span class="keyword">create</span> <span class="keyword">procedure</span> pcd_test_4(<span class="keyword">in</span> param_1 <span class="built_in">int</span>)</span><br><span class="line">    -&gt; <span class="keyword">begin</span></span><br><span class="line">    -&gt;     <span class="keyword">SET</span> @x = <span class="number">0</span>;  <span class="comment">-- 没有使用declare，所以x是会话级别的</span></span><br><span class="line">    -&gt;     REPEAT</span><br><span class="line">    -&gt;         SET @x = @x + 1;</span><br><span class="line">    -&gt;     UNTIL @x &gt; param_1 END REPEAT;</span><br><span class="line">    -&gt; end;//</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line">mysql&gt; delimiter ;</span><br><span class="line"></span><br><span class="line">mysql&gt; call pcd_test_4(10);</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select @x; -- x是会话级别的</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">| @x   |</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">|   11 |  <span class="comment">-- 一共循环11次(10&gt;10 为False，11 &gt; 10为True，才跳出)</span></span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- loop 循环</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- loop语法</span></span><br><span class="line">[begin_label:] <span class="keyword">LOOP</span></span><br><span class="line">    statement_list</span><br><span class="line"><span class="keyword">END</span> <span class="keyword">LOOP</span> [end_label]</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ITERATE 和label相结合，表示继续从label处执行</span></span><br><span class="line"><span class="comment">-- LEAVE   和label相结合，表示从label 标记的代码段离开</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- loop 例子</span></span><br><span class="line">mysql&gt; delimiter //</span><br><span class="line">mysql&gt; <span class="keyword">create</span> <span class="keyword">procedure</span> pcd_test_5(<span class="keyword">in</span> param_1 <span class="built_in">int</span>)</span><br><span class="line">    -&gt; <span class="keyword">begin</span></span><br><span class="line">    -&gt;     test_label: <span class="keyword">loop</span></span><br><span class="line">    -&gt;         <span class="keyword">set</span> param_1 := param_1 + <span class="number">1</span>; <span class="comment">-- 参数累加</span></span><br><span class="line">    -&gt;         if param_1 &lt; 10 then        -- 如果累加的值小于10</span><br><span class="line">    -&gt;             iterate test_label;     -- 继续执行 标签 test_label</span><br><span class="line">    -&gt;         end if;</span><br><span class="line">    -&gt;         leave test_label;  -- 如果&gt;=10则离开这个test_label(loop)</span><br><span class="line">    -&gt;     end loop test_label; </span><br><span class="line">    -&gt;     set @x = param_1; -- 设置会话级别的变量 </span><br><span class="line">    -&gt; end;//</span><br><span class="line"></span><br><span class="line">Query OK, 0 rows affected (0.02 sec)</span><br><span class="line">mysql&gt; delimiter ;</span><br><span class="line"></span><br><span class="line">mysql&gt; call pcd_test_5(5); -- 5&lt;10 ，累加5次后&gt;=10为true，离开循环</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select @x;</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">| @x   |</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">|   10 |  <span class="comment">-- 累加到10的 param_1 赋值给 x, 即为10</span></span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 老师给出的例子， 阶乘</span></span><br><span class="line">mysql&gt; <span class="keyword">create</span> <span class="keyword">table</span> test_proc_1(a <span class="built_in">int</span>, b <span class="built_in">int</span>); <span class="comment">-- 给一个存放数据的表</span></span><br><span class="line">Query OK, 0 rows affected (0.15 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; delimiter //</span><br><span class="line">mysql&gt; create procedure proc_test1(in total int, out res int)</span><br><span class="line">    -&gt; begin</span><br><span class="line">    -&gt;     declare i int;</span><br><span class="line">    -&gt;     set i := 1;</span><br><span class="line">    -&gt;     set res := 1;</span><br><span class="line">    -&gt;     if total &lt;= 0 then</span><br><span class="line">    -&gt;         set total := 1;</span><br><span class="line">    -&gt;     end if;</span><br><span class="line">    -&gt;     while i &lt;= total do</span><br><span class="line">    -&gt;         set res := res * i;</span><br><span class="line">    -&gt;         insert into test_proc_1 values(i, res);</span><br><span class="line">    -&gt;         set i := i + 1;</span><br><span class="line">    -&gt;     end while;</span><br><span class="line">    -&gt; end;//</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line">mysql&gt; delimiter ;</span><br><span class="line"></span><br><span class="line">mysql&gt; set @res_value := 0;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; call proc_test1(5, @res_value); -- 因为res是out变量，要预先有这个变量，这里上面设置了res_value(实参和形参不必同名)</span><br><span class="line">Query OK, 1 row affected (0.15 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select @res_value;</span><br><span class="line">+<span class="comment">------------+</span></span><br><span class="line">| @res_value |</span><br><span class="line">+<span class="comment">------------+</span></span><br><span class="line">|        120 | <span class="comment">-- 5的阶乘的结果是120</span></span><br><span class="line">+<span class="comment">------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> * <span class="keyword">from</span> test_proc_1;</span><br><span class="line">+<span class="comment">------+------+</span></span><br><span class="line">| a    | b    |</span><br><span class="line">+<span class="comment">------+------+</span></span><br><span class="line">|    1 |    1 |</span><br><span class="line">|    2 |    2 |</span><br><span class="line">|    3 |    6 |</span><br><span class="line">|    4 |   24 |</span><br><span class="line">|    5 |  120 |  <span class="comment">-- 每次insert的结果</span></span><br><span class="line">+<span class="comment">------+------+</span></span><br><span class="line">5 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="三-自定义函数"><a href="#三-自定义函数" class="headerlink" title="三. 自定义函数"></a>三. 自定义函数</h2><ul>
<li>自定义函数和存储过程很类似，但是必须要有返回值；</li>
<li>与内置的函数(sum(), max()等)使用方法类似<ul>
<li>select fun(val);</li>
<li>select * from t where  col= fun(val);</li>
</ul>
</li>
<li>自定义函数可能在遍历每条记录中使用；</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span></span><br><span class="line">    [DEFINER = &#123; <span class="keyword">user</span> | <span class="keyword">CURRENT_USER</span> &#125;]</span><br><span class="line">    <span class="keyword">FUNCTION</span> sp_name ([func_parameter[,...]])</span><br><span class="line">    <span class="keyword">RETURNS</span> <span class="keyword">type</span>  <span class="comment">-- 必须有返回值</span></span><br><span class="line">    [characteristic ...] routine_body</span><br><span class="line">    </span><br><span class="line">func_parameter:</span><br><span class="line">    param_name <span class="keyword">type</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span>:</span><br><span class="line">    <span class="keyword">Any</span> valid MySQL <span class="keyword">data</span> <span class="keyword">type</span></span><br><span class="line"></span><br><span class="line">characteristic:</span><br><span class="line">    <span class="keyword">COMMENT</span> <span class="string">'string'</span></span><br><span class="line">  | <span class="keyword">LANGUAGE</span> <span class="keyword">SQL</span></span><br><span class="line">  | [<span class="keyword">NOT</span>] <span class="keyword">DETERMINISTIC</span></span><br><span class="line">  | &#123; CONTAINS <span class="keyword">SQL</span> | <span class="keyword">NO</span> <span class="keyword">SQL</span> | <span class="keyword">READS</span> <span class="keyword">SQL</span> <span class="keyword">DATA</span> | MODIFIES <span class="keyword">SQL</span> <span class="keyword">DATA</span> &#125;</span><br><span class="line">  | <span class="keyword">SQL</span> <span class="keyword">SECURITY</span> &#123; DEFINER | INVOKER &#125;</span><br><span class="line"></span><br><span class="line">routine_body:</span><br><span class="line">    Valid <span class="keyword">SQL</span> routine <span class="keyword">statement</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">-- 删除</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">FUNCTION</span> fun_name;</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 老师给的例子，还是阶乘，用自定义函数的方式</span></span><br><span class="line"></span><br><span class="line">mysql&gt; delimiter //</span><br><span class="line">mysql&gt; </span><br><span class="line">mysql&gt; create function fun_test_1(total int)</span><br><span class="line">    -&gt; returns int</span><br><span class="line">    -&gt; begin</span><br><span class="line">    -&gt;     declare i int;</span><br><span class="line">    -&gt;     declare res int;</span><br><span class="line">    -&gt;     set i := 1;</span><br><span class="line">    -&gt;     set res := 1;</span><br><span class="line">    -&gt;     if total &lt;= 0 then</span><br><span class="line">    -&gt;         set total := 1;</span><br><span class="line">    -&gt; end if;</span><br><span class="line">    -&gt;     while i &lt;= total do</span><br><span class="line">    -&gt;         set res := res * i;</span><br><span class="line">    -&gt;         set i := i + 1;</span><br><span class="line">    -&gt;     end while;</span><br><span class="line">    -&gt;     return res;</span><br><span class="line">    -&gt; end;//</span><br><span class="line">ERROR 1418 (HY000): This function has none of DETERMINISTIC, NO SQL, or READS SQL DATA in its declaration and binary logging is enabled (you *might* want to use the less safe log_bin_trust_function_creators variable)</span><br><span class="line"><span class="comment">-- 报错，提示因为函的声明中没有"DETERMINISTIC, NO SQL, or READS SQL DATA"等关键字 ，需要使用打开参数 log_bin_trust_function_creators</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 解决方法，set global log_bin_trust_function_creators=1; 开启该选项可能会引起主从服务器不一致</span></span><br><span class="line"><span class="comment">--           或者 增加 上述相应功能的关键字</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 使用 deterministic 关键字</span></span><br><span class="line"><span class="comment">-- 当你声明一个函数的返回是确定性的，则必须显示的使用deterministic关键字，默认是 no deterministic的</span></span><br><span class="line">mysql&gt; delimiter //</span><br><span class="line">mysql&gt; create function fun_test_1(total int)</span><br><span class="line">    -&gt; returns int deterministic -- 这个只是告诉MySQL我这个函数是否会改变数据</span><br><span class="line">                                 <span class="comment">-- 即使我下面使用了insert，update等DML语句，MySQL不会检查</span></span><br><span class="line">                                 <span class="comment">-- 函数是否会改变数据，完全依赖创建函数的用户去指定的关键字</span></span><br><span class="line">                                 <span class="comment">-- 而非真的是否有修改数据</span></span><br><span class="line">                                 <span class="comment">-- 只是声明，而非约束</span></span><br><span class="line">    -&gt; begin</span><br><span class="line">    -&gt;     declare i int;</span><br><span class="line">    -&gt;     declare res int;</span><br><span class="line">    -&gt;     set i := 1;</span><br><span class="line">    -&gt;     set res := 1;</span><br><span class="line">    -&gt;     if total &lt;= 0 then</span><br><span class="line">    -&gt;         set total := 1;</span><br><span class="line">    -&gt;     end if;</span><br><span class="line">    -&gt;     while i &lt;= total do</span><br><span class="line">    -&gt;         set res := res * i;</span><br><span class="line">    -&gt;         insert into test_proc_1 values(i, res);  -- 在自定义函数中，同样可以使用sql</span><br><span class="line">                                                        <span class="comment">-- 并且该SQL是insert，其实和deterministic违背。</span></span><br><span class="line">    -&gt;         set i := i + 1;</span><br><span class="line">    -&gt;     end while;</span><br><span class="line">    -&gt;     return res;</span><br><span class="line">    -&gt; end;//</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line">mysql&gt; delimiter ;</span><br><span class="line"></span><br><span class="line">mysql&gt; truncate table test_proc_1;</span><br><span class="line">Query OK, 0 rows affected (0.11 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select fun_test_1(6);  -- return了6的阶乘，720</span><br><span class="line">+<span class="comment">---------------+</span></span><br><span class="line">| fun_test_1(6) |</span><br><span class="line">+<span class="comment">---------------+</span></span><br><span class="line">|           720 |</span><br><span class="line">+<span class="comment">---------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.02</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> * <span class="keyword">from</span> test_proc_1; </span><br><span class="line">+<span class="comment">------+------+</span></span><br><span class="line">| a    | b    |</span><br><span class="line">+<span class="comment">------+------+</span></span><br><span class="line">|    1 |    1 |</span><br><span class="line">|    2 |    2 |</span><br><span class="line">|    3 |    6 |</span><br><span class="line">|    4 |   24 |</span><br><span class="line">|    5 |  120 |</span><br><span class="line">|    6 |  720 |  <span class="comment">-- 使用了insert语句进行插入阶乘的历史记录</span></span><br><span class="line">+<span class="comment">------+------+</span></span><br><span class="line">6 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 关键字简单说明</span></span><br><span class="line"><span class="comment">-- DETERMINISTIC ： 当给定相同的输入，产生确定的结果</span></span><br><span class="line"><span class="comment">-- NOT DETERMINISTIC ： 默认值，认为产生的结果是不确定的</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- READS SQL DATA  ： 只是读取SQL数据</span></span><br><span class="line"><span class="comment">-- MODIFIES SQL DATA ： 会修改数据</span></span><br><span class="line"><span class="comment">-- NO SQL ： 没有SQL遇见</span></span><br><span class="line"><span class="comment">-- CONTAINS SQL ： 包含SQL语句，但是没有读写语句，理论有select now()等</span></span><br></pre></td></tr></table></figure>
<p><a href="https://dev.mysql.com/doc/refman/5.7/en/stored-programs-logging.html" target="_blank" rel="noopener">原文链接</a><br><strong>部分原文：</strong><br><em>By default, for a CREATE FUNCTION statement to be accepted, at least one of DETERMINISTIC, NO SQL, or READS SQL DATA must be specified explicitly. Otherwise an error occurs:</em><br>默认情况下，在创建自定义函数时，必须显示的指定关键字<code>DETERMINISTIC, NO SQL, 或者是 READS SQL DATA</code>中的至少一个(可以多个)，否则就会有如下错误</p>
<blockquote>
<p>ERROR 1418 (HY000): This function has none of DETERMINISTIC, NO SQL,or READS SQL DATA in its declaration and binary logging is enabled (you <em>might</em> want to use the less safe log_bin_trust_function_creators<br>variable)</p>
</blockquote>
<p><a href="http://stackoverflow.com/questions/26015160/deterministic-no-sql-or-reads-sql-data-in-its-declaration-and-binary-logging-i" target="_blank" rel="noopener">网上参考资料1</a><br><a href="http://blog.csdn.net/melody_mr/article/details/43529719" target="_blank" rel="noopener">网上参考资料2</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://chenwenning.github.io/2018/06/06/MySQL学习笔记(Day013)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="陈汶宁">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://pic.qqtn.com/up/2017-10/2017101317054482087.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CHENWENNING BLOG">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/06/06/MySQL学习笔记(Day013)/" itemprop="url">MySQL学习笔记（Day013：作业讲解一/Rank/视图/UNION/触发器）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-06-06T17:30:16+08:00">
                2018-06-06
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/mysql/" itemprop="url" rel="index">
                    <span itemprop="name">mysql</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/06/06/MySQL学习笔记(Day013)/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2018/06/06/MySQL学习笔记(Day013)/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="MySQL学习笔记（Day013：作业讲解一-Rank-视图-UNION-触发器）"><a href="#MySQL学习笔记（Day013：作业讲解一-Rank-视图-UNION-触发器）" class="headerlink" title="MySQL学习笔记（Day013：作业讲解一/Rank/视图/UNION/触发器）"></a>MySQL学习笔记（Day013：作业讲解一/Rank/视图/UNION/触发器）</h1><p>@(MySQL学习)</p>
<p>[TOC]</p>
<h2 id="一-作业讲解"><a href="#一-作业讲解" class="headerlink" title="一. 作业讲解"></a>一. 作业讲解</h2><ul>
<li><p><strong>查询employees表中非基层用户的最近详细信息</strong></p>
<blockquote>
<p>老师的讲解的版本中存在问题，重新作为作业</p>
</blockquote>
</li>
<li><p><strong>统计dbt3库下orders每周每个客户的订单数量</strong></p>
</li>
</ul>
<ol>
<li><p>思路</p>
<ul>
<li><p>找到订单中最小周(week)之前的一周的周一，这里进行了简化，使用了<code>1970-01-05</code>作为周一标记，作为起始(<code>start</code>)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@MyServer ~]&gt; cal 1 1970</span><br><span class="line">    January 1970    </span><br><span class="line">Su Mo Tu We Th Fr Sa</span><br><span class="line">             1  2  3</span><br><span class="line"> 4  5  6  7  8  9 10  <span class="comment"># 1970-01-05 刚好是周一，用1月12号，19号，26号等也是可以的</span></span><br><span class="line">11 12 13 14 15 16 17</span><br><span class="line">18 19 20 21 22 23 24</span><br><span class="line">25 26 27 28 29 30 31</span><br></pre></td></tr></table></figure>
</li>
<li><p>在起始条件周一（<code>start</code>)的基础上 <code>增加6天</code>时间，就是周日，即为一周的结束标记(<code>end</code>)</p>
</li>
<li>通过对<code>start</code>（周一）、<code>end</code>（周日）以及<code>o_custkey</code>进行<code>分组</code>，使用<code>count(o_orderkey)</code>得到对应的数量</li>
</ul>
</li>
<li><p>SQL语句</p>
 <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 最终结果</span></span><br><span class="line"><span class="keyword">select</span> o_custkey,</span><br><span class="line">ADDDATE(<span class="string">'1970-01-05'</span>, <span class="built_in">INTERVAL</span> <span class="keyword">FLOOR</span>(<span class="keyword">DATEDIFF</span>(o_orderdate, <span class="string">'1970-01-05'</span>)/<span class="number">7</span>)*<span class="number">7</span> <span class="keyword">Day</span>) <span class="keyword">as</span> <span class="keyword">start</span>,</span><br><span class="line">ADDDATE(<span class="string">'1970-01-05'</span>, <span class="built_in">INTERVAL</span> <span class="keyword">FLOOR</span>(<span class="keyword">DATEDIFF</span>(o_orderdate, <span class="string">'1970-01-05'</span>)/<span class="number">7</span>)*<span class="number">7</span> + <span class="number">6</span> <span class="keyword">Day</span>) <span class="keyword">as</span> <span class="keyword">end</span>,</span><br><span class="line"><span class="keyword">count</span>(o_orderkey) <span class="keyword">as</span> total </span><br><span class="line"><span class="keyword">from</span> dbt3.orders <span class="keyword">group</span> <span class="keyword">by</span> o_custkey, <span class="keyword">start</span>, <span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- DATEDIFF(o_orderdate, '1970-01-05')</span></span><br><span class="line">mysql&gt; select datediff('1971-01-01', '1970-01-05');  -- 随意取一个1971-01-01，作为演示</span><br><span class="line">+<span class="comment">--------------------------------------+</span></span><br><span class="line">| datediff('1971-01-01', '1970-01-05') |</span><br><span class="line">+<span class="comment">--------------------------------------+</span></span><br><span class="line">|                                  361 |  <span class="comment">-- 1971-01-01 减去 1970-01-5 为361天</span></span><br><span class="line">+<span class="comment">--------------------------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line">    </span><br><span class="line">mysql&gt; <span class="keyword">select</span> <span class="keyword">datediff</span>(<span class="string">'1971-01-01'</span>, <span class="string">'1970-01-05'</span>) / <span class="number">7</span>;  <span class="comment">-- 求周数</span></span><br><span class="line">+<span class="comment">------------------------------------------+</span></span><br><span class="line">| datediff('1971-01-01', '1970-01-05') / 7 |</span><br><span class="line">+<span class="comment">------------------------------------------+</span></span><br><span class="line">|                                  51.5714 |  <span class="comment">-- 相隔51.5714周</span></span><br><span class="line">+<span class="comment">------------------------------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- FLOOR 和 ROUND函数</span></span><br><span class="line"><span class="comment">-- FLOOR(arg)是返回一个不大于arg的最大整数，其实就是取整</span></span><br><span class="line">mysql&gt; <span class="keyword">select</span> <span class="keyword">floor</span>(<span class="number">5.4</span>);</span><br><span class="line">+<span class="comment">------------+</span></span><br><span class="line">| floor(5.4) |</span><br><span class="line">+<span class="comment">------------+</span></span><br><span class="line">|          5 |</span><br><span class="line">+<span class="comment">------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> <span class="keyword">floor</span>(<span class="number">5.5</span>);</span><br><span class="line">+<span class="comment">------------+</span></span><br><span class="line">| floor(5.5) |</span><br><span class="line">+<span class="comment">------------+</span></span><br><span class="line">|          5 |</span><br><span class="line">+<span class="comment">------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> <span class="keyword">floor</span>(<span class="number">5.6</span>);</span><br><span class="line">+<span class="comment">------------+</span></span><br><span class="line">| floor(5.6) |</span><br><span class="line">+<span class="comment">------------+</span></span><br><span class="line">|          5 |</span><br><span class="line">+<span class="comment">------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- ROUND(X, D) 返回值是对数字X保留到小數点后D位，D默认为0，结果符合四舍五入原则；如果D为负数，则保留小数点左边（整数）的位数</span></span><br><span class="line">mysql&gt; <span class="keyword">select</span> <span class="keyword">round</span>(<span class="number">5.4</span>);  <span class="comment">-- 默认D为0，四舍五入</span></span><br><span class="line">+<span class="comment">------------+</span></span><br><span class="line">| round(5.4) |</span><br><span class="line">+<span class="comment">------------+</span></span><br><span class="line">|          5 |</span><br><span class="line">+<span class="comment">------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> <span class="keyword">round</span>(<span class="number">5.5</span>);  <span class="comment">-- 默认D为0，四舍五入</span></span><br><span class="line">+<span class="comment">------------+</span></span><br><span class="line">| round(5.5) |</span><br><span class="line">+<span class="comment">------------+</span></span><br><span class="line">|          6 |</span><br><span class="line">+<span class="comment">------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> <span class="keyword">round</span>(<span class="number">5.123</span>, <span class="number">1</span>); <span class="comment">-- 设D为1，保留小数点右边1为，四舍五入，不进位</span></span><br><span class="line">+<span class="comment">-----------------+</span></span><br><span class="line">| round(5.123, 1) |</span><br><span class="line">+<span class="comment">-----------------+</span></span><br><span class="line">|             5.1 |</span><br><span class="line">+<span class="comment">-----------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> <span class="keyword">round</span>(<span class="number">5.163</span>, <span class="number">1</span>); <span class="comment">-- 设D为1，保留小数点右边1为，四舍五入，进位</span></span><br><span class="line">+<span class="comment">-----------------+</span></span><br><span class="line">| round(5.163, 1) |</span><br><span class="line">+<span class="comment">-----------------+</span></span><br><span class="line">|             5.2 |</span><br><span class="line">+<span class="comment">-----------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line">        </span><br><span class="line">mysql&gt; <span class="keyword">select</span> <span class="keyword">round</span>(<span class="number">524.163</span>, <span class="number">-1</span>);  <span class="comment">-- 保留小数点左边1位，不进位</span></span><br><span class="line">+<span class="comment">--------------------+</span></span><br><span class="line">| round(524.163, -1) |</span><br><span class="line">+<span class="comment">--------------------+</span></span><br><span class="line">|                520 |</span><br><span class="line">+<span class="comment">--------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> <span class="keyword">round</span>(<span class="number">524.163</span>, <span class="number">-2</span>);  <span class="comment">-- 保留小数点左边2位, 不进位</span></span><br><span class="line">+<span class="comment">--------------------+</span></span><br><span class="line">| round(524.163, -2) |</span><br><span class="line">+<span class="comment">--------------------+</span></span><br><span class="line">|                500 |</span><br><span class="line">+<span class="comment">--------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> <span class="keyword">round</span>(<span class="number">554.163</span>, <span class="number">-2</span>);  <span class="comment">-- 保留小数点左边2位, 进位</span></span><br><span class="line">+<span class="comment">--------------------+</span></span><br><span class="line">| round(554.163, -2) |</span><br><span class="line">+<span class="comment">--------------------+</span></span><br><span class="line">|                600 |</span><br><span class="line">+<span class="comment">--------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 所以这里使用floor函数取整， 超过一周且不满一周的则落在start 和 end 中间</span></span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> <span class="keyword">floor</span>(<span class="keyword">datediff</span>(<span class="string">'1971-01-01'</span>, <span class="string">'1970-01-05'</span>) / <span class="number">7</span>);</span><br><span class="line">+<span class="comment">-------------------------------------------------+</span></span><br><span class="line">| floor(datediff('1971-01-01', '1970-01-05') / 7) |</span><br><span class="line">+<span class="comment">-------------------------------------------------+</span></span><br><span class="line">|                                              51 |  <span class="comment">-- 取整为51周</span></span><br><span class="line">+<span class="comment">-------------------------------------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> <span class="keyword">floor</span>(<span class="keyword">datediff</span>(<span class="string">'1971-01-01'</span>, <span class="string">'1970-01-05'</span>) / <span class="number">7</span>) * <span class="number">7</span>;</span><br><span class="line">+<span class="comment">-----------------------------------------------------+</span></span><br><span class="line">| floor(datediff('1971-01-01', '1970-01-05') / 7) * 7 |</span><br><span class="line">+<span class="comment">-----------------------------------------------------+</span></span><br><span class="line">|                                                 357 |  <span class="comment">-- 乘以7，得出357天差值</span></span><br><span class="line">+<span class="comment">-----------------------------------------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> adddate(<span class="string">'1970-01-05'</span>, <span class="built_in">interval</span> <span class="keyword">floor</span>(<span class="keyword">datediff</span>(<span class="string">'1971-01-01'</span>, <span class="string">'1970-01-05'</span>)/<span class="number">7</span>)*<span class="number">7</span> <span class="keyword">day</span>) <span class="keyword">as</span> Monday_start;    </span><br><span class="line"><span class="comment">-- 使用adddate函数，在1970-01-05(周一)的基础上，增加357天（51周），得到的值1970-12-28也是周一，标记为start</span></span><br><span class="line">+<span class="comment">--------------+</span></span><br><span class="line">| Monday_start |</span><br><span class="line">+<span class="comment">--------------+</span></span><br><span class="line">| 1970-12-28   |  <span class="comment">-- 1970-12-28（周一），而传入的值1971-01-01是该周的周五</span></span><br><span class="line">+<span class="comment">--------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 以同样的方法得到周日</span></span><br><span class="line">mysql&gt; <span class="keyword">select</span> adddate(<span class="string">'1970-01-05'</span>, <span class="built_in">interval</span> <span class="keyword">floor</span>(<span class="keyword">datediff</span>(<span class="string">'1971-01-01'</span>, <span class="string">'1970-01-05'</span>)/<span class="number">7</span>)*<span class="number">7</span> + <span class="number">6</span> <span class="keyword">day</span>) <span class="keyword">as</span> Sunday_end;</span><br><span class="line">+<span class="comment">------------+</span></span><br><span class="line">| Sunday_end |</span><br><span class="line">+<span class="comment">------------+</span></span><br><span class="line">| 1971-01-03 |</span><br><span class="line">+<span class="comment">------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 通过以上的周一和周日的计算，即可求出1971-01-01这天所在的一周，得出start（周一）和end（周日）</span></span><br><span class="line"><span class="comment">-- 然后对start和end以及o_custkey做分组操作，并通过count(o_orderkey)得到分组的定单量</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<ul>
<li><strong>使用子查询实现RowNumber</strong></li>
</ul>
<ol>
<li><p>思路</p>
<ul>
<li>假设当前在第N行记录，通过主键emp_no遍历有多少行的记录<code>小于等于</code>当前行,即为当前行的行数</li>
</ul>
</li>
<li><p>SQL语句</p>
 <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">(<span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(<span class="number">1</span>) <span class="keyword">FROM</span> employees b <span class="keyword">WHERE</span> b.emp_no &lt;= a.emp_no ) <span class="keyword">AS</span> row_number,</span><br><span class="line">emp_no,<span class="keyword">CONCAT</span>(last_name,<span class="string">" "</span>,first_name) <span class="keyword">name</span>,gender,hire_date</span><br><span class="line"><span class="keyword">FROM</span> employees a <span class="keyword">ORDER</span> <span class="keyword">BY</span> emp_no <span class="keyword">LIMIT</span> <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 假设当前在第5行</span></span><br><span class="line">mysql&gt; select  b.emp_no  from employees.employees as b order by b.emp_no limit 5;</span><br><span class="line">+<span class="comment">--------+</span></span><br><span class="line">| emp_no |</span><br><span class="line">+<span class="comment">--------+</span></span><br><span class="line">|  10001 |</span><br><span class="line">|  10002 |</span><br><span class="line">|  10003 |</span><br><span class="line">|  10004 |</span><br><span class="line">|  10005 |  <span class="comment">-- 第5行的emp_no是10005</span></span><br><span class="line">+<span class="comment">--------+</span></span><br><span class="line">5 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span>  <span class="keyword">count</span>(*)  <span class="keyword">from</span> employees.employees <span class="keyword">as</span> b <span class="keyword">where</span> b.emp_no &lt;= <span class="number">10005</span> <span class="keyword">order</span> <span class="keyword">by</span> b.emp_no;</span><br><span class="line">查找小于等于5的行数有几行</span><br><span class="line">+<span class="comment">----------+</span></span><br><span class="line">| count(*) |</span><br><span class="line">+<span class="comment">----------+</span></span><br><span class="line">|        5 |  <span class="comment">-- 小于等于10005的记录有5行，则5就是10005该行记录的行号</span></span><br><span class="line">+<span class="comment">----------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 将该子查询的结果即可作为RowNumber</span></span><br><span class="line"><span class="comment">-- 但是该子查询的效率较低。不推荐使用。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 推荐Day012中提及的自定义变量方式</span></span><br><span class="line"><span class="keyword">SELECT</span> @a:=@a+<span class="number">1</span> <span class="keyword">AS</span> row_number,</span><br><span class="line">    emp_no,<span class="keyword">CONCAT</span>(last_name,<span class="string">" "</span>,first_name) <span class="keyword">name</span>,gender,hire_date</span><br><span class="line">    <span class="keyword">FROM</span> employees,(<span class="keyword">SELECT</span> @a:=<span class="number">0</span>) <span class="keyword">AS</span> a <span class="keyword">LIMIT</span> <span class="number">10</span>;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<hr>
<h2 id="二-Rank"><a href="#二-Rank" class="headerlink" title="二. Rank"></a>二. Rank</h2><blockquote>
<p>给出不同的用户的分数，然后根据分数计算排名<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create table test_rank(id int, score int);</span><br><span class="line">Query OK, 0 rows affected (0.16 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into test_rank values(1, 10), (2, 20), (3, 30), (4, 30), (5, 40), (6, 40);</span><br><span class="line">Query OK, 6 rows affected (0.05 sec)</span><br><span class="line">Records: 6  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from test_rank;</span><br><span class="line">+<span class="comment">------+-------+</span></span><br><span class="line">| id   | score |</span><br><span class="line">+<span class="comment">------+-------+</span></span><br><span class="line">|    1 |    10 |</span><br><span class="line">|    2 |    20 |</span><br><span class="line">|    3 |    30 |</span><br><span class="line">|    4 |    30 |</span><br><span class="line">|    5 |    40 |</span><br><span class="line">|    6 |    40 |</span><br><span class="line">+<span class="comment">------+-------+</span></span><br><span class="line">6 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">set</span> @prev_value := <span class="literal">NULL</span>;  <span class="comment">-- 假设比较到第N行，设置一个变量prev_value用于存放第N-1行score的分数</span></span><br><span class="line">                                 <span class="comment">-- 用于比较第N行的score和第N-1行的score</span></span><br><span class="line">                                 <span class="comment">-- prev_value可以理解为 是临时保存第N-1行的score的变量</span></span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; set @rank_count := 0;     -- 用于存放当前的排名</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select  id, score, </span><br><span class="line">    -&gt; case</span><br><span class="line">    -&gt;     when @prev_value = score then @rank_count  </span><br><span class="line">           <span class="comment">-- 相等则prev_value不变， 并返回rank_count（第一次为NULL，不会相等，所以跳转到下一个when语句）</span></span><br><span class="line">    -&gt;     when @prev_value := score then @rank_count := @rank_count + 1 </span><br><span class="line">           <span class="comment">-- 不等，则第N行的score赋值(:=)给prev_value。且rank_count增加1</span></span><br><span class="line">    -&gt; end as rank_column   -- case 开始的，end结尾</span><br><span class="line">    -&gt; from test_rank</span><br><span class="line">    -&gt; order by score desc;</span><br><span class="line">+<span class="comment">------+-------+-------------+</span></span><br><span class="line">| id   | score | rank_column |</span><br><span class="line">+<span class="comment">------+-------+-------------+</span></span><br><span class="line">|    5 |    40 |           1 |</span><br><span class="line">|    6 |    40 |           1 |</span><br><span class="line">|    3 |    30 |           2 |</span><br><span class="line">|    4 |    30 |           2 |</span><br><span class="line">|    2 |    20 |           3 |</span><br><span class="line">|    1 |    10 |           4 |</span><br><span class="line">+<span class="comment">------+-------+-------------+</span></span><br><span class="line">6 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- case  </span></span><br><span class="line"><span class="comment">--   when [condition_1] then [do_something_1] </span></span><br><span class="line"><span class="comment">--   when [condition_2] then [do_something_2] </span></span><br><span class="line"><span class="comment">--   end</span></span><br><span class="line"><span class="comment">-- 语法：如果 condition_1条件满足，则执行 do_something_1 然后就跳出,不会执行condition_2;</span></span><br><span class="line"><span class="comment">--       如果 condition_1条件不满足，则继续执行到 condition_2。以此类推。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- 作业：使用一条语句写出Rank</span></span><br><span class="line"><span class="comment">--</span></span><br></pre></td></tr></table></figure></p>
</blockquote>
<hr>
<h2 id="三-视图"><a href="#三-视图" class="headerlink" title="三. 视图"></a>三. 视图</h2><blockquote>
<p><a href="http://dev.mysql.com/doc/refman/5.7/en/create-view.html" target="_blank" rel="noopener">官方文档</a></p>
</blockquote>
<ul>
<li><strong>创建视图</strong></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- 创建视图</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line">mysql&gt; create view view_rank as select * from test_rank;  -- 针对上面的test_rank创建一个视图</span><br><span class="line">Query OK, 0 rows affected (0.03 sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 也可以对select结果增加条件进行过滤后，再创建视图</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mysql&gt; show create table test_rank\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">       Table: test_rank</span><br><span class="line"><span class="keyword">Create</span> <span class="keyword">Table</span>: <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`test_rank`</span> (    <span class="comment">-- 得到的是表结构</span></span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`score`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span></span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8mb4</span><br><span class="line"><span class="number">1</span> <span class="keyword">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">show</span> <span class="keyword">create</span> <span class="keyword">table</span> view_rank\G  <span class="comment">-- 他是以一张表的形式存在的，可通过show tables看到</span></span><br><span class="line">*************************** <span class="number">1.</span> <span class="keyword">row</span> ***************************</span><br><span class="line">                <span class="keyword">View</span>: view_rank</span><br><span class="line">         <span class="keyword">Create</span> <span class="keyword">View</span>: <span class="keyword">CREATE</span> ALGORITHM=UNDEFINED DEFINER=<span class="string">`root`</span>@<span class="string">`localhost`</span> <span class="keyword">SQL</span> <span class="keyword">SECURITY</span> DEFINER <span class="keyword">VIEW</span> <span class="string">`view_rank`</span> <span class="keyword">AS</span> <span class="keyword">select</span> <span class="string">`test_rank`</span>.<span class="string">`id`</span> <span class="keyword">AS</span> <span class="string">`id`</span>,<span class="string">`test_rank`</span>.<span class="string">`score`</span> <span class="keyword">AS</span> <span class="string">`score`</span> <span class="keyword">from</span> <span class="string">`test_rank`</span></span><br><span class="line">                      <span class="comment">-- 和真正的表不同的是，这里show出来的是视图的定义</span></span><br><span class="line">character_set_client: utf8</span><br><span class="line">collation_connection: utf8_general_ci</span><br><span class="line"><span class="number">1</span> <span class="keyword">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> * <span class="keyword">from</span> view_rank;  <span class="comment">-- 可以直接查询该视图得结果</span></span><br><span class="line">+<span class="comment">------+-------+</span></span><br><span class="line">| id   | score |</span><br><span class="line">+<span class="comment">------+-------+</span></span><br><span class="line">|    1 |    10 |</span><br><span class="line">|    2 |    20 |</span><br><span class="line">|    3 |    30 |</span><br><span class="line">|    4 |    30 |</span><br><span class="line">|    5 |    40 |</span><br><span class="line">|    6 |    40 |</span><br><span class="line">+<span class="comment">------+-------+</span></span><br><span class="line">6 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 视图的作用是，可以对开发人员是透明的，可以隐藏部分关键的列</span></span><br><span class="line"><span class="comment">-- 视图在mysql是虚拟表。根据视图的定义，还是取执行定义中的select语句。</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 只开放部分列</span></span><br><span class="line">mysql&gt; <span class="keyword">create</span> <span class="keyword">view</span> view_rank_1 <span class="keyword">as</span> <span class="keyword">select</span> <span class="keyword">id</span> <span class="keyword">from</span> test_rank; <span class="comment">-- 只开放id列</span></span><br><span class="line">Query OK, 0 rows affected (0.04 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from view_rank_1;  -- 即使 select * ，也只能看到id列，具有隐藏原来表中部分列的功能                        </span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">| id   |</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">|    1 |</span><br><span class="line">|    2 |</span><br><span class="line">|    3 |</span><br><span class="line">|    4 |</span><br><span class="line">|    5 |</span><br><span class="line">|    6 |</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">6 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 不要取用select * from 去创建视图，因为mysql会把*逐个解析成列。</span></span><br><span class="line"><span class="comment">-- 当原来的表结构发生变化时，视图的表结构是不会发生变化的，视图在创建的瞬间，便确定了结构。</span></span><br><span class="line"><span class="comment">-- 比如，当你alter原来的表 增加列(add columns)时,再去查询该视图,新增加的列是不存在的。</span></span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">alter</span> <span class="keyword">table</span> test_rank <span class="keyword">add</span> <span class="keyword">column</span>  c <span class="built_in">int</span> <span class="keyword">default</span> <span class="number">0</span>; <span class="comment">-- 增加一列名字为c，默认值为0</span></span><br><span class="line">Query OK, 0 rows affected (0.30 sec)</span><br><span class="line">Records: 0  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from test_rank;  -- 查询原表，新的列c出现了</span><br><span class="line">+<span class="comment">------+-------+------+</span></span><br><span class="line">| id   | score | c    |</span><br><span class="line">+<span class="comment">------+-------+------+</span></span><br><span class="line">|    1 |    10 |    0 |</span><br><span class="line">|    2 |    20 |    0 |</span><br><span class="line">|    3 |    30 |    0 |</span><br><span class="line">|    4 |    30 |    0 |</span><br><span class="line">|    5 |    40 |    0 |</span><br><span class="line">|    6 |    40 |    0 |</span><br><span class="line">+<span class="comment">------+-------+------+</span></span><br><span class="line">6 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> * <span class="keyword">from</span> view_rank; <span class="comment">-- 尽管view_rank用select * 创建，但当时没有列c，所以无法得到c列的值</span></span><br><span class="line">+<span class="comment">------+-------+</span></span><br><span class="line">| id   | score |</span><br><span class="line">+<span class="comment">------+-------+</span></span><br><span class="line">|    1 |    10 |</span><br><span class="line">|    2 |    20 |</span><br><span class="line">|    3 |    30 |</span><br><span class="line">|    4 |    30 |</span><br><span class="line">|    5 |    40 |</span><br><span class="line">|    6 |    40 |</span><br><span class="line">+<span class="comment">------+-------+</span></span><br><span class="line">6 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 注意：mysql中的视图都是虚拟表。不像Oracle可以物化成真实存在的表。</span></span><br><span class="line"><span class="comment">--      每次查询视图，实际上还是去查询的原来的表，只是查询的规则是在视图创建时经过定义的。</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p><strong>视图的算法</strong><br>视图的算法(<code>ALGORITHM</code>)有三种方式：</p>
<ul>
<li><code>UNDEFINED</code> 默认方式，由MySQL来判断使用下面的哪种算法</li>
<li><code>MERGE</code> ： <code>每次</code>通过<code>物理表</code>查询得到结果，把结果merge(合并)起来返回</li>
<li><p><code>TEMPTABLE</code> ： 产生一张<code>临时表</code>，把数据放入临时表后，客户端再去临时表取数据（<code>不会缓存</code>）</p>
<blockquote>
<p><code>TEMPTABLE 特点</code>：即使访问条件一样，第二次查询还是会去读取物理表中的内容，并重新生成一张临时表,并不会取缓存之前的表。<em>（临时表是Memory存储引擎，默认放内存，超过配置大小放磁盘）</em></p>
</blockquote>
<blockquote>
<p>当查询有一个较大的结果集时，使用<code>TEMPTABLE</code>可以快速的结束对该物理表的访问，从而可以快速释放这张物理表上占用的资源。然后客户端可以对临时表上的数据做一些耗时的操作，而不影响原来的物理表。</p>
</blockquote>
</li>
</ul>
</li>
</ul>
<pre><code>**所以一般我们使用`UNDEFINED`，由MySQL自己去判断**
</code></pre><hr>
<h2 id="四-UNION"><a href="#四-UNION" class="headerlink" title="四. UNION"></a>四. UNION</h2><ol>
<li><code>UNION</code> 的作用是将两个查询的结果集进行合并。</li>
<li>UNION必须由<code>两条或两条以上</code>的SELECT语句组成，语句之间用关键字<code>UNION</code>分隔。</li>
<li>UNION中的每个查询必须包含相同的列（<code>类型相同或可以隐式转换</code>）、表达式或聚集函数。</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create table test_union_1(a int, b int);</span><br><span class="line">Query OK, 0 rows affected (0.18 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; create table test_union_2(a int, c int);  </span><br><span class="line">Query OK, 0 rows affected (0.15 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into test_union_1 values(1, 2), (3, 4), (5, 6), (10, 20);</span><br><span class="line">Query OK, 4 rows affected (0.06 sec)</span><br><span class="line">Records: 4  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into test_union_2 values(10, 20), (30, 40), (50, 60);  </span><br><span class="line">Query OK, 3 rows affected (0.03 sec)</span><br><span class="line">Records: 3  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from test_union_1;</span><br><span class="line">+<span class="comment">------+------+</span></span><br><span class="line">| a    | b    |</span><br><span class="line">+<span class="comment">------+------+</span></span><br><span class="line">|    1 |    2 |</span><br><span class="line">|    3 |    4 |</span><br><span class="line">|    5 |    6 |</span><br><span class="line">|   10 |   20 |  <span class="comment">-- test_union_1 中的10, 20</span></span><br><span class="line">+<span class="comment">------+------+</span></span><br><span class="line">4 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> * <span class="keyword">from</span> test_union_2;</span><br><span class="line">+<span class="comment">------+------+</span></span><br><span class="line">| a    | c    |</span><br><span class="line">+<span class="comment">------+------+</span></span><br><span class="line">|   10 |   20 | <span class="comment">-- test_union_2 中的10, 20</span></span><br><span class="line">|   30 |   40 |</span><br><span class="line">|   50 |   60 |  </span><br><span class="line">+<span class="comment">------+------+</span></span><br><span class="line">3 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> a, b <span class="keyword">as</span> t <span class="keyword">from</span> test_union_1</span><br><span class="line">    -&gt; <span class="keyword">union</span></span><br><span class="line">    -&gt; <span class="keyword">select</span> * <span class="keyword">from</span> test_union_2;</span><br><span class="line">+<span class="comment">------+------+</span></span><br><span class="line">| a    | t    |</span><br><span class="line">+<span class="comment">------+------+</span></span><br><span class="line">|    1 |    2 |</span><br><span class="line">|    3 |    4 |</span><br><span class="line">|    5 |    6 |</span><br><span class="line">|   10 |   20 | <span class="comment">-- 只出现了一次 10, 20，union会去重</span></span><br><span class="line">|   30 |   40 |</span><br><span class="line">|   50 |   60 |</span><br><span class="line">+<span class="comment">------+------+</span></span><br><span class="line">6 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> a, b <span class="keyword">as</span> t <span class="keyword">from</span> test_union_1</span><br><span class="line">    -&gt; <span class="keyword">union</span> all   <span class="comment">-- 使用 union all 可以不去重</span></span><br><span class="line">    -&gt; <span class="keyword">select</span> * <span class="keyword">from</span> test_union_2;</span><br><span class="line">+<span class="comment">------+------+</span></span><br><span class="line">| a    | t    |</span><br><span class="line">+<span class="comment">------+------+</span></span><br><span class="line">|    1 |    2 |</span><br><span class="line">|    3 |    4 |</span><br><span class="line">|    5 |    6 |</span><br><span class="line">|   10 |   20 | <span class="comment">-- test_union_1 中的10, 20</span></span><br><span class="line">|   10 |   20 | <span class="comment">-- test_union_2 中的10, 20</span></span><br><span class="line">|   30 |   40 |</span><br><span class="line">|   50 |   60 |</span><br><span class="line">+<span class="comment">------+------+</span></span><br><span class="line">7 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> a, b <span class="keyword">as</span> t <span class="keyword">from</span> test_union_1 <span class="keyword">where</span> a &gt; <span class="number">2</span> </span><br><span class="line">    -&gt; <span class="keyword">union</span></span><br><span class="line">    -&gt; <span class="keyword">select</span> * <span class="keyword">from</span> test_union_2 <span class="keyword">where</span> c &gt; <span class="number">50</span>;  <span class="comment">-- 使用where过滤也可以 </span></span><br><span class="line">+<span class="comment">------+------+</span></span><br><span class="line">| a    | t    |</span><br><span class="line">+<span class="comment">------+------+</span></span><br><span class="line">|    3 |    4 |</span><br><span class="line">|    5 |    6 |</span><br><span class="line">|   10 |   20 |</span><br><span class="line">|   50 |   60 |</span><br><span class="line">+<span class="comment">------+------+</span></span><br><span class="line">4 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>如果知道数据本身具有唯一性，没有重复，则建议使用<code>union all</code>，因为<code>union</code>会做<code>去重操作</code>，性能会比<code>union all</code>要低</p>
</blockquote>
<hr>
<h2 id="五-触发器"><a href="#五-触发器" class="headerlink" title="五. 触发器"></a>五. 触发器</h2><blockquote>
<p><a href="http://dev.mysql.com/doc/refman/5.7/en/create-trigger.html" target="_blank" rel="noopener">官方文档</a></p>
</blockquote>
<ul>
<li><p><strong>定义</strong></p>
<ul>
<li>触发器的对象是<code>表</code>，当表上出现<code>特定的事件</code>时<code>触发</code>该程序的执行</li>
</ul>
</li>
<li><p><strong>触发器的类型</strong></p>
<ul>
<li><p><strong><code>UPDATE</code></strong></p>
<ul>
<li>update 操作</li>
</ul>
</li>
<li><p><strong><code>DELETE</code></strong></p>
<ul>
<li>delete 操作</li>
<li>replace 操作<ul>
<li><strong>注意：</strong>drop，truncate等DDL操作<code>不会触发</code>DELETE</li>
</ul>
</li>
</ul>
</li>
<li><p><strong><code>INSERT</code></strong></p>
<ul>
<li>insert 操作</li>
<li>load data 操作</li>
<li>replace 操作</li>
</ul>
<blockquote>
<p>注意，<code>replace</code>操作会<strong><code>触发两次</code></strong>，一次是<code>UPDATE</code>类型的触发器，一次是<code>INSERT</code>类型的触发器<br>MySQL 5.6版本同一个类型的触发器只能有一个<em>(针对一个表)</em><br>MySQL 5.7允许多个同一类型的触发器</p>
</blockquote>
<blockquote>
<p><strong>注意：触发器只触发DML(Data Manipulation Language)操作，不会触发DDL(Data Definition Language)操作<em>（create,drop等操作）</em> </strong></p>
</blockquote>
</li>
</ul>
</li>
</ul>
<ul>
<li><p><strong>创建触发器</strong></p>
  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span></span><br><span class="line">    [DEFINER = &#123; <span class="keyword">user</span> | <span class="keyword">CURRENT_USER</span> &#125;]</span><br><span class="line">    <span class="keyword">TRIGGER</span> trigger_name  <span class="comment">-- 触发器名字</span></span><br><span class="line">    trigger_time trigger_event  <span class="comment">-- 触发时间和事件</span></span><br><span class="line">    <span class="keyword">ON</span> tbl_name <span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="keyword">ROW</span>    </span><br><span class="line">    [trigger_order]</span><br><span class="line">    trigger_body</span><br><span class="line"></span><br><span class="line">trigger_time: &#123; <span class="keyword">BEFORE</span> | <span class="keyword">AFTER</span> &#125;   <span class="comment">-- 事件之前还是之后触发</span></span><br><span class="line"></span><br><span class="line">trigger_event: &#123; <span class="keyword">INSERT</span> | <span class="keyword">UPDATE</span> | <span class="keyword">DELETE</span> &#125;  <span class="comment">-- 三个类型</span></span><br><span class="line"></span><br><span class="line">trigger_order: &#123; <span class="keyword">FOLLOWS</span> | <span class="keyword">PRECEDES</span> &#125; other_trigger_name</span><br></pre></td></tr></table></figure>
</li>
</ul>
<pre><code><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create table test_trigger_1 (</span><br><span class="line">    -&gt;     name varchar(10),</span><br><span class="line">    -&gt;     score int(10),</span><br><span class="line">    -&gt; primary key (name));</span><br><span class="line">Query OK, 0 rows affected (0.14 sec)</span><br><span class="line">    </span><br><span class="line">    mysql&gt; delimiter //  -- 将语句分隔符定义成 // （原来是';'）</span><br><span class="line">    mysql&gt; create trigger  trg_upd_score  -- 定义触发器名字</span><br><span class="line">        -&gt; before update on test_trigger_1  -- 作用在test_trigger_1 更新(update)之前(before)</span><br><span class="line">        -&gt; for each row  -- 每行</span><br><span class="line">        -&gt; begin  -- 开始定义</span><br><span class="line">        -&gt; if new.score &lt; 0 then   -- 如果新值小于0</span><br><span class="line">        -&gt;     set new.score=0;        -- 则设置成0</span><br><span class="line">        -&gt; elseif new.score &gt; 100 then  -- 如果新值大于100</span><br><span class="line">        -&gt;     set new.score = 100;  -- 则设置成100</span><br><span class="line">        -&gt; end if;  -- begin对应的 结束 </span><br><span class="line">        -&gt; end;//   -- 结束，使用新定义的 '//' 结尾</span><br><span class="line">    Query OK, 0 rows affected (0.03 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; delimiter ;  -- 恢复 ';' 结束符</span><br><span class="line"></span><br><span class="line"><span class="comment">-- new.col : 表示更新以后的值</span></span><br><span class="line"><span class="comment">-- old.col : 表示更新以前的值(只读)</span></span><br><span class="line"></span><br><span class="line">mysql&gt; insert into test_trigger_1 values ("tom", 200);  -- 插入新值</span><br><span class="line">Query OK, 1 row affected (0.04 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from test_trigger_1;</span><br><span class="line">+<span class="comment">------+-------+</span></span><br><span class="line">| name | score |</span><br><span class="line">+<span class="comment">------+-------+</span></span><br><span class="line">| tom  |   200 |  <span class="comment">-- 没改成100，因为定义的是update，而执行的是insert</span></span><br><span class="line">+<span class="comment">------+-------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">update</span> test_trigger_1 </span><br><span class="line">    -&gt; <span class="keyword">set</span> score=<span class="number">300</span> <span class="keyword">where</span> <span class="keyword">name</span>=<span class="string">'tom'</span>; <span class="comment">-- 改成300</span></span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line">Rows matched: 1  Changed: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from test_trigger_1;</span><br><span class="line">+<span class="comment">------+-------+</span></span><br><span class="line">| name | score |</span><br><span class="line">+<span class="comment">------+-------+</span></span><br><span class="line">| tom  |   100 | <span class="comment">-- 通过触发器的设置，大于100的值被修改成100</span></span><br><span class="line">+<span class="comment">------+-------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://chenwenning.github.io/2018/06/04/MySQL学习笔记(Day012)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="陈汶宁">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://pic.qqtn.com/up/2017-10/2017101317054482087.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CHENWENNING BLOG">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/06/04/MySQL学习笔记(Day012)/" itemprop="url">MySQL学习笔记（Day012：子查询/INSERT/UPDATE/DELETE/REPLACE）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-06-04T17:30:16+08:00">
                2018-06-04
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/mysql/" itemprop="url" rel="index">
                    <span itemprop="name">mysql</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/06/04/MySQL学习笔记(Day012)/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2018/06/04/MySQL学习笔记(Day012)/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="MySQL学习笔记（Day012：子查询-INSERT-UPDATE-DELETE-REPLACE）"><a href="#MySQL学习笔记（Day012：子查询-INSERT-UPDATE-DELETE-REPLACE）" class="headerlink" title="MySQL学习笔记（Day012：子查询/INSERT/UPDATE/DELETE/REPLACE）"></a>MySQL学习笔记（Day012：子查询/INSERT/UPDATE/DELETE/REPLACE）</h1><p>@(MySQL学习)</p>
<p>[TOC]</p>
<h2 id="一-子查询"><a href="#一-子查询" class="headerlink" title="一. 子查询"></a>一. 子查询</h2><blockquote>
<p>子查询就是指在一个select语句中嵌套另一个select语句。同时，子查询必须包含括号。<br><code>MySQL 5.6.x</code> 版本之前，MySQL的子查询性能较差，但是从5.6开始，不存在性能差的问题。</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> a <span class="keyword">from</span> t1 <span class="keyword">where</span> a &gt; <span class="keyword">any</span>(<span class="keyword">select</span> a <span class="keyword">from</span> t2);</span><br></pre></td></tr></table></figure>
<ol>
<li><code>select a from t1</code> 是外部查询(outer query)</li>
<li><code>(select a from t2)</code> 是子查询</li>
</ol>
<p>一般说来，子查询嵌套于外部查询中，可以将两个或两个以上的子查询进行嵌套</p>
<h3 id="1-子查询的使用"><a href="#1-子查询的使用" class="headerlink" title="1. 子查询的使用"></a>1. 子查询的使用</h3><h4 id="1-1-ANY-SOME"><a href="#1-1-ANY-SOME" class="headerlink" title="1.1.  ANY / SOME"></a>1.1.  ANY / SOME</h4><p>如果外部查询的列的结果和子查询的列的结果比较得到为True的话，则返回比较值为True的（外查询）的记录</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create table  t1 (a int);</span><br><span class="line">Query OK, 0 rows affected (0.15 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; create table  t2 (a int); </span><br><span class="line">Query OK, 0 rows affected (0.14 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into t1 values(10),(4);</span><br><span class="line">Query OK, 2 rows affected (0.02 sec)</span><br><span class="line">Records: 2  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into t2 values(12),(13),(5);</span><br><span class="line">Query OK, 3 rows affected (0.03 sec)</span><br><span class="line">Records: 3  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; select a from t1;</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">| a    |</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">|   10 |</span><br><span class="line">|    4 |</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">2 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> * <span class="keyword">from</span> t2;</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">| a    |</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">|   12 |   <span class="comment">-- t1中10，4比12小</span></span><br><span class="line">|   13 |   <span class="comment">-- t1中10，4比13小</span></span><br><span class="line">|    5 |   <span class="comment">-- t1中10比5大，4比5小</span></span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">3 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> a <span class="keyword">from</span> t1  </span><br><span class="line">    -&gt; <span class="keyword">where</span> a &gt; <span class="keyword">any</span></span><br><span class="line">    -&gt; (<span class="keyword">select</span> a <span class="keyword">from</span> t2); <span class="comment">-- 返回(12，13，4)</span></span><br><span class="line">                           <span class="comment">-- t1中a列的值，只要大于(12,13,4)中任意一值</span></span><br><span class="line">                           <span class="comment">-- 即t1.a &gt; t2.a为True，则返回对应的t1.a</span></span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">| a    |</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">|   10 |  <span class="comment">-- 10 比 5 大为True，则返回该值，4比t2中所有的a值小，为False</span></span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 这个查询可以解释为，t1表内a列的值 大于 t2表中a列的任意(any)一个值（t1.a &gt; any(t2.a) == true）,则返回t1.a的记录</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>ANY</code>关键词必须与一个<code>比较操作符</code>一起使用： <code>=</code>, <code>&gt;</code>, <code>&lt;</code>, <code>&gt;=</code>, <code>&lt;=</code>, <code>&lt;&gt;</code> <em>(这个是!=的意思)</em></p>
</blockquote>
<blockquote>
<p><strong>子查询中<code>SOME</code>和<code>ANY</code>是同一个意思</strong></p>
</blockquote>
<h4 id="1-2-IN"><a href="#1-2-IN" class="headerlink" title="1.2. IN"></a>1.2. IN</h4><p><code>in</code>是<code>ANY</code>的一种特殊情况：<strong><code>&quot;in&quot;</code></strong>  <code>equals</code>  <strong><code>&quot;= any&quot;</code></strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; insert into t1 values(5);  -- 向t1中插入一个t2中存在的值 5</span><br><span class="line">Query OK, 1 row affected (0.03 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select a from t1 where a = any(select a from t2); -- t1.a==t2.a 的只有5</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">| a    |</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">|    5 |</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> a <span class="keyword">from</span> t1 <span class="keyword">where</span> a <span class="keyword">in</span> (<span class="keyword">select</span> a <span class="keyword">from</span> t2); <span class="comment">-- in的结果等同于 =any 的结果</span></span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">| a    |</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">|    5 |</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>select a from s1 where  a in (select a in t2);</code>是用的比较多的一种语法</p>
</blockquote>
<h4 id="1-3-ALL"><a href="#1-3-ALL" class="headerlink" title="1.3. ALL"></a>1.3. ALL</h4><p>如果外部查询的列的结果和子查询的列的<code>所有结果</code>比较得到为True的话，则返回比较值为True的（外查询）的记录<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; truncate t1;   -- 清空t1</span><br><span class="line">Query OK, 0 rows affected (0.07 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; truncate t2;   -- 清空t2</span><br><span class="line">Query OK, 0 rows affected (0.10 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into t1 values(10),(4);</span><br><span class="line">Query OK, 2 rows affected (0.02 sec)</span><br><span class="line">Records: 2  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into t2 values(5),(4),(3);  </span><br><span class="line">Query OK, 3 rows affected (0.03 sec)</span><br><span class="line">Records: 3  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; select a from t1 where a &gt; all(select a from t2);</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">| a    |</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">|   10 |  <span class="comment">-- (10 &gt; 5, 4, 3 为 True) 而 (4 &gt;5, 4, 3 为 False)</span></span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p><code>ALL</code>关键词必须与一个<code>比较操作符</code>一起使用<br><code>NOT IN</code> 是 <code>&lt;&gt; ALL</code>的别名 </p>
</blockquote>
<h3 id="2-子查询的分类"><a href="#2-子查询的分类" class="headerlink" title="2. 子查询的分类"></a>2. 子查询的分类</h3><ul>
<li><p><strong>独立子查询</strong></p>
<ul>
<li>不依赖外部查询而运行的子查询<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select a from t1 where a in (1,2,3,4,5);</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">| a    |</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">|    4 |  </span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><strong>相关子查询</strong></p>
<ul>
<li>引用了外部查询列的子查询<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 在这个例子中，子查询中使用到了外部的列t2.a </span></span><br><span class="line">mysql&gt; select a from t1 where a in (select * from t2 where t1.a = t2.a);</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">| a    |</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">|    4 |</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h3 id="3-子查询的优化"><a href="#3-子查询的优化" class="headerlink" title="3. 子查询的优化"></a>3. 子查询的优化</h3><ul>
<li><strong>MySQL5.6之前</strong><br>在<code>MySQL5.6</code>之前，优化器会把子查询重写成<code>exists</code>的形式<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> a <span class="keyword">from</span> t1 <span class="keyword">where</span> a <span class="keyword">in</span> (<span class="keyword">select</span> a <span class="keyword">from</span> t2); <span class="comment">-- 这个是一条独立的子查询，时间复杂度 O(M+N)</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- 经过优化器重写后</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="keyword">select</span> a <span class="keyword">from</span> t1 <span class="keyword">where</span> <span class="keyword">exists</span> (<span class="keyword">select</span> <span class="number">1</span> <span class="keyword">from</span> t2 <span class="keyword">where</span> t1.a = t2.a); <span class="comment">-- 这是相关子查询，复杂度O(M*N + M)</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>所以在<code>MySQL 5.6</code>之前，部分的子查询需要重写成join的形式 <em>（注意表的大小）</em><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select t1.a from t1 join t2 on t1.a = t2.a;</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">| a    |</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">|    4 |</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure></p>
<ul>
<li><strong>MySQL 5.6之后</strong><br>在<code>MySQL 5.6</code>之后，优化器<code>不会</code>将子查询<code>重写</code>成<code>exists</code>的形式，而是自动优化，性能有了大幅提升</li>
</ul>
<blockquote>
<p>可通过<code>explain extended</code>来查看子查询优化的结果。由于<code>explain</code>还未讲到，该部分暂时跳过</p>
</blockquote>
<h3 id="4-包含NULL值的NOT-IN"><a href="#4-包含NULL值的NOT-IN" class="headerlink" title="4. 包含NULL值的NOT IN"></a>4. 包含NULL值的NOT IN</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select null in ('a', 'b', null);</span><br><span class="line">+<span class="comment">--------------------------+</span></span><br><span class="line">| null in ('a', 'b', null) |</span><br><span class="line">+<span class="comment">--------------------------+</span></span><br><span class="line">|                     NULL |</span><br><span class="line">+<span class="comment">--------------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>MySQL数据库的<code>比较操作</code>，除了返回<code>1(True)</code>, <code>0(False)</code>之外，还会返回<code>NULL</code><br><code>NULL</code>和<code>NULL</code>的比较，返回的还是<code>NULL</code></p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select null not in ('a', 'b', null);  </span><br><span class="line">+<span class="comment">------------------------------+</span></span><br><span class="line">| null not in ('a', 'b', null) |</span><br><span class="line">+<span class="comment">------------------------------+</span></span><br><span class="line">|                         NULL |  <span class="comment">-- null不在('a', 'b', null)中，返回的还是null，因为有null和null的比较</span></span><br><span class="line">+<span class="comment">------------------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> <span class="string">'a'</span> <span class="keyword">not</span> <span class="keyword">in</span> (<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="literal">null</span>);  </span><br><span class="line">+<span class="comment">-----------------------------+</span></span><br><span class="line">| 'a' not in ('a', 'b', null) |</span><br><span class="line">+<span class="comment">-----------------------------+</span></span><br><span class="line">|                           0 |  <span class="comment">-- a 不在 ('a', 'b', null)中，返回0,即False</span></span><br><span class="line">+<span class="comment">-----------------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> <span class="string">'c'</span> <span class="keyword">not</span> <span class="keyword">in</span> (<span class="string">'a'</span>, <span class="string">'b'</span>);</span><br><span class="line">+<span class="comment">-----------------------+</span></span><br><span class="line">| 'c' not in ('a', 'b') |</span><br><span class="line">+<span class="comment">-----------------------+</span></span><br><span class="line">|                     1 |  <span class="comment">-- 这个返回值可以理解 'c'不在('a', 'b')中，返回1，即为True</span></span><br><span class="line">+<span class="comment">-----------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> <span class="string">'c'</span> <span class="keyword">not</span> <span class="keyword">in</span> (<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="literal">null</span>); </span><br><span class="line">+<span class="comment">-----------------------------+</span></span><br><span class="line">| 'c' not in ('a', 'b', null) |</span><br><span class="line">+<span class="comment">-----------------------------+</span></span><br><span class="line">|                        NULL | <span class="comment">-- 理论上应该是返回1，即True的。但是包含了null值。则返回null</span></span><br><span class="line">+<span class="comment">-----------------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>对于包含了<code>NULL</code>值的<code>IN</code>操作，总是返回<code>True</code>或者<code>NULL</code></strong><br><strong><code>NOT IN</code>返回<code>NOT True (False)</code>或者<code>NOT NULL (NULL)</code></strong></p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- SQL语句一 使用 EXISTS</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="keyword">select</span> customerid, companyname </span><br><span class="line">    <span class="keyword">from</span> customers <span class="keyword">as</span> A</span><br><span class="line">    <span class="keyword">where</span> country = <span class="string">'Spain'</span> </span><br><span class="line">        <span class="keyword">and</span> <span class="keyword">not</span> <span class="keyword">exists</span></span><br><span class="line">            ( <span class="keyword">select</span> * <span class="keyword">from</span> orders <span class="keyword">as</span> B</span><br><span class="line">              <span class="keyword">where</span> A.customerid = B.customerid );</span><br><span class="line">              </span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- SQL语句二 使用 IN</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="keyword">select</span> customerid, companyname </span><br><span class="line">    <span class="keyword">from</span> customers <span class="keyword">as</span> A</span><br><span class="line">    <span class="keyword">where</span> country = <span class="string">'Spain'</span> </span><br><span class="line">        <span class="keyword">and</span> customerid <span class="keyword">not</span> <span class="keyword">in</span> (<span class="keyword">select</span> customerid <span class="keyword">from</span> orders);</span><br><span class="line">              </span><br><span class="line"><span class="comment">-----</span></span><br><span class="line"><span class="comment">-- 当结果集合中没有NULL值时，上述两条SQL语句查询的结果是一致的 </span></span><br><span class="line"><span class="comment">-----</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- 插入一个NULL值</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> orders(orderid) <span class="keyword">values</span> (<span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">-----</span></span><br><span class="line"><span class="comment">-- SQL语句1 : 返回和之前一致</span></span><br><span class="line"><span class="comment">-- SQL语句2 : 返回为空表，因为子查询返回的结果集中存在NULL值。not in null 永远返回False或者NULL</span></span><br><span class="line"><span class="comment">--            此时 where (country = 'Spain' and (False or NULL)) 为 False OR NULL，条件永远不匹配</span></span><br><span class="line"><span class="comment">-----</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- SQL语句2 改写后</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="keyword">select</span> customerid, companyname </span><br><span class="line">    <span class="keyword">from</span> customers <span class="keyword">as</span> A</span><br><span class="line">    <span class="keyword">where</span> country = <span class="string">'Spain'</span> </span><br><span class="line">        <span class="keyword">and</span> customerid <span class="keyword">not</span> <span class="keyword">in</span> (<span class="keyword">select</span> customerid <span class="keyword">from</span> orders </span><br><span class="line">                                <span class="keyword">where</span> customerid <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">null</span>);  <span class="comment">-- 增加这个过滤条件，使用is not，而不是&lt;&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- 和 null比较，使用is和is not， 而不是 = 和 &lt;&gt;</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line">mysql&gt; select null = null; </span><br><span class="line">+<span class="comment">-------------+</span></span><br><span class="line">| null = null |</span><br><span class="line">+<span class="comment">-------------+</span></span><br><span class="line">|        NULL |</span><br><span class="line">+<span class="comment">-------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> <span class="literal">null</span> &lt;&gt; <span class="literal">null</span>;</span><br><span class="line">+<span class="comment">--------------+</span></span><br><span class="line">| null &lt;&gt; null |</span><br><span class="line">+<span class="comment">--------------+</span></span><br><span class="line">|         NULL |</span><br><span class="line">+<span class="comment">--------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> <span class="literal">null</span> <span class="keyword">is</span> <span class="literal">null</span>; </span><br><span class="line">+<span class="comment">--------------+</span></span><br><span class="line">| null is null |</span><br><span class="line">+<span class="comment">--------------+</span></span><br><span class="line">|            1 |  <span class="comment">-- 返回 True</span></span><br><span class="line">+<span class="comment">--------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> <span class="literal">null</span> <span class="keyword">is</span> <span class="keyword">not</span>  <span class="literal">null</span>;</span><br><span class="line">+<span class="comment">-------------------+</span></span><br><span class="line">| null is not  null |</span><br><span class="line">+<span class="comment">-------------------+</span></span><br><span class="line">|                 0 |  <span class="comment">-- 返回 False</span></span><br><span class="line">+<span class="comment">-------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>EXISTS</code>不管返回值是什么，而是看是否有<code>行</code>返回，所以<code>EXISTS</code>中子查询都是<code>select *</code>、<code>select 1</code>等，因为只关心返回是否有行（结果集）</p>
</blockquote>
<hr>
<h2 id="二-INSERT"><a href="#二-INSERT" class="headerlink" title="二. INSERT"></a>二. INSERT</h2><blockquote>
<p><a href="http://dev.mysql.com/doc/refman/5.7/en/insert.html" target="_blank" rel="noopener">官方文档</a></p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; insert into t1 values(1);  -- 插入一个值</span><br><span class="line">Query OK, 1 row affected (0.03 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into t1 values(2),(3),(-1);  -- 插入多个值，MySQL独有</span><br><span class="line">Query OK, 3 rows affected (0.03 sec)</span><br><span class="line">Records: 3  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into t1 select 8;   -- insert XXX select XXX 语法，MySQ独有</span><br><span class="line">Query OK, 1 row affected (0.02 sec)</span><br><span class="line">Records: 1  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; create table t3 (a int, b int); -- 有多个列</span><br><span class="line">Query OK, 0 rows affected (0.15 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into t3 select 8;  -- 没有指定列，报错</span><br><span class="line">ERROR 1136 (21S01): Column count doesn't match value count at row 1</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into t3(a) select 8;  -- 指定列a</span><br><span class="line">Query OK, 1 row affected (0.04 sec)</span><br><span class="line">Records: 1  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into t3 select 8, 9;  -- 不指定列，但是插入值匹配列的个数和类型</span><br><span class="line">Query OK, 1 row affected (0.03 sec)</span><br><span class="line">Records: 1  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from t3;</span><br><span class="line">+<span class="comment">------+------+</span></span><br><span class="line">| a    | b    |</span><br><span class="line">+<span class="comment">------+------+</span></span><br><span class="line">|    8 | NULL |</span><br><span class="line">|    8 |    9 |</span><br><span class="line">+<span class="comment">------+------+</span></span><br><span class="line">2 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">insert</span> <span class="keyword">into</span> t3(b) <span class="keyword">select</span> a <span class="keyword">from</span> t2;  <span class="comment">-- 从t2表中查询数据并插入到t3(a)中，注意指定列</span></span><br><span class="line">Query OK, 3 rows affected (0.03 sec)</span><br><span class="line">Records: 3  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from t3;</span><br><span class="line">+<span class="comment">------+------+</span></span><br><span class="line">| a    | b    |</span><br><span class="line">+<span class="comment">------+------+</span></span><br><span class="line">|    8 | NULL |</span><br><span class="line">|    8 |    9 |</span><br><span class="line">| NULL |    5 |</span><br><span class="line">| NULL |    4 |</span><br><span class="line">| NULL |    3 |</span><br><span class="line">+<span class="comment">------+------+</span></span><br><span class="line">5 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- 如果想快速增长表格中的数据，可以使用如下方法，使得数据成倍增长</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line">mysql&gt; <span class="keyword">insert</span> <span class="keyword">into</span> t3 <span class="keyword">select</span> * <span class="keyword">from</span> t3;</span><br><span class="line">Query OK, 5 rows affected (0.03 sec)  <span class="comment">-- 插入了5列</span></span><br><span class="line">Records: 5  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from t3;               </span><br><span class="line">+<span class="comment">------+------+</span></span><br><span class="line">| a    | b    |</span><br><span class="line">+<span class="comment">------+------+</span></span><br><span class="line">|    8 | NULL |</span><br><span class="line">|    8 |    9 |</span><br><span class="line">| NULL |    5 |</span><br><span class="line">| NULL |    4 |</span><br><span class="line">| NULL |    3 |</span><br><span class="line">|    8 | NULL |</span><br><span class="line">|    8 |    9 |</span><br><span class="line">| NULL |    5 |</span><br><span class="line">| NULL |    4 |</span><br><span class="line">| NULL |    3 |</span><br><span class="line">+<span class="comment">------+------+</span></span><br><span class="line">10 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">insert</span> <span class="keyword">into</span> t3 <span class="keyword">select</span> * <span class="keyword">from</span> t3;</span><br><span class="line">Query OK, 10 rows affected (0.03 sec)  <span class="comment">-- 插入了10列，成倍增长</span></span><br><span class="line">Records: 10  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from t3;               </span><br><span class="line">+<span class="comment">------+------+</span></span><br><span class="line">| a    | b    |</span><br><span class="line">+<span class="comment">------+------+</span></span><br><span class="line">|    8 | NULL |</span><br><span class="line">|    8 |    9 |</span><br><span class="line">| NULL |    5 |</span><br><span class="line">| NULL |    4 |</span><br><span class="line">| NULL |    3 |</span><br><span class="line">|    8 | NULL |</span><br><span class="line">|    8 |    9 |</span><br><span class="line">| NULL |    5 |</span><br><span class="line">| NULL |    4 |</span><br><span class="line">| NULL |    3 |</span><br><span class="line">|    8 | NULL |</span><br><span class="line">|    8 |    9 |</span><br><span class="line">| NULL |    5 |</span><br><span class="line">| NULL |    4 |</span><br><span class="line">| NULL |    3 |</span><br><span class="line">|    8 | NULL |</span><br><span class="line">|    8 |    9 |</span><br><span class="line">| NULL |    5 |</span><br><span class="line">| NULL |    4 |</span><br><span class="line">| NULL |    3 |</span><br><span class="line">+<span class="comment">------+------+</span></span><br><span class="line">20 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="三-DELETE"><a href="#三-DELETE" class="headerlink" title="三. DELETE"></a>三. DELETE</h2><blockquote>
<p><a href="http://dev.mysql.com/doc/refman/5.7/en/delete.html" target="_blank" rel="noopener">官方文档</a></p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; delete from t3 where a is null;  -- 根据过滤条件删除</span><br><span class="line">Query OK, 12 rows affected (0.03 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from t3;               </span><br><span class="line">+<span class="comment">------+------+</span></span><br><span class="line">| a    | b    |</span><br><span class="line">+<span class="comment">------+------+</span></span><br><span class="line">|    8 | NULL |</span><br><span class="line">|    8 |    9 |</span><br><span class="line">|    8 | NULL |</span><br><span class="line">|    8 |    9 |</span><br><span class="line">|    8 | NULL |</span><br><span class="line">|    8 |    9 |</span><br><span class="line">|    8 | NULL |</span><br><span class="line">|    8 |    9 |</span><br><span class="line">+<span class="comment">------+------+</span></span><br><span class="line">8 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">delete</span> <span class="keyword">from</span> t3;   <span class="comment">-- 删除整个表</span></span><br><span class="line">Query OK, 8 rows affected (0.03 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from t3;</span><br><span class="line">Empty <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="四-UPDATE"><a href="#四-UPDATE" class="headerlink" title="四. UPDATE"></a>四. UPDATE</h2><blockquote>
<p><a href="http://dev.mysql.com/doc/refman/5.7/en/update.html" target="_blank" rel="noopener">官方文档</a></p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; insert into t3 select 1,2;</span><br><span class="line">Query OK, 1 row affected (0.03 sec)</span><br><span class="line">Records: 1  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from t3;</span><br><span class="line">+<span class="comment">------+------+</span></span><br><span class="line">| a    | b    |</span><br><span class="line">+<span class="comment">------+------+</span></span><br><span class="line">|    1 |    2 |</span><br><span class="line">+<span class="comment">------+------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">update</span> t3 <span class="keyword">set</span> a=<span class="number">10</span> <span class="keyword">where</span> a=<span class="number">1</span>;</span><br><span class="line">Query OK, 1 row affected (0.03 sec)</span><br><span class="line">Rows matched: 1  Changed: 1  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from t3;</span><br><span class="line">+<span class="comment">------+------+</span></span><br><span class="line">| a    | b    |</span><br><span class="line">+<span class="comment">------+------+</span></span><br><span class="line">|   10 |    2 |</span><br><span class="line">+<span class="comment">------+------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- 关联后更新</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line">mysql&gt; <span class="keyword">select</span> * <span class="keyword">from</span> t1;</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">| a    |</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">|   10 |</span><br><span class="line">|    4 |  <span class="comment">-- 和t2中的4相等</span></span><br><span class="line">|    1 |</span><br><span class="line">|    2 |</span><br><span class="line">|    3 |  <span class="comment">-- 和t2中的3相等</span></span><br><span class="line">|   -1 |</span><br><span class="line">|    8 |</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">7 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> * <span class="keyword">from</span> t2;</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">| a    |</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">|    5 |</span><br><span class="line">|    4 |  <span class="comment">-- 和t1中的4相等</span></span><br><span class="line">|    3 |  <span class="comment">-- 和t1中的3相等</span></span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">3 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">update</span> t1 <span class="keyword">join</span> t2 <span class="keyword">on</span> t1.a = t2.a <span class="keyword">set</span> t1.a=<span class="number">100</span>;  <span class="comment">-- 先得到t1.a=t2.a的结果集</span></span><br><span class="line">                                                       <span class="comment">-- 然后将结果集中的t1.a设置为100</span></span><br><span class="line">Query OK, 2 rows affected (0.03 sec)</span><br><span class="line">Rows matched: 2  Changed: 2  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from t1;</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">| a    |</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">|   10 |</span><br><span class="line">|  100 |  <span class="comment">-- 该行被更新成100</span></span><br><span class="line">|    1 |</span><br><span class="line">|    2 |</span><br><span class="line">|  100 |  <span class="comment">-- 该行被更新成100</span></span><br><span class="line">|   -1 |</span><br><span class="line">|    8 |</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">7 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="五-REPLACE"><a href="#五-REPLACE" class="headerlink" title="五. REPLACE"></a>五. REPLACE</h2><blockquote>
<p><a href="http://dev.mysql.com/doc/refman/5.7/en/replace.html" target="_blank" rel="noopener">官方文档</a></p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create table t4(a int primary key auto_increment, b int);</span><br><span class="line">Query OK, 0 rows affected (0.15 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into t4 values(NULL, 10);</span><br><span class="line">Query OK, 1 row affected (0.02 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into t4 values(NULL, 11);</span><br><span class="line">Query OK, 1 row affected (0.03 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into t4 values(NULL, 12);</span><br><span class="line">Query OK, 1 row affected (0.03 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from t4;</span><br><span class="line">+<span class="comment">---+------+</span></span><br><span class="line">| a | b    |</span><br><span class="line">+<span class="comment">---+------+</span></span><br><span class="line">| 1 |   10 |</span><br><span class="line">| 2 |   11 |</span><br><span class="line">| 3 |   12 |</span><br><span class="line">+<span class="comment">---+------+</span></span><br><span class="line">3 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">insert</span> <span class="keyword">into</span> t4 <span class="keyword">values</span>(<span class="number">1</span>, <span class="number">100</span>);  <span class="comment">-- 报错，说存在重复的主键记录 "1"</span></span><br><span class="line">ERROR 1062 (23000): Duplicate entry '1' for key 'PRIMARY'</span><br><span class="line"></span><br><span class="line">mysql&gt; replace into t4 values(1, 100); -- 替换该主键对应的值  </span><br><span class="line">Query OK, 2 rows affected (0.03 sec)   <span class="comment">-- 两行记录受到影响</span></span><br><span class="line"></span><br><span class="line">mysql&gt; select * from t4;</span><br><span class="line">+<span class="comment">---+------+</span></span><br><span class="line">| a | b    |</span><br><span class="line">+<span class="comment">---+------+</span></span><br><span class="line">| 1 |  100 |  <span class="comment">-- 已经被替换</span></span><br><span class="line">| 2 |   11 |</span><br><span class="line">| 3 |   12 |</span><br><span class="line">+<span class="comment">---+------+</span></span><br><span class="line">3 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"><span class="comment">-----</span></span><br><span class="line"><span class="comment">-- replace的原理是：先delete，在insert</span></span><br><span class="line"><span class="comment">-----</span></span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">replace</span> <span class="keyword">into</span> t4 <span class="keyword">values</span>(<span class="number">5</span>, <span class="number">50</span>);  <span class="comment">-- 没有替换对象时，类似插入效果</span></span><br><span class="line">Query OK, 1 row affected (0.03 sec)    <span class="comment">-- 只影响1行</span></span><br><span class="line"></span><br><span class="line">mysql&gt; select * from t4;</span><br><span class="line">+<span class="comment">---+------+</span></span><br><span class="line">| a | b    |</span><br><span class="line">+<span class="comment">---+------+</span></span><br><span class="line">| 1 |  100 |</span><br><span class="line">| 2 |   11 |</span><br><span class="line">| 3 |   12 |</span><br><span class="line">| 5 |   50 |  <span class="comment">-- 插入了1行</span></span><br><span class="line">+<span class="comment">---+------+</span></span><br><span class="line">4 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- replace原理更明显的例子 </span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">create</span> <span class="keyword">table</span> t6 </span><br><span class="line">    -&gt; (a <span class="built_in">int</span> primary <span class="keyword">key</span>, </span><br><span class="line">    -&gt; b <span class="built_in">int</span> auto_increment,   <span class="comment">-- b是auto_increment的int型数据</span></span><br><span class="line">    -&gt; c <span class="built_in">int</span>, <span class="keyword">key</span>(b));</span><br><span class="line">Query OK, 0 rows affected (0.15 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into t6 values(10, NULL, 100),(20,NULL,200);  -- b自增长</span><br><span class="line">Query OK, 2 rows affected (0.02 sec)</span><br><span class="line">Records: 2  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from t6;</span><br><span class="line">+<span class="comment">----+---+------+</span></span><br><span class="line">| a  | b | c    |</span><br><span class="line">+<span class="comment">----+---+------+</span></span><br><span class="line">| 10 | 1 |  100 |  <span class="comment">-- b为1</span></span><br><span class="line">| 20 | 2 |  200 |  <span class="comment">-- b为2</span></span><br><span class="line">+<span class="comment">----+---+------+</span></span><br><span class="line">2 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">replace</span> <span class="keyword">into</span> t6 <span class="keyword">values</span>(<span class="number">10</span>,<span class="literal">NULL</span>,<span class="number">150</span>);  <span class="comment">-- 将a=10的替换掉</span></span><br><span class="line">Query OK, 2 rows affected (0.03 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from t6;</span><br><span class="line">+<span class="comment">----+---+------+</span></span><br><span class="line">| a  | b | c    |</span><br><span class="line">+<span class="comment">----+---+------+</span></span><br><span class="line">| 10 | 3 |  150 |  <span class="comment">-- 替换后b从1变成了3，说明是先删除，再插入</span></span><br><span class="line">| 20 | 2 |  200 |</span><br><span class="line">+<span class="comment">----+---+------+</span></span><br><span class="line">2 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">-----</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- insert on duplicate 效果和 replace类似</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line">mysql&gt; <span class="keyword">insert</span> <span class="keyword">into</span> t4 <span class="keyword">values</span>(<span class="number">1</span>,<span class="number">1</span>);  <span class="comment">-- 插入报错，存在key为1的记录</span></span><br><span class="line">ERROR 1062 (23000): Duplicate entry '1' for key 'PRIMARY'</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into t4 values(1,1) on duplicate key update b=1;  -- 带上on duplicate参数</span><br><span class="line">                                                                <span class="comment">-- 非SQL标准，不推荐</span></span><br><span class="line">Query OK, 2 rows affected (0.03 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from t4;</span><br><span class="line">+<span class="comment">---+------+</span></span><br><span class="line">| a | b    |</span><br><span class="line">+<span class="comment">---+------+</span></span><br><span class="line">| 1 |    1 |  <span class="comment">-- 该行的b列从100被替换成1</span></span><br><span class="line">| 2 |   11 |</span><br><span class="line">| 3 |   12 |</span><br><span class="line">| 5 |   50 |</span><br><span class="line">+<span class="comment">---+------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- insert ignore</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line">mysql&gt; insert ignore into t4 values(1,1);   -- 忽略重复的错误</span><br><span class="line">Query OK, 0 rows affected, 1 warning (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; show warnings;</span><br><span class="line">+<span class="comment">---------+------+---------------------------------------+</span></span><br><span class="line">| Level   | Code | Message                               |</span><br><span class="line">+<span class="comment">---------+------+---------------------------------------+</span></span><br><span class="line">| Warning | 1062 | Duplicate entry '1' for key 'PRIMARY' |</span><br><span class="line">+<span class="comment">---------+------+---------------------------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="六-其他知识点"><a href="#六-其他知识点" class="headerlink" title="六. 其他知识点"></a>六. 其他知识点</h2><ul>
<li><strong>更新有关系的值</strong></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create table t5 (a int, b int);</span><br><span class="line">Query OK, 0 rows affected (0.14 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into t5 values(1,1);</span><br><span class="line">Query OK, 1 row affected (0.03 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from t5;</span><br><span class="line">+<span class="comment">------+------+</span></span><br><span class="line">| a    | b    |</span><br><span class="line">+<span class="comment">------+------+</span></span><br><span class="line">|    1 |    1 |</span><br><span class="line">+<span class="comment">------+------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">update</span> t5 <span class="keyword">set</span> a=a+<span class="number">1</span>, b=a <span class="keyword">where</span> a=<span class="number">1</span>;</span><br><span class="line">Query OK, 1 row affected (0.02 sec)</span><br><span class="line">Rows matched: 1  Changed: 1  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from t5;</span><br><span class="line">+<span class="comment">------+------+</span></span><br><span class="line">| a    | b    |</span><br><span class="line">+<span class="comment">------+------+</span></span><br><span class="line">|    2 |    2 |  <span class="comment">-- SQL Server和Oracle中得到的值是2, 1</span></span><br><span class="line">+<span class="comment">------+------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> se</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>显示行号(RowNumber)</strong></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- 方法一</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line">mysql&gt; use employees ;</span><br><span class="line">Reading table information for completion of table and column names</span><br><span class="line">You can turn off this feature to get a quicker startup with -A</span><br><span class="line"></span><br><span class="line">Database changed</span><br><span class="line">mysql&gt; set @rn:=0;  -- 产生 SESSION(会话)级别的变量</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select @rn:=@rn+1 as rownumber, emp_no, gender from employees limit 10;  -- ：= 是赋值的意思</span><br><span class="line">+<span class="comment">-----------+--------+--------+</span></span><br><span class="line">| rownumber | emp_no | gender |</span><br><span class="line">+<span class="comment">-----------+--------+--------+</span></span><br><span class="line">|        11 |  10001 | M      |</span><br><span class="line">|        12 |  10002 | F      |</span><br><span class="line">|        13 |  10003 | M      |</span><br><span class="line">|        14 |  10004 | M      |</span><br><span class="line">|        15 |  10005 | M      |</span><br><span class="line">|        16 |  10006 | F      |</span><br><span class="line">|        17 |  10007 | F      |</span><br><span class="line">|        18 |  10008 | M      |</span><br><span class="line">|        19 |  10009 | F      |</span><br><span class="line">|        20 |  10010 | F      |</span><br><span class="line">+<span class="comment">-----------+--------+--------+</span></span><br><span class="line">10 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- 方法二 （推荐）</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line">mysql&gt; <span class="keyword">select</span> @rn1:=@rn1+<span class="number">1</span> <span class="keyword">as</span> rownumber, emp_no, gender <span class="keyword">from</span> employees, (<span class="keyword">select</span> @rn1:=<span class="number">0</span>) <span class="keyword">as</span> a <span class="keyword">limit</span> <span class="number">10</span>;</span><br><span class="line">+<span class="comment">-----------+--------+--------+</span></span><br><span class="line">| rownumber | emp_no | gender |</span><br><span class="line">+<span class="comment">-----------+--------+--------+</span></span><br><span class="line">|         1 |  10001 | M      |</span><br><span class="line">|         2 |  10002 | F      |</span><br><span class="line">|         3 |  10003 | M      |</span><br><span class="line">|         4 |  10004 | M      |</span><br><span class="line">|         5 |  10005 | M      |</span><br><span class="line">|         6 |  10006 | F      |</span><br><span class="line">|         7 |  10007 | F      |</span><br><span class="line">|         8 |  10008 | M      |</span><br><span class="line">|         9 |  10009 | F      |</span><br><span class="line">|        10 |  10010 | F      |</span><br><span class="line">+<span class="comment">-----------+--------+--------+</span></span><br><span class="line">10 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- MySQL 自定义变量，根据每一记录进行变化的</span></span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> @rn1:=<span class="number">0</span>;</span><br><span class="line">+<span class="comment">---------+</span></span><br><span class="line">| @rn1:=0 |</span><br><span class="line">+<span class="comment">---------+</span></span><br><span class="line">|       0 |  <span class="comment">-- 只有一行记录</span></span><br><span class="line">+<span class="comment">---------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 相当于 把 employees 和 (select @rn1:=0)做了笛卡尔积，然后使用@rn1:=@rn + 1，根据每行进行累加</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- ":=" 和 "="</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line">mysql&gt; <span class="keyword">set</span> @a:=<span class="number">1</span>;  <span class="comment">-- 赋值为1</span></span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select @a;</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">| @a   |</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">|    1 |</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">set</span> @a:=<span class="number">10</span>;  <span class="comment">-- 赋值为10</span></span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select @a;</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">| @a   |</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">|   10 |</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> @a=<span class="number">9</span>;  <span class="comment">-- 进行比较</span></span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">| @a=9 |</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">|    0 |  <span class="comment">-- 返回为False</span></span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- 作业：通过子查询或者其他方式，计算出employees的行号</span></span><br><span class="line"><span class="comment">--</span></span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://chenwenning.github.io/2018/06/02/MySQL学习笔记(Day010)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="陈汶宁">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://pic.qqtn.com/up/2017-10/2017101317054482087.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CHENWENNING BLOG">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/06/02/MySQL学习笔记(Day010)/" itemprop="url">MySQL学习笔记（Day010：Employees/临时表的创建/外键约束）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-06-02T17:30:16+08:00">
                2018-06-02
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/mysql/" itemprop="url" rel="index">
                    <span itemprop="name">mysql</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/06/02/MySQL学习笔记(Day010)/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2018/06/02/MySQL学习笔记(Day010)/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="MySQL学习笔记（Day010：Employees-临时表的创建-外键约束）"><a href="#MySQL学习笔记（Day010：Employees-临时表的创建-外键约束）" class="headerlink" title="MySQL学习笔记（Day010：Employees/临时表的创建/外键约束）"></a>MySQL学习笔记（Day010：Employees/临时表的创建/外键约束）</h1><p>@(MySQL学习)</p>
<p>[TOC]</p>
<h2 id="一-Employees数据库安装"><a href="#一-Employees数据库安装" class="headerlink" title="一. Employees数据库安装"></a>一. Employees数据库安装</h2><h3 id="1-Employees数据库介绍"><a href="#1-Employees数据库介绍" class="headerlink" title="1. Employees数据库介绍"></a>1. Employees数据库介绍</h3><p><code>Employees</code>数据库是一个用于学习和测试的数据库，大约<code>160MB</code>，<code>4百万条记录</code></p>
<h3 id="2-Employees的安装"><a href="#2-Employees的安装" class="headerlink" title="2. Employees的安装"></a>2. Employees的安装</h3><blockquote>
<p><a href="https://dev.mysql.com/doc/employee/en/employees-installation.html" target="_blank" rel="noopener">官方安装文档</a></p>
</blockquote>
<h4 id="2-1-下载"><a href="#2-1-下载" class="headerlink" title="2.1. 下载"></a>2.1. 下载</h4><p>根据官方文档的连接，我们可以找到下载该数据库的两种方式</p>
<ul>
<li><a href="https://launchpad.net/test-db/employees-db-1/1.0.6/+download/employees_db-full-1.0.6.tar.bz2" target="_blank" rel="noopener">employees_db-full-1.0.6.tar.bz2</a></li>
<li><a href="https://github.com/datacharmer/test_db" target="_blank" rel="noopener">github-test_db</a> 使用<code>git clone</code> 进行仓库拉取</li>
</ul>
<h4 id="2-2-解压和拉取"><a href="#2-2-解压和拉取" class="headerlink" title="2.2. 解压和拉取"></a>2.2. 解压和拉取</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">[root@MyServer Downloads]&gt; tar jxf employees_db-full-1.0.6.tar.bz2 </span><br><span class="line"><span class="comment"># 老师讲解时说是解压有问题，但是我这里却可以解压</span></span><br><span class="line">[root@MyServer Downloads]&gt; <span class="built_in">cd</span> employees_db</span><br><span class="line">[root@MyServer employees_db]&gt; ll</span><br><span class="line">total 164492</span><br><span class="line">-rw-r--r--. 1 501 games       752 Mar 30  2009 Changelog</span><br><span class="line">-rw-r--r--. 1 501 games      6460 Oct  9  2008 employees_partitioned2.sql</span><br><span class="line">-rw-r--r--. 1 501 games      7624 Feb  6  2009 employees_partitioned3.sql</span><br><span class="line">-rw-r--r--. 1 501 games      5660 Feb  6  2009 employees_partitioned.sql</span><br><span class="line">-rw-r--r--. 1 501 games      3861 Nov 28  2008 employees.sql <span class="comment"># 主要文件</span></span><br><span class="line">-rw-r--r--. 1 501 games       241 Jul 30  2008 load_departments.dump</span><br><span class="line">-rw-r--r--. 1 501 games  13828291 Mar 30  2009 load_dept_emp.dump</span><br><span class="line">-rw-r--r--. 1 501 games      1043 Jul 30  2008 load_dept_manager.dump</span><br><span class="line">-rw-r--r--. 1 501 games  17422825 Jul 30  2008 load_employees.dump</span><br><span class="line">-rw-r--r--. 1 501 games 115848997 Jul 30  2008 load_salaries.dump</span><br><span class="line">-rw-r--r--. 1 501 games  21265449 Jul 30  2008 load_titles.dump</span><br><span class="line">-rw-r--r--. 1 501 games      3889 Mar 30  2009 objects.sql</span><br><span class="line">-rw-r--r--. 1 501 games      2211 Jul 30  2008 README</span><br><span class="line">-rw-r--r--. 1 501 games      4455 Mar 30  2009 test_employees_md5.sql</span><br><span class="line">-rw-r--r--. 1 501 games      4450 Mar 30  2009 test_employees_sha.sql</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@MyServer github_employees]&gt; git <span class="built_in">clone</span> https://github.com/datacharmer/test_db.git</span><br><span class="line">Initialized empty Git repository <span class="keyword">in</span> /root/Downloads/github_employees/test_db/.git/</span><br><span class="line">Cloning into <span class="string">'test_db'</span>...</span><br><span class="line">remote: Counting objects: 94, <span class="keyword">done</span>.</span><br><span class="line">remote: Total 94 (delta 0), reused 0 (delta 0), pack-reused 94</span><br><span class="line">Unpacking objects: 100% (94/94), <span class="keyword">done</span>.</span><br><span class="line">Checking connectivity... <span class="keyword">done</span>.</span><br><span class="line"></span><br><span class="line">[root@MyServer test_db]&gt; ll</span><br><span class="line">total 168340</span><br><span class="line">-rw-r--r--. 1 root root      964 Dec  2 21:25 Changelog</span><br><span class="line">-rw-r--r--. 1 root root     7948 Dec  2 21:25 employees_partitioned_5.1.sql</span><br><span class="line">-rw-r--r--. 1 root root     6276 Dec  2 21:25 employees_partitioned.sql</span><br><span class="line">-rw-r--r--. 1 root root     4193 Dec  2 21:25 employees.sql  <span class="comment"># 主要文件</span></span><br><span class="line">drwxrwxr-x. 2 root root     4096 Dec  2 21:25 images</span><br><span class="line">-rw-r--r--. 1 root root      250 Dec  2 21:25 load_departments.dump</span><br><span class="line">-rw-r--r--. 1 root root 14159880 Dec  2 21:25 load_dept_emp.dump</span><br><span class="line">-rw-r--r--. 1 root root     1090 Dec  2 21:25 load_dept_manager.dump</span><br><span class="line">-rw-r--r--. 1 root root 17722832 Dec  2 21:25 load_employees.dump</span><br><span class="line">-rw-r--r--. 1 root root 39806034 Dec  2 21:25 load_salaries1.dump</span><br><span class="line">-rw-r--r--. 1 root root 39805981 Dec  2 21:25 load_salaries2.dump</span><br><span class="line">-rw-r--r--. 1 root root 39080916 Dec  2 21:25 load_salaries3.dump</span><br><span class="line">-rw-r--r--. 1 root root 21708736 Dec  2 21:25 load_titles.dump</span><br><span class="line">-rw-r--r--. 1 root root     4568 Dec  2 21:25 objects.sql</span><br><span class="line">-rw-r--r--. 1 root root     4007 Dec  2 21:25 README.md</span><br><span class="line">drwxrwxr-x. 2 root root     4096 Dec  2 21:25 sakila</span><br><span class="line">-rw-r--r--. 1 root root      272 Dec  2 21:25 show_elapsed.sql</span><br><span class="line">-rwxr-xr-x. 1 root root     1800 Dec  2 21:25 sql_test.sh</span><br><span class="line">-rw-r--r--. 1 root root     4878 Dec  2 21:25 test_employees_md5.sql</span><br><span class="line">-rw-r--r--. 1 root root     4882 Dec  2 21:25 test_employees_sha.sql</span><br></pre></td></tr></table></figure>
<p><strong>解压出来的主要文件大小是不一样的，且根据网页上发布和更新的时间上看，github中的时间比较新，所以这里使用github中源作为的安装文件</strong></p>
<h4 id="2-3-安装"><a href="#2-3-安装" class="headerlink" title="2.3. 安装"></a>2.3. 安装</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@MyServer test_db]&gt; mysql -uroot -S /tmp/mysql.sock_57 -p &lt; employees.sql </span><br><span class="line">Enter password: </span><br><span class="line">INFO</span><br><span class="line">CREATING DATABASE STRUCTURE</span><br><span class="line">INFO</span><br><span class="line">storage engine: InnoDB</span><br><span class="line">INFO</span><br><span class="line">LOADING departments</span><br><span class="line">INFO</span><br><span class="line">LOADING employees</span><br><span class="line">INFO</span><br><span class="line">LOADING dept_emp</span><br><span class="line">INFO</span><br><span class="line">LOADING dept_manager</span><br><span class="line">INFO</span><br><span class="line">LOADING titles</span><br><span class="line">INFO</span><br><span class="line">LOADING salaries</span><br><span class="line">data_load_time_diff</span><br><span class="line">00:01:51</span><br></pre></td></tr></table></figure>
<h4 id="2-4-验证"><a href="#2-4-验证" class="headerlink" title="2.4. 验证"></a>2.4. 验证</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line">[root@MyServer test_db]&gt; time mysql -uroot -S /tmp/mysql.sock_57 -p -t &lt; test_employees_sha.sql </span><br><span class="line">Enter password: </span><br><span class="line">+----------------------+</span><br><span class="line">| INFO                 |</span><br><span class="line">+----------------------+</span><br><span class="line">| TESTING INSTALLATION |</span><br><span class="line">+----------------------+</span><br><span class="line">+--------------+------------------+------------------------------------------+</span><br><span class="line">| table_name   | expected_records | expected_crc                             |</span><br><span class="line">+--------------+------------------+------------------------------------------+</span><br><span class="line">| employees    |           300024 | 4d4aa689914d8fd41db7e45c2168e7dcb9697359 |</span><br><span class="line">| departments  |                9 | 4b315afa0e35ca6649df897b958345bcb3d2b764 |</span><br><span class="line">| dept_manager |               24 | 9687a7d6f93ca8847388a42a6d8d93982a841c6c |</span><br><span class="line">| dept_emp     |           331603 | d95ab9fe07df0865f592574b3b33b9c741d9fd1b |</span><br><span class="line">| titles       |           443308 | d12d5f746b88f07e69b9e36675b6067abb01b60e |</span><br><span class="line">| salaries     |          2844047 | b5a1785c27d75e33a4173aaa22ccf41ebd7d4a9f |</span><br><span class="line">+--------------+------------------+------------------------------------------+</span><br><span class="line">+--------------+------------------+------------------------------------------+</span><br><span class="line">| table_name   | found_records    | found_crc                                |</span><br><span class="line">+--------------+------------------+------------------------------------------+</span><br><span class="line">| employees    |           300024 | 4d4aa689914d8fd41db7e45c2168e7dcb9697359 |</span><br><span class="line">| departments  |                9 | 4b315afa0e35ca6649df897b958345bcb3d2b764 |</span><br><span class="line">| dept_manager |               24 | 9687a7d6f93ca8847388a42a6d8d93982a841c6c |</span><br><span class="line">| dept_emp     |           331603 | d95ab9fe07df0865f592574b3b33b9c741d9fd1b |</span><br><span class="line">| titles       |           443308 | d12d5f746b88f07e69b9e36675b6067abb01b60e |</span><br><span class="line">| salaries     |          2844047 | b5a1785c27d75e33a4173aaa22ccf41ebd7d4a9f |</span><br><span class="line">+--------------+------------------+------------------------------------------+</span><br><span class="line">+--------------+---------------+-----------+</span><br><span class="line">| table_name   | records_match | crc_match |</span><br><span class="line">+--------------+---------------+-----------+</span><br><span class="line">| employees    | OK            | ok        |</span><br><span class="line">| departments  | OK            | ok        |</span><br><span class="line">| dept_manager | OK            | ok        |</span><br><span class="line">| dept_emp     | OK            | ok        |</span><br><span class="line">| titles       | OK            | ok        |</span><br><span class="line">| salaries     | OK            | ok        |</span><br><span class="line">+--------------+---------------+-----------+</span><br><span class="line">+------------------+</span><br><span class="line">| computation_time |</span><br><span class="line">+------------------+</span><br><span class="line">| 00:00:18         |</span><br><span class="line">+------------------+</span><br><span class="line">+---------+--------+</span><br><span class="line">| summary | result |</span><br><span class="line">+---------+--------+</span><br><span class="line">| CRC     | OK     |</span><br><span class="line">| count   | OK     |</span><br><span class="line">+---------+--------+</span><br><span class="line"></span><br><span class="line">real    0m19.406s</span><br><span class="line">user    0m0.005s</span><br><span class="line">sys     0m0.004s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@MyServer test_db]&gt; time mysql -uroot -S /tmp/mysql.sock_57 -p -t &lt; test_employees_md5.sql    </span><br><span class="line">Enter password: </span><br><span class="line">+----------------------+</span><br><span class="line">| INFO                 |</span><br><span class="line">+----------------------+</span><br><span class="line">| TESTING INSTALLATION |</span><br><span class="line">+----------------------+</span><br><span class="line">+--------------+------------------+----------------------------------+</span><br><span class="line">| table_name   | expected_records | expected_crc                     |</span><br><span class="line">+--------------+------------------+----------------------------------+</span><br><span class="line">| employees    |           300024 | 4ec56ab5ba37218d187cf6ab09ce1aa1 |</span><br><span class="line">| departments  |                9 | d1af5e170d2d1591d776d5638d71fc5f |</span><br><span class="line">| dept_manager |               24 | 8720e2f0853ac9096b689c14664f847e |</span><br><span class="line">| dept_emp     |           331603 | ccf6fe516f990bdaa49713fc478701b7 |</span><br><span class="line">| titles       |           443308 | bfa016c472df68e70a03facafa1bc0a8 |</span><br><span class="line">| salaries     |          2844047 | fd220654e95aea1b169624ffe3fca934 |</span><br><span class="line">+--------------+------------------+----------------------------------+</span><br><span class="line">+--------------+------------------+----------------------------------+</span><br><span class="line">| table_name   | found_records    | found_crc                        |</span><br><span class="line">+--------------+------------------+----------------------------------+</span><br><span class="line">| employees    |           300024 | 4ec56ab5ba37218d187cf6ab09ce1aa1 |</span><br><span class="line">| departments  |                9 | d1af5e170d2d1591d776d5638d71fc5f |</span><br><span class="line">| dept_manager |               24 | 8720e2f0853ac9096b689c14664f847e |</span><br><span class="line">| dept_emp     |           331603 | ccf6fe516f990bdaa49713fc478701b7 |</span><br><span class="line">| titles       |           443308 | bfa016c472df68e70a03facafa1bc0a8 |</span><br><span class="line">| salaries     |          2844047 | fd220654e95aea1b169624ffe3fca934 |</span><br><span class="line">+--------------+------------------+----------------------------------+</span><br><span class="line">+--------------+---------------+-----------+</span><br><span class="line">| table_name   | records_match | crc_match |</span><br><span class="line">+--------------+---------------+-----------+</span><br><span class="line">| employees    | OK            | ok        |</span><br><span class="line">| departments  | OK            | ok        |</span><br><span class="line">| dept_manager | OK            | ok        |</span><br><span class="line">| dept_emp     | OK            | ok        |</span><br><span class="line">| titles       | OK            | ok        |</span><br><span class="line">| salaries     | OK            | ok        |</span><br><span class="line">+--------------+---------------+-----------+</span><br><span class="line">+------------------+</span><br><span class="line">| computation_time |</span><br><span class="line">+------------------+</span><br><span class="line">| 00:00:16         |</span><br><span class="line">+------------------+</span><br><span class="line">+---------+--------+</span><br><span class="line">| summary | result |</span><br><span class="line">+---------+--------+</span><br><span class="line">| CRC     | OK     |</span><br><span class="line">| count   | OK     |</span><br><span class="line">+---------+--------+</span><br><span class="line"></span><br><span class="line">real    0m18.452s</span><br><span class="line">user    0m0.007s</span><br><span class="line">sys     0m0.005s</span><br></pre></td></tr></table></figure>
<p>至此，<code>Employees</code>测试数据库就安装完成了</p>
<hr>
<h2 id="二-表-TABLE"><a href="#二-表-TABLE" class="headerlink" title="二. 表(TABLE)"></a>二. 表(TABLE)</h2><h3 id="1-表的介绍"><a href="#1-表的介绍" class="headerlink" title="1. 表的介绍"></a>1. 表的介绍</h3><ul>
<li>表是关系数据库的核心</li>
<li>表 = 关系</li>
<li>表是记录的集合</li>
<li>二维表格模型易于人的理解</li>
<li>MySQL默认存储引擎都是基于行(记录)存储</li>
<li>每行记录都是基于列进行组织的</li>
</ul>
<h3 id="2-表是数据的集合"><a href="#2-表是数据的集合" class="headerlink" title="2. 表是数据的集合"></a>2. 表是数据的集合</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> table_name <span class="keyword">limit</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>
<p>集合是无序的，上面的SQL语句的意思是 <strong>从表(集合)中<code>随机</code>选出一条数据，结果是不确定的</strong>, 不能简单的认为是取出第一条数据。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> table_name <span class="keyword">order</span> <span class="keyword">by</span> col_name <span class="keyword">limit</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>
<p>只有通过<code>order by</code>排序之后取出的数据，才是确定的。</p>
<h3 id="3-创建表"><a href="#3-创建表" class="headerlink" title="3. 创建表"></a>3. 创建表</h3><h4 id="3-1-临时表"><a href="#3-1-临时表" class="headerlink" title="3.1. 临时表"></a>3.1. 临时表</h4><blockquote>
<p><a href="https://dev.mysql.com/doc/refman/5.7/en/create-table.html" target="_blank" rel="noopener">官方文档 表创建的语法</a></p>
</blockquote>
<ul>
<li><strong>临时表的创建</strong><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">--  mysql 5.7.9</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line">mysql&gt; select version();</span><br><span class="line">+<span class="comment">-----------+</span></span><br><span class="line">| version() |</span><br><span class="line">+<span class="comment">-----------+</span></span><br><span class="line">| 5.7.9-log |</span><br><span class="line">+<span class="comment">-----------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">use</span> burn_test;</span><br><span class="line">Database changed</span><br><span class="line"></span><br><span class="line">mysql&gt; create temporary table temp_a(a int);</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; show  create table temp_a\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">       Table: temp_a</span><br><span class="line"><span class="keyword">Create</span> <span class="keyword">Table</span>: <span class="keyword">CREATE</span> <span class="keyword">TEMPORARY</span> <span class="keyword">TABLE</span> <span class="string">`temp_a`</span> (</span><br><span class="line">  <span class="string">`a`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span></span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8mb4   <span class="comment">-- 使用的是innodb </span></span><br><span class="line"><span class="number">1</span> <span class="keyword">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- mysql 5.6.27</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line">mysql&gt; <span class="keyword">select</span> <span class="keyword">version</span>();</span><br><span class="line">+<span class="comment">------------+</span></span><br><span class="line">| version()  |</span><br><span class="line">+<span class="comment">------------+</span></span><br><span class="line">| 5.6.27-log |</span><br><span class="line">+<span class="comment">------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">create</span> <span class="keyword">temporary</span> <span class="keyword">table</span>  temp_a_56(a <span class="built_in">int</span>);</span><br><span class="line">Query OK, 0 rows affected (0.06 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; show create table temp_a_56\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">       Table: temp_a_56</span><br><span class="line"><span class="keyword">Create</span> <span class="keyword">Table</span>: <span class="keyword">CREATE</span> <span class="keyword">TEMPORARY</span> <span class="keyword">TABLE</span> <span class="string">`temp_a_56`</span> (</span><br><span class="line">  <span class="string">`a`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span></span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8mb4  <span class="comment">-- 5.6 也是innodb</span></span><br><span class="line"><span class="number">1</span> <span class="keyword">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">-----</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- 终端1 MySQL 5.7.9</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> <span class="keyword">version</span>();</span><br><span class="line">+<span class="comment">-----------+</span></span><br><span class="line">| version() |</span><br><span class="line">+<span class="comment">-----------+</span></span><br><span class="line">| 5.7.9-log |</span><br><span class="line">+<span class="comment">-----------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">show</span> <span class="keyword">processlist</span>\G</span><br><span class="line">*************************** <span class="number">1.</span> <span class="keyword">row</span> ***************************</span><br><span class="line">     <span class="keyword">Id</span>: <span class="number">10</span>  <span class="comment">-- 当前ID 是 10</span></span><br><span class="line">   <span class="keyword">User</span>: root</span><br><span class="line">   Host: localhost</span><br><span class="line">     db: burn_test</span><br><span class="line">Command: <span class="keyword">Query</span></span><br><span class="line">   <span class="keyword">Time</span>: <span class="number">0</span></span><br><span class="line">  State: <span class="keyword">starting</span></span><br><span class="line">   Info: <span class="keyword">show</span> <span class="keyword">processlist</span>   <span class="comment">-- 当前终端执行</span></span><br><span class="line">*************************** <span class="number">2.</span> <span class="keyword">row</span> ***************************</span><br><span class="line">     <span class="keyword">Id</span>: <span class="number">12</span></span><br><span class="line">   <span class="keyword">User</span>: root</span><br><span class="line">   Host: localhost</span><br><span class="line">     db: <span class="literal">NULL</span></span><br><span class="line">Command: <span class="keyword">Sleep</span></span><br><span class="line">   <span class="keyword">Time</span>: <span class="number">328</span></span><br><span class="line">  State: </span><br><span class="line">   Info: <span class="literal">NULL</span></span><br><span class="line">*************************** <span class="number">3.</span> <span class="keyword">row</span> ***************************</span><br><span class="line">     <span class="keyword">Id</span>: <span class="number">13</span></span><br><span class="line">   <span class="keyword">User</span>: root</span><br><span class="line">   Host: localhost</span><br><span class="line">     db: burn_test</span><br><span class="line">Command: <span class="keyword">Sleep</span></span><br><span class="line">   <span class="keyword">Time</span>: <span class="number">16</span></span><br><span class="line">  State: </span><br><span class="line">   Info: <span class="literal">NULL</span></span><br><span class="line"><span class="number">3</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">insert</span> <span class="keyword">into</span> temp_a <span class="keyword">values</span>(<span class="number">123</span>);</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from temp_a;      </span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">| a    |</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">|  123 |</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- 终端2 MySQL 5.7.9</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line">mysql&gt; <span class="keyword">select</span> <span class="keyword">version</span>();</span><br><span class="line">+<span class="comment">-----------+</span></span><br><span class="line">| version() |</span><br><span class="line">+<span class="comment">-----------+</span></span><br><span class="line">| 5.7.9-log |</span><br><span class="line">+<span class="comment">-----------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">show</span> <span class="keyword">processlist</span>\G</span><br><span class="line">*************************** <span class="number">1.</span> <span class="keyword">row</span> ***************************</span><br><span class="line">     <span class="keyword">Id</span>: <span class="number">10</span></span><br><span class="line">   <span class="keyword">User</span>: root</span><br><span class="line">   Host: localhost</span><br><span class="line">     db: burn_test</span><br><span class="line">Command: <span class="keyword">Sleep</span></span><br><span class="line">   <span class="keyword">Time</span>: <span class="number">75</span></span><br><span class="line">  State: </span><br><span class="line">   Info: <span class="literal">NULL</span></span><br><span class="line">*************************** <span class="number">2.</span> <span class="keyword">row</span> ***************************</span><br><span class="line">     <span class="keyword">Id</span>: <span class="number">12</span></span><br><span class="line">   <span class="keyword">User</span>: root</span><br><span class="line">   Host: localhost</span><br><span class="line">     db: <span class="literal">NULL</span></span><br><span class="line">Command: <span class="keyword">Sleep</span></span><br><span class="line">   <span class="keyword">Time</span>: <span class="number">403</span></span><br><span class="line">  State: </span><br><span class="line">   Info: <span class="literal">NULL</span></span><br><span class="line">*************************** <span class="number">3.</span> <span class="keyword">row</span> ***************************</span><br><span class="line">     <span class="keyword">Id</span>: <span class="number">13</span>   <span class="comment">-- 当前 ID 是 13</span></span><br><span class="line">   <span class="keyword">User</span>: root</span><br><span class="line">   Host: localhost</span><br><span class="line">     db: burn_test</span><br><span class="line">Command: <span class="keyword">Query</span></span><br><span class="line">   <span class="keyword">Time</span>: <span class="number">0</span></span><br><span class="line">  State: <span class="keyword">starting</span></span><br><span class="line">   Info: <span class="keyword">show</span> <span class="keyword">processlist</span>  <span class="comment">-- 当前终端执行</span></span><br><span class="line"><span class="number">3</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">use</span> burn_test;</span><br><span class="line">Database changed</span><br><span class="line"></span><br><span class="line">mysql&gt; show tables;</span><br><span class="line">Empty <span class="keyword">set</span> (<span class="number">0.00</span> sec)   <span class="comment">-- 从其他终端登录的用户(session)无法看到temp_a这个临时表</span></span><br><span class="line"></span><br><span class="line"><span class="comment">----</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- 临时表 和 普通表 同名问题</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line">mysql&gt; <span class="keyword">create</span> <span class="keyword">table</span> test_1 (a <span class="built_in">int</span>);  <span class="comment">-- 创建一张普通的表叫做 test_1</span></span><br><span class="line">Query OK, 0 rows affected (0.16 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into test_1 values(23);</span><br><span class="line">Query OK, 1 row affected (0.03 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into test_1 values(24);</span><br><span class="line">Query OK, 1 row affected (0.03 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from test_1;</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">| a    |</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">|   23 |   <span class="comment">-- 可以看到插入的数据</span></span><br><span class="line">|   24 |</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">2 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">create</span> <span class="keyword">temporary</span> <span class="keyword">table</span> test_1 (a <span class="built_in">int</span>);   <span class="comment">-- 创建一种和test_1 同名的临时表</span></span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into test_1 values(1000);  -- 插入一个 不一样的值</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from test_1;</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">| a    |</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">| 1000 |   <span class="comment">-- 只能搜索到 临时表中的数据</span></span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">create</span> <span class="keyword">temporary</span> <span class="keyword">table</span> <span class="keyword">if</span> <span class="keyword">not</span> <span class="keyword">exists</span> table_name  (a <span class="built_in">int</span>);  <span class="comment">-- 使用if not exists进行判断</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<p><strong>1：临时表是<code>SESSION</code>级别的, 当前用户logout或者其他用户登录上来，是无法看到这张表的</strong><br><strong>2：当临时表和普通表同名时，当前用户只能看到同名的临时表</strong><br><strong>3：创建表时带上<code>if not exists</code>进行表的存在性检查；同时建议在临时表的表名前面加上统一的<code>prefix</code></strong></p>
</blockquote>
<ul>
<li><strong>临时表的作用</strong><ul>
<li>临时表主要的作用是给当前登录的用户存储临时数据或者临时结果的。</li>
<li>不要和SQL优化器在排序过程中内部帮你创建的临时表相混淆。</li>
</ul>
</li>
</ul>
<ul>
<li><p><strong>临时表的存储引擎</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select version();</span><br><span class="line">+<span class="comment">-----------+</span></span><br><span class="line">| version() |</span><br><span class="line">+<span class="comment">-----------+</span></span><br><span class="line">| 5.7.9-log |</span><br><span class="line">+<span class="comment">-----------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">show</span> <span class="keyword">variables</span> <span class="keyword">like</span> <span class="string">"default%tmp%"</span>;</span><br><span class="line">+<span class="comment">----------------------------+--------+</span></span><br><span class="line">| Variable_name              | Value  |</span><br><span class="line">+<span class="comment">----------------------------+--------+</span></span><br><span class="line">| default_tmp_storage_engine | InnoDB |  <span class="comment">-- 5.7.9 的临时表默认存储引擎就是 InnoDB</span></span><br><span class="line">+<span class="comment">----------------------------+--------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> <span class="keyword">version</span>();</span><br><span class="line">+<span class="comment">------------+</span></span><br><span class="line">| version()  |</span><br><span class="line">+<span class="comment">------------+</span></span><br><span class="line">| 5.6.27-log |</span><br><span class="line">+<span class="comment">------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">show</span> <span class="keyword">variables</span> <span class="keyword">like</span> <span class="string">"default%tmp%"</span>;</span><br><span class="line">+<span class="comment">----------------------------+--------+</span></span><br><span class="line">| Variable_name              | Value  |</span><br><span class="line">+<span class="comment">----------------------------+--------+</span></span><br><span class="line">| default_tmp_storage_engine | InnoDB |  <span class="comment">-- 5.7.26 的临时表默认存储引擎也是 InnoDB</span></span><br><span class="line">+<span class="comment">----------------------------+--------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 5.6 之前用的是MyISAM</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>临时表存储位置</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># MySQL 5.7</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">mysql&gt; system ls -l /tmp  <span class="comment"># 使用system 可以解析执行linux shell命令</span></span><br><span class="line">total 20</span><br><span class="line">drwxr-xr-x. 4 mysql mysql 4096 Dec  2 10:06 mysql_data</span><br><span class="line">srwxrwxrwx. 1 mysql mysql    0 Dec  2 21:20 mysql.sock_56</span><br><span class="line">srwxrwxrwx. 1 mysql mysql    0 Dec  2 20:51 mysql.sock_57</span><br><span class="line">-rw-------. 1 mysql mysql    5 Dec  2 20:51 mysql.sock_57.lock</span><br><span class="line">-rw-r-----. 1 mysql mysql 8554 Dec  2 22:04 <span class="comment">#sqlf18_a_0.frm  -- temp_1 的表结构</span></span><br><span class="line"></span><br><span class="line">mysql&gt; system ls -l /data/mysql_data/5.7/ | grep ib</span><br><span class="line">-rw-r-----. 1 mysql mysql       879 Dec  2 20:47 ib_buffer_pool</span><br><span class="line">-rw-r-----. 1 mysql mysql  12582912 Dec  2 22:21 ibdata1</span><br><span class="line">-rw-r-----. 1 mysql mysql 134217728 Dec  2 22:20 ib_logfile0</span><br><span class="line">-rw-r-----. 1 mysql mysql 134217728 Dec  2 21:33 ib_logfile1</span><br><span class="line">-rw-r-----. 1 mysql mysql  12582912 Dec  2 22:33 ibtmp1  -- 这个是我们的表结构对应的数据</span><br><span class="line"></span><br><span class="line">mysql&gt; show variables like <span class="string">"innodb_temp%"</span>;</span><br><span class="line">+----------------------------+-----------------------+</span><br><span class="line">| Variable_name              | Value                 |</span><br><span class="line">+----------------------------+-----------------------+</span><br><span class="line">| innodb_temp_data_file_path | ibtmp1:12M:autoextend |</span><br><span class="line">+----------------------------+-----------------------+</span><br><span class="line">1 row <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">#-----</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># MySQL 5.6</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">mysql&gt; system ls -l /tmp</span><br><span class="line">total 68</span><br><span class="line">drwxr-xr-x. 4 mysql mysql  4096 Dec  2 10:06 mysql_data</span><br><span class="line">srwxrwxrwx. 1 mysql mysql     0 Dec  2 21:20 mysql.sock_56</span><br><span class="line">srwxrwxrwx. 1 mysql mysql     0 Dec  2 20:51 mysql.sock_57</span><br><span class="line">-rw-------. 1 mysql mysql     5 Dec  2 20:51 mysql.sock_57.lock</span><br><span class="line">-rw-rw----. 1 mysql mysql  8554 Dec  2 22:38 <span class="comment">#sql13f3_7_0.frm   -- 表结构</span></span><br><span class="line">-rw-rw----. 1 mysql mysql 49152 Dec  2 22:38 <span class="comment">#sql13f3_7_0.ibd   -- 表数据</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 5.6.27 中没有 innodb_temp_data_file_path 变量</span></span><br><span class="line">mysql&gt; show variables like <span class="string">"innodb_temp%"</span>;</span><br><span class="line">Empty <span class="built_in">set</span> (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; show variables like <span class="string">"%innodb%temp%"</span>;</span><br><span class="line">Empty <span class="built_in">set</span> (0.00 sec)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<p>MySQL5.7.9 把临时<code>表结构</code>放在<code>tmpdir</code>，而数据<code>表数据</code>放在<code>datadir</code><br>MySQL5.6.27 把临时<code>表结构</code>和<code>表数据</code>都放在<code>tmpdir</code></p>
</blockquote>
<h3 id="4-查看表结构"><a href="#4-查看表结构" class="headerlink" title="4. 查看表结构"></a>4. 查看表结构</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show create table test_1\G   -- 表结构</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">       Table: test_1</span><br><span class="line"><span class="keyword">Create</span> <span class="keyword">Table</span>: <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`test_1`</span> (</span><br><span class="line">  <span class="string">`a`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span></span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8mb4</span><br><span class="line"><span class="number">1</span> <span class="keyword">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">desc</span> test_1\G  <span class="comment">-- 表的描述,描述二维表信息</span></span><br><span class="line">*************************** <span class="number">1.</span> <span class="keyword">row</span> ***************************</span><br><span class="line">  <span class="keyword">Field</span>: a</span><br><span class="line">   <span class="keyword">Type</span>: <span class="built_in">int</span>(<span class="number">11</span>)</span><br><span class="line">   <span class="literal">Null</span>: YES</span><br><span class="line">    <span class="keyword">Key</span>: </span><br><span class="line"><span class="keyword">Default</span>: <span class="literal">NULL</span></span><br><span class="line">  Extra: </span><br><span class="line"><span class="number">1</span> <span class="keyword">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">show</span> <span class="keyword">table</span> <span class="keyword">status</span> <span class="keyword">like</span> <span class="string">"test_1"</span>\G    <span class="comment">-- 看表结构的元数据信息</span></span><br><span class="line">*************************** <span class="number">1.</span> <span class="keyword">row</span> ***************************</span><br><span class="line">           <span class="keyword">Name</span>: test_1</span><br><span class="line">         <span class="keyword">Engine</span>: <span class="keyword">InnoDB</span></span><br><span class="line">        <span class="keyword">Version</span>: <span class="number">10</span></span><br><span class="line">     Row_format: Dynamic</span><br><span class="line">           <span class="keyword">Rows</span>: <span class="number">2</span></span><br><span class="line"> Avg_row_length: <span class="number">4096</span></span><br><span class="line">    Data_length: <span class="number">8192</span></span><br><span class="line">Max_data_length: <span class="number">0</span></span><br><span class="line">   Index_length: <span class="number">0</span></span><br><span class="line">      Data_free: <span class="number">0</span></span><br><span class="line"> Auto_increment: <span class="literal">NULL</span></span><br><span class="line">    Create_time: <span class="number">2015</span><span class="number">-12</span><span class="number">-02</span> <span class="number">22</span>:<span class="number">20</span>:<span class="number">19</span></span><br><span class="line">    Update_time: <span class="number">2015</span><span class="number">-12</span><span class="number">-02</span> <span class="number">22</span>:<span class="number">20</span>:<span class="number">44</span></span><br><span class="line">     Check_time: <span class="literal">NULL</span></span><br><span class="line">      <span class="keyword">Collation</span>: utf8mb4_general_ci</span><br><span class="line">       <span class="keyword">Checksum</span>: <span class="literal">NULL</span></span><br><span class="line"> Create_options: </span><br><span class="line">        <span class="keyword">Comment</span>: </span><br><span class="line"><span class="number">1</span> <span class="keyword">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<h3 id="5-ALTER-TABLE"><a href="#5-ALTER-TABLE" class="headerlink" title="5. ALTER TABLE"></a>5. ALTER TABLE</h3><blockquote>
<p><a href="http://dev.mysql.com/doc/refman/5.7/en/alter-table.html" target="_blank" rel="noopener">ALTER TABLE语法官方文档</a><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; alter table test_1 add column b char(10);  -- 添加列 b</span><br><span class="line">Query OK, 0 rows affected (0.25 sec)</span><br><span class="line">Records: 0  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from test_1;</span><br><span class="line">+<span class="comment">------+------+</span></span><br><span class="line">| a    | b    |</span><br><span class="line">+<span class="comment">------+------+</span></span><br><span class="line">|   23 | NULL |</span><br><span class="line">|   24 | NULL |</span><br><span class="line">+<span class="comment">------+------+</span></span><br><span class="line">2 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">alter</span> <span class="keyword">table</span> test_1 <span class="keyword">drop</span> <span class="keyword">column</span> b;  <span class="comment">-- 删除列 b</span></span><br><span class="line">Query OK, 0 rows affected (0.27 sec)</span><br><span class="line">Records: 0  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from test_1;</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">| a    |</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">|   23 |</span><br><span class="line">|   24 |</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">2 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure></p>
</blockquote>
<blockquote>
<p>注意，当表记录很大的时候，<code>alter table</code>会很耗时，影响性能</p>
</blockquote>
<ul>
<li><strong>ONLINE DDL</strong><br>5.6以后对在线DDL操作进行了优化，以提高性能。<a href="http://dev.mysql.com/doc/refman/5.7/en/innodb-create-index-overview.html" target="_blank" rel="noopener">官方文档</a>     </li>
</ul>
<hr>
<h2 id="三-外键约束"><a href="#三-外键约束" class="headerlink" title="三. 外键约束"></a>三. 外键约束</h2><h3 id="1-外键的介绍"><a href="#1-外键的介绍" class="headerlink" title="1. 外键的介绍"></a>1. 外键的介绍</h3><blockquote>
<p><a href="https://dev.mysql.com/doc/refman/5.7/en/create-table-foreign-keys.html" target="_blank" rel="noopener">官方文档</a><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- 摘自 MySQL官方文档</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> product (         <span class="comment">-- 商品表</span></span><br><span class="line">    <span class="keyword">category</span> <span class="built_in">INT</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,     <span class="comment">-- 商品种类</span></span><br><span class="line">    <span class="keyword">id</span> <span class="built_in">INT</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,           <span class="comment">-- 商品id</span></span><br><span class="line">    price <span class="built_in">DECIMAL</span>, </span><br><span class="line">    PRIMARY <span class="keyword">KEY</span>(<span class="keyword">category</span>, <span class="keyword">id</span>)  <span class="comment">-- 主键是 (category, id)</span></span><br><span class="line">)   <span class="keyword">ENGINE</span>=<span class="keyword">INNODB</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> customer (   <span class="comment">-- 客户表</span></span><br><span class="line">    <span class="keyword">id</span> <span class="built_in">INT</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,      <span class="comment">-- 客户id</span></span><br><span class="line">    PRIMARY <span class="keyword">KEY</span> (<span class="keyword">id</span>)      <span class="comment">-- 主键是 id</span></span><br><span class="line">)   <span class="keyword">ENGINE</span>=<span class="keyword">INNODB</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> product_order (         <span class="comment">-- 订单表</span></span><br><span class="line">    <span class="keyword">no</span> <span class="built_in">INT</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,  <span class="comment">-- number，自增长</span></span><br><span class="line">    product_category <span class="built_in">INT</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,   <span class="comment">-- 商品种类</span></span><br><span class="line">    product_id <span class="built_in">INT</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,         <span class="comment">-- 商品id </span></span><br><span class="line">    customer_id <span class="built_in">INT</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,        <span class="comment">-- 客户id</span></span><br><span class="line"></span><br><span class="line">    PRIMARY <span class="keyword">KEY</span>(<span class="keyword">no</span>),                        <span class="comment">-- 主键是  no </span></span><br><span class="line">    <span class="keyword">INDEX</span> (product_category, product_id),   <span class="comment">-- 对 (product_category, product_id) 做索引</span></span><br><span class="line">    <span class="keyword">INDEX</span> (customer_id),                    <span class="comment">-- 对 customer_id 做索引</span></span><br><span class="line"></span><br><span class="line">    FOREIGN <span class="keyword">KEY</span> (product_category, product_id)  <span class="comment">-- 两个外键约束</span></span><br><span class="line">    <span class="keyword">REFERENCES</span> product(<span class="keyword">category</span>, <span class="keyword">id</span>)   <span class="comment">-- 字段 product_category 引用自 product表的category</span></span><br><span class="line">                                       <span class="comment">-- 字段 product_id 引用自 product表的id</span></span><br><span class="line">      <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="keyword">CASCADE</span> <span class="keyword">ON</span> <span class="keyword">DELETE</span> RESTRICT,     <span class="comment">-- 级联跟新  和  严格模式删除</span></span><br><span class="line"></span><br><span class="line">    FOREIGN <span class="keyword">KEY</span> (customer_id)</span><br><span class="line">      <span class="keyword">REFERENCES</span> customer(<span class="keyword">id</span>)</span><br><span class="line">)   <span class="keyword">ENGINE</span>=<span class="keyword">INNODB</span>;</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h3 id="2-外键操作"><a href="#2-外键操作" class="headerlink" title="2. 外键操作"></a>2. 外键操作</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- 表结构 摘自  MySQL 官方文档</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"></span><br><span class="line">mysql&gt; create table parent (</span><br><span class="line">    -&gt;     id int not null,</span><br><span class="line">    -&gt;     primary key (id)</span><br><span class="line">    -&gt; ) engine=innodb;</span><br><span class="line">Query OK, 0 rows affected (0.14 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; create table child (</span><br><span class="line">    -&gt;     id int, </span><br><span class="line">    -&gt;     parent_id INT,</span><br><span class="line">    -&gt;     index par_ind (parent_id),</span><br><span class="line">    -&gt;     foreign key (parent_id) </span><br><span class="line">    -&gt;         references parent(id)</span><br><span class="line">    -&gt;         on delete cascade on update cascade  -- 比官网例子增加 update cascade </span><br><span class="line">    -&gt; ) engine=innodb;</span><br><span class="line">Query ok, 0 rows affected (0.15 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into child values(1,1);  -- 我们插入一条数据，id=1，parent_id=1</span><br><span class="line">ERROR 1452 (23000): Cannot add or <span class="keyword">update</span> a <span class="keyword">child</span> <span class="keyword">row</span>: a foreign <span class="keyword">key</span> <span class="keyword">constraint</span> fails (<span class="string">`burn_test`</span>.<span class="string">`child`</span>, <span class="keyword">CONSTRAINT</span> <span class="string">`child_ibfk_1`</span> FOREIGN <span class="keyword">KEY</span> (<span class="string">`parent_id`</span>) <span class="keyword">REFERENCES</span> <span class="string">`parent`</span> (<span class="string">`id`</span>) <span class="keyword">ON</span> <span class="keyword">DELETE</span> <span class="keyword">CASCADE</span>)  </span><br><span class="line"><span class="comment">-- 直接报错了，因为此时parent表中没有任何记录</span></span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">parent</span> <span class="keyword">values</span>(<span class="number">1</span>);   <span class="comment">-- 现在parent中插入记录</span></span><br><span class="line">Query OK, 1 row affected (0.03 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into child values(1,1);  -- 然后在child中插入记录，且parent_id是在parent中存在的</span><br><span class="line">Query OK, 1 row affected (0.02 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into child values(1,2);  -- 插入parent_id=2的记录，报错。因为此时parent_id=2的记录不存在</span><br><span class="line">ERROR 1452 (23000): Cannot add or <span class="keyword">update</span> a <span class="keyword">child</span> <span class="keyword">row</span>: a foreign <span class="keyword">key</span> <span class="keyword">constraint</span> fails (<span class="string">`burn_test`</span>.<span class="string">`child`</span>, <span class="keyword">CONSTRAINT</span> <span class="string">`child_ibfk_1`</span> FOREIGN <span class="keyword">KEY</span> (<span class="string">`parent_id`</span>) <span class="keyword">REFERENCES</span> <span class="string">`parent`</span> (<span class="string">`id`</span>) <span class="keyword">ON</span> <span class="keyword">DELETE</span> <span class="keyword">CASCADE</span>)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> * <span class="keyword">from</span>  <span class="keyword">child</span>;     </span><br><span class="line">+<span class="comment">------+-----------+</span></span><br><span class="line">| id   | parent_id |</span><br><span class="line">+<span class="comment">------+-----------+</span></span><br><span class="line">|    1 |         1 |  <span class="comment">-- parent_id = 1</span></span><br><span class="line">+<span class="comment">------+-----------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> * <span class="keyword">from</span>  <span class="keyword">parent</span>;</span><br><span class="line">+<span class="comment">----+</span></span><br><span class="line">| id |</span><br><span class="line">+<span class="comment">----+</span></span><br><span class="line">|  1 |  <span class="comment">-- 根据表结构的定义（Foreign_key），这个值就是 child表中的id</span></span><br><span class="line">+<span class="comment">----+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">update</span> <span class="keyword">parent</span> <span class="keyword">set</span> <span class="keyword">id</span>=<span class="number">100</span> <span class="keyword">where</span> <span class="keyword">id</span>=<span class="number">1</span>;       </span><br><span class="line">Query OK, 1 row affected (0.04 sec)</span><br><span class="line">Rows matched: 1  Changed: 1  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from parent;</span><br><span class="line">+<span class="comment">-----+</span></span><br><span class="line">| id  |</span><br><span class="line">+<span class="comment">-----+</span></span><br><span class="line">| 100 |  <span class="comment">-- 已经设置成了100</span></span><br><span class="line">+<span class="comment">-----+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">child</span>;</span><br><span class="line">+<span class="comment">------+-----------+</span></span><br><span class="line">| id   | parent_id |</span><br><span class="line">+<span class="comment">------+-----------+</span></span><br><span class="line">|    1 |       100 |  <span class="comment">-- 自动变化，这是on update cascade的作用，联级更新，parent更新，child也跟着更新</span></span><br><span class="line">+<span class="comment">------+-----------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">delete</span> <span class="keyword">from</span> <span class="keyword">parent</span> <span class="keyword">where</span> <span class="keyword">id</span>=<span class="number">100</span>;  <span class="comment">-- 删除这条记录</span></span><br><span class="line">Query OK, 1 row affected (0.03 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from parent;  -- id=100的记录已经被删除了</span><br><span class="line">Empty <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">child</span>;  <span class="comment">-- id=1，parent_id=100的记录跟着被删除了。on delete cascade的作用</span></span><br><span class="line">Empty <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">alter</span> <span class="keyword">table</span> <span class="keyword">child</span> <span class="keyword">drop</span> foreign <span class="keyword">key</span> child_ibfk_1;  <span class="comment">-- 删除 之前的外键</span></span><br><span class="line">Query OK, 0 rows affected (0.07 sec)</span><br><span class="line">Records: 0  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; alter table child add foreign key(parent_id) </span><br><span class="line">    -&gt; references parent(id) on update cascade on delete restrict;  -- 使用严格模式</span><br><span class="line">Query OK, 0 rows affected (0.27 sec)</span><br><span class="line">Records: 0  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into parent values(50);</span><br><span class="line">Query OK, 1 row affected (0.03 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into child values(3,50); </span><br><span class="line">Query OK, 1 row affected (0.03 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into child values(3,51);  -- 和之前一样会提示错误</span><br><span class="line">ERROR 1452 (23000): Cannot add or <span class="keyword">update</span> a <span class="keyword">child</span> <span class="keyword">row</span>: a foreign <span class="keyword">key</span> <span class="keyword">constraint</span> fails (<span class="string">`burn_test`</span>.<span class="string">`child`</span>, <span class="keyword">CONSTRAINT</span> <span class="string">`child_ibfk_1`</span> FOREIGN <span class="keyword">KEY</span> (<span class="string">`parent_id`</span>) <span class="keyword">REFERENCES</span> <span class="string">`parent`</span> (<span class="string">`id`</span>) <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="keyword">CASCADE</span>)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">delete</span> <span class="keyword">from</span> <span class="keyword">parent</span> <span class="keyword">where</span> <span class="keyword">id</span>=<span class="number">50</span>;  <span class="comment">-- 删除失败了，因为是restrict模式</span></span><br><span class="line">ERROR 1451 (23000): Cannot <span class="keyword">delete</span> <span class="keyword">or</span> <span class="keyword">update</span> a <span class="keyword">parent</span> <span class="keyword">row</span>: a foreign <span class="keyword">key</span> <span class="keyword">constraint</span> fails (<span class="string">`burn_test`</span>.<span class="string">`child`</span>, <span class="keyword">CONSTRAINT</span> <span class="string">`child_ibfk_1`</span> FOREIGN <span class="keyword">KEY</span> (<span class="string">`parent_id`</span>) <span class="keyword">REFERENCES</span> <span class="string">`parent`</span> (<span class="string">`id`</span>) <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="keyword">CASCADE</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 注意，delete 后面说明都不写表示 no action == restrict</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>外键约束，可以让数据进行一致性更新，但是会有一定的<code>性能损耗</code>，线上业务使用不多。通常上述级联更新和删除都是由应用层业务逻辑进行判断并实现。</p>
</blockquote>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://chenwenning.github.io/2018/06/01/MySQL学习笔记(Day009：JSON)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="陈汶宁">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://pic.qqtn.com/up/2017-10/2017101317054482087.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CHENWENNING BLOG">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/06/01/MySQL学习笔记(Day009：JSON)/" itemprop="url">MySQL学习笔记（Day009：JSON）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-06-01T17:30:16+08:00">
                2018-06-01
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/mysql/" itemprop="url" rel="index">
                    <span itemprop="name">mysql</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/06/01/MySQL学习笔记(Day009：JSON)/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2018/06/01/MySQL学习笔记(Day009：JSON)/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="MySQL学习笔记（Day009：JSON）"><a href="#MySQL学习笔记（Day009：JSON）" class="headerlink" title="MySQL学习笔记（Day009：JSON）"></a>MySQL学习笔记（Day009：JSON）</h1><p>@(MySQL学习)</p>
<p>[TOC]</p>
<h2 id="一-MySQL-JSON类型"><a href="#一-MySQL-JSON类型" class="headerlink" title="一. MySQL JSON类型"></a>一. MySQL JSON类型</h2><h3 id="1-JSON介绍"><a href="#1-JSON介绍" class="headerlink" title="1. JSON介绍"></a>1. JSON介绍</h3><ul>
<li><strong>JSON</strong>（<code>J</code>ava<code>S</code>cript <code>O</code>bject <code>N</code>otation）是一种轻量级的数据交换语言，并且是独立于语言的文本格式。</li>
<li>一些<code>NoSQL数据库</code>选择<code>JSON</code>作为其数据存储格式，比如：MongoDB、CouchDB等。</li>
<li>MySQL<code>5.7.x</code>开始支持<strong>JSON</strong>数据类型。</li>
</ul>
<blockquote>
<p><a href="http://dev.mysql.com/doc/refman/5.7/en/json.html" target="_blank" rel="noopener">官方文档(JSON类型)</a></p>
</blockquote>
<h3 id="2-JSON格式示例"><a href="#2-JSON格式示例" class="headerlink" title="2. JSON格式示例"></a>2. JSON格式示例</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- 摘自 维基百科</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">     "firstName": "John",    <span class="comment">-- Key : Value 格式</span></span><br><span class="line">     "lastName": "Smith",</span><br><span class="line">     "sex": "male",</span><br><span class="line">     "age": 25,</span><br><span class="line">     "address":              <span class="comment">-- Key : Value ; 其中 Value 也是一个 Key-Value 的结构</span></span><br><span class="line">     &#123;</span><br><span class="line">         "streetAddress": "21 2nd Street",</span><br><span class="line">         "city": "New York",</span><br><span class="line">         "state": "NY",</span><br><span class="line">         "postalCode": "10021"</span><br><span class="line">     &#125;,</span><br><span class="line">     "phoneNumber": </span><br><span class="line">     [</span><br><span class="line">         &#123;</span><br><span class="line">           "type": "home",</span><br><span class="line">           "number": "212 555-1234"</span><br><span class="line">         &#125;,</span><br><span class="line">         &#123;</span><br><span class="line">           "type": "fax",</span><br><span class="line">           "number": "646 555-4567"</span><br><span class="line">         &#125;</span><br><span class="line">     ]</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-JSON-VS-BLOB"><a href="#3-JSON-VS-BLOB" class="headerlink" title="3. JSON VS BLOB"></a>3. JSON VS BLOB</h3><ul>
<li><p><strong>JSON</strong></p>
<ul>
<li>JSON数据可以做有效性检查;</li>
<li>JSON使得查询性能提升;</li>
<li>JSON支持部分属性索引，通过虚拟列的功能可以对JSON中的部分数据进行索引;</li>
</ul>
</li>
<li><p><strong>BLOB</strong></p>
<ul>
<li>BLOB类型无法在数据库层做约束性检查;</li>
<li>BLOB进行查询，需要遍历所有字符串;</li>
<li>BLOB做只能做指定长度的索引;</li>
</ul>
</li>
</ul>
<blockquote>
<p>5.7之前，只能把JSON当作BLOB进行存储。数据库层面无法对JSON数据做一些操作，只能由应用程序处理。</p>
</blockquote>
<h3 id="4-结构化和非结构化"><a href="#4-结构化和非结构化" class="headerlink" title="4.结构化和非结构化"></a>4.结构化和非结构化</h3><ul>
<li><p><strong>结构化</strong></p>
<ul>
<li>二维表结构（行和列）</li>
<li>使用SQL语句进行操作</li>
</ul>
</li>
<li><p><strong>非结构化</strong></p>
<ul>
<li>使用Key-Value格式定义数据，无结构定义</li>
<li>Value可以嵌套Key-Value格式的数据</li>
<li>使用JSON进行实现</li>
</ul>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- SQL创建User表</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">user</span> (</span><br><span class="line">    <span class="keyword">id</span> <span class="built_in">bigint</span> <span class="keyword">not</span> <span class="literal">null</span> auto_increment,</span><br><span class="line">    user_name <span class="built_in">varchar</span>(<span class="number">10</span>),</span><br><span class="line">    age <span class="built_in">int</span>,</span><br><span class="line">    primary <span class="keyword">key</span>(<span class="keyword">id</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># JSON定义的User表</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line">db.user.insert(&#123;</span><br><span class="line">    user_name:<span class="string">"tom"</span>,</span><br><span class="line">    age:<span class="number">30</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">db.createCollection(<span class="string">"user"</span>)</span><br></pre></td></tr></table></figure>
<h3 id="5-JSON操作示例"><a href="#5-JSON操作示例" class="headerlink" title="5. JSON操作示例"></a>5. JSON操作示例</h3><h4 id="5-1-JSON入门"><a href="#5-1-JSON入门" class="headerlink" title="5.1 JSON入门"></a>5.1 JSON入门</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- 创建带json字段的表</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line">mysql&gt; create table user (</span><br><span class="line">    -&gt; uid int auto_increment,</span><br><span class="line">    -&gt; data json,</span><br><span class="line">    -&gt; primary key(uid)</span><br><span class="line">    -&gt; );</span><br><span class="line">Query OK, 0 rows affected (0.11 sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- 插入json数据</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line">mysql&gt; insert into user values (</span><br><span class="line">    -&gt; null,  -- 自增长数据，可以插入null</span><br><span class="line">    -&gt; '&#123;</span><br><span class="line">    '&gt; "name":"tom",</span><br><span class="line">    '&gt; "age":18,</span><br><span class="line">    '&gt; "address":"SZ"</span><br><span class="line">    '&gt; &#125;'</span><br><span class="line">    -&gt; );</span><br><span class="line">Query OK, 1 row affected (0.03 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into user values (</span><br><span class="line">    -&gt; null,</span><br><span class="line">    -&gt; '&#123;</span><br><span class="line">    '&gt; "name":"jim",</span><br><span class="line">    '&gt; "age":28,</span><br><span class="line">    '&gt; "mail":"jim@163.com"</span><br><span class="line">    '&gt; &#125;'</span><br><span class="line">    -&gt; );</span><br><span class="line">Query OK, 1 row affected (0.02 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into user values ( null, "can you insert it?");  -- 无法插入，因为是JSON类型</span><br><span class="line">ERROR 3140 (22032): Invalid JSON text: "Invalid value." at position 0 in value (or column) can you <span class="keyword">insert</span> it?.  <span class="comment">-- 这短话有单引号，但是渲染有问题，所以这里去掉了</span></span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">user</span>;</span><br><span class="line">+<span class="comment">-----+---------------------------------------------------+</span></span><br><span class="line">| uid | data                                              |</span><br><span class="line">+<span class="comment">-----+---------------------------------------------------+</span></span><br><span class="line">|   1 | &#123;"age": 18, "name": "tom", "address": "SZ"&#125;       |  -- 这个json中有address字段</span><br><span class="line">|   2 | &#123;"age": 28, "mail": "jim@163.com", "name": "jim"&#125; |  -- 这个json中有mail字段</span><br><span class="line">+<span class="comment">-----+---------------------------------------------------+</span></span><br><span class="line">2 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<h4 id="5-2-JSON常用函数介绍"><a href="#5-2-JSON常用函数介绍" class="headerlink" title="5.2 JSON常用函数介绍"></a>5.2 JSON常用函数介绍</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- 使用json_extract提取数据</span></span><br><span class="line"><span class="comment">-- 原型 : JSON_EXTRACT(json_doc, path[, path] ...) </span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line">mysql&gt; select json_extract('[10, 20, [30, 40]]', '$[1]');                  </span><br><span class="line">+<span class="comment">--------------------------------------------+</span></span><br><span class="line">| json_extract('[10, 20, [30, 40]]', '$[1]') |</span><br><span class="line">+<span class="comment">--------------------------------------------+</span></span><br><span class="line">| 20                                         |  <span class="comment">-- 从list中抽取 下标 为1的元素（下标从0开始）</span></span><br><span class="line">+<span class="comment">--------------------------------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span></span><br><span class="line">    -&gt; json_extract(<span class="keyword">data</span>, <span class="string">'$.name'</span>),    <span class="comment">-- 提起name字段的数据</span></span><br><span class="line">    -&gt; json_extract(<span class="keyword">data</span>, <span class="string">'$.address'</span>)  <span class="comment">-- 提取address字段的数据</span></span><br><span class="line">    -&gt; <span class="keyword">from</span> <span class="keyword">user</span>;</span><br><span class="line">+<span class="comment">------------------------------+---------------------------------+</span></span><br><span class="line">| json_extract(data, '$.name') | json_extract(data, '$.address') |</span><br><span class="line">+<span class="comment">------------------------------+---------------------------------+</span></span><br><span class="line">| "tom"                        | "SZ"                            |</span><br><span class="line">| "jim"                        | NULL                            |  <span class="comment">-- jim 没有address字段，填充了NULL</span></span><br><span class="line">+<span class="comment">------------------------------+---------------------------------+</span></span><br><span class="line">2 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- json_object 将list(K-V对)封装成json格式</span></span><br><span class="line"><span class="comment">-- 原型 : JSON_OBJECT([key, val[, key, val] ...])</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line">mysql&gt; <span class="keyword">select</span> json_object(<span class="string">"name"</span>, <span class="string">"jery"</span>, <span class="string">"email"</span>, <span class="string">"jery@163.com"</span>, <span class="string">"age"</span>,<span class="number">33</span>);</span><br><span class="line">+<span class="comment">----------------------------------------------------------------+</span></span><br><span class="line">| json_object("name", "jery", "email", "jery@163.com", "age",33) |</span><br><span class="line">+<span class="comment">----------------------------------------------------------------+</span></span><br><span class="line">| &#123;"age": 33, "name": "jery", "email": "jery@163.com"&#125;           |  -- 封装成了K-V对</span><br><span class="line">+<span class="comment">----------------------------------------------------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">user</span> <span class="keyword">values</span> ( </span><br><span class="line">    -&gt; <span class="literal">null</span>,</span><br><span class="line">    -&gt; json_object(<span class="string">"name"</span>, <span class="string">"jery"</span>, <span class="string">"email"</span>, <span class="string">"jery@163.com"</span>, <span class="string">"age"</span>,<span class="number">33</span>)  <span class="comment">-- 进行封装</span></span><br><span class="line">    -&gt; );</span><br><span class="line">Query OK, 1 row affected (0.03 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from user;</span><br><span class="line">+<span class="comment">-----+------------------------------------------------------+</span></span><br><span class="line">| uid | data                                                 |</span><br><span class="line">+<span class="comment">-----+------------------------------------------------------+</span></span><br><span class="line">|   1 | &#123;"age": 18, "name": "tom", "address": "SZ"&#125;          |</span><br><span class="line">|   2 | &#123;"age": 28, "mail": "jim@163.com", "name": "jim"&#125;    |</span><br><span class="line">|   4 | &#123;"age": 33, "name": "jery", "email": "jery@163.com"&#125; |</span><br><span class="line">+<span class="comment">-----+------------------------------------------------------+</span></span><br><span class="line">3 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- json_insert 插入数据</span></span><br><span class="line"><span class="comment">-- 原型 : JSON_INSERT(json_doc, path, val[, path, val] ...)</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line">mysql&gt; <span class="keyword">set</span> @j = <span class="string">'&#123; "a": 1, "b": [2, 3]&#125;'</span>;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select json_insert(@j, '$.a', 10, '$.c', '[true, false]');                 </span><br><span class="line">+<span class="comment">----------------------------------------------------+</span></span><br><span class="line">| json_insert(@j, '$.a', 10, '$.c', '[true, false]') |</span><br><span class="line">+<span class="comment">----------------------------------------------------+</span></span><br><span class="line">| &#123;"a": 1, "b": [2, 3], "c": "[true, false]"&#125;        |  -- a还是=1，存在的被忽略，不受影响</span><br><span class="line">+<span class="comment">----------------------------------------------------+  -- c之前不存在，则插入</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">update</span> <span class="keyword">user</span> <span class="keyword">set</span> <span class="keyword">data</span> = json_insert(<span class="keyword">data</span>, <span class="string">"$.address_2"</span>, <span class="string">"BJ"</span>) <span class="keyword">where</span> uid = <span class="number">1</span>;  <span class="comment">-- 插入 addres_2</span></span><br><span class="line">Query OK, 1 row affected (0.03 sec)</span><br><span class="line">Rows matched: 1  Changed: 1  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from user;</span><br><span class="line">+<span class="comment">-----+----------------------------------------------------------------+</span></span><br><span class="line">| uid | data                                                           |</span><br><span class="line">+<span class="comment">-----+----------------------------------------------------------------+</span></span><br><span class="line">|   1 | &#123;"age": 18, "name": "tom", "address": "SZ", "address_2": "BJ"&#125; |  -- 增加了addres_2 : "BJ"</span><br><span class="line">|   2 | &#123;"age": 28, "mail": "jim@163.com", "name": "jim"&#125;              |</span><br><span class="line">|   4 | &#123;"age": 33, "name": "jery", "email": "jery@163.com"&#125;           |</span><br><span class="line">+<span class="comment">-----+----------------------------------------------------------------+</span></span><br><span class="line">3 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- json_merge 合并数据并返回。注意：原数据不受影响</span></span><br><span class="line"><span class="comment">-- 原型 : JSON_MERGE(json_doc, json_doc[, json_doc] ...)</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line">mysql&gt; <span class="keyword">select</span> json_merge(<span class="string">'&#123;"name": "x"&#125;'</span>, <span class="string">'&#123;"id": 47&#125;'</span>);    <span class="comment">-- 原来有两个JSON             </span></span><br><span class="line">+<span class="comment">-------------------------------------------+</span></span><br><span class="line">| json_merge('&#123;"name": "x"&#125;', '&#123;"id": 47&#125;') |</span><br><span class="line">+<span class="comment">-------------------------------------------+</span></span><br><span class="line">| &#123;"id": 47, "name": "x"&#125;                   |  -- 合并多个JSON</span><br><span class="line">+<span class="comment">-------------------------------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> </span><br><span class="line">    -&gt; json_merge(</span><br><span class="line">    -&gt; json_extract(<span class="keyword">data</span>, <span class="string">'$.address'</span>),      <span class="comment">-- json 1</span></span><br><span class="line">    -&gt; json_extract(<span class="keyword">data</span>, <span class="string">'$.address_2'</span>))    <span class="comment">-- jons 2</span></span><br><span class="line">    -&gt; <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> uid = <span class="number">1</span>;</span><br><span class="line">+<span class="comment">---------------------------------------------------------------------------------+</span></span><br><span class="line">| json_merge( json_extract(data, '$.address'), json_extract(data, '$.address_2')) |</span><br><span class="line">+<span class="comment">---------------------------------------------------------------------------------+</span></span><br><span class="line">| ["SZ", "BJ"]                                                                    |  <span class="comment">-- 合并成一个json</span></span><br><span class="line">+<span class="comment">---------------------------------------------------------------------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- json_array_append 追加数据</span></span><br><span class="line"><span class="comment">-- 原型 : JSON_ARRAY_APPEND(json_doc, path, val[, path, val] ...) </span></span><br><span class="line"><span class="comment">-- json_append 在5.7.9 中重命名为 json_array_append</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line">mysql&gt; <span class="keyword">set</span> @j = <span class="string">'["a", ["b", "c"], "d"]'</span>;     <span class="comment">-- 下标为1的元素中只有["b", "c"]</span></span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select json_array_append(@j, '$[1]', 1);                       </span><br><span class="line">+<span class="comment">----------------------------------+</span></span><br><span class="line">| json_array_append(@j, '$[1]', 1) |</span><br><span class="line">+<span class="comment">----------------------------------+</span></span><br><span class="line">| ["a", ["b", "c", 1], "d"]        |    <span class="comment">--  现在插入了 数字 1</span></span><br><span class="line">+<span class="comment">----------------------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line">mysql&gt; <span class="keyword">update</span> <span class="keyword">user</span> <span class="keyword">set</span> <span class="keyword">data</span> = json_array_append(</span><br><span class="line">    -&gt; <span class="keyword">data</span>,</span><br><span class="line">    -&gt; <span class="string">'$.address'</span>,</span><br><span class="line">    -&gt; json_extract(<span class="keyword">data</span>, <span class="string">'$.address_2'</span>))</span><br><span class="line">    -&gt; <span class="keyword">where</span> uid = <span class="number">1</span>;</span><br><span class="line">Query OK, 1 row affected (0.02 sec)</span><br><span class="line">Rows matched: 1  Changed: 1  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from user;</span><br><span class="line">+<span class="comment">-----+------------------------------------------------------------------------+</span></span><br><span class="line">| uid | data                                                                   |</span><br><span class="line">+<span class="comment">-----+------------------------------------------------------------------------+</span></span><br><span class="line">|   1 | &#123;"age": 18, "name": "tom", "address": ["SZ", "BJ"], "address_2": "BJ"&#125; | --address_2追加到address</span><br><span class="line">|   2 | &#123;"age": 28, "mail": "jim@163.com", "name": "jim"&#125;                      |</span><br><span class="line">|   4 | &#123;"age": 33, "name": "jery", "email": "jery@163.com"&#125;                   |</span><br><span class="line">+<span class="comment">-----+------------------------------------------------------------------------+</span></span><br><span class="line">3 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- json_remove 从json记录中删除数据</span></span><br><span class="line"><span class="comment">-- 原型 : JSON_REMOVE(json_doc, path[, path] ...)</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line">mysql&gt; <span class="keyword">set</span> @j = <span class="string">'["a", ["b", "c"], "d"]'</span>;   </span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select json_remove(@j, '$[1]');</span><br><span class="line">+<span class="comment">-------------------------+</span></span><br><span class="line">| json_remove(@j, '$[1]') |</span><br><span class="line">+<span class="comment">-------------------------+</span></span><br><span class="line">| ["a", "d"]              |  <span class="comment">-- 删除了下标为1的元素["b", "c"]</span></span><br><span class="line">+<span class="comment">-------------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">update</span> <span class="keyword">user</span> <span class="keyword">set</span> <span class="keyword">data</span> = json_remove(<span class="keyword">data</span>, <span class="string">"$.address_2"</span>) <span class="keyword">where</span> uid = <span class="number">1</span>;</span><br><span class="line">Query OK, 1 row affected (0.03 sec)</span><br><span class="line">Rows matched: 1  Changed: 1  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from user;</span><br><span class="line">+<span class="comment">-----+------------------------------------------------------+</span></span><br><span class="line">| uid | data                                                 |</span><br><span class="line">+<span class="comment">-----+------------------------------------------------------+</span></span><br><span class="line">|   1 | &#123;"age": 18, "name": "tom", "address": ["SZ", "BJ"]&#125;  |  -- address_2 的字段删除了</span><br><span class="line">|   2 | &#123;"age": 28, "mail": "jim@163.com", "name": "jim"&#125;    |</span><br><span class="line">|   4 | &#123;"age": 33, "name": "jery", "email": "jery@163.com"&#125; |</span><br><span class="line">+<span class="comment">-----+------------------------------------------------------+</span></span><br><span class="line">3 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<blockquote>
<p><a href="http://dev.mysql.com/doc/refman/5.7/en/json-function-reference.html" target="_blank" rel="noopener">官方文档(JSON函数)</a></p>
</blockquote>
<h4 id="5-3-JSON创建索引"><a href="#5-3-JSON创建索引" class="headerlink" title="5.3 JSON创建索引"></a>5.3 JSON创建索引</h4><p><code>JSON</code>类型数据本身<code>无法直接</code>创建索引，需要将需要索引的<code>JSON数据</code>重新<code>生成虚拟列(Virtual Columns)</code>之后，对<code>该列</code>进行<code>索引</code></p>
<blockquote>
<p><a href="https://dev.mysql.com/doc/refman/5.7/en/create-table.html#create-table-secondary-indexes-virtual-columns" target="_blank" rel="noopener">官方文档–JSON创建索引</a></p>
</blockquote>
<ul>
<li><p><strong>新建表时创建JSON索引</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create table test_inex_1(</span><br><span class="line">    -&gt; data json,</span><br><span class="line">    -&gt; gen_col varchar(10) generated always as (json_extract(data, '$.name')),  -- 抽取data中的name， 生成新的一列，名字为gen_col</span><br><span class="line">    -&gt; index idx (gen_col)  -- 将gen_col 作为索引</span><br><span class="line">    -&gt; );</span><br><span class="line">Query OK, 0 rows affected (0.13 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; show create table test_index_1；</span><br><span class="line"><span class="comment">-- -----省略表格线-----</span></span><br><span class="line">| test_index_1 | <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`test_index_1`</span> (</span><br><span class="line">  <span class="string">`data`</span> <span class="keyword">json</span> <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`gen_col`</span> <span class="built_in">varchar</span>(<span class="number">10</span>) <span class="keyword">GENERATED</span> <span class="keyword">ALWAYS</span> <span class="keyword">AS</span> (json_extract(<span class="keyword">data</span>, <span class="string">'$.name'</span>)) <span class="keyword">VIRTUAL</span>,</span><br><span class="line">  <span class="keyword">KEY</span> <span class="string">`idx`</span> (<span class="string">`gen_col`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8mb4 |</span><br><span class="line"><span class="comment">-- -----省略表格线-----</span></span><br><span class="line"><span class="number">1</span> <span class="keyword">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">insert</span> <span class="keyword">into</span> test_index_1(<span class="keyword">data</span>) <span class="keyword">values</span> (<span class="string">'&#123;"name":"tom", "age":18, "address":"SH"&#125;'</span>);</span><br><span class="line">Query OK, 1 row affected (0.04 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into test_index_1(data) values ('&#123;"name":"jim", "age":28, "address":"SZ"&#125;');      </span><br><span class="line">Query OK, 1 row affected (0.03 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from test_index_1;</span><br><span class="line">+<span class="comment">---------------------------------------------+---------+</span></span><br><span class="line">| data                                        | gen_col |</span><br><span class="line">+<span class="comment">---------------------------------------------+---------+</span></span><br><span class="line">| &#123;"age": 18, "name": "tom", "address": "SH"&#125; | "tom"   |</span><br><span class="line">| &#123;"age": 28, "name": "jim", "address": "SZ"&#125; | "jim"   |</span><br><span class="line">+<span class="comment">---------------------------------------------+---------+</span></span><br><span class="line">2 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> json_extract(<span class="keyword">data</span>,<span class="string">"$.name"</span>) <span class="keyword">as</span> username <span class="keyword">from</span> test_index_1 <span class="keyword">where</span> gen_col=<span class="string">"tom"</span>;  <span class="comment">-- 如果这样做，为空，原因如下</span></span><br><span class="line">Empty <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> <span class="keyword">hex</span>(<span class="string">'"'</span>);</span><br><span class="line">+<span class="comment">----------+</span></span><br><span class="line">| hex('"') |</span><br><span class="line">+<span class="comment">----------+</span></span><br><span class="line">| 22       |  <span class="comment">-- 双引号的 16进制</span></span><br><span class="line">+<span class="comment">----------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> <span class="keyword">hex</span>(gen_col) <span class="keyword">from</span> test_index_1;</span><br><span class="line">+<span class="comment">--------------+</span></span><br><span class="line">| hex(gen_col) |</span><br><span class="line">+<span class="comment">--------------+</span></span><br><span class="line">| 226A696D22   |  <span class="comment">-- 双引号本身也作为了存储内容</span></span><br><span class="line">| 22746F6D22   |</span><br><span class="line">+<span class="comment">--------------+</span></span><br><span class="line">2 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> json_extract(<span class="keyword">data</span>,<span class="string">"$.name"</span>) <span class="keyword">as</span> username <span class="keyword">from</span> test_index_1 <span class="keyword">where</span> gen_col=<span class="string">'"tom"'</span>;  <span class="comment">-- 使用'"tome"',用单引号括起来</span></span><br><span class="line">+<span class="comment">----------+</span></span><br><span class="line">| username |</span><br><span class="line">+<span class="comment">----------+</span></span><br><span class="line">| "tom"    |  <span class="comment">-- 找到了对应的数据</span></span><br><span class="line">+<span class="comment">----------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">explain</span> <span class="keyword">select</span> json_extract(<span class="keyword">data</span>,<span class="string">"$.name"</span>) <span class="keyword">as</span> username <span class="keyword">from</span> test_index_1 <span class="keyword">where</span> gen_col=<span class="string">'"tom"'</span>\G</span><br><span class="line">*************************** <span class="number">1.</span> <span class="keyword">row</span> ***************************</span><br><span class="line">           <span class="keyword">id</span>: <span class="number">1</span></span><br><span class="line">  select_type: SIMPLE</span><br><span class="line">        <span class="keyword">table</span>: test_index_1</span><br><span class="line">   <span class="keyword">partitions</span>: <span class="literal">NULL</span></span><br><span class="line">         <span class="keyword">type</span>: <span class="keyword">ref</span> </span><br><span class="line">possible_keys: idx    <span class="comment">-- 使用了 key idx</span></span><br><span class="line">          <span class="keyword">key</span>: idx</span><br><span class="line">      key_len: <span class="number">43</span></span><br><span class="line">          <span class="keyword">ref</span>: const</span><br><span class="line">         <span class="keyword">rows</span>: <span class="number">1</span></span><br><span class="line">     filtered: <span class="number">100.00</span></span><br><span class="line">        Extra: <span class="literal">NULL</span></span><br><span class="line"><span class="number">1</span> <span class="keyword">row</span> <span class="keyword">in</span> <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">---</span></span><br><span class="line"><span class="comment">--- 建立表的时候去掉双引用</span></span><br><span class="line"><span class="comment">---</span></span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">create</span> <span class="keyword">table</span> test_index_2 (</span><br><span class="line">    -&gt; <span class="keyword">data</span> <span class="keyword">json</span>,</span><br><span class="line">    -&gt; gen_col <span class="built_in">varchar</span>(<span class="number">10</span>) <span class="keyword">generated</span> <span class="keyword">always</span> <span class="keyword">as</span> (</span><br><span class="line">    -&gt;    json_unquote(    <span class="comment">-- 使用json_unquote函数进行去掉双引号</span></span><br><span class="line">    -&gt;             json_extract(<span class="keyword">data</span>, <span class="string">"$.name"</span>)</span><br><span class="line">    -&gt;    )),</span><br><span class="line">    -&gt; <span class="keyword">key</span> idx(gen_col)</span><br><span class="line">    -&gt; );</span><br><span class="line">Query OK, 0 rows affected (0.13 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; show create table test_index_2;</span><br><span class="line"><span class="comment">-- -----省略表格线-----</span></span><br><span class="line">| test_index_2 | <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`test_index_2`</span> (</span><br><span class="line">  <span class="string">`data`</span> <span class="keyword">json</span> <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`gen_col`</span> <span class="built_in">varchar</span>(<span class="number">10</span>) <span class="keyword">GENERATED</span> <span class="keyword">ALWAYS</span> <span class="keyword">AS</span> (json_unquote(</span><br><span class="line">            json_extract(<span class="keyword">data</span>, <span class="string">"$.name"</span>)</span><br><span class="line">   )) <span class="keyword">VIRTUAL</span>,</span><br><span class="line">  <span class="keyword">KEY</span> <span class="string">`idx`</span> (<span class="string">`gen_col`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8mb4 |</span><br><span class="line"><span class="comment">-- -----省略表格线-----</span></span><br><span class="line"><span class="number">1</span> <span class="keyword">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">insert</span> <span class="keyword">into</span> test_index_2(<span class="keyword">data</span>) <span class="keyword">values</span> (<span class="string">'&#123;"name":"tom", "age":18, "address":"SH"&#125;'</span>);</span><br><span class="line">Query OK, 1 row affected (0.03 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into test_index_2(data) values ('&#123;"name":"jim", "age":28, "address":"SZ"&#125;');</span><br><span class="line">Query OK, 1 row affected (0.02 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select json_extract(data,"$.name") as username from test_index_2 where gen_col="tom";  -- 未加单引号</span><br><span class="line">+<span class="comment">----------+</span></span><br><span class="line">| username |</span><br><span class="line">+<span class="comment">----------+</span></span><br><span class="line">| "tom"    |  <span class="comment">-- 可以找到数据</span></span><br><span class="line">+<span class="comment">----------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">explain</span> <span class="keyword">select</span> json_extract(<span class="keyword">data</span>,<span class="string">"$.name"</span>) <span class="keyword">as</span> username <span class="keyword">from</span> test_index_2 <span class="keyword">where</span> gen_col=<span class="string">"tom"</span>\G</span><br><span class="line">*************************** <span class="number">1.</span> <span class="keyword">row</span> ***************************</span><br><span class="line">           <span class="keyword">id</span>: <span class="number">1</span></span><br><span class="line">  select_type: SIMPLE</span><br><span class="line">        <span class="keyword">table</span>: test_index_2</span><br><span class="line">   <span class="keyword">partitions</span>: <span class="literal">NULL</span></span><br><span class="line">         <span class="keyword">type</span>: <span class="keyword">ref</span></span><br><span class="line">possible_keys: idx   <span class="comment">-- 使用了 key idx</span></span><br><span class="line">          <span class="keyword">key</span>: idx</span><br><span class="line">      key_len: <span class="number">43</span></span><br><span class="line">          <span class="keyword">ref</span>: const</span><br><span class="line">         <span class="keyword">rows</span>: <span class="number">1</span></span><br><span class="line">     filtered: <span class="number">100.00</span></span><br><span class="line">        Extra: <span class="literal">NULL</span></span><br><span class="line"><span class="number">1</span> <span class="keyword">row</span> <span class="keyword">in</span> <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>修改已存在的表创建JSON索引</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- 使用之前的user表操作</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line">mysql&gt; show create table user;</span><br><span class="line"><span class="comment">-- -----省略表格线-----</span></span><br><span class="line">| user  | <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`user`</span> (</span><br><span class="line">  <span class="string">`uid`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`data`</span> <span class="keyword">json</span> <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`uid`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> AUTO_INCREMENT=<span class="number">5</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8mb4 |</span><br><span class="line"><span class="comment">-- -----省略表格线-----</span></span><br><span class="line"><span class="number">1</span> <span class="keyword">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">user</span>;</span><br><span class="line">+<span class="comment">-----+------------------------------------------------------+</span></span><br><span class="line">| uid | data                                                 |</span><br><span class="line">+<span class="comment">-----+------------------------------------------------------+</span></span><br><span class="line">|   1 | &#123;"age": 18, "name": "tom", "address": ["SZ", "BJ"]&#125;  |</span><br><span class="line">|   2 | &#123;"age": 28, "mail": "jim@163.com", "name": "jim"&#125;    |</span><br><span class="line">|   4 | &#123;"age": 33, "name": "jery", "email": "jery@163.com"&#125; |</span><br><span class="line">+<span class="comment">-----+------------------------------------------------------+</span></span><br><span class="line"></span><br><span class="line">mysql&gt; alter table user </span><br><span class="line">    -&gt; add user_name varchar(32)</span><br><span class="line">    -&gt; generated always as (json_extract(data,"$.name")) virtual;</span><br><span class="line">Query OK, 0 rows affected (0.05 sec)</span><br><span class="line">Records: 0  Duplicates: 0  Warnings: 0</span><br><span class="line"><span class="comment">-- virtual 关键字是不将该列的字段值存储，对应的是stored</span></span><br><span class="line"></span><br><span class="line">mysql&gt; select user_name from user;  </span><br><span class="line">+<span class="comment">-----------+</span></span><br><span class="line">| user_name |</span><br><span class="line">+<span class="comment">-----------+</span></span><br><span class="line">| "tom"     |</span><br><span class="line">| "jim"     |</span><br><span class="line">| "jery"    |</span><br><span class="line">+<span class="comment">-----------+</span></span><br><span class="line">3 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">alter</span> <span class="keyword">table</span> <span class="keyword">user</span> <span class="keyword">add</span> <span class="keyword">index</span> idx(user_name);          </span><br><span class="line">Query OK, 0 rows affected (0.13 sec)</span><br><span class="line">Records: 0  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from user where user_name='"tom"';  -- 加单引号</span><br><span class="line">+<span class="comment">-----+-----------------------------------------------------+-----------+</span></span><br><span class="line">| uid | data                                                | user_name |</span><br><span class="line">+<span class="comment">-----+-----------------------------------------------------+-----------+</span></span><br><span class="line">|   1 | &#123;"age": 18, "name": "tom", "address": ["SZ", "BJ"]&#125; | "tom"     |</span><br><span class="line">+<span class="comment">-----+-----------------------------------------------------+-----------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">explain</span> <span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">user</span> <span class="keyword">where</span> user_name=<span class="string">'"tom"'</span>\G</span><br><span class="line">*************************** <span class="number">1.</span> <span class="keyword">row</span> ***************************</span><br><span class="line">           <span class="keyword">id</span>: <span class="number">1</span></span><br><span class="line">  select_type: SIMPLE</span><br><span class="line">        <span class="keyword">table</span>: <span class="keyword">user</span></span><br><span class="line">   <span class="keyword">partitions</span>: <span class="literal">NULL</span></span><br><span class="line">         <span class="keyword">type</span>: <span class="keyword">ref</span></span><br><span class="line">possible_keys: idx   <span class="comment">-- 使用了 key idx</span></span><br><span class="line">          <span class="keyword">key</span>: idx</span><br><span class="line">      key_len: <span class="number">131</span></span><br><span class="line">          <span class="keyword">ref</span>: const</span><br><span class="line">         <span class="keyword">rows</span>: <span class="number">1</span></span><br><span class="line">     filtered: <span class="number">100.00</span></span><br><span class="line">        Extra: <span class="literal">NULL</span></span><br><span class="line"><span class="number">1</span> <span class="keyword">row</span> <span class="keyword">in</span> <span class="keyword">set</span>, <span class="number">1</span> <span class="keyword">warning</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">show</span> <span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">user</span>;</span><br><span class="line"><span class="comment">-- -----省略表格线-----</span></span><br><span class="line">| user  | <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`user`</span> (</span><br><span class="line">  <span class="string">`uid`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`data`</span> <span class="keyword">json</span> <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`user_name`</span> <span class="built_in">varchar</span>(<span class="number">32</span>) <span class="keyword">GENERATED</span> <span class="keyword">ALWAYS</span> <span class="keyword">AS</span> (json_extract(<span class="keyword">data</span>,<span class="string">"$.name"</span>)) <span class="keyword">VIRTUAL</span>,</span><br><span class="line">  <span class="string">`user_name2`</span> <span class="built_in">varchar</span>(<span class="number">32</span>) <span class="keyword">GENERATED</span> <span class="keyword">ALWAYS</span> <span class="keyword">AS</span> (json_extract(<span class="keyword">data</span>,<span class="string">"$.name"</span>)) <span class="keyword">VIRTUAL</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`uid`</span>),</span><br><span class="line">  <span class="keyword">KEY</span> <span class="string">`idx`</span> (<span class="string">`user_name`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> AUTO_INCREMENT=<span class="number">5</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8mb4 |</span><br><span class="line"><span class="comment">-- -----省略表格线-----</span></span><br><span class="line"><span class="number">1</span> <span class="keyword">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<hr>
<h2 id="二-附录"><a href="#二-附录" class="headerlink" title="二. 附录"></a>二. 附录</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- 老师演示JSON的SQL</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> <span class="keyword">if</span> <span class="keyword">exists</span> <span class="keyword">User</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="keyword">User</span> (</span><br><span class="line">    uid <span class="built_in">BIGINT</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT PRIMARY <span class="keyword">KEY</span>,</span><br><span class="line">    <span class="keyword">name</span> <span class="built_in">VARCHAR</span>(<span class="number">32</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">    email <span class="built_in">VARCHAR</span>(<span class="number">256</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">    address <span class="built_in">VARCHAR</span>(<span class="number">512</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">    <span class="keyword">UNIQUE</span> <span class="keyword">KEY</span> (<span class="keyword">name</span>),</span><br><span class="line">    <span class="keyword">UNIQUE</span> <span class="keyword">KEY</span> (email)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">User</span> <span class="keyword">VALUES</span> (<span class="literal">NULL</span>,<span class="string">'David'</span>,<span class="string">'david@gmail'</span>,<span class="string">'Shanghai ...'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">User</span> <span class="keyword">VALUES</span> (<span class="literal">NULL</span>,<span class="string">'Amy'</span>,<span class="string">'amy@gmail'</span>,<span class="string">'Beijing ...'</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">User</span> <span class="keyword">VALUES</span> (<span class="literal">NULL</span>,<span class="string">'Tom'</span>,<span class="string">'tom@gmail'</span>,<span class="string">'Guangzhou ...'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">User</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="keyword">User</span> <span class="keyword">ADD</span> <span class="keyword">COLUMN</span> address2 <span class="built_in">VARCHAR</span>(<span class="number">512</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>;</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> <span class="keyword">User</span> <span class="keyword">ADD</span> <span class="keyword">COLUMN</span> passport <span class="built_in">VARCHAR</span>(<span class="number">64</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> UserJson;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> UserJson(</span><br><span class="line">	uid <span class="built_in">BIGINT</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT PRIMARY <span class="keyword">KEY</span>,</span><br><span class="line">    <span class="keyword">data</span> <span class="keyword">JSON</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">truncate</span> <span class="keyword">table</span> UserJson;</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> UserJson </span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">    uid,JSON_OBJECT(<span class="string">'name'</span>,<span class="keyword">name</span>,<span class="string">'email'</span>,email,<span class="string">'address'</span>,address) <span class="keyword">AS</span> <span class="keyword">data</span></span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">    <span class="keyword">User</span>;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> UserJson; </span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> uid,JSON_EXTRACT(<span class="keyword">data</span>,<span class="string">'$.address2'</span>) <span class="keyword">from</span> UserJson;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">UPDATE</span> UserJson</span><br><span class="line"><span class="keyword">set</span> <span class="keyword">data</span> = json_insert(<span class="keyword">data</span>,<span class="string">"$.address2"</span>,<span class="string">"HangZhou ..."</span>)</span><br><span class="line"><span class="keyword">where</span> uid = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> JSON_EXTRACT(<span class="keyword">data</span>,<span class="string">'$.address[1]'</span>) <span class="keyword">from</span> UserJson;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> json_merge(JSON_EXTRACT(<span class="keyword">data</span>,<span class="string">'$.address'</span>) ,JSON_EXTRACT(<span class="keyword">data</span>,<span class="string">'$.address2'</span>)) </span><br><span class="line"><span class="keyword">from</span> UserJson;</span><br><span class="line"></span><br><span class="line"><span class="keyword">begin</span>;</span><br><span class="line"><span class="keyword">UPDATE</span> UserJson</span><br><span class="line"><span class="keyword">set</span> <span class="keyword">data</span> = json_array_append(<span class="keyword">data</span>,<span class="string">"$.address"</span>,JSON_EXTRACT(<span class="keyword">data</span>,<span class="string">'$.address2'</span>))</span><br><span class="line"><span class="keyword">where</span> JSON_EXTRACT(<span class="keyword">data</span>,<span class="string">'$.address2'</span>) <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">AND</span> uid &gt;<span class="number">0</span>;</span><br><span class="line"><span class="keyword">select</span> JSON_EXTRACT(<span class="keyword">data</span>,<span class="string">'$.address'</span>) <span class="keyword">from</span> UserJson;</span><br><span class="line"><span class="keyword">UPDATE</span> UserJson</span><br><span class="line"><span class="keyword">set</span> <span class="keyword">data</span> = JSON_REMOVE(<span class="keyword">data</span>,<span class="string">'$.address2'</span>)</span><br><span class="line"><span class="keyword">where</span> uid&gt;<span class="number">0</span>;</span><br><span class="line"><span class="keyword">commit</span>;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://chenwenning.github.io/2018/05/31/MySQL学习笔记(Day008)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="陈汶宁">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://pic.qqtn.com/up/2017-10/2017101317054482087.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CHENWENNING BLOG">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/31/MySQL学习笔记(Day008)/" itemprop="url">MySQL学习笔记（Day008：数据类型）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-05-31T17:30:16+08:00">
                2018-05-31
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/mysql/" itemprop="url" rel="index">
                    <span itemprop="name">mysql</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/05/31/MySQL学习笔记(Day008)/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2018/05/31/MySQL学习笔记(Day008)/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="MySQL学习笔记（Day008：数据类型）"><a href="#MySQL学习笔记（Day008：数据类型）" class="headerlink" title="MySQL学习笔记（Day008：数据类型）"></a>MySQL学习笔记（Day008：数据类型）</h1><p>@(MySQL学习)</p>
<p>[TOC]</p>
<h2 id="一-INT类型"><a href="#一-INT类型" class="headerlink" title="一. INT类型"></a>一. INT类型</h2><h3 id="1-INT类型的分类"><a href="#1-INT类型的分类" class="headerlink" title="1. INT类型的分类"></a>1. INT类型的分类</h3><ul>
<li><p><strong>TINYINT</strong></p>
<ul>
<li>存储空间 ： 1 字节</li>
<li>取值范围 <ul>
<li>有符号(signed) ：  [-128, 127]</li>
<li>无符号(unsigned) ：[0, 255]</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>SMALLINT</strong></p>
<ul>
<li>存储空间 ： 2 字节</li>
<li>取值范围 <ul>
<li>有符号(signed) ：  [-32768, 32767]</li>
<li>无符号(unsigned) ：[0, 65535]</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>MEDIUMINT</strong></p>
<ul>
<li>存储空间 ： 3 字节</li>
<li>取值范围 <ul>
<li>有符号(signed) ：  [-8388608, 8388607]</li>
<li>无符号(unsigned) ：[0, 16777215]</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>INT</strong></p>
<ul>
<li>存储空间 ： 4 字节</li>
<li>取值范围 <ul>
<li>有符号(signed) ：  [-2147483648, 2147483647]</li>
<li>无符号(unsigned) ：[0, 4294967295]</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>BIGINT</strong></p>
<ul>
<li>存储空间 ： 8 字节</li>
<li>取值范围 <ul>
<li>有符号(signed) ：  [-9223372036854775808, 9223372036854775807]</li>
<li>无符号(unsigned) ：[0, 18446744073709551615]</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="2-INT类型的使用"><a href="#2-INT类型的使用" class="headerlink" title="2. INT类型的使用"></a>2. INT类型的使用</h3><ul>
<li><p><strong>自增长ID</strong></p>
<ul>
<li><code>推荐</code>使用<code>BIGINT</code>，而不是INT；</li>
</ul>
</li>
<li><p><strong>unsigned or signed</strong></p>
<ul>
<li>根据实际情况使用，一般情况下推荐<code>默认</code>的<code>sigend</code></li>
<li>unsigned 的注意事项</li>
</ul>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create table test_unsigned(a int unsigned, b int unsigned);</span><br><span class="line">Query OK, 0 rows affected (0.14 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into test_unsigned values(1, 2);</span><br><span class="line">Query OK, 1 row affected (0.03 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select a - b from test_unsigned;</span><br><span class="line">ERROR 1690 (22003): BIGINT UNSIGNED value is out of range in '(`burn_test`.`test_unsigned`.`a` - `burn_test`.`test_unsigned`.`b`)'</span><br><span class="line"></span><br><span class="line">mysql&gt; select b - a from test_unsigned;   </span><br><span class="line">+<span class="comment">-------+</span></span><br><span class="line">| b - a |</span><br><span class="line">+<span class="comment">-------+</span></span><br><span class="line">|     1 |</span><br><span class="line">+<span class="comment">-------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">set</span> sql_mode = <span class="string">'no_unsigned_subtraction'</span>; <span class="comment">-- 这样就可以得到负数</span></span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select a - b from test_unsigned;</span><br><span class="line">+<span class="comment">-------+</span></span><br><span class="line">| a - b |</span><br><span class="line">+<span class="comment">-------+</span></span><br><span class="line">|    -1 |</span><br><span class="line">+<span class="comment">-------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>一般情况下使用<code>int</code>时，推荐有符号数<code>(signed)</code>， 使用无符号数只是比原来多一倍的取值，数量级上没有改变。</p>
</blockquote>
<blockquote>
<p>如果需要取值范围很大，直接选择用<code>BIGINT</code></p>
</blockquote>
<h3 id="3-INT-N"><a href="#3-INT-N" class="headerlink" title="3. INT(N)"></a>3. INT(N)</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show create table  test_unsigned;</span><br><span class="line">+<span class="comment">---------------+-------------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br><span class="line">| Table         | <span class="keyword">Create</span> <span class="keyword">Table</span>                                                                                                                                    |</span><br><span class="line">+<span class="comment">---------------+-------------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br><span class="line">| test_unsigned | <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`test_unsigned`</span> (</span><br><span class="line">  <span class="string">`a`</span> <span class="built_in">int</span>(<span class="number">10</span>) <span class="keyword">unsigned</span> <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>, </span><br><span class="line">  <span class="string">`b`</span> <span class="built_in">int</span>(<span class="number">10</span>) <span class="keyword">unsigned</span> <span class="keyword">DEFAULT</span> <span class="literal">NULL</span></span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8mb4 |</span><br><span class="line">+<span class="comment">---------------+-------------------------------------------------------------------------------------------------------------------------------------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="keyword">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>int(N) 和 zerofill</strong><ul>
<li>int(<strong>N</strong>)中的<code>N</code>是显示宽度，<code>不表示</code>存储的数字的<code>长度</code>的上限。</li>
<li><code>zerofill</code>表示当存储的数字<code>长度 &lt; N</code>时，用<code>数字0</code>填充左边，直至补满长度<code>N</code></li>
<li>当存储数字的长度<code>超过N时</code>，按照<code>实际存储</code>的数字显示</li>
</ul>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create  table  test_int_n(a int(3) zerofill);  -- 显示宽度N=3</span><br><span class="line">Query OK, 0 rows affected (0.11 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into test_int_n values(1);</span><br><span class="line">Query OK, 1 row affected (0.04 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from test_int_n;</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">| a    |</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">|  001 |   <span class="comment">-- 不满 N=3时，左边用0填充</span></span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">insert</span> <span class="keyword">into</span> test_int_n <span class="keyword">values</span>(<span class="number">1111</span>);</span><br><span class="line">Query OK, 1 row affected (0.03 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from test_int_n;</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">| a    |</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">|  001 |</span><br><span class="line">| 1111 |  <span class="comment">-- 超过N=3的长度时，是什么数字，显示什么数字</span></span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">2 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> a, <span class="keyword">HEX</span>(a) <span class="keyword">from</span> test_int_n\G</span><br><span class="line">*************************** <span class="number">1.</span> <span class="keyword">row</span> ***************************</span><br><span class="line">     a: <span class="number">001</span></span><br><span class="line"><span class="keyword">HEX</span>(a): <span class="number">1</span>    <span class="comment">-- 实际存储的还是1</span></span><br><span class="line">*************************** <span class="number">2.</span> <span class="keyword">row</span> ***************************</span><br><span class="line">     a: <span class="number">1111</span></span><br><span class="line"><span class="keyword">HEX</span>(a): <span class="number">457</span>  <span class="comment">-- 1111对应的16进制就是457</span></span><br><span class="line"><span class="number">2</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>int(N)中的<code>N</code>和<code>zerofill</code>配合才有意义，且仅仅是显示的时候才有意义，和实际存储没有关系，不会去截取数字的长度。</p>
</blockquote>
<h3 id="4-AUTO-INCREMENT"><a href="#4-AUTO-INCREMENT" class="headerlink" title="4. AUTO_INCREMENT"></a>4. AUTO_INCREMENT</h3><ul>
<li>自增</li>
<li>每张表一个</li>
<li>必须是索引的一部分</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create table test_auto_increment(a int auto_increment);</span><br><span class="line">ERROR 1075 (42000): Incorrect table definition; there can be only one auto column and it must be defined as a key</span><br><span class="line"><span class="comment">-- 没有指定为key，报错了</span></span><br><span class="line"></span><br><span class="line">mysql&gt; create table test_auto_increment(a int auto_increment primary key);  -- 指定为key后有效</span><br><span class="line">Query OK, 0 rows affected (0.11 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into test_auto_increment values(NULL);  -- 插入NULL值</span><br><span class="line">Query OK, 1 row affected (0.03 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from test_auto_increment;</span><br><span class="line">+<span class="comment">---+</span></span><br><span class="line">| a |</span><br><span class="line">+<span class="comment">---+</span></span><br><span class="line">| 1 |  <span class="comment">-- 插入NULL值，便可以让其自增，且默认从1开始</span></span><br><span class="line">+<span class="comment">---+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">insert</span> <span class="keyword">into</span> test_auto_increment <span class="keyword">values</span>(<span class="number">0</span>);  <span class="comment">-- 插入 0</span></span><br><span class="line">Query OK, 1 row affected (0.03 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from test_auto_increment;</span><br><span class="line">+<span class="comment">---+</span></span><br><span class="line">| a |</span><br><span class="line">+<span class="comment">---+</span></span><br><span class="line">| 1 |</span><br><span class="line">| 2 |  <span class="comment">-- 插入 0 ，自增长为2</span></span><br><span class="line">+<span class="comment">---+</span></span><br><span class="line">2 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">insert</span> <span class="keyword">into</span> test_auto_increment <span class="keyword">values</span>(<span class="number">-1</span>);  <span class="comment">-- 插入 -1</span></span><br><span class="line">Query OK, 1 row affected (0.02 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from test_auto_increment;</span><br><span class="line">+<span class="comment">----+</span></span><br><span class="line">| a  |</span><br><span class="line">+<span class="comment">----+</span></span><br><span class="line">| -1 |   <span class="comment">-- 刚刚插入的-1</span></span><br><span class="line">|  1 |</span><br><span class="line">|  2 |</span><br><span class="line">+<span class="comment">----+</span></span><br><span class="line">3 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">insert</span> <span class="keyword">into</span> test_auto_increment <span class="keyword">values</span>(<span class="literal">NULL</span>);  <span class="comment">-- 继续插入NULL</span></span><br><span class="line">Query OK, 1 row affected (0.02 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from test_auto_increment;</span><br><span class="line">+<span class="comment">----+</span></span><br><span class="line">| a  |</span><br><span class="line">+<span class="comment">----+</span></span><br><span class="line">| -1 |</span><br><span class="line">|  1 |</span><br><span class="line">|  2 |</span><br><span class="line">|  3 |  <span class="comment">-- 刚刚插入NULL， 自增为3</span></span><br><span class="line">+<span class="comment">----+</span></span><br><span class="line">4 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">insert</span> <span class="keyword">into</span> test_auto_increment <span class="keyword">values</span>(<span class="string">'0'</span>); <span class="comment">-- 插入字符0</span></span><br><span class="line">Query OK, 1 row affected (0.04 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from test_auto_increment;</span><br><span class="line">+<span class="comment">----+</span></span><br><span class="line">| a  |</span><br><span class="line">+<span class="comment">----+</span></span><br><span class="line">| -1 |</span><br><span class="line">|  1 |</span><br><span class="line">|  2 |</span><br><span class="line">|  3 |</span><br><span class="line">|  4 |  <span class="comment">-- 插入字符'0' 后， 自增长为4</span></span><br><span class="line">+<span class="comment">----+</span></span><br><span class="line">5 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">update</span> test_auto_increment <span class="keyword">set</span> a = <span class="number">0</span> <span class="keyword">where</span> a = <span class="number">-1</span>;  <span class="comment">-- 更新为0</span></span><br><span class="line">Query OK, 1 row affected (0.03 sec)</span><br><span class="line">Rows matched: 1  Changed: 1  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from test_auto_increment;</span><br><span class="line">+<span class="comment">---+</span></span><br><span class="line">| a |</span><br><span class="line">+<span class="comment">---+</span></span><br><span class="line">| 0 |  <span class="comment">-- 原来的 -1 更新为0</span></span><br><span class="line">| 1 |</span><br><span class="line">| 2 |</span><br><span class="line">| 3 |</span><br><span class="line">| 4 |</span><br><span class="line">+<span class="comment">---+</span></span><br><span class="line">5 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">--  数字 0 这个值比较特殊， 插入0和插入NULL的效果是一样的，都是代表自增</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-----</span></span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">insert</span> <span class="keyword">into</span> test_auto_increment <span class="keyword">values</span>(<span class="literal">NULL</span>), (<span class="number">100</span>), (<span class="literal">NULL</span>); </span><br><span class="line">Query OK, 3 rows affected (0.02 sec)</span><br><span class="line">Records: 3  Duplicates: 0  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from test_auto_increment;</span><br><span class="line">+<span class="comment">-----+</span></span><br><span class="line">| a   |</span><br><span class="line">+<span class="comment">-----+</span></span><br><span class="line">|   0 |</span><br><span class="line">|   1 |</span><br><span class="line">|   2 |</span><br><span class="line">|   3 |</span><br><span class="line">|   4 |</span><br><span class="line">|   5 | <span class="comment">-- 第一个NULL</span></span><br><span class="line">| 100 | <span class="comment">-- 100</span></span><br><span class="line">| 101 | <span class="comment">-- 第二个NULL, 按当前最大的值 +１来设置，之前是100，所以这里101</span></span><br><span class="line">+<span class="comment">-----+</span></span><br><span class="line">8 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">insert</span> <span class="keyword">into</span> test_auto_increment <span class="keyword">values</span>(<span class="number">99</span>); <span class="comment">-- 插入99</span></span><br><span class="line">Query OK, 1 row affected (0.02 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from test_auto_increment;</span><br><span class="line">+<span class="comment">-----+</span></span><br><span class="line">| a   |</span><br><span class="line">+<span class="comment">-----+</span></span><br><span class="line">|   0 |</span><br><span class="line">|   1 |</span><br><span class="line">|   2 |</span><br><span class="line">|   3 |</span><br><span class="line">|   4 |</span><br><span class="line">|   5 |</span><br><span class="line">|  99 |  <span class="comment">-- 刚刚插入的 99</span></span><br><span class="line">| 100 |</span><br><span class="line">| 101 |</span><br><span class="line">+<span class="comment">-----+</span></span><br><span class="line">9 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>AUTO_INCREMENT</code>是实例启动时，取当前表的最大值，然后 +1 即为下次自增的值。<code>（MAX + 1)</code></p>
</blockquote>
<blockquote>
<p><strong>TIPS:</strong><br><code>insert into tablename select NULL;</code> 等价与 <code>insert into tablename values (NULL);</code></p>
</blockquote>
<hr>
<h2 id="二-数字类型"><a href="#二-数字类型" class="headerlink" title="二. 数字类型"></a>二. 数字类型</h2><h3 id="1-数字类型的分类"><a href="#1-数字类型的分类" class="headerlink" title="1. 数字类型的分类"></a>1. 数字类型的分类</h3><ul>
<li><p>单精度类型：FLOAT</p>
<ul>
<li>存储空间：4 字节</li>
<li>精确性：低</li>
</ul>
</li>
<li><p>双精度类型：DOUBLE</p>
<ul>
<li>占用空间：8 字节</li>
<li>精确性：低，比FLOAT高</li>
</ul>
</li>
<li><p>高精度类型：DECIMAL</p>
<ul>
<li>占用空间：变长</li>
<li>精确性：非常高</li>
</ul>
</li>
</ul>
<p><strong>注意：财务系统<code>必须使用DECIMAL</code></strong></p>
<hr>
<h2 id="三-字符串类型"><a href="#三-字符串类型" class="headerlink" title="三. 字符串类型"></a>三. 字符串类型</h2><h3 id="1-字符串类型介绍"><a href="#1-字符串类型介绍" class="headerlink" title="1. 字符串类型介绍"></a>1. 字符串类型介绍</h3><table>
<thead>
<tr>
<th style="text-align:center">类型</th>
<th style="text-align:center">说明</th>
<th style="text-align:center">N的含义</th>
<th style="text-align:center">是否有字符集</th>
<th style="text-align:center">最大长度</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><code>CHAR(N)</code></td>
<td style="text-align:center">定长字符</td>
<td style="text-align:center">字符</td>
<td style="text-align:center">是</td>
<td style="text-align:center">255</td>
</tr>
<tr>
<td style="text-align:center"><code>VARCHAR(N)</code></td>
<td style="text-align:center">变长字符</td>
<td style="text-align:center">字符</td>
<td style="text-align:center">是</td>
<td style="text-align:center">16384</td>
</tr>
<tr>
<td style="text-align:center">BINARY(N)</td>
<td style="text-align:center">定长二进制字节</td>
<td style="text-align:center">字节</td>
<td style="text-align:center">否</td>
<td style="text-align:center">255</td>
</tr>
<tr>
<td style="text-align:center">VARBINARY(N)</td>
<td style="text-align:center">变长二进制字节</td>
<td style="text-align:center">字节</td>
<td style="text-align:center">否</td>
<td style="text-align:center">16384</td>
</tr>
<tr>
<td style="text-align:center">TINYBLOB(N)</td>
<td style="text-align:center">二进制大对象</td>
<td style="text-align:center">字节</td>
<td style="text-align:center">否</td>
<td style="text-align:center">256</td>
</tr>
<tr>
<td style="text-align:center">BLOB(N)</td>
<td style="text-align:center">二进制大对象</td>
<td style="text-align:center">字节</td>
<td style="text-align:center">否</td>
<td style="text-align:center">16K</td>
</tr>
<tr>
<td style="text-align:center">MEDIUMBLOB(N)</td>
<td style="text-align:center">二进制大对象</td>
<td style="text-align:center">字节</td>
<td style="text-align:center">否</td>
<td style="text-align:center">16M</td>
</tr>
<tr>
<td style="text-align:center">LONGBLOB(N)</td>
<td style="text-align:center">二进制大对象</td>
<td style="text-align:center">字节</td>
<td style="text-align:center">否</td>
<td style="text-align:center">4G</td>
</tr>
<tr>
<td style="text-align:center">TINYTEXT(N)</td>
<td style="text-align:center">大对象</td>
<td style="text-align:center">字节</td>
<td style="text-align:center">是</td>
<td style="text-align:center">256</td>
</tr>
<tr>
<td style="text-align:center">TEXT(N)</td>
<td style="text-align:center">大对象</td>
<td style="text-align:center">字节</td>
<td style="text-align:center">是</td>
<td style="text-align:center">16K</td>
</tr>
<tr>
<td style="text-align:center">MEDIUMTEXT(N)</td>
<td style="text-align:center">大对象</td>
<td style="text-align:center">字节</td>
<td style="text-align:center">是</td>
<td style="text-align:center">16M</td>
</tr>
<tr>
<td style="text-align:center">LONGTEXT(N)</td>
<td style="text-align:center">大对象</td>
<td style="text-align:center">字节</td>
<td style="text-align:center">是</td>
<td style="text-align:center">4G</td>
</tr>
</tbody>
</table>
<h3 id="2-N和字符集"><a href="#2-N和字符集" class="headerlink" title="2. N和字符集"></a>2. N和字符集</h3><ul>
<li><strong>char(N)</strong><ul>
<li>假设当前table的字符集的<code>最大长度</code>为<code>W</code>, 则<code>char(N)</code>的最大存储空间为 <code>(N X W)Byte</code>;假设使用<code>UTF-8</code>，则char(10)可以最小存储10个字节的字符，最大存储30个字节的字符，其实是另一种意义上的<code>varchar</code></li>
<li>当存储的字符数<code>小于N</code>时，尾部使用<code>空格</code>填充，并且填充最小字节的空格</li>
</ul>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create table test_char(a char(10));</span><br><span class="line">Query OK, 0 rows affected (0.12 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; show create table test_char;</span><br><span class="line">+<span class="comment">-----------+------------------------------------------------------------------------------------------------+</span></span><br><span class="line">| Table     | <span class="keyword">Create</span> <span class="keyword">Table</span>                                                                                   |</span><br><span class="line">+<span class="comment">-----------+------------------------------------------------------------------------------------------------+</span></span><br><span class="line">| test_char | <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`test_char`</span> (</span><br><span class="line">  <span class="string">`a`</span> <span class="built_in">char</span>(<span class="number">10</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span></span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8mb4 |</span><br><span class="line">+<span class="comment">-----------+------------------------------------------------------------------------------------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="keyword">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">insert</span> <span class="keyword">into</span> test_char <span class="keyword">values</span>(<span class="string">'abc'</span>);</span><br><span class="line">Query OK, 1 row affected (0.02 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into test_char values('你好吗');</span><br><span class="line">Query OK, 1 row affected (0.05 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into test_char values('大家好ab');</span><br><span class="line">Query OK, 1 row affected (0.02 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into test_char values('大家ab好');</span><br><span class="line">Query OK, 1 row affected (0.03 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into test_char values('大家ab好吗');</span><br><span class="line">Query OK, 1 row affected (0.03 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select a, length(a) from test_char;</span><br><span class="line">+<span class="comment">----------------+-----------+</span></span><br><span class="line">| a              | length(a) |</span><br><span class="line">+<span class="comment">----------------+-----------+</span></span><br><span class="line">| abc            |         3 |</span><br><span class="line">| 你好吗         |         9 |</span><br><span class="line">| 大家好ab       |        11 |</span><br><span class="line">| 大家ab好       |        11 |</span><br><span class="line">| 大家ab好吗     |        14 |</span><br><span class="line">+<span class="comment">----------------+-----------+</span></span><br><span class="line">5 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> a, <span class="keyword">hex</span>(a) <span class="keyword">from</span> test_char;</span><br><span class="line">+<span class="comment">----------------+------------------------------+</span></span><br><span class="line">| a              | hex(a)                       |</span><br><span class="line">+<span class="comment">----------------+------------------------------+</span></span><br><span class="line">| abc            | 616263                       |    <span class="comment">-- 注意这里，以及下面的16进制值，一会可以对比</span></span><br><span class="line">| 你好吗         | E4BDA0E5A5BDE59097           |</span><br><span class="line">| 大家好ab       | E5A4A7E5AEB6E5A5BD6162       |</span><br><span class="line">| 大家ab好       | E5A4A7E5AEB66162E5A5BD       |</span><br><span class="line">| 大家ab好吗     | E5A4A7E5AEB66162E5A5BDE59097 |</span><br><span class="line">+<span class="comment">----------------+------------------------------+</span></span><br><span class="line">5 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> <span class="keyword">hex</span>(<span class="string">' '</span>);</span><br><span class="line">+<span class="comment">----------+</span></span><br><span class="line">| hex(' ') |</span><br><span class="line">+<span class="comment">----------+</span></span><br><span class="line">| 20       |   <span class="comment">-- 注意 空格 空格对应的16进制数字是 20</span></span><br><span class="line">+<span class="comment">----------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<p><strong><code>test_char</code>表实际二进制存储文件</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- </span></span><br><span class="line"><span class="comment">-- shell&gt; hexdump -C test_char.idb</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 1:abc</span></span><br><span class="line"><span class="comment">-- 2:你好吗</span></span><br><span class="line"><span class="comment">-- 3:大家好ab</span></span><br><span class="line"><span class="comment">-- 4:大家ab好</span></span><br><span class="line"><span class="comment">-- 5:大家ab好吗</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- ---省略---</span></span><br><span class="line">00006070  73 75 70 72 65 6d 75 6d  0a 00 00 00 10 00 24 00  |supremum......$.|</span><br><span class="line">00006080  00 00 00 02 03 00 00 00  00 1f 33 a8 00 00 00 26  |..........3....&amp;|</span><br><span class="line">00006090  01 10 61 62 63 20 20 20  20 20 20 20 0a 00 00 00  |..abc       ....| <span class="comment">-- 1:后面补了7个空格</span></span><br><span class="line">000060a0  18 00 24 00 00 00 00 02  04 00 00 00 00 1f 34 a9  |..$...........4.|</span><br><span class="line">000060b0  00 00 00 25 01 10 e4 bd  a0 e5 a5 bd e5 90 97 20  |...%........... | <span class="comment">-- 2:补充了1个空格</span></span><br><span class="line">000060c0  0b 00 00 00 20 00 25 00  00 00 00 02 05 00 00 00  |.... .%.........|</span><br><span class="line">000060d0  00 1f 39 ac 00 00 00 26  01 10 e5 a4 a7 e5 ae b6  |..9....&amp;........| <span class="comment">-- 3:没有补充空格</span></span><br><span class="line">000060e0  e5 a5 bd 61 62 0b 00 00  00 28 00 25 00 00 00 00  |...ab....(.%....|  <span class="comment">-- </span></span><br><span class="line">000060f0  02 06 00 00 00 00 1f 3a  ad 00 00 00 28 01 10 e5  |.......:....(...| <span class="comment">--</span></span><br><span class="line">00006100  a4 a7 e5 ae b6 61 62 e5  a5 bd 0e 00 00 00 30 ff  |.....ab.......0.|  <span class="comment">-- 4：没有补充空格</span></span><br><span class="line">00006110  5f 00 00 00 00 02 07 00  00 00 00 1f 3f b0 00 00  |_...........?...|</span><br><span class="line">00006120  00 29 01 10 e5 a4 a7 e5  ae b6 61 62 e5 a5 bd e5  |.)........ab....|<span class="comment">--</span></span><br><span class="line">00006130  90 97 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................| <span class="comment">-- 5：没有补充空格</span></span><br><span class="line">00006140  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br><span class="line"><span class="comment">-- ---省略---</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>varchar(N)</strong><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create table test_varchar(a varchar(10));</span><br><span class="line">Query OK, 0 rows affected (0.12 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; show create table test_varchar;</span><br><span class="line">+<span class="comment">--------------+------------------------------------------------------------------------------------------------------+</span></span><br><span class="line">| Table        | <span class="keyword">Create</span> <span class="keyword">Table</span>                                                                                         |</span><br><span class="line">+<span class="comment">--------------+------------------------------------------------------------------------------------------------------+</span></span><br><span class="line">| test_varchar | <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`test_varchar`</span> (</span><br><span class="line">  <span class="string">`a`</span> <span class="built_in">varchar</span>(<span class="number">10</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span></span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8mb4 |</span><br><span class="line">+<span class="comment">--------------+------------------------------------------------------------------------------------------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="keyword">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">insert</span> <span class="keyword">into</span> test_varchar <span class="keyword">values</span>(<span class="string">'abc'</span>);</span><br><span class="line">Query OK, 1 row affected (0.03 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into test_varchar values('你好吗');</span><br><span class="line">Query OK, 1 row affected (0.02 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into test_varchar values('大家好ab');</span><br><span class="line">Query OK, 1 row affected (0.03 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into test_varchar values('大家ab好');</span><br><span class="line">Query OK, 1 row affected (0.02 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into test_varchar values('大家ab好吗');</span><br><span class="line">Query OK, 1 row affected (0.03 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select a, hex(a) from test_varchar;</span><br><span class="line">+<span class="comment">----------------+------------------------------+</span></span><br><span class="line">| a              | hex(a)                       |</span><br><span class="line">+<span class="comment">----------------+------------------------------+</span></span><br><span class="line">| abc            | 616263                       |</span><br><span class="line">| 你好吗         | E4BDA0E5A5BDE59097           |</span><br><span class="line">| 大家好ab       | E5A4A7E5AEB6E5A5BD6162       |</span><br><span class="line">| 大家ab好       | E5A4A7E5AEB66162E5A5BD       |</span><br><span class="line">| 大家ab好吗     | E5A4A7E5AEB66162E5A5BDE59097 |</span><br><span class="line">+<span class="comment">----------------+------------------------------+</span></span><br><span class="line">5 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> a, <span class="keyword">length</span>(a) <span class="keyword">from</span> test_varchar;</span><br><span class="line">+<span class="comment">----------------+-----------+</span></span><br><span class="line">| a              | length(a) |</span><br><span class="line">+<span class="comment">----------------+-----------+</span></span><br><span class="line">| abc            |         3 |</span><br><span class="line">| 你好吗         |         9 |</span><br><span class="line">| 大家好ab       |        11 |</span><br><span class="line">| 大家ab好       |        11 |</span><br><span class="line">| 大家ab好吗     |        14 |</span><br><span class="line">+<span class="comment">----------------+-----------+</span></span><br><span class="line">5 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><strong><code>test_varchar</code>表实际二进制存储文件</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- </span></span><br><span class="line"><span class="comment">-- shell&gt; hexdump -C test_char.idb</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 1:abc</span></span><br><span class="line"><span class="comment">-- 2:你好吗</span></span><br><span class="line"><span class="comment">-- 3:大家好ab</span></span><br><span class="line"><span class="comment">-- 4:大家ab好</span></span><br><span class="line"><span class="comment">-- 5:大家ab好吗</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 和char一样观察，都没有进行空格的填充</span></span><br><span class="line"></span><br><span class="line">00006070  73 75 70 72 65 6d 75 6d  03 00 00 00 10 00 1d 00  |supremum........|</span><br><span class="line">00006080  00 00 00 02 08 00 00 00  00 1f 44 b5 00 00 00 29  |..........D....)|</span><br><span class="line">00006090  01 10 61 62 63 09 00 00  00 18 00 23 00 00 00 00  |..abc......#....| </span><br><span class="line">000060a0  02 09 00 00 00 00 1f 45  b6 00 00 00 2b 01 10 e4  |.......E....+...|</span><br><span class="line">000060b0  bd a0 e5 a5 bd e5 90 97  0b 00 00 00 20 00 25 00  |............ .%.|</span><br><span class="line">000060c0  00 00 00 02 0a 00 00 00  00 1f 4a b9 00 00 00 2c  |..........J....,|</span><br><span class="line">000060d0  01 10 e5 a4 a7 e5 ae b6  e5 a5 bd 61 62 0b 00 00  |...........ab...|</span><br><span class="line">000060e0  00 28 00 25 00 00 00 00  02 0b 00 00 00 00 1f 4b  |.(.%...........K|</span><br><span class="line">000060f0  ba 00 00 00 2c 01 10 e5  a4 a7 e5 ae b6 61 62 e5  |....,........ab.|</span><br><span class="line">00006100  a5 bd 0e 00 00 00 30 ff  67 00 00 00 00 02 0c 00  |......0.g.......|</span><br><span class="line">00006110  00 00 00 1f 50 bd 00 00  00 2d 01 10 e5 a4 a7 e5  |....P....-......|</span><br><span class="line">00006120  ae b6 61 62 e5 a5 bd e5  90 97 00 00 00 00 00 00  |..ab............|</span><br><span class="line">00006130  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>插入数据尾部带空格</strong></li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; insert into test_char values('好好好   ');  -- 后面有3个空格</span><br><span class="line">Query OK, 1 row affected (0.03 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into test_varchar values('好好好   '); -- 后面有3个空格</span><br><span class="line">Query OK, 1 row affected (0.02 sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- </span></span><br><span class="line"><span class="comment">-- test_char 表</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line">mysql&gt; select a, length(a) from test_char;   </span><br><span class="line">+<span class="comment">----------------+-----------+</span></span><br><span class="line">| a              | length(a) |</span><br><span class="line">+<span class="comment">----------------+-----------+</span></span><br><span class="line">| abc            |         3 |</span><br><span class="line">| 你好吗         |         9 |</span><br><span class="line">| 大家好ab       |        11 |</span><br><span class="line">| 大家ab好       |        11 |</span><br><span class="line">| 大家ab好吗     |        14 |</span><br><span class="line">| 好好好         |         9 |  <span class="comment">-- 只有9个字节</span></span><br><span class="line">+<span class="comment">----------------+-----------+</span></span><br><span class="line">6 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> a, <span class="keyword">hex</span>(a) <span class="keyword">from</span> test_char;</span><br><span class="line">+<span class="comment">----------------+------------------------------+</span></span><br><span class="line">| a              | hex(a)                       |</span><br><span class="line">+<span class="comment">----------------+------------------------------+</span></span><br><span class="line">| abc            | 616263                       |</span><br><span class="line">| 你好吗         | E4BDA0E5A5BDE59097           |</span><br><span class="line">| 大家好ab       | E5A4A7E5AEB6E5A5BD6162       |</span><br><span class="line">| 大家ab好       | E5A4A7E5AEB66162E5A5BD       |</span><br><span class="line">| 大家ab好吗     | E5A4A7E5AEB66162E5A5BDE59097 |</span><br><span class="line">| 好好好         | E5A5BDE5A5BDE5A5BD           | <span class="comment">-- 无填充空格</span></span><br><span class="line">+<span class="comment">----------------+------------------------------+</span></span><br><span class="line">6 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- test_varchar表</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line">mysql&gt; <span class="keyword">select</span> a, <span class="keyword">length</span>(a) <span class="keyword">from</span> test_varchar;</span><br><span class="line">+<span class="comment">----------------+-----------+</span></span><br><span class="line">| a              | length(a) |</span><br><span class="line">+<span class="comment">----------------+-----------+</span></span><br><span class="line">| abc            |         3 |</span><br><span class="line">| 你好吗         |         9 |</span><br><span class="line">| 大家好ab       |        11 |</span><br><span class="line">| 大家ab好       |        11 |</span><br><span class="line">| 大家ab好吗     |        14 |</span><br><span class="line">| 好好好         |        12 |  <span class="comment">-- (好好好)9个字节 +  3个字节的空格</span></span><br><span class="line">+<span class="comment">----------------+-----------+</span></span><br><span class="line">7 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> a, <span class="keyword">hex</span>(a) <span class="keyword">from</span> test_varchar;      </span><br><span class="line">+<span class="comment">----------------+------------------------------+</span></span><br><span class="line">| a              | hex(a)                       |</span><br><span class="line">+<span class="comment">----------------+------------------------------+</span></span><br><span class="line">| abc            | 616263                       |</span><br><span class="line">| 你好吗         | E4BDA0E5A5BDE59097           |</span><br><span class="line">| 大家好ab       | E5A4A7E5AEB6E5A5BD6162       |</span><br><span class="line">| 大家ab好       | E5A4A7E5AEB66162E5A5BD       |</span><br><span class="line">| 大家ab好吗     | E5A4A7E5AEB66162E5A5BDE59097 |</span><br><span class="line">| 好好好         | E5A5BDE5A5BDE5A5BD202020     |  <span class="comment">-- 后面有20 20 20 ，表示3个自己的空格</span></span><br><span class="line">+<span class="comment">----------------+------------------------------+</span></span><br><span class="line">7 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>上面的现象无法用统一的规则进行表述，但是<a href="http://dev.mysql.com/doc/refman/5.7/en/innodb-physical-record.html" target="_blank" rel="noopener">官方文档</a>给出的解释是，这样的安排是为了避免索引页的碎片 </p>
</blockquote>
<h3 id="3-BLOB和TEXT"><a href="#3-BLOB和TEXT" class="headerlink" title="3.BLOB和TEXT"></a>3.BLOB和TEXT</h3><ul>
<li><p>在BLOB和TEXT上创建索引时，必须指定索引前缀的长度</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create table test_text(a int primary key, b text, key(b));</span><br><span class="line">ERROR 1170 (42000): BLOB/TEXT column 'b' used in key specification without a key length</span><br><span class="line"></span><br><span class="line">mysql&gt; create table test_text(a int primary key, b text, key(b(64)));</span><br><span class="line">Query OK, 0 rows affected (0.13 sec)</span><br></pre></td></tr></table></figure>
</li>
<li><p>BLOB和TEXT列不能有默认值</p>
</li>
<li>BLOB和TEXT列排序时只使用该列的前max_sort_length个字节<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select @@max_sort_length;</span><br><span class="line">+<span class="comment">-------------------+</span></span><br><span class="line">| @@max_sort_length |</span><br><span class="line">+<span class="comment">-------------------+</span></span><br><span class="line">|              1024 |</span><br><span class="line">+<span class="comment">-------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<p>不建议在MySQL中存储大型的二进制数据，比如歌曲，视频</p>
</blockquote>
<hr>
<h2 id="四-字符集"><a href="#四-字符集" class="headerlink" title="四. 字符集"></a>四. 字符集</h2><h3 id="1-常见的字符集"><a href="#1-常见的字符集" class="headerlink" title="1. 常见的字符集"></a>1. 常见的字符集</h3><ul>
<li>utf8</li>
<li>utf8mb4</li>
<li>gbk</li>
<li>gb18030</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show character set;</span><br><span class="line">+<span class="comment">----------+---------------------------------+---------------------+--------+</span></span><br><span class="line">| Charset  | Description                     | Default collation   | Maxlen |</span><br><span class="line">+<span class="comment">----------+---------------------------------+---------------------+--------+</span></span><br><span class="line">| big5     | Big5 Traditional Chinese        | big5_chinese_ci     |      2 |</span><br><span class="line">| dec8     | DEC West European               | dec8_swedish_ci     |      1 |</span><br><span class="line">| cp850    | DOS West European               | cp850_general_ci    |      1 |</span><br><span class="line">| hp8      | HP West European                | hp8_english_ci      |      1 |</span><br><span class="line">| koi8r    | KOI8-R Relcom Russian           | koi8r_general_ci    |      1 |</span><br><span class="line">| latin1   | cp1252 West European            | latin1_swedish_ci   |      1 |</span><br><span class="line">| latin2   | ISO 8859-2 Central European     | latin2_general_ci   |      1 |</span><br><span class="line">| swe7     | 7bit Swedish                    | swe7_swedish_ci     |      1 |</span><br><span class="line">| ascii    | US ASCII                        | ascii_general_ci    |      1 |</span><br><span class="line">| ujis     | EUC-JP Japanese                 | ujis_japanese_ci    |      3 |</span><br><span class="line">| sjis     | Shift-JIS Japanese              | sjis_japanese_ci    |      2 |</span><br><span class="line">| hebrew   | ISO 8859-8 Hebrew               | hebrew_general_ci   |      1 |</span><br><span class="line">| tis620   | TIS620 Thai                     | tis620_thai_ci      |      1 |</span><br><span class="line">| euckr    | EUC-KR Korean                   | euckr_korean_ci     |      2 |</span><br><span class="line">| koi8u    | KOI8-U Ukrainian                | koi8u_general_ci    |      1 |</span><br><span class="line">| gb2312   | GB2312 Simplified Chinese       | gb2312_chinese_ci   |      2 |</span><br><span class="line">| greek    | ISO 8859-7 Greek                | greek_general_ci    |      1 |</span><br><span class="line">| cp1250   | Windows Central European        | cp1250_general_ci   |      1 |</span><br><span class="line">| gbk      | GBK Simplified Chinese          | gbk_chinese_ci      |      2 | <span class="comment">-- gbk，表示的字符有限</span></span><br><span class="line">| latin5   | ISO 8859-9 Turkish              | latin5_turkish_ci   |      1 |</span><br><span class="line">| armscii8 | ARMSCII-8 Armenian              | armscii8_general_ci |      1 |</span><br><span class="line">| utf8     | UTF-8 Unicode                   | utf8_general_ci     |      3 | <span class="comment">-- utf8，最长3字节</span></span><br><span class="line">| ucs2     | UCS-2 Unicode                   | ucs2_general_ci     |      2 |</span><br><span class="line">| cp866    | DOS Russian                     | cp866_general_ci    |      1 |</span><br><span class="line">| keybcs2  | DOS Kamenicky Czech-Slovak      | keybcs2_general_ci  |      1 |</span><br><span class="line">| macce    | Mac Central European            | macce_general_ci    |      1 |</span><br><span class="line">| macroman | Mac West European               | macroman_general_ci |      1 |</span><br><span class="line">| cp852    | DOS Central European            | cp852_general_ci    |      1 |</span><br><span class="line">| latin7   | ISO 8859-13 Baltic              | latin7_general_ci   |      1 |</span><br><span class="line">| utf8mb4  | UTF-8 Unicode                   | utf8mb4_general_ci  |      4 | <span class="comment">-- utf8 + mobile端字符</span></span><br><span class="line">| cp1251   | Windows Cyrillic                | cp1251_general_ci   |      1 |</span><br><span class="line">| utf16    | UTF-16 Unicode                  | utf16_general_ci    |      4 |</span><br><span class="line">| utf16le  | UTF-16LE Unicode                | utf16le_general_ci  |      4 |</span><br><span class="line">| cp1256   | Windows Arabic                  | cp1256_general_ci   |      1 |</span><br><span class="line">| cp1257   | Windows Baltic                  | cp1257_general_ci   |      1 |</span><br><span class="line">| utf32    | UTF-32 Unicode                  | utf32_general_ci    |      4 |</span><br><span class="line">| binary   | Binary pseudo charset           | binary              |      1 |</span><br><span class="line">| geostd8  | GEOSTD8 Georgian                | geostd8_general_ci  |      1 |</span><br><span class="line">| cp932    | SJIS for Windows Japanese       | cp932_japanese_ci   |      2 |</span><br><span class="line">| eucjpms  | UJIS for Windows Japanese       | eucjpms_japanese_ci |      3 |</span><br><span class="line">| gb18030  | China National Standard GB18030 | gb18030_chinese_ci  |      4 | <span class="comment">-- gb18030,最长4个字节</span></span><br><span class="line">+<span class="comment">----------+---------------------------------+---------------------+--------+</span></span><br><span class="line">41 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<h3 id="2-collation"><a href="#2-collation" class="headerlink" title="2. collation"></a>2. collation</h3><p>collation的含义是指排序规则，<code>ci（case insensitive）</code>结尾的排序集是不区分大小写的<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select 'a' = 'A';</span><br><span class="line">+<span class="comment">-----------+</span></span><br><span class="line">| 'a' = 'A' |</span><br><span class="line">+<span class="comment">-----------+</span></span><br><span class="line">|         1 |  <span class="comment">-- 因为大小写无关，所以返回1</span></span><br><span class="line">+<span class="comment">-----------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">create</span> <span class="keyword">table</span> test_ci (a <span class="built_in">varchar</span>(<span class="number">10</span>), <span class="keyword">key</span>(a));</span><br><span class="line">Query OK, 0 rows affected (0.13 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into test_ci values('a');</span><br><span class="line">Query OK, 1 row affected (0.02 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into test_ci values('A');</span><br><span class="line">Query OK, 1 row affected (0.03 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from test_ci where a = 'a';</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">| a    |</span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">| a    |  </span><br><span class="line">| A    |  <span class="comment">-- A也被我们查到了</span></span><br><span class="line">+<span class="comment">------+</span></span><br><span class="line">2 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>上面的情况如果从业务的角度上看，可以很好理解，比如创建一个用户叫做Tom，你是不希望再创建一个叫做tom的用户的</p>
</blockquote>
<ul>
<li><strong>修改默认的collation</strong><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; set names utf8mb4 collate utf8mb4_bin;  -- 当前会话有效</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select 'a' = 'A';</span><br><span class="line">+<span class="comment">-----------+</span></span><br><span class="line">| 'a' = 'A' |</span><br><span class="line">+<span class="comment">-----------+</span></span><br><span class="line">|         0 |</span><br><span class="line">+<span class="comment">-----------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<p>字符集的指定，可以在创建数据库的时候指定，也可以在创建表的时候单独指定，也可以创建列的时候进行指定</p>
</blockquote>
<hr>
<h2 id="五-集合类型"><a href="#五-集合类型" class="headerlink" title="五. 集合类型"></a>五. 集合类型</h2><ul>
<li>集合类型ENUM 和 SET</li>
<li>ENUM类型最多允许65536个值</li>
<li>SET类型最多允许64个值</li>
<li>通过sql_mode参数可以用户约束检查</li>
</ul>
<h3 id="1-集合类型的排序"><a href="#1-集合类型的排序" class="headerlink" title="1. 集合类型的排序"></a>1. 集合类型的排序</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create table test_col (</span><br><span class="line">    -&gt; user varchar(10),</span><br><span class="line">    -&gt; sex enum('male', 'female')  -- 虽然写的是字符串，单其实存储的整型，效率还是可以的</span><br><span class="line">    -&gt; );</span><br><span class="line">    </span><br><span class="line">mysql&gt; insert into test_col values ("tom", "male");</span><br><span class="line">Query OK, 1 row affected (0.02 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into test_col values ("tom", "xmale");  -- 不是male 和 female</span><br><span class="line">Query OK, 1 row affected, 1 warning (0.03 sec)  <span class="comment">-- 有warning</span></span><br><span class="line"></span><br><span class="line">mysql&gt; set sql_mode='strict_trans_tables';  -- 设置为严格模式</span><br><span class="line">Query OK, 0 rows affected, 2 warnings (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into test_col values ("tom", "xmale");</span><br><span class="line">ERROR 1265 (01000): Data truncated for column 'sex' at row 1</span><br></pre></td></tr></table></figure>
<blockquote>
<p>强烈建议新业务上都设置成严格模式</p>
</blockquote>
<h3 id="2-集合类型的排序"><a href="#2-集合类型的排序" class="headerlink" title="2. 集合类型的排序"></a>2. 集合类型的排序</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create table test_col_sort(</span><br><span class="line">    -&gt; user char(10),</span><br><span class="line">    -&gt; type enum('aaa','zzz','bbb','yyy','fff')  -- aaa=0, zzz=1, bbb=2, yyy=3, fff=4</span><br><span class="line">    -&gt; );</span><br><span class="line">Query OK, 0 rows affected (0.20 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from test_col_sort order by type asc; -- 以type作为key，进行升序排序</span><br><span class="line">+<span class="comment">-------+------+</span></span><br><span class="line">| user  | type |</span><br><span class="line">+<span class="comment">-------+------+</span></span><br><span class="line">| user1 | aaa  |  <span class="comment">-- 0</span></span><br><span class="line">| user4 | zzz  |  <span class="comment">-- 1</span></span><br><span class="line">| user2 | bbb  |  <span class="comment">-- 2</span></span><br><span class="line">| user3 | yyy  |  <span class="comment">-- 3</span></span><br><span class="line">+<span class="comment">-------+------+  -- 枚举类型实际是整型数据，按照插入顺序进行排列</span></span><br><span class="line">4 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- 使用ascii排序</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line">mysql&gt; <span class="keyword">select</span> * <span class="keyword">from</span> test_col_sort <span class="keyword">order</span> <span class="keyword">by</span> <span class="keyword">cast</span>(<span class="keyword">type</span> <span class="keyword">as</span> <span class="built_in">char</span>) <span class="keyword">asc</span>;  <span class="comment">-- 使用cast()函数转换成某种型</span></span><br><span class="line">+<span class="comment">-------+------+                                                     -- 这里我们转成char型</span></span><br><span class="line">| user  | type |                                                     <span class="comment">-- 然后进行排序(ascii)</span></span><br><span class="line">+<span class="comment">-------+------+</span></span><br><span class="line">| user1 | aaa  | <span class="comment">-- 0</span></span><br><span class="line">| user2 | bbb  | <span class="comment">-- 2</span></span><br><span class="line">| user3 | yyy  | <span class="comment">-- 3</span></span><br><span class="line">| user4 | zzz  | <span class="comment">-- 1</span></span><br><span class="line">+<span class="comment">-------+------+</span></span><br><span class="line">4 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 或者使用concat</span></span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> * <span class="keyword">from</span> test_col_sort <span class="keyword">order</span> <span class="keyword">by</span> <span class="keyword">concat</span>(<span class="keyword">type</span>) <span class="keyword">asc</span>;   <span class="comment">-- concat()是连接字符串函数            </span></span><br><span class="line">+<span class="comment">-------+------+</span></span><br><span class="line">| user  | type |</span><br><span class="line">+<span class="comment">-------+------+</span></span><br><span class="line">| user1 | aaa  |  <span class="comment">-- 0</span></span><br><span class="line">| user2 | bbb  |  <span class="comment">-- 2</span></span><br><span class="line">| user3 | yyy  |  <span class="comment">-- 3</span></span><br><span class="line">| user4 | zzz  |  <span class="comment">-- 1</span></span><br><span class="line">+<span class="comment">-------+------+</span></span><br><span class="line">4 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> <span class="keyword">concat</span>(<span class="string">"abc"</span>, <span class="string">"大家好"</span>);</span><br><span class="line">+<span class="comment">----------------------------+</span></span><br><span class="line">| concat("abc", "大家好")    |</span><br><span class="line">+<span class="comment">----------------------------+</span></span><br><span class="line">| abc大家好                  |</span><br><span class="line">+<span class="comment">----------------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="六-日期类型"><a href="#六-日期类型" class="headerlink" title="六. 日期类型"></a>六. 日期类型</h2><table>
<thead>
<tr>
<th>日期类型</th>
<th>占用空间(byte)（&lt;5.6）</th>
<th>占用空间(byte)(&gt;=5.6)</th>
<th>表示范围</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>DATETIME</code></td>
<td>8</td>
<td>5 + 微秒存储空间</td>
<td>1000-01-01 00:00:00 ~ 9999-12-31 23:59:59</td>
</tr>
<tr>
<td>DATE</td>
<td>3</td>
<td>3</td>
<td>1000-01-01 ~ 9999-12-31</td>
</tr>
<tr>
<td><code>TIMESTAMP</code></td>
<td>4</td>
<td>4 + 微秒存储空间</td>
<td>1970-01-01 00:00:00UTC ~ 2038-01-19 03:14:07UTC</td>
</tr>
<tr>
<td>YEAR</td>
<td>1</td>
<td>1</td>
<td>YEAR(2):1970-2070, YEAR(4):1901-2155</td>
</tr>
<tr>
<td>TIME</td>
<td>3</td>
<td>3 + 微秒存储空间</td>
<td>-838:59:59 ~ 838:59:59</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>微秒位数</th>
<th>所需存储空间</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>1, 2</td>
<td>1 byte</td>
</tr>
<tr>
<td>3, 4</td>
<td>2 bytes</td>
</tr>
<tr>
<td>5, 6</td>
<td>3 bytes</td>
</tr>
</tbody>
</table>
<blockquote>
<p>TIMESTAMP 带时区功能</p>
</blockquote>
<h3 id="1-TIMESTAMP和DATETIME"><a href="#1-TIMESTAMP和DATETIME" class="headerlink" title="1. TIMESTAMP和DATETIME"></a>1. TIMESTAMP和DATETIME</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create table test_time(a timestamp, b datetime);</span><br><span class="line">Query OK, 0 rows affected (0.12 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into test_time values (now(), now());</span><br><span class="line">Query OK, 1 row affected (0.03 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from test_time;</span><br><span class="line">+<span class="comment">---------------------+---------------------+</span></span><br><span class="line">| a                   | b                   |</span><br><span class="line">+<span class="comment">---------------------+---------------------+</span></span><br><span class="line">| 2015-11-28 10:00:39 | 2015-11-28 10:00:39 |</span><br><span class="line">+<span class="comment">---------------------+---------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> @@<span class="keyword">time_zone</span>; </span><br><span class="line">+<span class="comment">-------------+</span></span><br><span class="line">| @@time_zone |</span><br><span class="line">+<span class="comment">-------------+</span></span><br><span class="line">| SYSTEM      |</span><br><span class="line">+<span class="comment">-------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">set</span> <span class="keyword">time_zone</span>=<span class="string">'+00:00'</span>;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select @@time_zone;</span><br><span class="line">+<span class="comment">-------------+</span></span><br><span class="line">| @@time_zone |</span><br><span class="line">+<span class="comment">-------------+</span></span><br><span class="line">| +00:00      |</span><br><span class="line">+<span class="comment">-------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> * <span class="keyword">from</span> test_time;</span><br><span class="line">+<span class="comment">---------------------+---------------------+</span></span><br><span class="line">| a                   | b                   |</span><br><span class="line">+<span class="comment">---------------------+---------------------+</span></span><br><span class="line">| 2015-11-28 2:00:39 | 2015-11-28 10:00:39  |  <span class="comment">-- 时区的差别体现出来了</span></span><br><span class="line">+<span class="comment">---------------------+---------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<h3 id="2-微秒"><a href="#2-微秒" class="headerlink" title="2. 微秒"></a>2. 微秒</h3><p><strong>从<code>MySQL5.6.X</code>开始，支持<code>微秒</code>，最大显示<code>6位</code></strong><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select now(6);</span><br><span class="line">+<span class="comment">----------------------------+</span></span><br><span class="line">| now(6)                     |</span><br><span class="line">+<span class="comment">----------------------------+</span></span><br><span class="line">| 2015-11-30 21:15:36.415358 |  <span class="comment">-- 6位 微秒显示</span></span><br><span class="line">+<span class="comment">----------------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> <span class="keyword">now</span>(<span class="number">7</span>);</span><br><span class="line">ERROR 1426 (42000): Too-big precision 7 specified for 'now'. Maximum is 6.  <span class="comment">-- 不支持，最大到6</span></span><br><span class="line"></span><br><span class="line">mysql&gt; create table test_time_fac (t datetime(6));</span><br><span class="line">Query OK, 0 rows affected (0.11 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into test_time_fac values(now(6)); </span><br><span class="line">Query OK, 1 row affected (0.02 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from test_time_fac;</span><br><span class="line">+<span class="comment">----------------------------+</span></span><br><span class="line">| t                          |</span><br><span class="line">+<span class="comment">----------------------------+</span></span><br><span class="line">| 2015-11-30 21:19:27.900393 |  <span class="comment">-- 由于是用了6位微秒位数，根据表格显示，实际存储的空间是 5 + 3 = 8 byte</span></span><br><span class="line">+<span class="comment">----------------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure></p>
<h3 id="3-时间函数"><a href="#3-时间函数" class="headerlink" title="3. 时间函数"></a>3. 时间函数</h3><ul>
<li>常用函数<br>| 函数名 | 函数说明 | 备注 |<br>|——–|———-|——|<br>| NOW    | 返回<code>SQL执行时</code>的时间| 如果不考虑其他因素，可以理解为写完SQL，敲下回车瞬间的时间 |<br>| CURRENT_TIMESTAMP| 与NOW()函数同义||<br>| SYSDATE | 返回<code>函数执行时</code>的时间|MySQL处理你的函数时的时间，统一SQL语句中，大于NOW|<br>| DATA_ADD(date, interval expr uint) | 增加时间||<br>| DATA_SUB(date, interval expr uint) | 减少时间|可用ADD，然后unit给负数|<br>| DATE FORMAT| 格式化时间| |</li>
</ul>
<blockquote>
<p><a href="http://dev.mysql.com/doc/refman/5.7/en/date-and-time-functions.html" target="_blank" rel="noopener">所有时间函数–官方文档</a></p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- NOW和SYSDATE的区别</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line">mysql&gt; select now(6),sysdate(6),sleep(5),now(6),sysdate(6);</span><br><span class="line">+<span class="comment">----------------------------+----------------------------+----------+----------------------------+----------------------------+</span></span><br><span class="line">| now(6)                     | sysdate(6)                 | sleep(5) | now(6)                     | sysdate(6)                 |</span><br><span class="line">+<span class="comment">----------------------------+----------------------------+----------+----------------------------+----------------------------+</span></span><br><span class="line">| 2015-11-30 21:40:58.572383 | 2015-11-30 21:40:58.572542 |        0 | 2015-11-30 21:40:58.572383 | 2015-11-30 21:41:03.572720 |</span><br><span class="line">+<span class="comment">----------------------------+----------------------------+----------+----------------------------+----------------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">5.00</span> sec)</span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- 两个now(6)都相等，因为是SQL执行时的时间(可以简单立理解为按回车的时间)</span></span><br><span class="line"><span class="comment">-- 两个sysdate(6)差了5秒，刚好是sleep(5)的时间</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-----</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- date_add</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line">mysql&gt; <span class="keyword">select</span> <span class="keyword">date_add</span>(<span class="keyword">now</span>(), <span class="built_in">interval</span> <span class="number">5</span> <span class="keyword">day</span>);   <span class="comment">-- 增加5天</span></span><br><span class="line">+<span class="comment">---------------------------------+</span></span><br><span class="line">| date_add(now(), interval 5 day) |</span><br><span class="line">+<span class="comment">---------------------------------+</span></span><br><span class="line">| 2015-12-05 21:42:39             |</span><br><span class="line">+<span class="comment">---------------------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> <span class="keyword">date_add</span>(<span class="keyword">now</span>(), <span class="built_in">interval</span> <span class="number">-5</span> <span class="keyword">month</span>);  <span class="comment">-- 减少 5个月</span></span><br><span class="line">+<span class="comment">------------------------------------+</span></span><br><span class="line">| date_add(now(), interval -5 month) |</span><br><span class="line">+<span class="comment">------------------------------------+</span></span><br><span class="line">| 2015-06-30 21:43:49                |</span><br><span class="line">+<span class="comment">------------------------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">select</span> <span class="keyword">date_sub</span>(<span class="keyword">now</span>(), <span class="built_in">interval</span> <span class="number">5</span> <span class="keyword">month</span>);  <span class="comment">-- 与add + 负数一致</span></span><br><span class="line">+<span class="comment">-----------------------------------+</span></span><br><span class="line">| date_sub(now(), interval 5 month) |</span><br><span class="line">+<span class="comment">-----------------------------------+</span></span><br><span class="line">| 2015-06-30 21:44:21               |</span><br><span class="line">+<span class="comment">-----------------------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- date_format</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line">mysql&gt; <span class="keyword">SELECT</span> <span class="keyword">DATE_FORMAT</span>((<span class="keyword">select</span> <span class="keyword">now</span>(<span class="number">6</span>)), <span class="string">'%H:%i:%s'</span>);</span><br><span class="line">+<span class="comment">------------------------------------------+</span></span><br><span class="line">| DATE_FORMAT((<span class="keyword">select</span> <span class="keyword">now</span>(<span class="number">6</span>)), <span class="string">'%H:%i:%s'</span>) |</span><br><span class="line">+<span class="comment">------------------------------------------+</span></span><br><span class="line">| <span class="number">21</span>:<span class="number">48</span>:<span class="number">30</span>                                 |</span><br><span class="line">+<span class="comment">------------------------------------------+</span></span><br><span class="line"><span class="number">1</span> <span class="keyword">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<h3 id="4-字段更新时间"><a href="#4-字段更新时间" class="headerlink" title="4. 字段更新时间"></a>4. 字段更新时间</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create  table test_field_update(</span><br><span class="line">    -&gt; a int(10),</span><br><span class="line">    -&gt; b timestamp not null default current_timestamp on update current_timestamp</span><br><span class="line">    -&gt; );</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into test_field_update values(1, now(6));</span><br><span class="line">Query OK, 1 row affected (0.03 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from test_field_update;</span><br><span class="line">+<span class="comment">------+---------------------+</span></span><br><span class="line">| a    | b                   |</span><br><span class="line">+<span class="comment">------+---------------------+</span></span><br><span class="line">|    1 | 2015-11-30 21:55:18 |  <span class="comment">-- 上面使用了now(6)，但是这里没有微秒，是因为定义的时候就是timestamp</span></span><br><span class="line">+<span class="comment">------+---------------------+  -- 如果写成timestamp(6),就可以显示微秒</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">update</span> test_field_update <span class="keyword">set</span> a=<span class="number">100</span> <span class="keyword">where</span> a=<span class="number">1</span>;  <span class="comment">-- 只更新a字段</span></span><br><span class="line">Query OK, 1 row affected (0.03 sec)</span><br><span class="line">Rows matched: 1  Changed: 1  Warnings: 0</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from test_field_update;    </span><br><span class="line">+<span class="comment">------+---------------------+</span></span><br><span class="line">| a    | b                   |</span><br><span class="line">+<span class="comment">------+---------------------+</span></span><br><span class="line">|  100 | 2015-11-30 22:01:03 |  <span class="comment">-- 发现b字段跟着改变了</span></span><br><span class="line">+<span class="comment">------+---------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- 测试timestamp(6)</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line">mysql&gt; <span class="keyword">create</span> <span class="keyword">table</span> test_time_disp(</span><br><span class="line">    -&gt; a <span class="built_in">int</span>(<span class="number">10</span>),</span><br><span class="line">    -&gt; b <span class="keyword">timestamp</span>(<span class="number">6</span>) <span class="keyword">not</span> <span class="literal">null</span> <span class="keyword">default</span> <span class="keyword">current_timestamp</span>(<span class="number">6</span>) <span class="keyword">on</span> <span class="keyword">update</span> <span class="keyword">current_timestamp</span>(<span class="number">6</span>)  <span class="comment">-- 定义了(6)</span></span><br><span class="line">    -&gt; );</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into test_time_disp values(1, now(6));      </span><br><span class="line">Query OK, 1 row affected (0.02 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from test_time_disp;</span><br><span class="line">+<span class="comment">------+----------------------------+</span></span><br><span class="line">| a    | b                          |</span><br><span class="line">+<span class="comment">------+----------------------------+</span></span><br><span class="line">|    1 | 2015-11-30 22:03:23.545406 |  <span class="comment">-- 插入了now(6), 这里就显示了6位微秒</span></span><br><span class="line">+<span class="comment">------+----------------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://chenwenning.github.io/2018/05/30/MySQL学习笔记(Day007)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="陈汶宁">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://pic.qqtn.com/up/2017-10/2017101317054482087.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CHENWENNING BLOG">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/30/MySQL学习笔记(Day007)/" itemprop="url">MySQL学习笔记（Day007：多实例下/SSL）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-05-30T17:30:16+08:00">
                2018-05-30
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/mysql/" itemprop="url" rel="index">
                    <span itemprop="name">mysql</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/05/30/MySQL学习笔记(Day007)/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2018/05/30/MySQL学习笔记(Day007)/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="MySQL学习笔记（Day007：多实例下-SSL）"><a href="#MySQL学习笔记（Day007：多实例下-SSL）" class="headerlink" title="MySQL学习笔记（Day007：多实例下/SSL）"></a>MySQL学习笔记（Day007：多实例下/SSL）</h1><p>@(MySQL学习)</p>
<p>[TOC]</p>
<h2 id="一-多实例安装-–-多版本"><a href="#一-多实例安装-–-多版本" class="headerlink" title="一. 多实例安装 – 多版本"></a>一. 多实例安装 – 多版本</h2><h3 id="1-mysqld-multi-标签"><a href="#1-mysqld-multi-标签" class="headerlink" title="1. [mysqld_multi]标签"></a>1. [mysqld_multi]标签</h3><ul>
<li><strong><code>[mysqld_multi]</code> 是否需要配置</strong><br>从操作演示来看，在<code>my.cnf</code>(<em>老师给的模板配置</em>)上直接配置<code>[mysqld1]</code>、<code>[mysqld2]</code>等实例标签，而<code>不配置[mysqld_multi]</code>,使用<code>mysqld_multi start 1</code>也是<code>可以启动</code>数据库实例的，但是没有<code>mysqld_safe</code>的守护进程。所以该标签<code>需要配置</code></li>
</ul>
<h3 id="2-停止mysql实例"><a href="#2-停止mysql实例" class="headerlink" title="2. 停止mysql实例"></a>2. 停止mysql实例</h3><ul>
<li><p><strong><code>multi_admin用户</code>的作用</strong><br>通过<a href="http://dev.mysql.com/doc/refman/5.7/en/mysqld-multi.html" target="_blank" rel="noopener">官方文档</a>中我们看到，<code>&#39;multi_admin&#39;@&#39;localhost&#39;</code>这个用户主要的作用是用来<code>关闭</code>数据库实例，因为文档中只授权了<code>SHUTDOWN</code>权限。所以在<code>[mysqld_multi]</code>标签下，我们需要配置<code>user</code>和<code>password</code><strong>(注意<code>5.7.9</code>中是<code>pass</code>)</strong>来进行关闭数据库实例。</p>
</li>
<li><p><strong><code>[client]</code>标签</strong><br>从操作演示来看，老师并没有在<code>[mysqld_multi]</code>下配置<code>user</code>和<code>password</code>，但是仍然可以关闭数据库，原因是因为<code>/root/.my.cnf</code>中存在了<code>[client]</code>标签。该标签下的用户<code>user = root</code>有关闭数据库实例的权限，因此可以关闭数据库。</p>
</li>
</ul>
<blockquote>
<p>如果在<code>[client]</code>和<code>[mysqld_multi]</code>标签中同时存在<code>user</code>和<code>password</code>, 则在关闭数据库实例中会使用<code>[mysqld_multi]</code>中的<code>user</code>去关闭。<br><strong>(<code>存在精确匹配的标签，则优先使用精确匹配标签下的配置项</code>)</strong></p>
</blockquote>
<h3 id="3-多实例安装-–-多版本"><a href="#3-多实例安装-–-多版本" class="headerlink" title="3. 多实例安装 – 多版本"></a>3. 多实例安装 – 多版本</h3><ul>
<li><p><strong>环境说明</strong></p>
<ul>
<li><code>mysqld1</code> – MySQL 5.7.9</li>
<li><code>mysqld2</code> – MySQL 5.7.9</li>
<li><code>mysqld3</code> – MySQL 5.6.27</li>
<li><code>mysqld4</code> – MySQL 5.6.27</li>
</ul>
</li>
<li><p><strong>配置文件</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><span class="line">[client]</span><br><span class="line">user = root</span><br><span class="line">password = 123</span><br><span class="line"></span><br><span class="line">[mysqld_multi]  <span class="comment"># 这里使用了client标签中的user，故这里不再定义user</span></span><br><span class="line">mysqld = /usr/<span class="built_in">local</span>/mysql/bin/mysqld_safe</span><br><span class="line"><span class="built_in">log</span> = /var/<span class="built_in">log</span>/mysqld_multi.log</span><br><span class="line"></span><br><span class="line">[mysqld1]</span><br><span class="line">server-id = 11</span><br><span class="line">datadir = /data1</span><br><span class="line">basedir = /usr/<span class="built_in">local</span>/mysql   <span class="comment"># basedir定义使用了5.7的mysql版本</span></span><br><span class="line">port = 3307</span><br><span class="line">socket = /tmp/mysql.sock1</span><br><span class="line"></span><br><span class="line">[mysqld2]</span><br><span class="line">server-id = 22</span><br><span class="line">datadir = /data2</span><br><span class="line">basedir = /usr/<span class="built_in">local</span>/mysql</span><br><span class="line">port = 3308</span><br><span class="line">socket = /tmp/mysql.sock2</span><br><span class="line"></span><br><span class="line">[mysqld3]</span><br><span class="line">server-id = 33</span><br><span class="line">datadir = /data3</span><br><span class="line">basedir = /usr/<span class="built_in">local</span>/mysql56  <span class="comment"># basedir定义了使用5.6的mysql版本</span></span><br><span class="line">port = 3309</span><br><span class="line">socket = /tmp/mysql.sock3</span><br><span class="line">plugin_dir=/usr/<span class="built_in">local</span>/mysql56/lib/plugin  <span class="comment"># plugin 目录也变了</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#这里无需特别配置mysqld, 可以继承使用[mysqld_multi]中的配置，然后根据basedir找到对应的mysqld</span></span><br><span class="line"></span><br><span class="line">[mysqld4]</span><br><span class="line">server-id = 44</span><br><span class="line">datadir = /data4</span><br><span class="line">basedir = /usr/<span class="built_in">local</span>/mysql56</span><br><span class="line">port = 3310</span><br><span class="line">socket = /tmp/mysql.sock4</span><br><span class="line">plugin_dir=/usr/<span class="built_in">local</span>/mysql56/lib/plugin</span><br><span class="line"></span><br><span class="line"><span class="comment">#--------------以下参数是老师的模板，只是将个别size调小-----------</span></span><br><span class="line">[mysqld]</span><br><span class="line"><span class="comment">########basic settings########</span></span><br><span class="line">server-id = 100</span><br><span class="line">port = 3306</span><br><span class="line">user = mysql</span><br><span class="line">bind_address = 0.0.0.0</span><br><span class="line"><span class="comment">#autocommit = 0</span></span><br><span class="line">character_set_server=utf8mb4</span><br><span class="line">skip_name_resolve = 1</span><br><span class="line">max_connections = 800</span><br><span class="line">max_connect_errors = 1000</span><br><span class="line">datadir = /data/mysql_data</span><br><span class="line">transaction_isolation = READ-COMMITTED</span><br><span class="line">explicit_defaults_for_timestamp = 1</span><br><span class="line">join_buffer_size = 134217728</span><br><span class="line">tmp_table_size = 67108864</span><br><span class="line">tmpdir = /tmp</span><br><span class="line">max_allowed_packet = 16777216</span><br><span class="line">sql_mode = <span class="string">"STRICT_TRANS_TABLES,NO_ENGINE_SUBSTITUTION,NO_ZERO_DATE,NO_ZERO_IN_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER"</span></span><br><span class="line">interactive_timeout = 1800</span><br><span class="line">wait_timeout = 1800</span><br><span class="line">read_buffer_size = 16777216</span><br><span class="line">read_rnd_buffer_size = 33554432</span><br><span class="line">sort_buffer_size = 33554432</span><br><span class="line"><span class="comment">########log settings########</span></span><br><span class="line">log_error = error.log</span><br><span class="line">slow_query_log = 1</span><br><span class="line">slow_query_log_file = slow.log</span><br><span class="line">log_queries_not_using_indexes = 1</span><br><span class="line">log_slow_admin_statements = 1</span><br><span class="line">log_slow_slave_statements = 1</span><br><span class="line">log_throttle_queries_not_using_indexes = 10</span><br><span class="line">expire_logs_days = 90</span><br><span class="line">long_query_time = 2</span><br><span class="line">min_examined_row_limit = 100</span><br><span class="line"><span class="comment">########replication settings########</span></span><br><span class="line">master_info_repository = TABLE</span><br><span class="line">relay_log_info_repository = TABLE</span><br><span class="line">log_bin = bin.log</span><br><span class="line">sync_binlog = 1</span><br><span class="line">gtid_mode = on</span><br><span class="line">enforce_gtid_consistency = 1</span><br><span class="line">log_slave_updates</span><br><span class="line">binlog_format = row </span><br><span class="line">relay_log = relay.log</span><br><span class="line">relay_log_recovery = 1</span><br><span class="line">binlog_gtid_simple_recovery = 1</span><br><span class="line">slave_skip_errors = ddl_exist_errors</span><br><span class="line"><span class="comment">########innodb settings########</span></span><br><span class="line">innodb_page_size = 8192</span><br><span class="line">innodb_buffer_pool_size = 1G    <span class="comment"># 该参数减小到1G</span></span><br><span class="line">innodb_buffer_pool_instances = 8</span><br><span class="line">innodb_buffer_pool_load_at_startup = 1</span><br><span class="line">innodb_buffer_pool_dump_at_shutdown = 1</span><br><span class="line">innodb_lru_scan_depth = 2000</span><br><span class="line">innodb_lock_wait_timeout = 5</span><br><span class="line">innodb_io_capacity = 4000</span><br><span class="line">innodb_io_capacity_max = 8000</span><br><span class="line">innodb_flush_method = O_DIRECT</span><br><span class="line">innodb_file_format = Barracuda</span><br><span class="line">innodb_file_format_max = Barracuda</span><br><span class="line"><span class="comment">#innodb_log_group_home_dir = /redolog/</span></span><br><span class="line"><span class="comment">#innodb_undo_directory = /undolog/</span></span><br><span class="line">innodb_undo_logs = 128</span><br><span class="line">innodb_undo_tablespaces = 3</span><br><span class="line">innodb_flush_neighbors = 1</span><br><span class="line">innodb_log_file_size = 128M  <span class="comment"># 该参数减小到 128M</span></span><br><span class="line">innodb_log_buffer_size = 16777216</span><br><span class="line">innodb_purge_threads = 4</span><br><span class="line">innodb_large_prefix = 1</span><br><span class="line">innodb_thread_concurrency = 64</span><br><span class="line">innodb_print_all_deadlocks = 1</span><br><span class="line">innodb_strict_mode = 1</span><br><span class="line">innodb_sort_buffer_size = 67108864 </span><br><span class="line"><span class="comment">########semi sync replication settings########</span></span><br><span class="line">plugin_dir=/usr/<span class="built_in">local</span>/mysql/lib/plugin</span><br><span class="line"><span class="comment">#plugin_load = "rpl_semi_sync_master=semisync_master.so;rpl_semi_sync_slave=semisync_slave.so"</span></span><br><span class="line">loose_rpl_semi_sync_master_enabled = 1</span><br><span class="line">loose_rpl_semi_sync_slave_enabled = 1</span><br><span class="line">loose_rpl_semi_sync_master_timeout = 5000</span><br><span class="line"></span><br><span class="line">[mysqld-5.7]</span><br><span class="line">innodb_buffer_pool_dump_pct = 40</span><br><span class="line">innodb_page_cleaners = 4</span><br><span class="line">innodb_undo_log_truncate = 1</span><br><span class="line">innodb_max_undo_log_size = 1G   <span class="comment"># 该参数减小到1G</span></span><br><span class="line">innodb_purge_rseg_truncate_frequency = 128</span><br><span class="line">binlog_gtid_simple_recovery=1</span><br><span class="line">log_timestamps=system</span><br><span class="line">transaction_write_set_extraction=MURMUR32</span><br><span class="line">show_compatibility_56=on</span><br></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<p><strong>注意MySQL5.6.27的<code>plugin_dir</code>的路径</strong></p>
</blockquote>
<blockquote>
<p>配置说明：<br>1：配置的标签顺序没有关系，不会影响最终配置的有效性。<br>2：同类型标签中的配置项会合并，形成一个大的配置项<br>2：<code>匹配度高</code>的标签中的配置项的<code>值</code>，会<code>覆盖</code>掉<code>匹配度低</code>的标签中的配置项的<code>值</code></p>
</blockquote>
<blockquote>
<p><strong>[mysqld<code>N</code>]中的配置项会和[mysqld]中的配置项进行合并，并且[mysqld<code>N</code>]中已有的配置项的值，会覆盖掉[mysqld]中的配置项的值,如<code>datadir</code>, <code>port</code>等</strong></p>
</blockquote>
<ul>
<li><strong>安装操作</strong><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 准备好数据目录，并初始化安装</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">[root@MyServer ~]&gt; mkdir /data1</span><br><span class="line">[root@MyServer ~]&gt; mkdir /data2</span><br><span class="line">[root@MyServer ~]&gt; mkdir /data3</span><br><span class="line">[root@MyServer ~]&gt; mkdir /data4</span><br><span class="line">[root@MyServer ~]&gt; chown mysql.mysql /data&#123;1..4&#125;</span><br><span class="line">[root@MyServer ~]&gt; mysqld --initialize --user=mysql --datadir=/data1</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 这里无输出，临时密码见 /data1/error.log</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">[root@MyServer ~]&gt; mysqld --initialize --user=mysql --datadir=/data2</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 这里无输出，临时密码见 /data1/error.log</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">[root@MyServer mysql56]&gt; <span class="built_in">pwd</span></span><br><span class="line">/usr/<span class="built_in">local</span>/mysql56</span><br><span class="line">[root@MyServer mysql56]&gt; scripts/mysql_install_db  --user=mysql --datadir=/data3</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 这里有部分信息输出</span></span><br><span class="line"><span class="comment"># 安装后，需要检查error.log 确保没有错误出现</span></span><br><span class="line"><span class="comment"># 注意使用空密码登录后，修改密码</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">[root@MyServer mysql56]&gt; scripts/mysql_install_db  --user=mysql --datadir=/data4</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 这里有部分信息输出</span></span><br><span class="line"><span class="comment"># 安装后，需要检查error.log 确保没有错误出现</span></span><br><span class="line"><span class="comment"># 注意使用空密码登录后，修改密码</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">[root@MyServer ~]&gt; cp /usr/<span class="built_in">local</span>/mysql/support-files/mysqld_multi.server  /etc/init.d/mysqld_multid </span><br><span class="line"><span class="comment"># 拷贝启动脚本，方便自启</span></span><br><span class="line">[root@MyServer ~]&gt; chkconfig mysqld_multid on</span><br><span class="line"></span><br><span class="line">[root@MyServer ~]&gt; mysqld_multi report                       </span><br><span class="line">Reporting MySQL servers</span><br><span class="line">MySQL server from group: mysqld1 is not running</span><br><span class="line">MySQL server from group: mysqld2 is not running</span><br><span class="line">MySQL server from group: mysqld3 is not running</span><br><span class="line">MySQL server from group: mysqld4 is not running</span><br><span class="line"></span><br><span class="line">[root@MyServer ~]&gt; mysqld_multi  report</span><br><span class="line">Reporting MySQL servers</span><br><span class="line">MySQL server from group: mysqld1 is running</span><br><span class="line">MySQL server from group: mysqld2 is running</span><br><span class="line">MySQL server from group: mysqld3 is running</span><br><span class="line">MySQL server from group: mysqld4 is running</span><br><span class="line"></span><br><span class="line">[root@MyServer ~]&gt; ps -ef | grep mysqld</span><br><span class="line">root     13859     1  0 22:35 pts/1    00:00:00 /bin/sh /usr/<span class="built_in">local</span>/mysql/bin/mysqld_safe --server-id=11 --datadir=/data1 --basedir=/usr/<span class="built_in">local</span>/mysql --port=3307 --socket=/tmp/mysql.sock1</span><br><span class="line">root     13865     1  0 22:35 pts/1    00:00:00 /bin/sh /usr/<span class="built_in">local</span>/mysql/bin/mysqld_safe --server-id=22 --datadir=/data2 --basedir=/usr/<span class="built_in">local</span>/mysql --port=3308 --socket=/tmp/mysql.sock2</span><br><span class="line">root     13872     1  0 22:35 pts/1    00:00:00 /bin/sh /usr/<span class="built_in">local</span>/mysql/bin/mysqld_safe --server-id=33 --datadir=/data3 --basedir=/usr/<span class="built_in">local</span>/mysql56 --port=3309 --socket=/tmp/mysql.sock3 --plugin_dir=/usr/<span class="built_in">local</span>/mysql56/lib/plugin</span><br><span class="line">root     13886     1  0 22:35 pts/1    00:00:00 /bin/sh /usr/<span class="built_in">local</span>/mysql/bin/mysqld_safe --server-id=44 --datadir=/data4 --basedir=/usr/<span class="built_in">local</span>/mysql56 --port=3310 --socket=/tmp/mysql.sock4 --plugin_dir=/usr/<span class="built_in">local</span>/mysql56/lib/plugin</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 上面是mysqld_safe的守护进程</span></span><br><span class="line"><span class="comment"># 下面是实际的mysqld的进程，观察mysqld的路径</span></span><br><span class="line"><span class="comment"># 因为指定了basedir，所以会自动识别mysqld的路径</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">mysql    17783 13859  0 22:35 pts/1    00:00:00 /usr/<span class="built_in">local</span>/mysql-5.7.9-linux-glibc2.5-x86_64/bin/mysqld --basedir=/usr/<span class="built_in">local</span>/mysql --datadir=/data1 --plugin-dir=/usr/<span class="built_in">local</span>/mysql/lib/plugin --user=mysql --server-id=11 --<span class="built_in">log</span>-error=/data1/error.log --pid-file=/data1/MyServer.pid --socket=/tmp/mysql.sock1 --port=3307</span><br><span class="line">mysql    17784 13865  0 22:35 pts/1    00:00:00 /usr/<span class="built_in">local</span>/mysql-5.7.9-linux-glibc2.5-x86_64/bin/mysqld --basedir=/usr/<span class="built_in">local</span>/mysql --datadir=/data2 --plugin-dir=/usr/<span class="built_in">local</span>/mysql/lib/plugin --user=mysql --server-id=22 --<span class="built_in">log</span>-error=/data2/error.log --pid-file=/data2/MyServer.pid --socket=/tmp/mysql.sock2 --port=3308</span><br><span class="line">mysql    17819 13872  0 22:35 pts/1    00:00:00 /usr/<span class="built_in">local</span>/mysql-5.6.27-linux-glibc2.5-x86_64/bin/mysqld --basedir=/usr/<span class="built_in">local</span>/mysql56 --datadir=/data3 --plugin-dir=/usr/<span class="built_in">local</span>/mysql56/lib/plugin --user=mysql --server-id=33 --<span class="built_in">log</span>-error=/data3/error.log --pid-file=/data3/MyServer.pid --socket=/tmp/mysql.sock3 --port=3309</span><br><span class="line">mysql    17824 13886  0 22:35 pts/1    00:00:00 /usr/<span class="built_in">local</span>/mysql-5.6.27-linux-glibc2.5-x86_64/bin/mysqld --basedir=/usr/<span class="built_in">local</span>/mysql56 --datadir=/data4 --plugin-dir=/usr/<span class="built_in">local</span>/mysql56/lib/plugin --user=mysql --server-id=44 --<span class="built_in">log</span>-error=/data4/error.log --pid-file=/data4/MyServer.pid --socket=/tmp/mysql.sock4 --port=3310</span><br><span class="line">root     17988  2657  0 22:44 pts/1    00:00:00 grep mysqld</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@MyServer ~]&gt; ps -ef | grep mysqld |  grep -v mysqld_safe | grep -v grep | awk <span class="string">'&#123;print $8" "$9&#125;'</span>  </span><br><span class="line">/usr/<span class="built_in">local</span>/mysql-5.7.9-linux-glibc2.5-x86_64/bin/mysqld --basedir=/usr/<span class="built_in">local</span>/mysql</span><br><span class="line">/usr/<span class="built_in">local</span>/mysql-5.7.9-linux-glibc2.5-x86_64/bin/mysqld --basedir=/usr/<span class="built_in">local</span>/mysql</span><br><span class="line">/usr/<span class="built_in">local</span>/mysql-5.6.27-linux-glibc2.5-x86_64/bin/mysqld --basedir=/usr/<span class="built_in">local</span>/mysql56</span><br><span class="line">/usr/<span class="built_in">local</span>/mysql-5.6.27-linux-glibc2.5-x86_64/bin/mysqld --basedir=/usr/<span class="built_in">local</span>/mysql56</span><br></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<p><code>mysql3</code> 和 <code>mysql4</code>初始状态没有密码，以前可以直接使用<code>mysql -S  mysql.sock</code>登录，而现在登录的时候特别注意，因为我们使用了<code>[client]</code>标签,登录的时候如果不加<code>-p</code>参数会默认使用标签下的<code>user</code>和<code>password</code>, 然后导致登录不进去，所以需要使用如下登录方式：</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">shell&gt; mysql -u root -P3309 -S /tmp/mysql.sock3 -p</span><br><span class="line">Enter password: [直接回车]</span><br><span class="line">elcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 3</span><br><span class="line">Server version: 5.6.27-log MySQL Community Server (GPL)</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2015, Oracle and/or its affiliates. All rights reserved.</span><br><span class="line"></span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and/or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Type <span class="string">'help;'</span> or <span class="string">'\h'</span> <span class="keyword">for</span> <span class="built_in">help</span>. Type <span class="string">'\c'</span> to clear the current input statement.</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="built_in">set</span> password = password(<span class="string">"123"</span>); <span class="comment">#进行修改密码</span></span><br></pre></td></tr></table></figure>
<ul>
<li><strong>设置login-path</strong><br>设置<code>login-path</code>主要为了能够简化登录，同时还可以让每个数据库的密码都不同，避免使用[client]下的统一用户名密码<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@MyServer ~]&gt; mysql_config_editor  <span class="built_in">set</span> -G mysql1 -u root -p -S /tmp/mysql.sock1</span><br><span class="line">[root@MyServer ~]&gt; mysql_config_editor  <span class="built_in">set</span> -G mysql2 -u root -p -S /tmp/mysql.sock2</span><br><span class="line">[root@MyServer ~]&gt; mysql_config_editor  <span class="built_in">set</span> -G mysql3 -u root -p -S /tmp/mysql.sock3</span><br><span class="line">[root@MyServer ~]&gt; mysql_config_editor  <span class="built_in">set</span> -G mysql4 -u root -p -S /tmp/mysql.sock4</span><br><span class="line"></span><br><span class="line"><span class="comment"># 然后可以使用mysql --login-path=mysql1 这种方式登录</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- mysql1 </span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line">mysql&gt; select version();</span><br><span class="line">+<span class="comment">-----------+</span></span><br><span class="line">| version() |</span><br><span class="line">+<span class="comment">-----------+</span></span><br><span class="line">| 5.7.9-log |</span><br><span class="line">+<span class="comment">-----------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">show</span> <span class="keyword">variables</span> <span class="keyword">like</span> <span class="string">"port"</span>; </span><br><span class="line">+<span class="comment">---------------+-------+</span></span><br><span class="line">| Variable_name | Value |</span><br><span class="line">+<span class="comment">---------------+-------+</span></span><br><span class="line">| port          | 3307  |</span><br><span class="line">+<span class="comment">---------------+-------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- mysql2</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line">mysql&gt; <span class="keyword">select</span> <span class="keyword">version</span>();</span><br><span class="line">+<span class="comment">-----------+</span></span><br><span class="line">| version() |</span><br><span class="line">+<span class="comment">-----------+</span></span><br><span class="line">| 5.7.9-log |</span><br><span class="line">+<span class="comment">-----------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">show</span> <span class="keyword">variables</span> <span class="keyword">like</span> <span class="string">"port"</span>;</span><br><span class="line">+<span class="comment">---------------+-------+</span></span><br><span class="line">| Variable_name | Value |</span><br><span class="line">+<span class="comment">---------------+-------+</span></span><br><span class="line">| port          | 3308  |</span><br><span class="line">+<span class="comment">---------------+-------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- mysql3</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line">mysql&gt; <span class="keyword">select</span> <span class="keyword">version</span>();</span><br><span class="line">+<span class="comment">------------+</span></span><br><span class="line">| version()  |</span><br><span class="line">+<span class="comment">------------+</span></span><br><span class="line">| 5.6.27-log |  <span class="comment">-- mysql 5.6.27 </span></span><br><span class="line">+<span class="comment">------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">show</span> <span class="keyword">variables</span> <span class="keyword">like</span> <span class="string">"port"</span>;</span><br><span class="line">+<span class="comment">---------------+-------+</span></span><br><span class="line">| Variable_name | Value |</span><br><span class="line">+<span class="comment">---------------+-------+</span></span><br><span class="line">| port          | 3309  |</span><br><span class="line">+<span class="comment">---------------+-------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- mysql4</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line">mysql&gt; <span class="keyword">select</span> <span class="keyword">version</span>();</span><br><span class="line">+<span class="comment">------------+</span></span><br><span class="line">| version()  |</span><br><span class="line">+<span class="comment">------------+</span></span><br><span class="line">| 5.6.27-log |  <span class="comment">-- mysql 5.6.27</span></span><br><span class="line">+<span class="comment">------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">show</span> <span class="keyword">variables</span> <span class="keyword">like</span> <span class="string">"port"</span>;</span><br><span class="line">+<span class="comment">---------------+-------+</span></span><br><span class="line">| Variable_name | Value |</span><br><span class="line">+<span class="comment">---------------+-------+</span></span><br><span class="line">| port          | 3310  |</span><br><span class="line">+<span class="comment">---------------+-------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<h2 id="二-SSL安装"><a href="#二-SSL安装" class="headerlink" title="二. SSL安装"></a>二. SSL安装</h2><p>SSL（Secure Socket Layer）是维护Client - Server之间加密通讯的一套安全协议；</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like "port";</span><br><span class="line">+<span class="comment">---------------+-------+</span></span><br><span class="line">| Variable_name | Value |</span><br><span class="line">+<span class="comment">---------------+-------+</span></span><br><span class="line">| port          | 3307  |</span><br><span class="line">+<span class="comment">---------------+-------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">show</span> <span class="keyword">variables</span> <span class="keyword">like</span> <span class="string">"%ssl%"</span>;</span><br><span class="line">+<span class="comment">---------------+----------+</span></span><br><span class="line">| Variable_name | Value    |</span><br><span class="line">+<span class="comment">---------------+----------+</span></span><br><span class="line">| have_openssl  | DISABLED |  <span class="comment">--  SSL被禁止了</span></span><br><span class="line">| have_ssl      | DISABLED |</span><br><span class="line">| ssl_ca        |          |</span><br><span class="line">| ssl_capath    |          |</span><br><span class="line">| ssl_cert      |          |</span><br><span class="line">| ssl_cipher    |          |</span><br><span class="line">| ssl_crl       |          |</span><br><span class="line">| ssl_crlpath   |          |</span><br><span class="line">| ssl_key       |          |</span><br><span class="line">+<span class="comment">---------------+----------+</span></span><br><span class="line">9 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>经过之前的多实例安装，是没有开启SSL配置的</p>
</blockquote>
<h3 id="1-开启SSL-5-7-9"><a href="#1-开启SSL-5-7-9" class="headerlink" title="1. 开启SSL (5.7.9)"></a>1. 开启SSL (5.7.9)</h3><ul>
<li>环境说明<ul>
<li>虚拟机1：MyServer； IP：172.18.14.68, MySQL实例1 - mysql1</li>
<li>虚拟机2：MyServer； IP：172.18.14.41, MySQL客户端<blockquote>
<p>操作过程中看到的192.168.115.223 是宿主机IP，因为使用KVM虚拟机的NAT功能，所以会被转换</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 当前虚拟机1 MyServer</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">[root@MyServer mysql]&gt; <span class="built_in">pwd</span></span><br><span class="line">/usr/<span class="built_in">local</span>/mysql</span><br><span class="line">[root@MyServer mysql]&gt; bin/mysql_ssl_rsa_setup  --datadir=/data1 --user=mysql --uid=mysql </span><br><span class="line"><span class="comment"># 使用--uid后，就不需要chown mysql.mysql *.pem</span></span><br><span class="line"></span><br><span class="line">[root@MyServer data1]<span class="comment"># pwd</span></span><br><span class="line">/data1</span><br><span class="line">[root@MyServer data1]<span class="comment"># ll | grep pem</span></span><br><span class="line">-rw-------. 1 mysql mysql      1675 Nov 25 23:55 ca-key.pem</span><br><span class="line">-rw-r--r--. 1 mysql mysql      1070 Nov 25 23:55 ca.pem</span><br><span class="line">-rw-r--r--. 1 mysql mysql      1078 Nov 25 23:55 client-cert.pem <span class="comment">#客户端证书文件</span></span><br><span class="line">-rw-------. 1 mysql mysql      1679 Nov 25 23:55 client-key.pem  <span class="comment">#客户端私钥文件</span></span><br><span class="line">-rw-------. 1 mysql mysql      1675 Nov 25 23:55 private_key.pem <span class="comment">#用于密钥交换的公钥</span></span><br><span class="line">-rw-r--r--. 1 mysql mysql       451 Nov 25 23:55 public_key.pem <span class="comment">#用户密钥交换的私钥</span></span><br><span class="line">-rw-r--r--. 1 mysql mysql      1078 Nov 25 23:55 server-cert.pem <span class="comment">#服务器端证书文件</span></span><br><span class="line">-rw-------. 1 mysql mysql      1679 Nov 25 23:55 server-key.pem <span class="comment">#服务器端私钥文件</span></span><br><span class="line">[root@MyServer data1]&gt; mysqld_multi  stop 1</span><br><span class="line">[root@MyServer data1]&gt; mysqld_multi  start 1</span><br></pre></td></tr></table></figure>
</blockquote>
</li>
</ul>
</li>
</ul>
<blockquote>
<p>关于几个pem文件的用途说面，见<a href="http://dev.mysql.com/doc/relnotes/mysql/5.7/en/news-5-7-5.html" target="_blank" rel="noopener">官方文档</a>，并搜索关键字<code>private/public key-pair</code></p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- 当前虚拟机1 MyServer ,当前实例为 mysql1</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line">mysql&gt; show variables like "port";</span><br><span class="line">+<span class="comment">---------------+-------+</span></span><br><span class="line">| Variable_name | Value |</span><br><span class="line">+<span class="comment">---------------+-------+</span></span><br><span class="line">| port          | 3307  |</span><br><span class="line">+<span class="comment">---------------+-------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">show</span> <span class="keyword">variables</span> <span class="keyword">like</span> <span class="string">"%ssl%"</span>;</span><br><span class="line">+<span class="comment">---------------+-----------------+</span></span><br><span class="line">| Variable_name | Value           |</span><br><span class="line">+<span class="comment">---------------+-----------------+</span></span><br><span class="line">| have_openssl  | YES             |  <span class="comment">-- 已经支持SSL</span></span><br><span class="line">| have_ssl      | YES             |</span><br><span class="line">| ssl_ca        | ca.pem          |</span><br><span class="line">| ssl_capath    |                 |</span><br><span class="line">| ssl_cert      | server-cert.pem |  <span class="comment">-- 公钥文件</span></span><br><span class="line">| ssl_cipher    |                 |</span><br><span class="line">| ssl_crl       |                 |</span><br><span class="line">| ssl_crlpath   |                 |</span><br><span class="line">| ssl_key       | server-key.pem  |  <span class="comment">-- 私钥文件</span></span><br><span class="line">+<span class="comment">---------------+-----------------+</span></span><br><span class="line">9 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; \s  <span class="comment">-- status</span></span><br><span class="line"><span class="comment">--------------</span></span><br><span class="line">mysql  Ver <span class="number">14.14</span> Distrib <span class="number">5.7</span><span class="number">.9</span>, <span class="keyword">for</span> linux-glibc2<span class="number">.5</span> (x86_64) <span class="keyword">using</span>  EditLine wrapper</span><br><span class="line"></span><br><span class="line"><span class="keyword">Connection</span> <span class="keyword">id</span>:          <span class="number">2</span></span><br><span class="line"><span class="keyword">Current</span> <span class="keyword">database</span>:</span><br><span class="line"><span class="keyword">Current</span> <span class="keyword">user</span>:           root@localhost</span><br><span class="line">SSL:                    <span class="keyword">Not</span> <span class="keyword">in</span> <span class="keyword">use</span>  <span class="comment">-- 此时本地socket登录，不用SSL</span></span><br><span class="line"><span class="keyword">Current</span> pager:          stdout</span><br><span class="line"><span class="keyword">Using</span> <span class="keyword">outfile</span>:          <span class="string">''</span></span><br><span class="line"><span class="keyword">Using</span> delimiter:        ;</span><br><span class="line">Server version:         5.7.9-log MySQL Community Server (GPL)</span><br><span class="line">Protocol version:       10</span><br><span class="line">Connection:             Localhost via UNIX socket</span><br><span class="line">Server characterset:    utf8mb4</span><br><span class="line">Db     characterset:    utf8mb4</span><br><span class="line">Client characterset:    utf8</span><br><span class="line">Conn.  characterset:    utf8</span><br><span class="line">UNIX socket:            /tmp/mysql.sock1</span><br><span class="line">Uptime:                 6 min 16 sec</span><br><span class="line"></span><br><span class="line">Threads: 1  Questions: 7  Slow queries: 0  Opens: 108  <span class="keyword">Flush</span> <span class="keyword">tables</span>: <span class="number">1</span>  <span class="keyword">Open</span> <span class="keyword">tables</span>: <span class="number">101</span>  Queries per <span class="keyword">second</span> <span class="keyword">avg</span>: <span class="number">0.018</span></span><br><span class="line"><span class="comment">--------------</span></span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">create</span> <span class="keyword">user</span> <span class="string">'burn'</span>@<span class="string">'%'</span> <span class="keyword">identified</span> <span class="keyword">by</span> <span class="string">'123'</span>; <span class="comment">-- 创建一个burn@%用户，先不require ssl</span></span><br><span class="line">Query OK, 0 rows affected (0.02 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; grant all on *.* to 'burn'@'%';</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from mysql.user where user='burn'\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">                  Host: %</span><br><span class="line">                  User: burn</span><br><span class="line">           Select_priv: Y</span><br><span class="line">           Insert_priv: Y</span><br><span class="line">           Update_priv: Y</span><br><span class="line">           Delete_priv: Y</span><br><span class="line">           Create_priv: Y</span><br><span class="line">             Drop_priv: Y</span><br><span class="line">           Reload_priv: Y</span><br><span class="line">         Shutdown_priv: Y</span><br><span class="line">          Process_priv: Y</span><br><span class="line">             File_priv: Y</span><br><span class="line">            Grant_priv: N</span><br><span class="line">       References_priv: Y</span><br><span class="line">            Index_priv: Y</span><br><span class="line">            Alter_priv: Y</span><br><span class="line">          Show_db_priv: Y</span><br><span class="line">            Super_priv: Y</span><br><span class="line"> Create_tmp_table_priv: Y</span><br><span class="line">      Lock_tables_priv: Y</span><br><span class="line">          Execute_priv: Y</span><br><span class="line">       Repl_slave_priv: Y</span><br><span class="line">      Repl_client_priv: Y</span><br><span class="line">      Create_view_priv: Y</span><br><span class="line">        Show_view_priv: Y</span><br><span class="line">   Create_routine_priv: Y</span><br><span class="line">    Alter_routine_priv: Y</span><br><span class="line">      Create_user_priv: Y</span><br><span class="line">            Event_priv: Y</span><br><span class="line">          Trigger_priv: Y</span><br><span class="line">Create_tablespace_priv: Y</span><br><span class="line">              ssl_type:         <span class="comment">--  此处为空</span></span><br><span class="line">            ssl_cipher: </span><br><span class="line">           x509_issuer: </span><br><span class="line">          x509_subject: </span><br><span class="line">         max_questions: 0</span><br><span class="line">           max_updates: 0</span><br><span class="line">       max_connections: 0</span><br><span class="line">  max_user_connections: 0</span><br><span class="line">                plugin: mysql_native_password</span><br><span class="line"> authentication_string: *23AE809DDACAF96AF0FD78ED04B6A265E05AA257</span><br><span class="line">      password_expired: N</span><br><span class="line"> password_last_changed: 2015-11-26 09:55:31</span><br><span class="line">     password_lifetime: NULL</span><br><span class="line">        account_locked: N</span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 当前虚拟机2  MyServer2</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">[root@MyServer2 bin]&gt; ./mysql -u burn -h 172.18.14.68 -P3307 -p</span><br><span class="line">Enter password: </span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 6</span><br><span class="line">Server version: 5.7.9-log MySQL Community Server (GPL)</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2015, Oracle and/or its affiliates. All rights reserved.</span><br><span class="line"></span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and/or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Type <span class="string">'help;'</span> or <span class="string">'\h'</span> <span class="keyword">for</span> <span class="built_in">help</span>. Type <span class="string">'\c'</span> to clear the current input statement.</span><br><span class="line"></span><br><span class="line">mysql&gt; \s</span><br><span class="line">--------------</span><br><span class="line">./mysql  Ver 14.14 Distrib 5.7.9, <span class="keyword">for</span> linux-glibc2.5 (x86_64) using  EditLine wrapper</span><br><span class="line"></span><br><span class="line">Connection id:          6</span><br><span class="line">Current database:</span><br><span class="line">Current user:           burn@192.168.115.223</span><br><span class="line">SSL:                    Cipher <span class="keyword">in</span> use is DHE-RSA-AES256-SHA  <span class="comment">#已经使用了ssl登录了</span></span><br><span class="line">Current pager:          stdout</span><br><span class="line">Using outfile:          <span class="string">''</span></span><br><span class="line">Using delimiter:        ;</span><br><span class="line">Server version:         5.7.9-log MySQL Community Server (GPL)</span><br><span class="line">Protocol version:       10</span><br><span class="line">Connection:             172.18.14.68 via TCP/IP</span><br><span class="line">Server characterset:    utf8mb4</span><br><span class="line">Db     characterset:    utf8mb4</span><br><span class="line">Client characterset:    utf8</span><br><span class="line">Conn.  characterset:    utf8</span><br><span class="line">TCP port:               3307</span><br><span class="line">Uptime:                 3 min 6 sec</span><br><span class="line"></span><br><span class="line">Threads: 2  Questions: 19  Slow queries: 0  Opens: 109  Flush tables: 1  Open tables: 102  Queries per second avg: 0.102</span><br><span class="line">--------</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 当前虚拟机2 MyServer2</span></span><br><span class="line"><span class="comment"># 上面测试中我们没有使用--ssl参数，也是用了ssl登录的，原因如下</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">[root@MyServer2 bin]&gt; ./mysql --<span class="built_in">help</span> | grep ssl                </span><br><span class="line">  --ssl               If <span class="built_in">set</span> to ON, this option enforces that SSL is</span><br><span class="line">                      server. To <span class="built_in">disable</span> client SSL capabilities use --ssl=OFF.</span><br><span class="line">                      (Defaults to on; use --skip-ssl to <span class="built_in">disable</span>.)</span><br><span class="line">                      <span class="comment"># 这里说，默认是开启的，可以用--skip-ssl 禁用</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 当前虚拟机2 MyServer2 </span></span><br><span class="line"><span class="comment"># 禁用ssl登录测试</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">[root@MyServer2 bin]&gt; ./mysql -u burn -h 172.18.14.68 -P3307 -p --skip-ssl  <span class="comment">#这里跳过了ssl</span></span><br><span class="line">Enter password: </span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 7</span><br><span class="line">Server version: 5.7.9-log MySQL Community Server (GPL)</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2015, Oracle and/or its affiliates. All rights reserved.</span><br><span class="line"></span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and/or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Type <span class="string">'help;'</span> or <span class="string">'\h'</span> <span class="keyword">for</span> <span class="built_in">help</span>. Type <span class="string">'\c'</span> to clear the current input statement.</span><br><span class="line"></span><br><span class="line">mysql&gt; \s</span><br><span class="line">--------------</span><br><span class="line">./mysql  Ver 14.14 Distrib 5.7.9, <span class="keyword">for</span> linux-glibc2.5 (x86_64) using  EditLine wrapper</span><br><span class="line"></span><br><span class="line">Connection id:          7</span><br><span class="line">Current database:</span><br><span class="line">Current user:           burn@192.168.115.223</span><br><span class="line">SSL:                    Not <span class="keyword">in</span> use    <span class="comment"># 果然就禁用了ssl</span></span><br><span class="line">Current pager:          stdout</span><br><span class="line">Using outfile:          <span class="string">''</span></span><br><span class="line">Using delimiter:        ;</span><br><span class="line">Server version:         5.7.9-log MySQL Community Server (GPL)</span><br><span class="line">Protocol version:       10</span><br><span class="line">Connection:             172.18.14.68 via TCP/IP</span><br><span class="line">Server characterset:    utf8mb4</span><br><span class="line">Db     characterset:    utf8mb4</span><br><span class="line">Client characterset:    utf8</span><br><span class="line">Conn.  characterset:    utf8</span><br><span class="line">TCP port:               3307</span><br><span class="line">Uptime:                 5 min 50 sec</span><br><span class="line"></span><br><span class="line">Threads: 2  Questions: 24  Slow queries: 0  Opens: 109  Flush tables: 1  Open tables: 102  Queries per second avg: 0.068</span><br><span class="line">--------------</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- 当前虚拟机1 MyServer, 当前实例mysql1</span></span><br><span class="line"><span class="comment">-- 让用户必须使用ssl</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line">mysql&gt; show variables like "port";</span><br><span class="line">+<span class="comment">---------------+-------+</span></span><br><span class="line">| Variable_name | Value |</span><br><span class="line">+<span class="comment">---------------+-------+</span></span><br><span class="line">| port          | 3307  |</span><br><span class="line">+<span class="comment">---------------+-------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">alter</span> <span class="keyword">user</span> <span class="string">'burn'</span>@<span class="string">'%'</span> require ssl;</span><br><span class="line">Query OK, 0 rows affected (0.02 sec)</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 当前虚拟机2 MyServer2</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">[root@MyServer2 bin]&gt; ./mysql -u burn -h 172.18.14.68 -P3307 -p --skip-ssl</span><br><span class="line">Enter password: </span><br><span class="line">ERROR 1045 (28000): Access denied <span class="keyword">for</span> user <span class="string">'burn'</span>@<span class="string">'192.168.115.223'</span> (using password: YES) <span class="comment">## 禁用了SSL就无法登录了</span></span><br><span class="line"><span class="comment">##</span></span><br><span class="line">[root@MyServer2 bin]&gt; ./mysql -u burn -h 172.18.14.68 -P3307 -p <span class="comment"># 默认就启用ssl</span></span><br><span class="line">Enter password: </span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 9</span><br><span class="line">Server version: 5.7.9-log MySQL Community Server (GPL)</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2015, Oracle and/or its affiliates. All rights reserved.</span><br><span class="line"></span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and/or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Type <span class="string">'help;'</span> or <span class="string">'\h'</span> <span class="keyword">for</span> <span class="built_in">help</span>. Type <span class="string">'\c'</span> to clear the current input statement.</span><br><span class="line"></span><br><span class="line">mysql&gt; \s</span><br><span class="line">--------------</span><br><span class="line">./mysql  Ver 14.14 Distrib 5.7.9, <span class="keyword">for</span> linux-glibc2.5 (x86_64) using  EditLine wrapper</span><br><span class="line"></span><br><span class="line">Connection id:          9</span><br><span class="line">Current database:</span><br><span class="line">Current user:           burn@192.168.115.223</span><br><span class="line">SSL:                    Cipher <span class="keyword">in</span> use is DHE-RSA-AES256-SHA  <span class="comment"># 确实启用了</span></span><br><span class="line">Current pager:          stdout</span><br><span class="line">Using outfile:          <span class="string">''</span></span><br><span class="line">Using delimiter:        ;</span><br><span class="line">Server version:         5.7.9-log MySQL Community Server (GPL)</span><br><span class="line">Protocol version:       10</span><br><span class="line">Connection:             172.18.14.68 via TCP/IP</span><br><span class="line">Server characterset:    utf8mb4</span><br><span class="line">Db     characterset:    utf8mb4</span><br><span class="line">Client characterset:    utf8</span><br><span class="line">Conn.  characterset:    utf8</span><br><span class="line">TCP port:               3307</span><br><span class="line">Uptime:                 14 min 25 sec</span><br><span class="line"></span><br><span class="line">Threads: 2  Questions: 32  Slow queries: 0  Opens: 109  Flush tables: 1  Open tables: 102  Queries per second avg: 0.036</span><br><span class="line">--------------</span><br></pre></td></tr></table></figure>
<h3 id="2-开启证书认证-5-7-9"><a href="#2-开启证书认证-5-7-9" class="headerlink" title="2. 开启证书认证(5.7.9)"></a>2. 开启证书认证(5.7.9)</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- 当前虚拟机1 MyServer， 当前实例 msyql1</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line">mysql&gt; show variables like "port";</span><br><span class="line">+<span class="comment">---------------+-------+</span></span><br><span class="line">| Variable_name | Value |</span><br><span class="line">+<span class="comment">---------------+-------+</span></span><br><span class="line">| port          | 3307  |</span><br><span class="line">+<span class="comment">---------------+-------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">create</span> <span class="keyword">user</span> <span class="string">'burn_x509'</span>@<span class="string">'%'</span> <span class="keyword">identified</span> <span class="keyword">by</span> <span class="string">'123'</span> require x509; <span class="comment">-- 启用证书认证</span></span><br><span class="line">Query OK, 0 rows affected (0.02 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; grant all on *.* to 'burn'@'%';</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from mysql.user where user='burn_x509'\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">                  Host: %</span><br><span class="line">                  User: burn_x509</span><br><span class="line">           Select_priv: N</span><br><span class="line">           Insert_priv: N</span><br><span class="line">           Update_priv: N</span><br><span class="line">           Delete_priv: N</span><br><span class="line">           Create_priv: N</span><br><span class="line">             Drop_priv: N</span><br><span class="line">           Reload_priv: N</span><br><span class="line">         Shutdown_priv: N</span><br><span class="line">          Process_priv: N</span><br><span class="line">             File_priv: N</span><br><span class="line">            Grant_priv: N</span><br><span class="line">       References_priv: N</span><br><span class="line">            Index_priv: N</span><br><span class="line">            Alter_priv: N</span><br><span class="line">          Show_db_priv: N</span><br><span class="line">            Super_priv: N</span><br><span class="line"> Create_tmp_table_priv: N</span><br><span class="line">      Lock_tables_priv: N</span><br><span class="line">          Execute_priv: N</span><br><span class="line">       Repl_slave_priv: N</span><br><span class="line">      Repl_client_priv: N</span><br><span class="line">      Create_view_priv: N</span><br><span class="line">        Show_view_priv: N</span><br><span class="line">   Create_routine_priv: N</span><br><span class="line">    Alter_routine_priv: N</span><br><span class="line">      Create_user_priv: N</span><br><span class="line">            Event_priv: N</span><br><span class="line">          Trigger_priv: N</span><br><span class="line">Create_tablespace_priv: N</span><br><span class="line">              ssl_type: X509    <span class="comment">-- 使用X509登录</span></span><br><span class="line">            ssl_cipher: </span><br><span class="line">           x509_issuer: </span><br><span class="line">          x509_subject: </span><br><span class="line">         max_questions: 0</span><br><span class="line">           max_updates: 0</span><br><span class="line">       max_connections: 0</span><br><span class="line">  max_user_connections: 0</span><br><span class="line">                plugin: mysql_native_password</span><br><span class="line"> authentication_string: *23AE809DDACAF96AF0FD78ED04B6A265E05AA257</span><br><span class="line">      password_expired: N</span><br><span class="line"> password_last_changed: 2015-11-26 10:14:43</span><br><span class="line">     password_lifetime: NULL</span><br><span class="line">        account_locked: N</span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 当前虚拟机2 MyServer2 </span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">[root@MyServer2 bin]&gt; ./mysql -u burn_x509 -h 172.18.14.68 -P3307 -p</span><br><span class="line">Enter password: </span><br><span class="line">ERROR 1045 (28000): Access denied <span class="keyword">for</span> user <span class="string">'burn_x509'</span>@<span class="string">'192.168.115.223'</span> (using password: YES)  <span class="comment"># 即使默认开启了ssl，也是无法登录的</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 当前虚拟机1 MyServer</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">[root@MyServer data1]&gt; <span class="built_in">pwd</span></span><br><span class="line">/data1</span><br><span class="line">[root@MyServer data1]&gt; ll | grep pem</span><br><span class="line">-rw-------. 1 mysql mysql      1675 Nov 25 23:55 ca-key.pem</span><br><span class="line">-rw-r--r--. 1 mysql mysql      1070 Nov 25 23:55 ca.pem</span><br><span class="line">-rw-r--r--. 1 mysql mysql      1078 Nov 25 23:55 client-cert.pem</span><br><span class="line">-rw-------. 1 mysql mysql      1679 Nov 25 23:55 client-key.pem</span><br><span class="line">-rw-------. 1 mysql mysql      1675 Nov 25 23:55 private_key.pem</span><br><span class="line">-rw-r--r--. 1 mysql mysql       451 Nov 25 23:55 public_key.pem</span><br><span class="line">-rw-r--r--. 1 mysql mysql      1078 Nov 25 23:55 server-cert.pem</span><br><span class="line">-rw-------. 1 mysql mysql      1679 Nov 25 23:55 server-key.pem</span><br><span class="line">[root@MyServer data1]&gt; scp client-cert.pem  client-key.pem  root@172.18.14.41:~/</span><br><span class="line">The authenticity of host <span class="string">'172.18.14.41 (172.18.14.41)'</span> can<span class="string">'t be established.</span></span><br><span class="line"><span class="string">RSA key fingerprint is 5f:f5:3c:b0:57:79:8d:50:c6:c8:69:b0:90:6e:98:3b.</span></span><br><span class="line"><span class="string">Are you sure you want to continue connecting (yes/no)? yes</span></span><br><span class="line"><span class="string">Warning: Permanently added '</span>172.18.14.41<span class="string">' (RSA) to the list of known hosts.</span></span><br><span class="line"><span class="string">root@172.18.14.41'</span>s password: </span><br><span class="line">client-cert.pem                                                                                           100% 1078     1.1KB/s   00:00    </span><br><span class="line">client-key.pem                                                                                            100% 1679     1.6KB/s   00:00</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 当前虚拟机2 MyServer2</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">[root@MyServer2 ~]&gt; ll | grep pem</span><br><span class="line">-rw-r--r--.  1 root root       1078 Nov 26 10:22 client-cert.pem</span><br><span class="line">-rw-------.  1 root root       1679 Nov 26 10:22 client-key.pem</span><br><span class="line"></span><br><span class="line">[root@MyServer2 ~]&gt; mysql -u burn_x509 -h 172.18.14.68 -P 3307 -p --ssl-cert=./client-cert.pem  --ssl-key=./client-key.pem </span><br><span class="line">Enter password: </span><br><span class="line">Welcome to the MySQL monitor.  Commands end with ; or \g.</span><br><span class="line">Your MySQL connection id is 12</span><br><span class="line">Server version: 5.7.9-log MySQL Community Server (GPL)</span><br><span class="line"></span><br><span class="line">Copyright (c) 2000, 2015, Oracle and/or its affiliates. All rights reserved.</span><br><span class="line"></span><br><span class="line">Oracle is a registered trademark of Oracle Corporation and/or its</span><br><span class="line">affiliates. Other names may be trademarks of their respective</span><br><span class="line">owners.</span><br><span class="line"></span><br><span class="line">Type <span class="string">'help;'</span> or <span class="string">'\h'</span> <span class="keyword">for</span> <span class="built_in">help</span>. Type <span class="string">'\c'</span> to clear the current input statement.</span><br><span class="line"></span><br><span class="line">mysql&gt; \s</span><br><span class="line">--------------</span><br><span class="line">mysql  Ver 14.14 Distrib 5.6.27, <span class="keyword">for</span> linux-glibc2.5 (x86_64) using  EditLine wrapper</span><br><span class="line"></span><br><span class="line">Connection id:          12</span><br><span class="line">Current database:</span><br><span class="line">Current user:           burn_x509@192.168.115.223</span><br><span class="line">SSL:                    Cipher <span class="keyword">in</span> use is DHE-RSA-AES256-SHA <span class="comment"># 使用加密方式登录，且通过证书，因为这个用户 require X509</span></span><br><span class="line">Current pager:          stdout</span><br><span class="line">Using outfile:          <span class="string">''</span></span><br><span class="line">Using delimiter:        ;</span><br><span class="line">Server version:         5.7.9-log MySQL Community Server (GPL)</span><br><span class="line">Protocol version:       10</span><br><span class="line">Connection:             172.18.14.68 via TCP/IP</span><br><span class="line">Server characterset:    utf8mb4</span><br><span class="line">Db     characterset:    utf8mb4</span><br><span class="line">Client characterset:    utf8</span><br><span class="line">Conn.  characterset:    utf8</span><br><span class="line">TCP port:               3307</span><br><span class="line">Uptime:                 32 min 15 sec</span><br><span class="line"></span><br><span class="line">Threads: 2  Questions: 41  Slow queries: 0  Opens: 114  Flush tables: 1  Open tables: 107  Queries per second avg: 0.021</span><br><span class="line">--------------</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://chenwenning.github.io/2018/05/30/MySQL学习笔记(Day006)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="陈汶宁">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://pic.qqtn.com/up/2017-10/2017101317054482087.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="CHENWENNING BLOG">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/30/MySQL学习笔记(Day006)/" itemprop="url">MySQL学习笔记（Day006：存储引擎二/多实例安装）</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-05-30T17:29:16+08:00">
                2018-05-30
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/mysql/" itemprop="url" rel="index">
                    <span itemprop="name">mysql</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/05/30/MySQL学习笔记(Day006)/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2018/05/30/MySQL学习笔记(Day006)/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="MySQL学习笔记（Day006：存储引擎二-多实例安装）"><a href="#MySQL学习笔记（Day006：存储引擎二-多实例安装）" class="headerlink" title="MySQL学习笔记（Day006：存储引擎二/多实例安装）"></a>MySQL学习笔记（Day006：存储引擎二/多实例安装）</h1><p>@(MySQL学习)</p>
<p>[TOC]</p>
<h2 id="一-MyISAM存储引擎-下"><a href="#一-MyISAM存储引擎-下" class="headerlink" title="一. MyISAM存储引擎(下)"></a>一. MyISAM存储引擎(下)</h2><h3 id="1-MyISAM还在使用的原因"><a href="#1-MyISAM还在使用的原因" class="headerlink" title="1. MyISAM还在使用的原因"></a>1. MyISAM还在使用的原因</h3><ul>
<li>历史原因，需要逐步替换</li>
<li>部分如User，DB等系统表(MyISAM引擎)，可以直接拷贝，比较方便</li>
<li>性能好，或者存储小<code>不是</code>MyISAM的优点，也不是存在的原因</li>
</ul>
<h3 id="2-MyISAM文件组成"><a href="#2-MyISAM文件组成" class="headerlink" title="2. MyISAM文件组成"></a>2. MyISAM文件组成</h3><ul>
<li><code>frm</code> 表结构文件</li>
<li><code>MYI</code> 索引文件</li>
<li><code>MYD</code> 数据文件<ul>
<li>数据文件是堆表数据结构，堆是无序数据的集合</li>
<li><code>MYI</code>中的叶子节点，指向<code>MYD</code>中的数据页</li>
<li>当数据移动到页外时，需要修改对应指针</li>
</ul>
</li>
</ul>
<h3 id="3-myisamchk"><a href="#3-myisamchk" class="headerlink" title="3. myisamchk"></a>3. myisamchk</h3><p><strong><code>myisamchk</code>通过扫描MYD文件来重建MYI文件；如果MYD文件中某条记录有问题，将跳过该记录</strong></p>
<hr>
<h2 id="二-Memory存储引擎"><a href="#二-Memory存储引擎" class="headerlink" title="二. Memory存储引擎"></a>二. Memory存储引擎</h2><h3 id="1-Memory介绍"><a href="#1-Memory介绍" class="headerlink" title="1. Memory介绍"></a>1. Memory介绍</h3><ul>
<li>全内存存储的引擎</li>
<li>数据库重启后数据丢失</li>
<li>支持哈希索引</li>
<li>不支持事物</li>
</ul>
<p>###2. Memory特性</p>
<ul>
<li><strong><code>千万不要用Memory存储引擎去做缓存(Cache)</code>, 性能上不及Redis和Memcahced</strong></li>
<li>Memory<code>不能禁用</code>，当涉及内部排序操作的临时表时，使用该存储引擎<ul>
<li><code>max_heap_table_size</code>决定使用内存的大小，默认时<code>16M</code><ul>
<li>无论该表使用的什么引擎，只要使用到临时表，或者指定Memory，都受参数影响</li>
</ul>
</li>
<li>当上面设置的内存放不下数据时，(&gt;=5.6)转为MyISAM,(&gt;=5.7)转为InnoDB<ul>
<li>注意磁盘上临时路径空间的大小(<code>tmpdir</code>)</li>
</ul>
</li>
<li>内存使用为会话(SESSION)级别，当心内核OOM</li>
</ul>
</li>
<li>支持哈希索引，且仅支持等值查询</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show global status like "%tmp%tables";</span><br><span class="line">+<span class="comment">-------------------------+-------+</span></span><br><span class="line">| Variable_name           | Value |</span><br><span class="line">+<span class="comment">-------------------------+-------+</span></span><br><span class="line">| Created_tmp_disk_tables | 0     |   <span class="comment">-- 内存放不下，转成磁盘存储的数量,如果过大，考虑增大内存参数</span></span><br><span class="line">| Created_tmp_tables      | 4     |   <span class="comment">-- 创建临时表的数量</span></span><br><span class="line">+<span class="comment">-------------------------+-------+</span></span><br><span class="line">2 rows in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">show</span> <span class="keyword">variables</span> <span class="keyword">like</span> <span class="string">'tmpdir'</span>;</span><br><span class="line">+<span class="comment">---------------+-------+</span></span><br><span class="line">| Variable_name | Value |</span><br><span class="line">+<span class="comment">---------------+-------+</span></span><br><span class="line">| tmpdir        | /tmp  |  <span class="comment">-- memory转成磁盘存储的路径</span></span><br><span class="line">+<span class="comment">---------------+-------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">show</span> <span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">User</span>\G</span><br><span class="line">*************************** <span class="number">1.</span> <span class="keyword">row</span> ***************************</span><br><span class="line"><span class="keyword">Table</span>: <span class="keyword">User</span></span><br><span class="line"><span class="keyword">Create</span> <span class="keyword">Table</span>: <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`User`</span> (</span><br><span class="line"><span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line"><span class="string">`name`</span> <span class="built_in">varchar</span>(<span class="number">128</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>),</span><br><span class="line"><span class="keyword">KEY</span> <span class="string">`name`</span> (<span class="string">`name`</span>) <span class="keyword">USING</span> <span class="keyword">HASH</span>  <span class="comment">-- 对这个字段使用USING HASH,创建hash索引</span></span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">MEMORY</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=latin1</span><br><span class="line"><span class="number">1</span> <span class="keyword">row</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<h3 id="3-Memory的物理特性"><a href="#3-Memory的物理特性" class="headerlink" title="3. Memory的物理特性"></a>3. Memory的物理特性</h3><ul>
<li>内存不会一次性分配最大空间，而是随着使用逐步增到到最大值</li>
<li>通过链表管理空闲空间</li>
<li>使用固定长度存储数据</li>
<li>不支持BLOB和TEXT类型</li>
<li>可以创建自增主键</li>
</ul>
<hr>
<h2 id="三-CSV存储引擎"><a href="#三-CSV存储引擎" class="headerlink" title="三. CSV存储引擎"></a>三. CSV存储引擎</h2><h3 id="1-CSV介绍"><a href="#1-CSV介绍" class="headerlink" title="1. CSV介绍"></a>1. CSV介绍</h3><ul>
<li>CSV - Comma-Separated Values，使用逗号分隔</li>
<li>不支持特殊字符</li>
<li>CSV是一种标准文件格式</li>
<li>文件以纯文本形式存储表格数据</li>
<li>使用广泛</li>
</ul>
<h3 id="2-CSV文件组成"><a href="#2-CSV文件组成" class="headerlink" title="2. CSV文件组成"></a>2. CSV文件组成</h3><ul>
<li><code>frm</code> 表结构</li>
<li><code>CSV</code> 数据文件</li>
<li><code>CSM</code> 元数据信息</li>
</ul>
<h3 id="2-CSV特性"><a href="#2-CSV特性" class="headerlink" title="2. CSV特性"></a>2. CSV特性</h3><ul>
<li>MySQL CSV存储引擎运行时，即创建CSV<code>文件</code></li>
<li>通过MySQL标准接口来查看和修改CSV文件</li>
<li>无需将CSV文件导入到数据库，只需创建相同字段的表结构，拷贝CSV文件即可</li>
<li>CSV存储引擎表每个字段<code>必须是NOT NULL</code>属性</li>
</ul>
<hr>
<h2 id="四-Federated存储引擎"><a href="#四-Federated存储引擎" class="headerlink" title="四.Federated存储引擎"></a>四.Federated存储引擎</h2><h3 id="1-Federated介绍"><a href="#1-Federated介绍" class="headerlink" title="1. Federated介绍"></a>1. Federated介绍</h3><ul>
<li>允许本地访问远程MySQL数据库中表的数据</li>
<li>本地不存储任何数据文件</li>
<li>类似Oracle中的DBLink</li>
<li>Federated存储引擎默认不开启, 需要在<code>my.cnf</code>的<code>[mysqld]</code>标签下添加 <code>federated</code></li>
<li>MySQL的Federated不支持异构数据库访问，MariaDB中的<code>FederatedX</code>支持</li>
</ul>
<h3 id="2-Federated-语法"><a href="#2-Federated-语法" class="headerlink" title="2. Federated 语法"></a>2. Federated 语法</h3><p><code>scheme://user_name[:password]@host_name[:port_num]/db_name/tbl_name</code></p>
<p><code>CONNECTION=&#39;mysql://username:password@hostname:port/database/tablename&#39;</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- 例子</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`T1`</span> (</span><br><span class="line"><span class="string">`A`</span> <span class="built_in">VARCHAR</span>(<span class="number">100</span>),</span><br><span class="line"><span class="keyword">UNIQUE</span> <span class="keyword">KEY</span> (<span class="string">`A`</span> (<span class="number">30</span>))</span><br><span class="line">) <span class="keyword">ENGINE</span>=FEDERATED</span><br><span class="line"><span class="keyword">CONNECTION</span>=<span class="string">'MYSQL://david:123@127.0.0.1:3306/TEST/T1'</span>;</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="五-多实例安装"><a href="#五-多实例安装" class="headerlink" title="五. 多实例安装"></a>五. 多实例安装</h2><h3 id="1-多实例介绍"><a href="#1-多实例介绍" class="headerlink" title="1.  多实例介绍"></a>1.  多实例介绍</h3><ul>
<li>一台服务器上安装多个MySQL数据库实例</li>
<li>可以充分利用服务器的硬件资源</li>
<li>通过mysqld_multi进行管理</li>
</ul>
<h3 id="2-安装要求"><a href="#2-安装要求" class="headerlink" title="2. 安装要求"></a>2. 安装要求</h3><ul>
<li><p>MySQL实例1 - <code>mysql1</code></p>
<ul>
<li>port = 3306</li>
<li>datadir = /data1</li>
<li>socket = /tmp/mysql.sock1</li>
</ul>
</li>
<li><p>MySQL实例2 - <code>mysql2</code></p>
<ul>
<li>port = 3307</li>
<li>datadir = /data2</li>
<li>socket = /tmp/mysql.sock2</li>
</ul>
</li>
<li><p>MySQL实例3 - <code>mysql3</code></p>
<ul>
<li>port = 3308</li>
<li>datadir = /data3</li>
<li>socket = /tmp/mysql.sock3</li>
</ul>
</li>
<li><p>MySQL实例4 - <code>mysql4</code></p>
<ul>
<li>port = 3309</li>
<li>datadir = /data4</li>
<li>socket = /tmp/mysql.sock4</li>
</ul>
</li>
</ul>
<blockquote>
<p><strong><code>该三个参数必须定制，且必须不同 (port / datadir / socket)</code></strong><br><code>server-id</code>和多数据库实例没有关系，和数据库复制有关系。</p>
</blockquote>
<h3 id="3-安装操作"><a href="#3-安装操作" class="headerlink" title="3. 安装操作"></a>3. 安装操作</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 多实例配置文件，可以mysqld_multi --example 查看例子</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">[root@MyServer /]&gt; cat /etc/my.cnf </span><br><span class="line"><span class="comment">#[client]           # 这个标签如果配置了用户和密码，</span></span><br><span class="line">                    <span class="comment"># 并且[mysqld_multi]下没有配置用户名密码，</span></span><br><span class="line">                    <span class="comment"># 则mysqld_multi stop时, 会使用这个密码</span></span><br><span class="line">                    <span class="comment"># 如果没有精确的匹配，则匹配[client]标签</span></span><br><span class="line"><span class="comment">#user = root        </span></span><br><span class="line"><span class="comment">#password = 123</span></span><br><span class="line"><span class="comment">#-------------</span></span><br><span class="line">[mysqld_multi]</span><br><span class="line">mysqld = /usr/<span class="built_in">local</span>/mysql/bin/mysqld_safe</span><br><span class="line">mysqladmin = /usr/<span class="built_in">local</span>/mysql/bin/mysqladmin</span><br><span class="line">user = multi_admin</span><br><span class="line">pass = 123  <span class="comment"># 官方文档中写的password，但是存在bug，需要改成pass(v5.7.9)</span></span><br><span class="line">            <span class="comment"># 写成password，start时正常，stop时，报如下错误</span></span><br><span class="line">            <span class="comment"># Access denied for user 'multi_admin'@'localhost' (using password: YES)</span></span><br><span class="line"><span class="built_in">log</span> = /var/<span class="built_in">log</span>/mysqld_multi.log</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[mysqld1]  <span class="comment"># mysqld后面的数字为GNR, 是该实例的标识</span></span><br><span class="line">           <span class="comment"># mysqld_multi  start 1,  mysqld_multi start 2-4</span></span><br><span class="line">server-id = 11</span><br><span class="line">socket = /tmp/mysql.sock1</span><br><span class="line">port = 3306</span><br><span class="line">bind_address = 0.0.0.0</span><br><span class="line">datadir = /data1</span><br><span class="line">user = mysql</span><br><span class="line">performance_schema = off</span><br><span class="line">innodb_buffer_pool_size = 32M</span><br><span class="line">skip_name_resolve = 1</span><br><span class="line">log_error = error.log</span><br><span class="line">pid-file = /data1/mysql.pid1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[mysqld2]</span><br><span class="line">server-id = 12</span><br><span class="line">socket = /tmp/mysql.sock2</span><br><span class="line">port = 3307</span><br><span class="line">bind_address = 0.0.0.0</span><br><span class="line">datadir = /data2</span><br><span class="line">user = mysql</span><br><span class="line">performance_schema = off</span><br><span class="line">innodb_buffer_pool_size = 32M</span><br><span class="line">skip_name_resolve = 1</span><br><span class="line">log_error = error.log</span><br><span class="line">pid-file = /data2/mysql.pid2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[mysqld3]</span><br><span class="line">server-id = 13</span><br><span class="line">socket = /tmp/mysql.sock3</span><br><span class="line">port = 3308</span><br><span class="line">bind_address = 0.0.0.0</span><br><span class="line">datadir = /data3</span><br><span class="line">user = mysql</span><br><span class="line">performance_schema = off</span><br><span class="line">innodb_buffer_pool_size = 32M</span><br><span class="line">skip_name_resolve = 1</span><br><span class="line">log_error = error.log</span><br><span class="line">pid-file = /data3/mysql.pid3</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[mysqld4]</span><br><span class="line">server-id = 14</span><br><span class="line">socket = /tmp/mysql.sock4</span><br><span class="line">port = 3309</span><br><span class="line">bind_address = 0.0.0.0</span><br><span class="line">datadir = /data4</span><br><span class="line">user = mysql</span><br><span class="line">performance_schema = off</span><br><span class="line">innodb_buffer_pool_size = 32M</span><br><span class="line">skip_name_resolve = 1</span><br><span class="line">log_error = error.log</span><br><span class="line">pid-file = /data4/mysql.pid4</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 准备好数据目录，并初始化安装</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">[root@MyServer ~]&gt; mkdir /data1</span><br><span class="line">[root@MyServer ~]&gt; mkdir /data2</span><br><span class="line">[root@MyServer ~]&gt; mkdir /data3</span><br><span class="line">[root@MyServer ~]&gt; mkdir /data4</span><br><span class="line">[root@MyServer ~]&gt; chown mysql.mysql /data&#123;1..4&#125;</span><br><span class="line">[root@MyServer ~]&gt; mysqld --initialize --user=mysql --datadir=/data1</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 一些日志输出，并提示临时密码，下同</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">[root@MyServer ~]&gt; mysqld --initialize --user=mysql --datadir=/data2</span><br><span class="line">[root@MyServer ~]&gt; mysqld --initialize --user=mysql --datadir=/data3</span><br><span class="line">[root@MyServer ~]&gt; mysqld --initialize --user=mysql --datadir=/data4</span><br><span class="line"><span class="comment"># 安装后，需要检查error.log 确保没有错误出现</span></span><br><span class="line">[root@MyServer ~]&gt; cp /usr/<span class="built_in">local</span>/mysql/support-files/mysqld_multi.server  /etc/init.d/mysqld_multid </span><br><span class="line"><span class="comment"># 拷贝启动脚本，方便自启</span></span><br><span class="line">[root@MyServer ~]&gt; chkconfig mysqld_multid on</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@MyServer ~]&gt; mysqld_multi  start</span><br><span class="line">[root@MyServer ~]&gt; mysqld_multi  report</span><br><span class="line">Reporting MySQL servers</span><br><span class="line">MySQL server from group: mysqld1 is running</span><br><span class="line">MySQL server from group: mysqld2 is running</span><br><span class="line">MySQL server from group: mysqld3 is running</span><br><span class="line">MySQL server from group: mysqld4 is running</span><br><span class="line">[root@MyServer ~]&gt; netstat -tunlp | grep mysql</span><br><span class="line">[root@MyServer ~]&gt; netstat -tunlp | grep mysql</span><br><span class="line">tcp        0      0 :::3307                     :::*                        LISTEN      6221/mysqld         </span><br><span class="line">tcp        0      0 :::3308                     :::*                        LISTEN      6232/mysqld         </span><br><span class="line">tcp        0      0 :::3309                     :::*                        LISTEN      6238/mysqld         </span><br><span class="line">tcp        0      0 :::3306                     :::*                        LISTEN      6201/mysqld         </span><br><span class="line"></span><br><span class="line">[root@MyServer ~]&gt; mysql -u root -S /tmp/mysql.sock1 -p -P3306</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 使用-S /tmp/mysql.sock1 进行登录，并输入临时密码后，修改密码，下同</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">[root@MyServer ~]&gt; mysql -u root -S /tmp/mysql.sock2 -p -P3307</span><br><span class="line">[root@MyServer ~]&gt; mysql -u root -S /tmp/mysql.sock3 -p -P3308</span><br><span class="line">[root@MyServer ~]&gt; mysql -u root -S /tmp/mysql.sock4 -p -P3309</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- mysql1</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line">mysql&gt; show variables like "port"; </span><br><span class="line">+<span class="comment">---------------+-------+</span></span><br><span class="line">| Variable_name | Value |</span><br><span class="line">+<span class="comment">---------------+-------+</span></span><br><span class="line">| port          | 3306  |</span><br><span class="line">+<span class="comment">---------------+-------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">show</span> <span class="keyword">variables</span> <span class="keyword">like</span> <span class="string">"socket"</span>;</span><br><span class="line">+<span class="comment">---------------+------------------+</span></span><br><span class="line">| Variable_name | Value            |</span><br><span class="line">+<span class="comment">---------------+------------------+</span></span><br><span class="line">| socket        | /tmp/mysql.sock1 |</span><br><span class="line">+<span class="comment">---------------+------------------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">show</span> <span class="keyword">variables</span> <span class="keyword">like</span> <span class="string">"datadir"</span>;</span><br><span class="line">+<span class="comment">---------------+---------+</span></span><br><span class="line">| Variable_name | Value   |</span><br><span class="line">+<span class="comment">---------------+---------+</span></span><br><span class="line">| datadir       | /data1/ |</span><br><span class="line">+<span class="comment">---------------+---------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- 这样才能进行关闭数据库的操作</span></span><br><span class="line"><span class="comment">-- 和[mysqld_multi]中的user，pass(注意在5.7.9中不是password)对应起来 （类比[client]标签）</span></span><br><span class="line"><span class="comment">-- 一会测试federated链接，需要增加federated参数，并重启mysql2</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line">mysql&gt; <span class="keyword">create</span> <span class="keyword">user</span> <span class="string">'multi_admin'</span>@<span class="string">'localhost'</span> <span class="keyword">identified</span> <span class="keyword">by</span> <span class="string">'123'</span>;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line">mysql&gt; grant shutdown on *.* to 'multi_admin'@'localhost';</span><br><span class="line"></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- mysql2, mysql3, mysql4 类似。可以看到与my.cnf中对应的port和socket</span></span><br><span class="line"><span class="comment">--</span></span><br></pre></td></tr></table></figure>
<h2 id="六-Federated测试"><a href="#六-Federated测试" class="headerlink" title="六. Federated测试"></a>六. Federated测试</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- mysql1 准备数据</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line">mysql&gt; show variables like "port"; </span><br><span class="line">+<span class="comment">---------------+-------+</span></span><br><span class="line">| Variable_name | Value |</span><br><span class="line">+<span class="comment">---------------+-------+</span></span><br><span class="line">| port          | 3306  |   <span class="comment">-- mysql1 实例端口</span></span><br><span class="line">+<span class="comment">---------------+-------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">create</span> <span class="keyword">database</span> burn;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; use burn;</span><br><span class="line">Database changed</span><br><span class="line"></span><br><span class="line">mysql&gt; create table book (</span><br><span class="line">    -&gt; id int not null auto_increment,</span><br><span class="line">    -&gt; name varchar(128) not null,</span><br><span class="line">    -&gt; primary key(id)</span><br><span class="line">    -&gt; );</span><br><span class="line">Query OK, 0 rows affected (0.20 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; insert into book values(1, "book1");</span><br><span class="line">Query OK, 1 row affected (0.02 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from book;</span><br><span class="line">+<span class="comment">----+-------+</span></span><br><span class="line">| id | name  |</span><br><span class="line">+<span class="comment">----+-------+</span></span><br><span class="line">|  1 | book1 |</span><br><span class="line">+<span class="comment">----+-------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">create</span> <span class="keyword">user</span> <span class="string">'burn'</span>@<span class="string">'127.0.0.1'</span> <span class="keyword">identified</span> <span class="keyword">by</span> <span class="string">'123'</span>;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; grant select on burn.* to 'burn'@'127.0.0.1';</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; show grants for 'burn'@'127.0.0.1';</span><br><span class="line">+<span class="comment">------------------------------------------------+</span></span><br><span class="line">| Grants for burn@127.0.0.1                      |</span><br><span class="line">+<span class="comment">------------------------------------------------+</span></span><br><span class="line">| <span class="keyword">GRANT</span> <span class="keyword">USAGE</span> <span class="keyword">ON</span> *.* <span class="keyword">TO</span> <span class="string">'burn'</span>@<span class="string">'127.0.0.1'</span>       |</span><br><span class="line">| <span class="keyword">GRANT</span> <span class="keyword">SELECT</span> <span class="keyword">ON</span> <span class="string">`burn`</span>.* <span class="keyword">TO</span> <span class="string">'burn'</span>@<span class="string">'127.0.0.1'</span> |</span><br><span class="line">+<span class="comment">------------------------------------------------+</span></span><br><span class="line"><span class="number">2</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- mysql2 测试Federated</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line">mysql&gt; show variables like "port";</span><br><span class="line">+<span class="comment">---------------+-------+</span></span><br><span class="line">| Variable_name | Value |</span><br><span class="line">+<span class="comment">---------------+-------+</span></span><br><span class="line">| port          | 3307  |  <span class="comment">-- msyql2 实例端口</span></span><br><span class="line">+<span class="comment">---------------+-------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">show</span> <span class="keyword">engines</span>;</span><br><span class="line">+<span class="comment">--------------------+---------+----------------------------------------------------------------+--------------+------+------------+</span></span><br><span class="line">| Engine             | Support | <span class="keyword">Comment</span>                                                        | Transactions | XA   | Savepoints |</span><br><span class="line">+<span class="comment">--------------------+---------+----------------------------------------------------------------+--------------+------+------------+</span></span><br><span class="line">| MyISAM             | YES     | MyISAM <span class="keyword">storage</span> <span class="keyword">engine</span>                                          | <span class="keyword">NO</span>           | <span class="keyword">NO</span>   | <span class="keyword">NO</span>         |</span><br><span class="line">| CSV                | YES     | CSV <span class="keyword">storage</span> <span class="keyword">engine</span>                                             | <span class="keyword">NO</span>           | <span class="keyword">NO</span>   | <span class="keyword">NO</span>         |</span><br><span class="line">| PERFORMANCE_SCHEMA | YES     | <span class="keyword">Performance</span> <span class="keyword">Schema</span>                                             | <span class="keyword">NO</span>           | <span class="keyword">NO</span>   | <span class="keyword">NO</span>         |</span><br><span class="line">| BLACKHOLE          | YES     | /dev/<span class="literal">null</span> <span class="keyword">storage</span> <span class="keyword">engine</span> (anything you write <span class="keyword">to</span> it disappears) | <span class="keyword">NO</span>           | <span class="keyword">NO</span>   | <span class="keyword">NO</span>         |</span><br><span class="line">| MRG_MYISAM         | YES     | Collection <span class="keyword">of</span> identical MyISAM <span class="keyword">tables</span>                          | <span class="keyword">NO</span>           | <span class="keyword">NO</span>   | <span class="keyword">NO</span>         |</span><br><span class="line">| <span class="keyword">InnoDB</span>             | <span class="keyword">DEFAULT</span> | Supports transactions, <span class="keyword">row</span>-<span class="keyword">level</span> locking, <span class="keyword">and</span> foreign <span class="keyword">keys</span>     | YES          | YES  | YES        |</span><br><span class="line">| <span class="keyword">ARCHIVE</span>            | YES     | <span class="keyword">Archive</span> <span class="keyword">storage</span> <span class="keyword">engine</span>                                         | <span class="keyword">NO</span>           | <span class="keyword">NO</span>   | <span class="keyword">NO</span>         |</span><br><span class="line">| <span class="keyword">MEMORY</span>             | YES     | <span class="keyword">Hash</span> based, <span class="keyword">stored</span> <span class="keyword">in</span> <span class="keyword">memory</span>, useful <span class="keyword">for</span> <span class="keyword">temporary</span> <span class="keyword">tables</span>      | <span class="keyword">NO</span>           | <span class="keyword">NO</span>   | <span class="keyword">NO</span>         |</span><br><span class="line">| FEDERATED          | <span class="keyword">NO</span>      | Federated MySQL <span class="keyword">storage</span> <span class="keyword">engine</span>                                 | <span class="literal">NULL</span>         | <span class="literal">NULL</span> | <span class="literal">NULL</span>       |</span><br><span class="line">+<span class="comment">--------------------+---------+----------------------------------------------------------------+--------------+------+------------+</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- federated 引擎没有打开</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="number">9</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 在[mysqld2]标签下面增加federated</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line">[root@MyServer ~]&gt; cat /etc/my.cnf</span><br><span class="line"><span class="comment"># ... 省略 ...</span></span><br><span class="line">[mysqld2]</span><br><span class="line">federated <span class="comment"># 新增的配置项，表示打开federated引擎</span></span><br><span class="line"><span class="comment"># ... 省略 ...</span></span><br><span class="line">[root@MyServer ~]&gt; mysqld_multi stop 2</span><br><span class="line">[root@MyServer ~]&gt; mysqld_multi start 2   <span class="comment"># 重启配置</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like "port";</span><br><span class="line">+<span class="comment">---------------+-------+</span></span><br><span class="line">| Variable_name | Value |</span><br><span class="line">+<span class="comment">---------------+-------+</span></span><br><span class="line">| port          | 3307  |  <span class="comment">-- msyql2 实例端口</span></span><br><span class="line">+<span class="comment">---------------+-------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.01</span> sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; <span class="keyword">show</span> <span class="keyword">engines</span>;</span><br><span class="line">+<span class="comment">--------------------+---------+----------------------------------------------------------------+--------------+------+------------+</span></span><br><span class="line">| Engine             | Support | <span class="keyword">Comment</span>                                                        | Transactions | XA   | Savepoints |</span><br><span class="line">+<span class="comment">--------------------+---------+----------------------------------------------------------------+--------------+------+------------+</span></span><br><span class="line">| MyISAM             | YES     | MyISAM <span class="keyword">storage</span> <span class="keyword">engine</span>                                          | <span class="keyword">NO</span>           | <span class="keyword">NO</span>   | <span class="keyword">NO</span>         |</span><br><span class="line">| CSV                | YES     | CSV <span class="keyword">storage</span> <span class="keyword">engine</span>                                             | <span class="keyword">NO</span>           | <span class="keyword">NO</span>   | <span class="keyword">NO</span>         |</span><br><span class="line">| PERFORMANCE_SCHEMA | YES     | <span class="keyword">Performance</span> <span class="keyword">Schema</span>                                             | <span class="keyword">NO</span>           | <span class="keyword">NO</span>   | <span class="keyword">NO</span>         |</span><br><span class="line">| BLACKHOLE          | YES     | /dev/<span class="literal">null</span> <span class="keyword">storage</span> <span class="keyword">engine</span> (anything you write <span class="keyword">to</span> it disappears) | <span class="keyword">NO</span>           | <span class="keyword">NO</span>   | <span class="keyword">NO</span>         |</span><br><span class="line">| MRG_MYISAM         | YES     | Collection <span class="keyword">of</span> identical MyISAM <span class="keyword">tables</span>                          | <span class="keyword">NO</span>           | <span class="keyword">NO</span>   | <span class="keyword">NO</span>         |</span><br><span class="line">| <span class="keyword">InnoDB</span>             | <span class="keyword">DEFAULT</span> | Supports transactions, <span class="keyword">row</span>-<span class="keyword">level</span> locking, <span class="keyword">and</span> foreign <span class="keyword">keys</span>     | YES          | YES  | YES        |</span><br><span class="line">| <span class="keyword">ARCHIVE</span>            | YES     | <span class="keyword">Archive</span> <span class="keyword">storage</span> <span class="keyword">engine</span>                                         | <span class="keyword">NO</span>           | <span class="keyword">NO</span>   | <span class="keyword">NO</span>         |</span><br><span class="line">| <span class="keyword">MEMORY</span>             | YES     | <span class="keyword">Hash</span> based, <span class="keyword">stored</span> <span class="keyword">in</span> <span class="keyword">memory</span>, useful <span class="keyword">for</span> <span class="keyword">temporary</span> <span class="keyword">tables</span>      | <span class="keyword">NO</span>           | <span class="keyword">NO</span>   | <span class="keyword">NO</span>         |</span><br><span class="line">| FEDERATED          | YES     | Federated MySQL <span class="keyword">storage</span> <span class="keyword">engine</span>                                 | <span class="keyword">NO</span>           | <span class="keyword">NO</span>   | <span class="keyword">NO</span>         |</span><br><span class="line">+<span class="comment">--------------------+---------+----------------------------------------------------------------+--------------+------+------------+</span></span><br><span class="line"><span class="number">9</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- 显示 federated 已经启用</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line">mysql&gt; <span class="keyword">create</span> <span class="keyword">database</span> federated_test;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; use federated_test;</span><br><span class="line">Database changed</span><br><span class="line"></span><br><span class="line">mysql&gt; create table federated_table_1 (</span><br><span class="line">    -&gt; id int not null auto_increment,</span><br><span class="line">    -&gt; name varchar(128) not null,</span><br><span class="line">    -&gt; primary key(id)</span><br><span class="line">    -&gt; ) engine=federated</span><br><span class="line">    -&gt; connection='mysql://burn:123@127.0.0.1:3306/burn/book';</span><br><span class="line">Query OK, 0 rows affected (0.04 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from federated_table_1;</span><br><span class="line">+<span class="comment">----+-------+</span></span><br><span class="line">| id | name  |</span><br><span class="line">+<span class="comment">----+-------+</span></span><br><span class="line">|  1 | book1 |  <span class="comment">-- 和 mysqld1 上的内容一致。</span></span><br><span class="line">+<span class="comment">----+-------+</span></span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br><span class="line"><span class="comment">--</span></span><br><span class="line"><span class="comment">-- 由于只有select权限，无法对该表进行insert操作</span></span><br><span class="line"><span class="comment">--</span></span><br><span class="line">mysql&gt; <span class="keyword">insert</span> <span class="keyword">into</span>  federated_table_1 <span class="keyword">values</span>(<span class="number">2</span>, <span class="string">"book2"</span>);</span><br><span class="line">ERROR 1296 (HY000): Got error 10000 'Error on remote system: 1142: <span class="keyword">INSERT</span> command denied <span class="keyword">to</span> <span class="keyword">user</span> <span class="string">'burn'</span>@<span class="string">'127.0.0.1'</span> <span class="keyword">for</span> <span class="keyword">table</span> <span class="string">'book'' from FEDERATED</span></span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="http://pic.qqtn.com/up/2017-10/2017101317054482087.jpg"
                alt="陈汶宁" />
            
              <p class="site-author-name" itemprop="name">陈汶宁</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">16</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">5</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">5</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/chenwenning" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="chen2838975464@163.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">陈汶宁</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"droidlover"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    
    <script src="/lib/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  


















  





  

  

  

  
  

  

  

  

</body>
</html>
